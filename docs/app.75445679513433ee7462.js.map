{"version":3,"sources":["webpack://roguelikedev-2021/./src/styles/style.css","webpack://roguelikedev-2021/./src/styles/style.css?ff94","webpack://roguelikedev-2021/./src/js/actions/_Action.js","webpack://roguelikedev-2021/./src/js/actions/UnableToPerformAction.js","webpack://roguelikedev-2021/./src/js/map/fov/_BaseFov.js","webpack://roguelikedev-2021/./src/js/map/fov/FovSlope.js","webpack://roguelikedev-2021/./src/js/map/fov/AdamMilazzoFov.js","webpack://roguelikedev-2021/./src/js/map/fov/SimpleFov.js","webpack://roguelikedev-2021/./src/js/ui/message/SubMessage.js","webpack://roguelikedev-2021/./src/js/ui/message/Message.js","webpack://roguelikedev-2021/./src/js/ui/UIElement.js","webpack://roguelikedev-2021/./src/js/ui/MessageConsole.js","webpack://roguelikedev-2021/./src/js/actions/NoAction.js","webpack://roguelikedev-2021/./src/js/ui/Details.js","webpack://roguelikedev-2021/./src/js/event/_EventHandler.js","webpack://roguelikedev-2021/./src/js/controls/Key.js","webpack://roguelikedev-2021/./src/js/controls/Controls.js","webpack://roguelikedev-2021/./src/js/util/ArrayUtil.js","webpack://roguelikedev-2021/./src/js/components/_Component.js","webpack://roguelikedev-2021/./src/js/components/positionalObject/_PositionalObject.js","webpack://roguelikedev-2021/./src/js/util/Extend.js","webpack://roguelikedev-2021/./src/js/components/positionalObject/SolidObject.js","webpack://roguelikedev-2021/./src/js/components/positionalObject/CharacterObject.js","webpack://roguelikedev-2021/./src/js/components/BlocksMovement.js","webpack://roguelikedev-2021/./src/js/components/Walkable.js","webpack://roguelikedev-2021/./src/js/components/Fov.js","webpack://roguelikedev-2021/./src/js/components/BlocksFov.js","webpack://roguelikedev-2021/./src/js/map/MapLayer.js","webpack://roguelikedev-2021/./src/js/components/Openable.js","webpack://roguelikedev-2021/./src/js/components/VisibilityModifier.js","webpack://roguelikedev-2021/./src/js/components/ai/_AI.js","webpack://roguelikedev-2021/./src/js/components/ai/AIDead.js","webpack://roguelikedev-2021/./src/js/ui/menu/GameOverMenu.js","webpack://roguelikedev-2021/./src/js/event/GameOverEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/CharacterHealth.js","webpack://roguelikedev-2021/./src/js/ui/CharacterMana.js","webpack://roguelikedev-2021/./src/js/ui/Character.js","webpack://roguelikedev-2021/./src/js/components/Fighter.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/_ActionWithDirection.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/MovementAction.js","webpack://roguelikedev-2021/./src/js/actions/WaitAction.js","webpack://roguelikedev-2021/./src/js/actions/WanderAction.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/MeleeAction.js","webpack://roguelikedev-2021/./src/js/pathfinding/BinaryHeap.js","webpack://roguelikedev-2021/./src/js/pathfinding/AStar.js","webpack://roguelikedev-2021/./src/js/pathfinding/GridNode.js","webpack://roguelikedev-2021/./src/js/pathfinding/Graph.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/OpenAction.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/BumpAction.js","webpack://roguelikedev-2021/./src/js/components/ai/AIMeleeChase.js","webpack://roguelikedev-2021/./src/js/components/Faction.js","webpack://roguelikedev-2021/./src/js/components/Remnant.js","webpack://roguelikedev-2021/./src/js/actions/itemAction/ItemAction.js","webpack://roguelikedev-2021/./src/js/components/consumable/_Consumable.js","webpack://roguelikedev-2021/./src/js/components/consumable/HealingConsumable.js","webpack://roguelikedev-2021/./src/js/ui/Inventory.js","webpack://roguelikedev-2021/./src/js/components/Inventory.js","webpack://roguelikedev-2021/./src/js/components/consumable/DamageNearestConsumable.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/_SelectIndexHandler.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/SingleRangedAttackHandler.js","webpack://roguelikedev-2021/./src/js/components/ai/AIConfusedEnemy.js","webpack://roguelikedev-2021/./src/js/components/consumable/ConfusionConsumable.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/AreaRangedAttackHandler.js","webpack://roguelikedev-2021/./src/js/components/consumable/AOEDamageConsumable.js","webpack://roguelikedev-2021/./src/js/components/consumable/ManaConsumable.js","webpack://roguelikedev-2021/./src/js/components/ai/AIGelatinousCube.js","webpack://roguelikedev-2021/./src/js/components/ai/AIPlayer.js","webpack://roguelikedev-2021/./src/js/components/ExplodeOnDeath.js","webpack://roguelikedev-2021/./src/js/components/AttachedItems.js","webpack://roguelikedev-2021/./src/js/components/interactable/_Interactable.js","webpack://roguelikedev-2021/./src/js/components/interactable/StairsInteractable.js","webpack://roguelikedev-2021/./src/js/ui/BottomContainer.js","webpack://roguelikedev-2021/./src/js/components/Level.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/EmptyTileTargetHandler.js","webpack://roguelikedev-2021/./src/js/components/consumable/SummonPortalConsumable.js","webpack://roguelikedev-2021/./src/js/components/interactable/PortalInteractable.js","webpack://roguelikedev-2021/./src/js/components/equipment/EquipmentType.js","webpack://roguelikedev-2021/./src/js/components/equipment/EquipmentSlot.js","webpack://roguelikedev-2021/./src/js/components/equipment/Equipment.js","webpack://roguelikedev-2021/./src/js/components/equipment/Equippable.js","webpack://roguelikedev-2021/./src/js/components/ComponentLoader.js","webpack://roguelikedev-2021/./src/js/entity/_Entity.js","webpack://roguelikedev-2021/./src/js/entity/Tile.js","webpack://roguelikedev-2021/./src/js/entity/Actor.js","webpack://roguelikedev-2021/./src/js/entity/Item.js","webpack://roguelikedev-2021/./src/js/entity/EntityLoader.js","webpack://roguelikedev-2021/./src/js/map/GameMap.js","webpack://roguelikedev-2021/./src/js/map/TutorialMap.js","webpack://roguelikedev-2021/./src/js/map/mapGeneration/ChanceLoader.js","webpack://roguelikedev-2021/./src/js/map/room/RectangularRoom.js","webpack://roguelikedev-2021/./src/js/map/room/_Room.js","webpack://roguelikedev-2021/./src/js/map/mapGeneration/MapGeneration.js","webpack://roguelikedev-2021/./src/js/map/BasicDungeon.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorControls.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorInfo.js","webpack://roguelikedev-2021/./src/js/event/EditorEventHandler.js","webpack://roguelikedev-2021/./src/js/actions/PickupAction.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/LookHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/PauseMenu.js","webpack://roguelikedev-2021/./src/js/SaveManager.js","webpack://roguelikedev-2021/./src/js/ui/menu/LoadGameMenu.js","webpack://roguelikedev-2021/./src/js/event/_MenuEventHandler.js","webpack://roguelikedev-2021/./src/js/event/LoadGameMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/ControlsMenu.js","webpack://roguelikedev-2021/./src/js/event/ControlsMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/SettingsMenu.js","webpack://roguelikedev-2021/./src/js/settings/Settings.js","webpack://roguelikedev-2021/./src/js/event/SettingsMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/CreditsMenu.js","webpack://roguelikedev-2021/./src/js/event/CreditsMenuEventsHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/SaveGameMenu.js","webpack://roguelikedev-2021/./src/js/event/SaveGameMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/event/PauseMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/actions/InteractAction.js","webpack://roguelikedev-2021/./src/js/actions/itemAction/DropFromEquipmentAction.js","webpack://roguelikedev-2021/./src/js/event/DefaultPlayerEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/MainMenu.js","webpack://roguelikedev-2021/./src/js/map/room/Shop.js","webpack://roguelikedev-2021/./src/js/map/room/Forge.js","webpack://roguelikedev-2021/./src/js/map/Town.js","webpack://roguelikedev-2021/./src/js/event/MainMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/map/MapLoader.js","webpack://roguelikedev-2021/./src/js/Engine.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorLayer.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorPaint.js","webpack://roguelikedev-2021/./src/js/SceneState.js","webpack://roguelikedev-2021/./src/js/map/MainMenuMap.js","webpack://roguelikedev-2021/./src/index.js"],"names":["___CSS_LOADER_EXPORT___","push","module","id","Action","constructor","entity","this","perform","console","error","isPlayer","UnableToPerformAction","reason","super","BaseFov","previousVisibleObjects","visibleObjects","visibleActors","visibleItems","oldObjects","newObjects","left","right","top","bottom","teardown","compute","x","y","z","radius","Math","max","min","addVisibleObject","object","indexOf","addVisibleActor","addVisibleItem","remove","newIndex","splice","oldIndex","removeVisible","visibleIndex","visibleItemsIndex","previousVisibleItemsIndex","exploreTile","minZ","maxZ","tilesOnly","tilesIter","entry","tileArrayX","tile","actor","positionalObject","getComponent","item","FovSlope","greater","greaterOrEqual","lessOrEqual","AdamMilazzoFov","octant","computeOctant","originX","originY","originZ","rangeLimit","topY","bottomY","round","blocksLight","ax","wasOpaque","isOpaque","setVisible","nx","ny","wallTiles","wallTile","blocksFov","SimpleFov","minX","maxX","minY","maxY","i","j","SubMessage","text","color","options","bold","italics","isEqual","subMessage","Message","subMessages","count","length","sub1","sub2","getHtml","messageDom","document","createElement","classList","add","subMessageDom","innerText","style","appendChild","getCountHtml","amountDom","UIElement","html","dom","htmlToElement","template","trim","innerHTML","content","firstChild","isOpen","contains","open","close","messages","builder","getElementsByClassName","addEventListener","e","parent","target","parentElement","messagesInnerDom","build","stack","addMessage","slice","clear","lastMessage","updateLastMessageCount","addNewMessage","lastMessageDom","querySelectorAll","NoAction","updatePlayerDetails","updatePositionDetails","getPosition","position","updatePositionOnly","skipPlayer","zStart","tiles","get","name","isVisible","abs","letter","fighter","getHealthDescription","itemLines","line","nearby","isAlive","EventHandler","raycaster","mouse","mouseDown","window","isPlayerTurn","highlightedTiles","removeEventListener","clearHighlights","handleEvent","type","onMouseMove","onMouseDown","onMouseUp","onLeftClick","onRightClick","onChange","onKeydown","handleInput","getMouseIntersectingObjects","clientX","clientY","setFromCamera","intersectObject","scene","isHighlighted","highlightedTile","clearAndSetHighlights","highlight","clearAndSetHighlight","updatePlayer","removeHighlight","self","defaultDelay","lastShiftUp","treatShiftNumpadEqual","keysDown","keysDelayed","defaults","Map","controls","set","load","key","preventDefault","getModifierState","shiftKey","code","startsWith","keyCode","getKey","endsWith","localStorage","getItem","JSON","parse","resetToDefault","save","setItem","stringify","Array","from","entries","setControls","controlsMap","value","keys","val","clone","isPressed","pressed","defaultKeys","forEach","keyToTest","isDelayed","delayed","deleteKey","delay","setTimeout","testPressed","succeeded","ArrayUtil","numRows","array","_Component","args","baseType","parentEntity","cachedSave","clearSaveCache","getDescription","parseRandFloat","defaultValue","returnValue","valueSplit","split","parseFloat","toFixed","parseRandInt","parseInt","parseRandIntBetween","_PositionalObject","hasComponent","components","positionalobject","meshes","highlighted","width","height","depth","scale","opacity","xRot","yRot","zRot","xOffset","yOffset","zOffset","size","actorZOffset","deathAnimation","undefined","transparency","saveJson","Tile","createObject","stop","hasObject","onMapTeardown","resetColor","mesh","material","originalColor","shiftColor","scalar","transparent","multiplyScalar","setTransparency","actualOpacity","getObjectPosition","updateObjectPosition","rotation","PI","visible","fov","explored","move","callEvent","moveTo","updateRotation","updateOffsets","updateZOffset","distance","other","horizontalDistance","isSamePosition","onEntityDeath","finalRotation","random","to","onUpdate","start","Extend","out","arguments","Object","prototype","hasOwnProperty","call","obj","deep","cachedSolidGeometries","SolidObject","solidobject","extend","newDepth","anyFound","geometry","parameters","cachedTextGeometries","fontCache","CharacterObject","characterobject","fontName","centered","characters","has","font","character","createMesh","newHeight","newSize","sameFont","cachedFamilyName","data","familyName","sameSize","cachedSize","cachedHeight","cachedLetter","cachedCentered","curveSegments","bevelEnabled","bevelThickness","bevelSize","bevelOffset","bevelSegments","center","lastAnimation","animateInTween","translateX","translateY","translateZ","rotateX","rotateY","rotateZ","animateIn","animation","startScale","setupAnimation","animations","firstAnimation","newAnimation","chain","time","end","tween","percent","_startTime","_duration","zRotation","BlocksMovement","blocksMovement","Walkable","walkable","Fov","setExplored","BlocksFov","freeze","Floor","Wall","DecorativeBG","Decorative","Openable","openable","openEntity","closedEntity","VisibilityModifier","visibilityModifier","modifier","amount","arg","getVisibility","visibility","AI","onMeleeAttack","blockingActor","stopCombatAnimations","blockingPosition","originalPosition","attackPosition","currentPosition","tweenAttack","tweenReturn","combatTweens","onEntityMove","AIDead","aiDead","previousAI","GameOverEventHandler","returnToMainMenu","MainMenuEventHandler","fgDom","textDom","update","current","strengthDom","damageDom","agilityDom","defenseDom","blockChanceDom","constitutionDom","healthDom","healingBonusDom","wisomDom","manaDom","availableStatPointsDom","levelDom","currentXpDom","neededXpDom","xpFilledDom","populate","player","strength","getDamageDisplay","agility","defense","blockChance","constitution","hp","maxHp","healingBonus","wisdom","mana","maxMana","level","statPointsAvailable","xp","xpForLevel","getPercentXPTowardsLevel","toggle","Fighter","baseStrength","baseDamage","baseAgility","baseDefense","baseConstitution","baseHp","baseWisdom","baseMana","minDamage","maxDamage","recalculateStats","calculateStats","floor","newMax","getMaxHp","newMaxMana","getMaxMana","calculateDamage","calculateDefense","calculateBlockChance","updateUI","equipmentStrength","equipmentAgility","equipmentConstitution","equipmentWisdom","equipment","equippables","getEquippables","equippable","statDamage","equipmentMinDamage","equipmentMaxDamage","statDefense","equipmentDefense","statBlockChance","equipmentBlockChance","getDamage","getBlockedDamage","statHp","equipmentHp","health","statMana","equipmentMana","createDamageIndicator","damage","xRand","yRand","zRand","indicator","easing","onComplete","takeDamage","die","heal","newHp","healedHp","consumeMana","recoverMana","newMana","recoveredMana","ai","aiArgs","removeComponent","newAI","setComponent","description","onComponentsLoaded","onEquipmentChange","ActionWithDirection","dx","dy","dz","MovementAction","destX","destY","destZ","gameMap","isInBounds","ground","tryMoveTo","below","above","getBlockingActorAtLocation","blocksMovementComponent","floorTile","walkableComponent","WaitAction","WanderAction","MeleeAction","entityFighter","blockingFighter","plural","blockingName","attackColor","blockRandom","blockedColor","BinaryHeap","scoreFunction","element","sinkDown","pop","result","bubbleUp","node","rescoreElement","n","parentN","elemScore","isDone","child2N","child1N","child1Score","swap","child1","child2","AStar","curr","path","unshift","f","graph","cleanDirty","heuristicType","heuristic","closest","openHeap","getHeap","closestNode","h","heuristicManhattan","heuristicDiagonal","markDirty","currentNode","pathTo","closed","neighbors","il","neighbor","isWall","gScore","g","getCost","beenVisited","visited","pos0","pos1","D2","sqrt","d1","d2","GridNode","weight","toString","fromNeighbor","Graph","gridIn","nodes","diagonal","grid","row","init","dirtyNodes","cleanNode","ret","graphString","rowDebug","join","OpenAction","BumpAction","tileX","AIMeleeChase","aiMeleeChase","chaseLocation","movementActions","currentMovement","entityPosition","closestEnemies","closestDistance","entityFaction","actorFaction","isEnemyOf","actorPosition","closestEnemy","closestEnemyPosition","fovWidth","fovHeight","cost","fill","map","costGraph","search","lastAction","next","shift","Faction","faction","factions","enemies","setFactions","setEnemies","factionList","enemyList","enemy","otherFaction","Remnant","remnant","isRemnant","ItemAction","targetPosition","consumable","activate","getTargetActor","Consumable","consume","parentStorage","use","getAction","consumer","getConsumer","HealingConsumable","healingConsumable","action","amountHealed","getModifiedAmount","equipmentDom","equipmentSlots","slot","setAttribute","storageWrapDom","goldCountDom","itemTooltipDom","itemDragDom","body","openStorages","itemsOnGround","populateInventory","items","populateSlot","storageItem","openEquipmentStorage","beltItem","openGroundItems","inventory","gold","maxStorage","maxItems","storage","inventoryStorageDom","inventoryStorageTitleDom","inventorySlots","populateItemsAtGround","itemPosition","ceil","getComponentDescriptions","dropAll","goldItem","drop","parentPosition","DamageNearestConsumable","damageNearestConsumable","maxRange","getClosestActor","actualDamage","airActors","actors","consumerPosition","consumerFaction","SelectIndexHandler","resetPosition","initted","selectIndex","exit","DefaultPlayerEventHandler","confirmIndex","moveCamera","obscuredTile","visibleTile","tilesX","intersects","SingleRangedAttackHandler","callback","AIConfusedEnemy","aiConfusedEnemy","turnsRemaining","setTurnsRemaining","turns","ConfusionConsumable","confusionConsumable","AreaRangedAttackHandler","centerIsObscured","centerTile","visibleTiles","AOEDamageConsumable","aoeDamageConsumable","fovHit","targetActors","airFovHit","targetsHit","areaOfEffect","areaOfEffectText","ManaConsumable","manaConsumable","amountRecovered","AIGelatinousCube","performAction","attachedItems","itemsPickedUp","finalPosition","templatePosition","clearItems","AIPlayer","ExplodeOnDeath","explodeOnDeath","AttachedItems","itemJson","index","animateEntity","onAddToScene","onCreateRemnant","remnantPosition","onDestroyRemnant","Interactable","interact","StairsInteractable","stairsInteractable","generator","setPosition","playerPosition","newMap","openCharacter","openSkills","beltSlotsDom","updateAll","updateXp","updateStatPointsIndicator","updateSkillPointsIndicator","updateBeltSlots","skillPointsAvailable","playerEquipment","beltEquippable","beltSlotDom","Level","xpGiven","statPointsPerLevel","skillPointsPerLevel","requiresLevelUp","previousLevelXp","levelXpAdjusted","levelUp","useStatPoint","useSkillPoint","addXp","EmptyTileTargetHandler","SummonPortalConsumable","hasFloorTile","floorTiles","portalInteractable","PortalInteractable","MAIN_HAND","OFF_HAND","BODY","HELMET","GLOVES","SHOULDER","BELT","BOOTS","STORAGE","AMULET","RING","EquipmentSlot","Equipment","equipmentSlot","equipmentItem","fromIndex","toIndex","fromItem","addItem","belt","success","addPartialStacks","addFullStacks","Equippable","lightRadius","damageSplit","storageJson","originalAmount","partialMax","amountToAdd","inventoryItem","amountCanAdd","maxStackSize","setAmount","types","component","create","_Entity","componentArray","loadComponents","json","event","setName","newName","Actor","Item","templates","loadTemplates","parsedJson","extends","loadTemplate","placeholder","npcs","foliage","furniture","amulets","armor","belts","boots","gloves","helmets","misc","potions","rings","scrolls","shields","shoulder","weapons","entities","createFromTemplate","GameMap","timeout","saveCache","create2dArray","clearTimeout","tilesArray","removeEntity","removeActor","removeItem","groundPosition","mapItem","saveData","tileMap","charCode","tileJson","String","fromCharCode","mapKey","tileMapIter","tileMapEntry","actorJson","tileLayer","tilesToLoad","createdActor","createdItem","revealPreviouslyExplored","tileIter","revealFromPosition","_revealGradually","maxRadius","xRadiusMin","xRadiusMax","yRadiusMin","yRadiusMax","xIsEdge","_revealAtPosition","reveal","updateFOV","range","draw","drawItemsInFov","newObjectsRemoved","newObject","fovComponent","actorsRemoved","actorRemnant","itemsRemoved","itemRemnant","visibleObject","oldObject","isActor","xDiff","yDiff","getAliveActorAtLocation","location","aliveActor","isPositionVisible","addPlayer","updatePlayerUI","playerFighter","TutorialMap","wall","overlay","overlayColors","overlayColorIndex","charAt","overlayChar","entityGroups","itemGroups","generators","loadEntityGroups","loadItemGroups","loadGenerator","group","getChancesForLevel","chances","getActorForLevel","actorOrGroup","getRandomFromGroup","actorGroup","getItemForLevel","itemOrGroup","itemGroup","returnChance","totalWeight","chance","currentWeight","rand","RectangularRoom","placeEntities","x1","y1","x2","y2","getCenterX","getCenterY","otherRoom","createRoom","previousFloorTile","isVerticalEdge","isHorizontalEdge","maxMonsters","numMonsters","actorId","placeItems","numItems","itemId","numGoldItems","MapGeneration","cornerX","cornerY","bresenham","startY","endY","bresenhamCreateTiles","startX","endX","createWall","wallEntity","floorEntity","BasicDungeon","maxRooms","roomMinSize","roomMaxSize","maxMonstersByFloor","maxItemsByFloor","getFloorAmount","weights","previousMapName","rooms","roomWidth","roomHeight","newRoom","intersectsOtherRoom","room","centerX","centerY","lastRoom","tunnelBetween","lastRoomCenterX","lastRoomCenterY","addAction","activeAction","setControl","subId","char","active","allActions","parentNode","children","getAttribute","dataMap","entityDom","addData","addDataInput","domElement","label","dataDom","onchange","updateScale","onblur","setData","tagName","setDataForEntity","EditorEventHandler","selectedEntity","clearSelected","parentObject","removeEntityFromMouseEvent","PickupAction","entityInventory","itemsToPickup","anyGoldPickedUp","entityEquipment","LookHandler","saveName","autosaveTurnCounter","loadSaves","getCurrentSaveName","saveSaves","delete","saveToDelete","saves","autosave","settings","autosavesEnabled","autosaveTurns","lastAutosave","getLastAutosave","autosaveAmount","setLastAutosave","Date","oldSavesDom","saveElement","formatDate","date","formatTime","formatted","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","MenuEventHandler","eventHandler","previousEventHandler","returnToPreviousMenu","LoadGameMenuEventHandler","ControlsMenuEventHandler","isEditingKey","editingDom","tempValue","tempControls","populateControls","saveAndExit","cancel","resetControls","newKey","blur","setKey","populateControl","keyName","primaryKey","getElementById","secondaryKey","showStats","messageConsolePosition","displayFPS","debugControlsEnabled","toSave","SettingsMenuEventHandler","tempSettings","populateSettings","checked","applyDisplayFPS","applyAutosavesEnabled","newSaveAmount","newTurnsAmount","applyAllSettings","autosaveAmountInput","autosaveTurnsInput","removeAttribute","CreditsMenuEventsHandler","overwriteDom","SaveGameMenuEventHandler","overwriteName","newSaveName","PauseMenuEventHandler","openSaveGameMenu","openLoadGameMenu","openControlsMenu","openSettingsMenu","openCreditsMenu","quit","InteractAction","wallInteractable","floorInteractable","DropFromEquipmentAction","hideItemTooltip","attemptToDrag","dragDistance","dragStart","startDragging","isDragging","dragOffset","hoveringOver","cloneNode","updateToolTipSize","slotDragging","tooltipRect","sourceSlot","sourceItem","sourceStorage","parentClasses","targetRect","getBoundingClientRect","sourceIsGround","sourceIsInventorySlot","sourceIsEquipmentSlot","targetIsGround","targetIsInventorySlot","targetIsEquipmentSlot","targetSlot","fromEquippable","targetItem","targetStorage","storageEquippable","sourceStorageItem","sourceStorageEquippable","targetStorageItem","targetStorageEquippable","Shop","walls","randWall","npc","Forge","isRightHalf","isBottomHalf","Town","jStart","jEnd","jStartRandom","jEndRandom","createTree","randomGrass","absI","absJ","startNewGame","MapLoader","loadMap","mapType","engine","gameMaps","mapLoader","needsMapUpdate","airFov","setEventHandler","handleEvents","processAction","performedAction","handleEnemyTurns","setMap","playerIndex","addMap","clearMaps","maps","values","loadData","currentMap","setupGameHtml","setupLights","updateCamera","gameDom","canvasDom","renderer","antialias","alpha","setClearColor","stats","showPanel","updateStatsVisibility","updateCameraPosition","ambientLight","dirLight","aspectRatio","offsetWidth","offsetHeight","camera","viewSize","setSize","lookAt","up","MainMenuMap","updateRender","playerVisibility","tileAtPlayer","isFovNew"],"mappings":"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","file":"app.75445679513433ee7462.js","sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"* {\\n    box-sizing: border-box;\\n}\\n\\nbody {\\n    margin: 0 auto;\\n    overflow: hidden;\\n    width: 100vw;\\n    height: 100vh;\\n    font-size: 1.2vh;\\n}\\n\\nbody.disable-select * {\\n    user-select: none;\\n}\\n\\n.ui {\\n    display: block;\\n    z-index: -1000 !important;\\n    opacity: 0;\\n    pointer-events: none;\\n}\\n\\n.ui.active {\\n    z-index: 0 !important;\\n    opacity: 1;\\n    pointer-events: all;\\n}\\n\\n.menu {\\n    position: fixed;\\n    left: 5%;\\n    top: 5%;\\n    background-color: #000;\\n    min-width: 20%;\\n    max-width: 30%;\\n    text-align: center;\\n    padding: 0.5vh 2.5vh 4vh;\\n    border-radius: 15px 0;\\n    color: #eee;\\n}\\n\\n.menu--full {\\n    left: 10%;\\n    right: 10%;\\n    max-width: none;\\n}\\n\\n.menu hr {\\n    margin: 1.5vh 0;\\n}\\n\\n.menu.active {\\n    background-color: rgba(0, 0, 0, .7);\\n}\\n\\n.menu__title {\\n    font-size: 5vh;\\n    color: #fff;\\n    margin: 0 0 1.5vh;\\n    font-family: Georgia, serif;\\n}\\n\\n.menu__action {\\n    margin: 0 auto;\\n    display: block;\\n    width: 75%;\\n    font-family: Lucida Console, serif;\\n    font-size: 1.8vh;\\n    padding: .5vh;\\n}\\n\\n.menu__action--cancel {\\n    background-color: #f33;\\n}\\n\\n.menu__action--cancel:hover {\\n    background-color: #f11;\\n}\\n\\n.menu__action--confirm {\\n    background-color: #3f3;\\n}\\n\\n.menu__action--confirm:hover {\\n    background-color: #3c3;\\n}\\n\\n.menu__action + .menu__action {\\n    margin-top: 15px;\\n}\\n\\n.menu--full .menu__action {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.menu--full .menu__action + .menu__action {\\n    margin-top: 0;\\n    margin-left: 15px;\\n}\\n\\n#editor-controls {\\n    position: fixed;\\n    top: 50px;\\n    right: 50px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-controls__action {\\n    display: block;\\n    padding: 5px 0;\\n    background-color: #ccc;\\n    font-size: 20px;\\n    text-align: center;\\n    width: 45px;\\n}\\n\\n.editor-controls__action.active {\\n    border-style: inset;\\n}\\n\\n#editor-info {\\n    position: fixed;\\n    top: 50px;\\n    right: 200px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-info__component {\\n    border: 1px solid #999;\\n    padding: 5px;\\n    background-color: #ccc;\\n    display: none;\\n}\\n\\n.editor-info__component.active {\\n    display: block;\\n}\\n\\n.editor-info__component + .editor-info__component {\\n    border-top: 0;\\n}\\n\\n.editor-info__label {\\n    font-weight: bold;\\n    text-transform: capitalize;\\n}\\n\\n.game {\\n    width: 100vw;\\n    height: 100vh;\\n}\\n\\n.view {\\n    display: block;\\n    float: left;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.details {\\n    padding: 10px 15px;\\n    font-size: 2vh;\\n    display: block;\\n    width: 20%;\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    background-color: #ddd;\\n}\\n\\n\\n.details__header {\\n    margin-top: 20px;\\n}\\n.details__line {\\n    display: block;\\n}\\n\\n.console {\\n    background-color: #eee;\\n    transform: translate(0, 0);\\n    position: fixed;\\n    left: 0;\\n    right: 0;\\n    width: 45%;\\n    margin: 0 auto;\\n    height: 12.25%;\\n    bottom: 8%;\\n}\\n\\n.console.active {\\n    opacity: .95;\\n}\\n\\n.console.animate {\\n    transition: all 1s ease;\\n}\\n\\n.console.full {\\n    transform: translate(0, -10%);\\n    height: 80%;\\n}\\n\\n.console.active.full {\\n    opacity: 1;\\n}\\n\\n.console.collapsed {\\n    height: 4.5%;\\n}\\n\\n.console__button {\\n    position: absolute;\\n    top: 0;\\n    z-index: 100;\\n    opacity: 1;\\n}\\n\\n.console__increase {\\n    right: 40px;\\n}\\n\\n.console.full .console__increase {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.console__decrease {\\n    right: 64px;\\n}\\n\\n.console.collapsed .console__decrease {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.messages__wrap {\\n    position: absolute;\\n    opacity: 1;\\n    padding: 5px;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.messages {\\n    display:flex;\\n    flex-direction:column-reverse;\\n    height: 100%;\\n    overflow-y: scroll;\\n}\\n\\n.messages__inn {\\n\\n}\\n\\n.message {\\n    font-size: 1.66vh;\\n    text-shadow: 1px 1px 0 #888;\\n}\\n\\n.message__text {\\n\\n}\\n\\n.message__bold {\\n    font-weight: bold;\\n}\\n\\n.message__italics {\\n    font-style: italic;\\n}\\n\\n.message__amount {\\n    margin-left: 1em;\\n}\\n\\n.character-info {\\n    font-family: Arial, serif;\\n    font-weight: bold;\\n    font-size: 15vh;\\n    text-align: center;\\n}\\n#character-health {\\n    color: #c00;\\n}\\n\\n#character-mana {\\n    color: #00c;\\n}\\n\\n.character-info__wrap {\\n    position: absolute;\\n    top: 5%;\\n    bottom: 5%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n#character-mana .character-info__wrap {\\n    transform: rotate(180deg);\\n}\\n\\n.character-info__bg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 10;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-health .character-info__bg {\\n    color: #ffe0e0;\\n}\\n\\n.character-info__fg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 20;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-mana .character-info__bg,\\n#character-mana .character-info__fg {\\n    bottom: -15%;\\n    font-size: 18.75vh;\\n}\\n\\n#character-mana .character-info__fg {\\n    color: #e0e0ff;\\n}\\n\\n.character-info__text {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    font-size: 3vh;\\n    color: #000;\\n    z-index: 30;\\n    text-shadow: 1px 1px 3px #eee;\\n}\\n\\n#character-health .character-info__text {\\n    top: 38%;\\n    bottom: 0;\\n}\\n\\n#character-mana .character-info__text {\\n    transform: rotate(180deg);\\n    top: 0;\\n    bottom: 38%;\\n}\\n\\n.inventory {\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.inventory.active {\\n    transform: translateX(0);\\n}\\n\\n.inventory__equipment {\\n    width: 100%;\\n    height: 55%;\\n    display: grid;\\n    grid-template-columns: repeat(3, minmax(0, 1fr));\\n    grid-template-rows: repeat(4, minmax(0, 1fr));\\n    background-color: #333;\\n    grid-gap: 0.2vw;\\n    padding: 1vh 7.5vh\\n}\\n\\n.inventory__storage-wrap {\\n    width: 100%;\\n    height: 40%;\\n    background-color: #333;\\n    position: relative;\\n    overflow-y: auto;\\n}\\n\\n.inventory__storage {\\n    width: 100%;\\n    display: grid;\\n    grid-template-columns: repeat(10, minmax(0, 1fr));\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.inventory__storage-title {\\n    grid-column: span 10;\\n    padding: 5px;\\n    background-color: #ccc;\\n    font-size: 1.8vh;\\n}\\n\\n.slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n    position: relative;\\n    font-family: helvetica, serif;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot .item {\\n    font-size: 7.5vh;\\n}\\n\\n.inventory__equipment-slot:before {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    right: 0;\\n    bottom: 0;\\n    width: 100%;\\n    height: 100%;\\n    font-size: 7.5vh;\\n    opacity: 0.15;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot.has-item:before {\\n    display: none;\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"0\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"1\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"2\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"3\\\"]:before {\\n    content: \\\"\\\";\\n    transform: rotate(180deg);\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"4\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"5\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"6\\\"]:before,\\n.inventory__equipment-slot[data-index=\\\"8\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"7\\\"]:before {\\n    content: \\\"-\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"9\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"10\\\"]:before {\\n    content: \\\"\\\";\\n}\\n.inventory__equipment-slot[data-index=\\\"11\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__storage-slot {\\n    height: 5.3vh;\\n}\\n\\n.slot.has-item:hover {\\n    cursor: pointer;\\n    background-color: #999;\\n}\\n\\n.slot.disabled {\\n    background-color: #845b5b;\\n}\\n\\n.slot.dragging .item {\\n    display: none;\\n}\\n\\n.character {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(-100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.character.active {\\n    transform: translateX(0);\\n}\\n\\n.character__title {\\n    text-align: center;\\n    font-weight: bold;\\n    margin-top: 0;\\n    margin-bottom: 40px;\\n    text-transform: uppercase;\\n    font-family: Arial, serif;\\n    font-size: 3vh;\\n}\\n\\n.character__xp {\\n    width: 80%;\\n    margin: 0 auto 40px;\\n}\\n\\n.item {\\n    font-family: helvetica, serif;\\n    pointer-events: none;\\n    position: relative;\\n    font-size: 4.5vh;\\n    user-select: none;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n    width: 100%;\\n}\\n\\n.item__icon {\\n\\n}\\n\\n.item__amount {\\n    position: absolute;\\n    right: 5%;\\n    bottom: 5%;\\n    font-size: 1.1vw;\\n    color: #fff;\\n    line-height: 0.7vw;\\n}\\n\\n.item__details {\\n    display: none;\\n}\\n\\n.item__tooltip .item__details {\\n    display: block;\\n}\\n\\n.item__details-line  {\\n    display: block;\\n}\\n\\n.item__details-line span {\\n    font-weight: bold;\\n}\\n\\n.inventory__golddisplay {\\n    width: 100%;\\n    height: 5%;\\n    font-size: 1.5vw;\\n    padding: 1%;\\n}\\n\\n.item__tooltip {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    background: #ccc;\\n    padding: 5px 10px;\\n    border-radius: 5px;\\n    max-width: 30%;\\n    font-size: 1.5vh;\\n    pointer-events: none;\\n}\\n\\n.item__tooltip.active {\\n    display: block;\\n}\\n\\n.item__drag {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    text-align: center;\\n    pointer-events: none;\\n}\\n\\n.item__drag.active {\\n    display: block;\\n}\\n\\n.item__name {\\n    font-weight: bold;\\n    font-size: 2.5vh;\\n}\\n\\n.item__description {\\n    font-style: italic;\\n}\\n\\n\\n.savegame__overwrite {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 100%;\\n    height: 100%;\\n    background-color: #000;\\n    display: none;\\n    pointer-events: none;\\n    padding: 15px;\\n    border-radius: 15px 0;\\n}\\n\\n.savegame__overwrite.active {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.savegame__overwrite-title {\\n    color: #fff;\\n    font-size: 3vh;\\n}\\n\\n.savegame__oldsaves,\\n.loadgame__oldsaves {\\n    margin-bottom: 15px;\\n}\\n\\n.savegame__newsave-input {\\n    font-size: 2.2vh;\\n    display: inline-block;\\n    float: left;\\n    margin-right: 1vh;\\n}\\n\\n.save {\\n    text-align: left;\\n    position: relative;\\n    font-size: 2vh;\\n    font-weight: bold;\\n}\\n\\n.save label {\\n    font-family: Lucida Console, serif;\\n    display: block;\\n}\\n\\n.save + .save {\\n    margin-top: 1vh;\\n}\\n\\n.save__title,\\n.save__delete {\\n    font-size: 2vh;\\n}\\n.save__title {\\n    width: 80%;\\n    display: inline-grid;\\n    grid-template-columns: 2fr 1fr;\\n}\\n\\n.save__text {\\n    grid-column: 1;\\n    grid-row: 1 / span 2;\\n    pointer-events: none;\\n}\\n\\n.save__date,\\n.save__time {\\n    font-size: 1.2vh;\\n    grid-column: 2;\\n    text-align: right;\\n    pointer-events: none;\\n}\\n\\n.save__date {\\n    grid-row: 1;\\n}\\n\\n.save__time {\\n    grid-row: 2;\\n}\\n\\n.save__delete {\\n    width: 10%;\\n    background-color: #f66;\\n    font-size: 3.6vh;\\n    line-height: 2.9vh;\\n    font-weight: bold;\\n    float: right;\\n}\\n\\n.save__confirm {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.credits {\\n    font-size: 5vh;\\n    width: 100%;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n    max-width: 100%;\\n    border-radius: 0;\\n}\\n\\n.credits .menu__content {\\n    transform: translateY(30%);\\n}\\n\\n.credits.active .menu__content {\\n    transform: translateY(-100%);\\n    transition: all 30s linear;\\n}\\n\\n.credits__title {\\n    font-size: 15vh;\\n    margin: 0;\\n}\\n\\n.credits__section {\\n    padding: 15vh;\\n}\\n\\n.settings input[type=checkbox] {\\n    width: 2vh;\\n    height: 2vh;\\n}\\n\\n.settings input[type=number] {\\n    min-width: 55px;\\n    width: 4.5vh;\\n}\\n\\n.settings .menu__actions,\\n.controls .menu__actions {\\n    margin-top: 3vh;\\n}\\n\\n.controls label {\\n    text-align: right;\\n    padding-right: 25px;\\n}\\n\\n.settings__section,\\n.controls__section {\\n    text-align: left;\\n    font-size: 2vh;\\n}\\n\\n.settings__section-title,\\n.controls__section-title {\\n    font-size: 3vh;\\n    margin-top: 0;\\n    margin-bottom: .5vh;\\n    text-decoration: underline;\\n}\\n\\n.settings__section + .settings__section,\\n.controls__section + .controls__section {\\n    padding-top: 15px;\\n    margin-top: 15px;\\n}\\n\\n.settings__section-inn,\\n.controls__section-inn{\\n    padding: 0 15px;\\n}\\n\\n.control {\\n    display: grid;\\n    grid-template-columns: 1.3fr 1fr 1fr;\\n}\\n\\n.controls__section {\\n    display: inline-block;\\n    width: 47%;\\n    margin-right: 2%;\\n}\\n\\n.controls__section-inn {\\n    display: grid;\\n}\\n\\n.stat__group {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    margin-top: 10px;\\n}\\n\\n.stat {\\n    display: grid;\\n    grid-template-columns: 4fr 2fr 1fr;\\n    text-align: center;\\n    width: 97%;\\n}\\n\\n.attribute {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    text-align: center;\\n}\\n\\n.stat__title,\\n.stat__text,\\n.attribute__title,\\n.attribute__value {\\n    border: 2px solid #000;\\n    padding: 5px;\\n}\\n\\n.attribute + .attribute .attribute__title,\\n.attribute + .attribute .attribute__value{\\n    border-top: 0;\\n}\\n\\n.stat__text,\\n.attribute__value {\\n    border-left: 0;\\n}\\n\\n.stat__title {\\n    text-transform: uppercase;\\n    font-weight: bold;\\n}\\n.stat__text {\\n    margin-right: 7px;\\n}\\n\\n.stat__level {\\n    display: none;\\n    pointer-events: none;\\n    background-color: #3a3;\\n    color: #fff;\\n    font-weight: bold;\\n}\\n\\n.character.has-statpoint .stat__level {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.available-stats {\\n    display: none;\\n    text-align: center;\\n    margin: 20px 0;\\n}\\n\\n.character.has-statpoint .available-stats {\\n    display: block;\\n}\\n\\n.available-stats__inn {\\n    border: 1px solid #000;\\n    display: inline-block;\\n    padding: 10px;\\n}\\n\\n.available-stats__value {\\n    margin-right: 10px;\\n}\\n\\n.character__xp-text {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n}\\n\\n.character__xp-value {\\n    text-align: right;\\n}\\n\\n.character__xp-bar {\\n    width: 100%;\\n    height: 20px;\\n    background: repeating-linear-gradient(to right, #ddd, #ddd 10%, #eee 10%, #eee 20%);\\n    position: relative;\\n    border: 2px solid #333;\\n}\\n\\n.bottom-container .character__xp-bar{\\n    position: absolute;\\n    bottom: 32%;\\n    height: 8%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n.character__xp-filled {\\n    background-color: rgba(210, 210, 0, .6);\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n}\\n\\n.bottom-container {\\n    position: fixed;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 75%;\\n    height: 20%;\\n    display: grid;\\n    grid-template-columns: 1fr 3fr 1fr;\\n    margin: 0 auto;\\n}\\n\\n.bottom-container__left,\\n.bottom-container__center,\\n.bottom-container__right {\\n    position: relative;\\n}\\n\\n.hotbar {\\n    position: absolute;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 100%;\\n    height: 32%;\\n    display: grid;\\n    grid-template-columns: 4.5fr 1fr 4.5fr;\\n    background-color: #333;\\n}\\n\\n.spell-slots,\\n.belt-slots {\\n    display: grid;\\n    width: 100%;\\n    height: 100%;\\n    grid-template-columns: repeat(6, 1fr);\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.spell-slot,\\n.belt-slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n}\\n\\n.spell-slot + .spell-slot,\\n.belt-slot + .belt-slot {\\n    border-left: 0;\\n}\\n\\n.hotbar__controls {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    grid-template-rows: 35% 65%;\\n    padding: 0.4vh 0 0.6vh;\\n    grid-gap: 0.2vh;\\n}\\n\\n.hotbar__controls button {\\n    width: 100%;\\n    height: 100%;\\n    border-radius: 0;\\n    font-weight: bold;\\n    text-transform: uppercase;\\n    line-height: 0;\\n}\\n\\n.hotbar-inventory,\\n.hotbar-character,\\n.hotbar-skills {\\n    width: 100%;\\n    height: 100%;\\n}\\n.hotbar-inventory {\\n    grid-row: 1;\\n    grid-column: span 2;\\n}\\n.hotbar-character {\\n    grid-row: 2;\\n    grid-column: 1;\\n}\\n.hotbar__open-character.has-statpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n.hotbar-skills {\\n    grid-row: 2;\\n    grid-column: 2;\\n}\\n.hotbar__open-skill.has-skillpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n\\n.pickup-slot {\\n    height: 5.3vh;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/styles/style.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"* {\\n    box-sizing: border-box;\\n}\\n\\nbody {\\n    margin: 0 auto;\\n    overflow: hidden;\\n    width: 100vw;\\n    height: 100vh;\\n    font-size: 1.2vh;\\n}\\n\\nbody.disable-select * {\\n    user-select: none;\\n}\\n\\n.ui {\\n    display: block;\\n    z-index: -1000 !important;\\n    opacity: 0;\\n    pointer-events: none;\\n}\\n\\n.ui.active {\\n    z-index: 0 !important;\\n    opacity: 1;\\n    pointer-events: all;\\n}\\n\\n.menu {\\n    position: fixed;\\n    left: 5%;\\n    top: 5%;\\n    background-color: #000;\\n    min-width: 20%;\\n    max-width: 30%;\\n    text-align: center;\\n    padding: 0.5vh 2.5vh 4vh;\\n    border-radius: 15px 0;\\n    color: #eee;\\n}\\n\\n.menu--full {\\n    left: 10%;\\n    right: 10%;\\n    max-width: none;\\n}\\n\\n.menu hr {\\n    margin: 1.5vh 0;\\n}\\n\\n.menu.active {\\n    background-color: rgba(0, 0, 0, .7);\\n}\\n\\n.menu__title {\\n    font-size: 5vh;\\n    color: #fff;\\n    margin: 0 0 1.5vh;\\n    font-family: Georgia, serif;\\n}\\n\\n.menu__action {\\n    margin: 0 auto;\\n    display: block;\\n    width: 75%;\\n    font-family: Lucida Console, serif;\\n    font-size: 1.8vh;\\n    padding: .5vh;\\n}\\n\\n.menu__action--cancel {\\n    background-color: #f33;\\n}\\n\\n.menu__action--cancel:hover {\\n    background-color: #f11;\\n}\\n\\n.menu__action--confirm {\\n    background-color: #3f3;\\n}\\n\\n.menu__action--confirm:hover {\\n    background-color: #3c3;\\n}\\n\\n.menu__action + .menu__action {\\n    margin-top: 15px;\\n}\\n\\n.menu--full .menu__action {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.menu--full .menu__action + .menu__action {\\n    margin-top: 0;\\n    margin-left: 15px;\\n}\\n\\n#editor-controls {\\n    position: fixed;\\n    top: 50px;\\n    right: 50px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-controls__action {\\n    display: block;\\n    padding: 5px 0;\\n    background-color: #ccc;\\n    font-size: 20px;\\n    text-align: center;\\n    width: 45px;\\n}\\n\\n.editor-controls__action.active {\\n    border-style: inset;\\n}\\n\\n#editor-info {\\n    position: fixed;\\n    top: 50px;\\n    right: 200px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-info__component {\\n    border: 1px solid #999;\\n    padding: 5px;\\n    background-color: #ccc;\\n    display: none;\\n}\\n\\n.editor-info__component.active {\\n    display: block;\\n}\\n\\n.editor-info__component + .editor-info__component {\\n    border-top: 0;\\n}\\n\\n.editor-info__label {\\n    font-weight: bold;\\n    text-transform: capitalize;\\n}\\n\\n.game {\\n    width: 100vw;\\n    height: 100vh;\\n}\\n\\n.view {\\n    display: block;\\n    float: left;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.details {\\n    padding: 10px 15px;\\n    font-size: 2vh;\\n    display: block;\\n    width: 20%;\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    background-color: #ddd;\\n}\\n\\n\\n.details__header {\\n    margin-top: 20px;\\n}\\n.details__line {\\n    display: block;\\n}\\n\\n.console {\\n    background-color: #eee;\\n    transform: translate(0, 0);\\n    position: fixed;\\n    left: 0;\\n    right: 0;\\n    width: 45%;\\n    margin: 0 auto;\\n    height: 12.25%;\\n    bottom: 8%;\\n}\\n\\n.console.active {\\n    opacity: .95;\\n}\\n\\n.console.animate {\\n    transition: all 1s ease;\\n}\\n\\n.console.full {\\n    transform: translate(0, -10%);\\n    height: 80%;\\n}\\n\\n.console.active.full {\\n    opacity: 1;\\n}\\n\\n.console.collapsed {\\n    height: 4.5%;\\n}\\n\\n.console__button {\\n    position: absolute;\\n    top: 0;\\n    z-index: 100;\\n    opacity: 1;\\n}\\n\\n.console__increase {\\n    right: 40px;\\n}\\n\\n.console.full .console__increase {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.console__decrease {\\n    right: 64px;\\n}\\n\\n.console.collapsed .console__decrease {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.messages__wrap {\\n    position: absolute;\\n    opacity: 1;\\n    padding: 5px;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.messages {\\n    display:flex;\\n    flex-direction:column-reverse;\\n    height: 100%;\\n    overflow-y: scroll;\\n}\\n\\n.messages__inn {\\n\\n}\\n\\n.message {\\n    font-size: 1.66vh;\\n    text-shadow: 1px 1px 0 #888;\\n}\\n\\n.message__text {\\n\\n}\\n\\n.message__bold {\\n    font-weight: bold;\\n}\\n\\n.message__italics {\\n    font-style: italic;\\n}\\n\\n.message__amount {\\n    margin-left: 1em;\\n}\\n\\n.character-info {\\n    font-family: Arial, serif;\\n    font-weight: bold;\\n    font-size: 15vh;\\n    text-align: center;\\n}\\n#character-health {\\n    color: #c00;\\n}\\n\\n#character-mana {\\n    color: #00c;\\n}\\n\\n.character-info__wrap {\\n    position: absolute;\\n    top: 5%;\\n    bottom: 5%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n#character-mana .character-info__wrap {\\n    transform: rotate(180deg);\\n}\\n\\n.character-info__bg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 10;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-health .character-info__bg {\\n    color: #ffe0e0;\\n}\\n\\n.character-info__fg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 20;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-mana .character-info__bg,\\n#character-mana .character-info__fg {\\n    bottom: -15%;\\n    font-size: 18.75vh;\\n}\\n\\n#character-mana .character-info__fg {\\n    color: #e0e0ff;\\n}\\n\\n.character-info__text {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    font-size: 3vh;\\n    color: #000;\\n    z-index: 30;\\n    text-shadow: 1px 1px 3px #eee;\\n}\\n\\n#character-health .character-info__text {\\n    top: 38%;\\n    bottom: 0;\\n}\\n\\n#character-mana .character-info__text {\\n    transform: rotate(180deg);\\n    top: 0;\\n    bottom: 38%;\\n}\\n\\n.inventory {\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.inventory.active {\\n    transform: translateX(0);\\n}\\n\\n.inventory__equipment {\\n    width: 100%;\\n    height: 55%;\\n    display: grid;\\n    grid-template-columns: repeat(3, minmax(0, 1fr));\\n    grid-template-rows: repeat(4, minmax(0, 1fr));\\n    background-color: #333;\\n    grid-gap: 0.2vw;\\n    padding: 1vh 7.5vh\\n}\\n\\n.inventory__storage-wrap {\\n    width: 100%;\\n    height: 40%;\\n    background-color: #333;\\n    position: relative;\\n    overflow-y: auto;\\n}\\n\\n.inventory__storage {\\n    width: 100%;\\n    display: grid;\\n    grid-template-columns: repeat(10, minmax(0, 1fr));\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.inventory__storage-title {\\n    grid-column: span 10;\\n    padding: 5px;\\n    background-color: #ccc;\\n    font-size: 1.8vh;\\n}\\n\\n.slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n    position: relative;\\n    font-family: helvetica, serif;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot .item {\\n    font-size: 7.5vh;\\n}\\n\\n.inventory__equipment-slot:before {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    right: 0;\\n    bottom: 0;\\n    width: 100%;\\n    height: 100%;\\n    font-size: 7.5vh;\\n    opacity: 0.15;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot.has-item:before {\\n    display: none;\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"0\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"1\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"2\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"3\\\"]:before {\\n    content: \\\"\\\";\\n    transform: rotate(180deg);\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"4\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"5\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"6\\\"]:before,\\n.inventory__equipment-slot[data-index=\\\"8\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"7\\\"]:before {\\n    content: \\\"-\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"9\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"10\\\"]:before {\\n    content: \\\"\\\";\\n}\\n.inventory__equipment-slot[data-index=\\\"11\\\"]:before {\\n    content: \\\"\\\";\\n}\\n\\n.inventory__storage-slot {\\n    height: 5.3vh;\\n}\\n\\n.slot.has-item:hover {\\n    cursor: pointer;\\n    background-color: #999;\\n}\\n\\n.slot.disabled {\\n    background-color: #845b5b;\\n}\\n\\n.slot.dragging .item {\\n    display: none;\\n}\\n\\n.character {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(-100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.character.active {\\n    transform: translateX(0);\\n}\\n\\n.character__title {\\n    text-align: center;\\n    font-weight: bold;\\n    margin-top: 0;\\n    margin-bottom: 40px;\\n    text-transform: uppercase;\\n    font-family: Arial, serif;\\n    font-size: 3vh;\\n}\\n\\n.character__xp {\\n    width: 80%;\\n    margin: 0 auto 40px;\\n}\\n\\n.item {\\n    font-family: helvetica, serif;\\n    pointer-events: none;\\n    position: relative;\\n    font-size: 4.5vh;\\n    user-select: none;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n    width: 100%;\\n}\\n\\n.item__icon {\\n\\n}\\n\\n.item__amount {\\n    position: absolute;\\n    right: 5%;\\n    bottom: 5%;\\n    font-size: 1.1vw;\\n    color: #fff;\\n    line-height: 0.7vw;\\n}\\n\\n.item__details {\\n    display: none;\\n}\\n\\n.item__tooltip .item__details {\\n    display: block;\\n}\\n\\n.item__details-line  {\\n    display: block;\\n}\\n\\n.item__details-line span {\\n    font-weight: bold;\\n}\\n\\n.inventory__golddisplay {\\n    width: 100%;\\n    height: 5%;\\n    font-size: 1.5vw;\\n    padding: 1%;\\n}\\n\\n.item__tooltip {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    background: #ccc;\\n    padding: 5px 10px;\\n    border-radius: 5px;\\n    max-width: 30%;\\n    font-size: 1.5vh;\\n    pointer-events: none;\\n}\\n\\n.item__tooltip.active {\\n    display: block;\\n}\\n\\n.item__drag {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    text-align: center;\\n    pointer-events: none;\\n}\\n\\n.item__drag.active {\\n    display: block;\\n}\\n\\n.item__name {\\n    font-weight: bold;\\n    font-size: 2.5vh;\\n}\\n\\n.item__description {\\n    font-style: italic;\\n}\\n\\n\\n.savegame__overwrite {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 100%;\\n    height: 100%;\\n    background-color: #000;\\n    display: none;\\n    pointer-events: none;\\n    padding: 15px;\\n    border-radius: 15px 0;\\n}\\n\\n.savegame__overwrite.active {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.savegame__overwrite-title {\\n    color: #fff;\\n    font-size: 3vh;\\n}\\n\\n.savegame__oldsaves,\\n.loadgame__oldsaves {\\n    margin-bottom: 15px;\\n}\\n\\n.savegame__newsave-input {\\n    font-size: 2.2vh;\\n    display: inline-block;\\n    float: left;\\n    margin-right: 1vh;\\n}\\n\\n.save {\\n    text-align: left;\\n    position: relative;\\n    font-size: 2vh;\\n    font-weight: bold;\\n}\\n\\n.save label {\\n    font-family: Lucida Console, serif;\\n    display: block;\\n}\\n\\n.save + .save {\\n    margin-top: 1vh;\\n}\\n\\n.save__title,\\n.save__delete {\\n    font-size: 2vh;\\n}\\n.save__title {\\n    width: 80%;\\n    display: inline-grid;\\n    grid-template-columns: 2fr 1fr;\\n}\\n\\n.save__text {\\n    grid-column: 1;\\n    grid-row: 1 / span 2;\\n    pointer-events: none;\\n}\\n\\n.save__date,\\n.save__time {\\n    font-size: 1.2vh;\\n    grid-column: 2;\\n    text-align: right;\\n    pointer-events: none;\\n}\\n\\n.save__date {\\n    grid-row: 1;\\n}\\n\\n.save__time {\\n    grid-row: 2;\\n}\\n\\n.save__delete {\\n    width: 10%;\\n    background-color: #f66;\\n    font-size: 3.6vh;\\n    line-height: 2.9vh;\\n    font-weight: bold;\\n    float: right;\\n}\\n\\n.save__confirm {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.credits {\\n    font-size: 5vh;\\n    width: 100%;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n    max-width: 100%;\\n    border-radius: 0;\\n}\\n\\n.credits .menu__content {\\n    transform: translateY(30%);\\n}\\n\\n.credits.active .menu__content {\\n    transform: translateY(-100%);\\n    transition: all 30s linear;\\n}\\n\\n.credits__title {\\n    font-size: 15vh;\\n    margin: 0;\\n}\\n\\n.credits__section {\\n    padding: 15vh;\\n}\\n\\n.settings input[type=checkbox] {\\n    width: 2vh;\\n    height: 2vh;\\n}\\n\\n.settings input[type=number] {\\n    min-width: 55px;\\n    width: 4.5vh;\\n}\\n\\n.settings .menu__actions,\\n.controls .menu__actions {\\n    margin-top: 3vh;\\n}\\n\\n.controls label {\\n    text-align: right;\\n    padding-right: 25px;\\n}\\n\\n.settings__section,\\n.controls__section {\\n    text-align: left;\\n    font-size: 2vh;\\n}\\n\\n.settings__section-title,\\n.controls__section-title {\\n    font-size: 3vh;\\n    margin-top: 0;\\n    margin-bottom: .5vh;\\n    text-decoration: underline;\\n}\\n\\n.settings__section + .settings__section,\\n.controls__section + .controls__section {\\n    padding-top: 15px;\\n    margin-top: 15px;\\n}\\n\\n.settings__section-inn,\\n.controls__section-inn{\\n    padding: 0 15px;\\n}\\n\\n.control {\\n    display: grid;\\n    grid-template-columns: 1.3fr 1fr 1fr;\\n}\\n\\n.controls__section {\\n    display: inline-block;\\n    width: 47%;\\n    margin-right: 2%;\\n}\\n\\n.controls__section-inn {\\n    display: grid;\\n}\\n\\n.stat__group {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    margin-top: 10px;\\n}\\n\\n.stat {\\n    display: grid;\\n    grid-template-columns: 4fr 2fr 1fr;\\n    text-align: center;\\n    width: 97%;\\n}\\n\\n.attribute {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    text-align: center;\\n}\\n\\n.stat__title,\\n.stat__text,\\n.attribute__title,\\n.attribute__value {\\n    border: 2px solid #000;\\n    padding: 5px;\\n}\\n\\n.attribute + .attribute .attribute__title,\\n.attribute + .attribute .attribute__value{\\n    border-top: 0;\\n}\\n\\n.stat__text,\\n.attribute__value {\\n    border-left: 0;\\n}\\n\\n.stat__title {\\n    text-transform: uppercase;\\n    font-weight: bold;\\n}\\n.stat__text {\\n    margin-right: 7px;\\n}\\n\\n.stat__level {\\n    display: none;\\n    pointer-events: none;\\n    background-color: #3a3;\\n    color: #fff;\\n    font-weight: bold;\\n}\\n\\n.character.has-statpoint .stat__level {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.available-stats {\\n    display: none;\\n    text-align: center;\\n    margin: 20px 0;\\n}\\n\\n.character.has-statpoint .available-stats {\\n    display: block;\\n}\\n\\n.available-stats__inn {\\n    border: 1px solid #000;\\n    display: inline-block;\\n    padding: 10px;\\n}\\n\\n.available-stats__value {\\n    margin-right: 10px;\\n}\\n\\n.character__xp-text {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n}\\n\\n.character__xp-value {\\n    text-align: right;\\n}\\n\\n.character__xp-bar {\\n    width: 100%;\\n    height: 20px;\\n    background: repeating-linear-gradient(to right, #ddd, #ddd 10%, #eee 10%, #eee 20%);\\n    position: relative;\\n    border: 2px solid #333;\\n}\\n\\n.bottom-container .character__xp-bar{\\n    position: absolute;\\n    bottom: 32%;\\n    height: 8%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n.character__xp-filled {\\n    background-color: rgba(210, 210, 0, .6);\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n}\\n\\n.bottom-container {\\n    position: fixed;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 75%;\\n    height: 20%;\\n    display: grid;\\n    grid-template-columns: 1fr 3fr 1fr;\\n    margin: 0 auto;\\n}\\n\\n.bottom-container__left,\\n.bottom-container__center,\\n.bottom-container__right {\\n    position: relative;\\n}\\n\\n.hotbar {\\n    position: absolute;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 100%;\\n    height: 32%;\\n    display: grid;\\n    grid-template-columns: 4.5fr 1fr 4.5fr;\\n    background-color: #333;\\n}\\n\\n.spell-slots,\\n.belt-slots {\\n    display: grid;\\n    width: 100%;\\n    height: 100%;\\n    grid-template-columns: repeat(6, 1fr);\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.spell-slot,\\n.belt-slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n}\\n\\n.spell-slot + .spell-slot,\\n.belt-slot + .belt-slot {\\n    border-left: 0;\\n}\\n\\n.hotbar__controls {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    grid-template-rows: 35% 65%;\\n    padding: 0.4vh 0 0.6vh;\\n    grid-gap: 0.2vh;\\n}\\n\\n.hotbar__controls button {\\n    width: 100%;\\n    height: 100%;\\n    border-radius: 0;\\n    font-weight: bold;\\n    text-transform: uppercase;\\n    line-height: 0;\\n}\\n\\n.hotbar-inventory,\\n.hotbar-character,\\n.hotbar-skills {\\n    width: 100%;\\n    height: 100%;\\n}\\n.hotbar-inventory {\\n    grid-row: 1;\\n    grid-column: span 2;\\n}\\n.hotbar-character {\\n    grid-row: 2;\\n    grid-column: 1;\\n}\\n.hotbar__open-character.has-statpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n.hotbar-skills {\\n    grid-row: 2;\\n    grid-column: 2;\\n}\\n.hotbar__open-skill.has-skillpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n\\n.pickup-slot {\\n    height: 5.3vh;\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!./style.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import engine from \"../Engine\";\n\nexport default class Action {\n    constructor(entity) {\n        this.entity = entity;\n    }\n\n    /**\n     *\n     * @returns {Action}\n     */\n    perform() {\n        console.error(\"Not Implemented\");\n    }\n\n    isPlayer() {\n        return this.entity === engine.player;\n    }\n}","import Action from \"./_Action\";\n\nexport default class UnableToPerformAction extends Action {\n    constructor(entity, reason) {\n        super(entity);\n\n        this.reason = reason;\n    }\n\n    perform() {\n        return this;\n    }\n}","import engine from \"../../Engine\";\n\nexport default class BaseFov {\n    constructor() {\n        this.previousVisibleObjects = [];\n        this.visibleObjects = [];\n        this.visibleActors = [];\n        this.visibleItems = [];\n        this.oldObjects = [];\n        this.newObjects = [];\n        this.left = 0;\n        this.right = 0;\n        this.top = 0;\n        this.bottom = 0;\n    }\n\n    teardown() {\n        this.previousVisibleObjects = [];\n        this.visibleObjects = [];\n        this.visibleActors = [];\n        this.visibleItems = [];\n        this.oldObjects = [];\n        this.newObjects = [];\n    }\n\n    compute(x, y, z, radius) {\n        this.previousVisibleObjects = this.visibleObjects;\n        this.visibleObjects = [];\n        this.visibleActors = [];\n        this.visibleItems = [];\n        this.oldObjects = [];\n        this.newObjects = [];\n\n        this.left = Math.max(0, x - radius);\n        this.right = Math.min(engine.gameMap.width, x + radius + 1);\n        this.top = Math.max(0, y - radius);\n        this.bottom = Math.min(engine.gameMap.height, y + radius + 1);\n    }\n\n    addVisibleObject(object) {\n        if (this.visibleObjects.indexOf(object) === -1) {\n            this.visibleObjects.push(object);\n        }\n\n        if (this.previousVisibleObjects.indexOf(object) === -1 && this.newObjects.indexOf(object) === -1) {\n            this.newObjects.push(object);\n        }\n    }\n\n    addVisibleActor(object) {\n        if (this.visibleActors.indexOf(object) === -1) {\n            this.visibleActors.push(object);\n        }\n    }\n\n    addVisibleItem(object) {\n        if (this.visibleItems.indexOf(object) === -1) {\n            this.visibleItems.push(object);\n        }\n    }\n\n    remove(object) {\n        const newIndex = this.newObjects.indexOf(object);\n        if (newIndex > -1) {\n            this.newObjects.splice(newIndex, 1);\n        }\n\n        const oldIndex = this.oldObjects.indexOf(object);\n        if (oldIndex > -1) {\n            this.oldObjects.splice(oldIndex, 1);\n        }\n\n        this.removeVisible(object);\n    }\n\n    removeVisible(object) {\n        const visibleIndex = this.visibleObjects.indexOf(object);\n        if (visibleIndex > -1 ) {\n            this.visibleObjects.splice(visibleIndex, 1);\n        }\n\n        const visibleItemsIndex = this.visibleItems.indexOf(object);\n        if (visibleItemsIndex > -1) {\n            this.visibleItems.splice(visibleItemsIndex, 1);\n        }\n\n        const previousVisibleItemsIndex = this.previousVisibleObjects.indexOf(object);\n        if (previousVisibleItemsIndex > -1) {\n            this.previousVisibleObjects.splice(previousVisibleItemsIndex, 1);\n        }\n    }\n\n    exploreTile(x, y, minZ, maxZ, tilesOnly = false) {\n        const tilesIter = engine.gameMap.tiles.entries();\n        for (const entry of tilesIter) {\n            if (entry[0] >= minZ && entry[0] <= maxZ) {\n                const tilesArray = entry[1];\n                const tileArrayX = tilesArray[x];\n                if (tileArrayX) {\n                    const tile = tileArrayX[y];\n\n                    if (tile) {\n                        this.addVisibleObject(tile);\n                    }\n                }\n            }\n        }\n\n        if (!tilesOnly) {\n            for (const actor of engine.gameMap.actors) {\n                const positionalObject = actor.getComponent(\"positionalobject\");\n                if (positionalObject) {\n                    if (positionalObject.x === x && positionalObject.y === y) {\n                        this.addVisibleObject(actor);\n                        this.addVisibleActor(actor);\n                    }\n                }\n            }\n\n            for (const item of engine.gameMap.items) {\n                const positionalObject = item.getComponent(\"positionalobject\");\n                if (positionalObject) {\n                    if (positionalObject.x === x && positionalObject.y === y) {\n                        this.addVisibleObject(item);\n                        this.addVisibleItem(item);\n                    }\n                }\n            }\n        }\n    }\n}","export default class FovSlope {\n    constructor(y, x) {\n        this.y = y;\n        this.x = x;\n    }\n\n    greater(y, x) {\n        return this.y * x > this.x * y;\n    }\n\n    greaterOrEqual(y, x) {\n        return this.y * x >= this.x * y;\n    }\n    /*\n    less(y, x) {\n        return this.y * x < this.x * y;\n    }\n    */\n    lessOrEqual(y, x) {\n        return this.y * x <= this.x * y;\n    }\n}","import BaseFov from \"./_BaseFov\";\nimport FovSlope from \"./FovSlope\";\nimport engine from \"../../Engine\";\n\n/**\n * Credit to Adam Milazzo for this fov algorithm: http://www.adammil.net/blog/v125_roguelike_vision_algorithms.html\n */\nexport default class AdamMilazzoFov extends BaseFov {\n    constructor() {\n        super();\n    }\n\n    compute(x, y, z, radius, minZ, maxZ) {\n        super.compute(x, y, z, radius);\n\n        this.exploreTile(x, y, minZ, maxZ);\n        for (let octant = 0; octant < 8; octant ++) {\n            this.computeOctant(octant, x, y, z, radius, 1, new FovSlope(1, 1), new FovSlope(0, 1), minZ, maxZ);\n        }\n    }\n\n    computeOctant(octant, originX, originY, originZ, rangeLimit, x, top, bottom, minZ, maxZ) {\n        for (; x <= rangeLimit; x++) {\n            let topY;\n            if (top.x === 1) {\n                topY = x;\n            } else {\n                topY = Math.round(((x * 2 - 1) * top.y + top.x) / (top.x * 2));\n\n                if (this.blocksLight(octant, originX, originY, originZ, x, topY)) {\n                    if (top.greaterOrEqual(topY * 2 + 1, x * 2) && !this.blocksLight(octant, originX, originY, originZ, x, topY + 1)) {\n                        topY ++;\n                    }\n                } else {\n                    let ax = x * 2;\n                    if (this.blocksLight(octant, originX, originY, originZ, x + 1, topY + 1)) {\n                        ax ++;\n                    }\n\n                    if (top.greater(topY * 2 + 1, ax)) {\n                        topY ++;\n                    }\n                }\n            }\n\n            let bottomY;\n            if (bottom.y === 0) {\n                bottomY = 0;\n            } else {\n                bottomY = ((x * 2 - 1) * bottom.y + bottom.x) / (bottom.x * 2);\n\n                if (bottom.greaterOrEqual(bottomY * 2 + 1, x * 2) && this.blocksLight(octant, originX, originY, originZ, x, bottomY) && !this.blocksLight(octant, originX, originY, originZ, x, bottomY + 1)) {\n                    bottomY ++;\n                }\n            }\n\n            let wasOpaque = -1; // 0:false, 1:true, -1:not applicable\n            for (let y = topY; y >= bottomY; y--) {\n                const isOpaque = this.blocksLight(octant, originX, originY, originZ, x, y);\n                const isVisible = isOpaque || ((y !== topY || top.greaterOrEqual(y, x)) && (y !== bottomY || bottom.lessOrEqual(y, x)));\n\n                if (isVisible) {\n                    this.setVisible(octant, originX, originY, x, y, minZ, maxZ);\n                }\n\n                if (x !== rangeLimit) {\n                    if (isOpaque) {\n                        if (wasOpaque === 0) {\n                            const nx = x * 2;\n                            const ny = y * 2 + 1;\n\n                            if (top.greater(ny, nx)) {\n                                if (y === bottomY) {\n                                    bottom = new FovSlope(ny, nx);\n                                    break;\n                                } else {\n                                    this.computeOctant(octant, originX, originY, originZ, rangeLimit, x + 1, top, new FovSlope(ny, nx), minZ, maxZ);\n                                }\n                            } else {\n                                if (y === bottomY) {\n                                    return;\n                                }\n                            }\n                        }\n\n                        wasOpaque = 1;\n                    } else {\n                        if (wasOpaque > 0) {\n                            const nx = x * 2;\n                            const ny = y * 2 + 1;\n\n                            if (bottom.greaterOrEqual(ny, nx)) {\n                                return;\n                            }\n\n                            top = new FovSlope(ny, nx);\n                        }\n\n                        wasOpaque = 0;\n                    }\n                }\n            }\n\n            if (wasOpaque !== 0) {\n                break;\n            }\n        }\n    }\n\n    blocksLight(octant, originX, originY, originZ, x, y) {\n        switch(octant) {\n            case 0:\n                originX += x;\n                originY -= y;\n                break;\n            case 1:\n                originX += y;\n                originY -= x;\n                break;\n            case 2:\n                originX -= y;\n                originY -= x;\n                break;\n            case 3:\n                originX -= x;\n                originY -= y;\n                break;\n            case 4:\n                originX -= x;\n                originY += y;\n                break;\n            case 5:\n                originX -= y;\n                originY += x;\n                break;\n            case 6:\n                originX += y;\n                originY += x;\n                break;\n            case 7:\n                originX += x;\n                originY += y;\n                break;\n        }\n\n        let blocksLight = false;\n        if (engine.gameMap.tiles.has(originZ)) {\n            const wallTiles = engine.gameMap.tiles.get(originZ);\n            if (wallTiles[originX]) {\n                const wallTile = wallTiles[originX][originY];\n                if (wallTile) {\n                    const blocksFov = wallTile.getComponent(\"blocksFov\");\n                    if (blocksFov) {\n                        blocksLight = blocksFov.blocksFov;\n                    }\n                }\n            }\n        }\n\n        return blocksLight;\n    }\n\n    setVisible(octant, originX, originY, x, y, minZ, maxZ) {\n        switch(octant) {\n            case 0:\n                originX += x;\n                originY -= y;\n                break;\n            case 1:\n                originX += y;\n                originY -= x;\n                break;\n            case 2:\n                originX -= y;\n                originY -= x;\n                break;\n            case 3:\n                originX -= x;\n                originY -= y;\n                break;\n            case 4:\n                originX -= x;\n                originY += y;\n                break;\n            case 5:\n                originX -= y;\n                originY += x;\n                break;\n            case 6:\n                originX += y;\n                originY += x;\n                break;\n            case 7:\n                originX += x;\n                originY += y;\n                break;\n        }\n\n        this.exploreTile(originX, originY, minZ, maxZ);\n    }\n}","import BaseFov from \"./_BaseFov\";\nimport engine from \"../../Engine\";\n\nexport default class SimpleFov extends BaseFov {\n    constructor() {\n        super();\n    }\n\n    compute(x, y, z, radius, minZ, maxZ) {\n        super.compute(x, y, z, radius, minZ, maxZ);\n\n        const minX = Math.max(0, x - radius);\n        const maxX = Math.min(engine.gameMap.width, x + radius);\n        const minY = Math.max(0, y - radius);\n        const maxY = Math.min(engine.gameMap.height, y + radius);\n\n        for (let i = minX; i < maxX; i++) {\n            for (let j = minY; j < maxY; j++) {\n                this.exploreTile(i, j, minZ, maxZ, true);\n            }\n        }\n    }\n}","export default class SubMessage {\n    constructor(text, color, options) {\n        this.text = text;\n        this.color = color || \"#333\";\n\n        this.bold = false;\n        this.italics = false;\n        if (options) {\n            this.bold = options.bold || false;\n            this.italics = options.italics || false;\n        }\n    }\n\n    isEqual(subMessage) {\n        return this.text === subMessage.text && this.color === subMessage.color && this.bold === subMessage.bold && this.italics === subMessage.italics;\n    }\n}","export default class Message {\n    constructor(subMessages = []) {\n        this.subMessages = subMessages;\n        this.count = 1;\n    }\n\n    isEqual(subMessages) {\n        if (this.subMessages.length !== subMessages.length) {\n            return false;\n        }\n\n        for (let i = 0; i < this.subMessages.length; i++) {\n            const sub1 = this.subMessages[i];\n            const sub2 = subMessages[i];\n\n            if (!sub1.isEqual(sub2)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    getHtml() {\n        const messageDom = document.createElement(\"div\");\n        messageDom.classList.add(\"message\");\n\n        for (const subMessage of this.subMessages) {\n            const subMessageDom = document.createElement(\"span\");\n            subMessageDom.classList.add(\"message__text\");\n\n            if (subMessage.bold) {\n                subMessageDom.classList.add(\"message__bold\");\n            }\n\n            if (subMessage.italics) {\n                subMessageDom.classList.add(\"message__italics\");\n            }\n            subMessageDom.innerText = subMessage.text;\n            subMessageDom.style.color = subMessage.color;\n            messageDom.appendChild(subMessageDom);\n        }\n\n        if (this.count > 1) {\n            messageDom.appendChild(this.getCountHtml());\n        }\n\n        return messageDom;\n    }\n\n    getCountHtml() {\n        const amountDom = document.createElement(\"span\");\n        amountDom.classList.add(\"message__amount\");\n        amountDom.innerText = \"x\" + this.count;\n\n        return amountDom;\n    }\n}","export default class UIElement {\n    constructor(html) {\n        this.dom = this.htmlToElement(html);\n    }\n\n    /**\n     * Reference: https://stackoverflow.com/a/35385518\n     * @param {String} html HTML representing a single element\n     * @return {Element}\n     */\n    htmlToElement(html) {\n        const template = document.createElement(\"template\");\n        html = html.trim(); // Never return a text node of whitespace as the result\n        template.innerHTML = html;\n        return template.content.firstChild;\n    }\n\n    // /**\n    //  * Reference: https://stackoverflow.com/a/35385518\n    //  * @param {String} html HTML representing any number of sibling elements\n    //  * @return {NodeList}\n    //  */\n    // htmlToElements(html) {\n    //     const template = document.createElement('template');\n    //     template.innerHTML = html;\n    //     return template.content.childNodes;\n    // }\n\n    isOpen() {\n        return this.dom.classList.contains(\"active\");\n    }\n\n    open() {\n        if (!this.dom.classList.contains(\"active\")) {\n            this.dom.classList.add(\"active\");\n        }\n    }\n\n    close() {\n        this.dom.classList.remove(\"active\");\n    }\n}","import html from \"../../html/ui/MessageConsole.html\";\nimport SubMessage from \"./message/SubMessage\";\nimport Message from \"./message/Message\";\nimport UIElement from \"./UIElement\";\n\nclass MessageConsole extends UIElement {\n    constructor() {\n        super(html);\n        this.messages = [];\n        this.builder = [];\n\n        const consoleIncreaseDom = this.dom.getElementsByClassName(\"console__increase\")[0];\n        consoleIncreaseDom.addEventListener(\"click\", function(e) {\n            const parent = e.target.parentElement;\n            if (!parent.classList.contains(\"animate\")) {\n                parent.classList.add(\"animate\");\n            }\n            if (parent.classList.contains(\"collapsed\")) {\n                parent.classList.remove(\"collapsed\");\n            } else {\n                parent.classList.add(\"full\");\n            }\n        });\n\n        const consoleDecreaseDom = this.dom.getElementsByClassName(\"console__decrease\")[0];\n        consoleDecreaseDom.addEventListener(\"click\", function(e) {\n            const parent = e.target.parentElement;\n            if (!parent.classList.contains(\"animate\")) {\n                parent.classList.add(\"animate\");\n            }\n            if (parent.classList.contains(\"full\")) {\n                parent.classList.remove(\"full\");\n            } else {\n                parent.classList.add(\"collapsed\");\n            }\n        });\n\n        this.messagesInnerDom = this.dom.getElementsByClassName(\"messages__inn\")[0];\n    }\n\n    text(text, color, options) {\n        this.builder.push(new SubMessage(text, color, options));\n        return this; // Allow chaining\n    }\n\n    build(stack = true) {\n        this.addMessage(this.builder.slice(0), stack);\n        this.builder = [];\n    }\n\n    clear() {\n        this.messagesInnerDom.innerHTML = \"\";\n        this.messages = [];\n    }\n\n    addMessage(subMessages, stack = true) {\n        if (stack && this.messages.length > 0) {\n            const lastMessage = this.messages[this.messages.length - 1];\n            if (lastMessage.isEqual(subMessages)) {\n                lastMessage.count += 1;\n                this.updateLastMessageCount(lastMessage);\n            } else {\n                this.messages.push(new Message(subMessages));\n                this.addNewMessage();\n            }\n        } else {\n            this.messages.push(new Message(subMessages));\n            this.addNewMessage();\n        }\n    }\n\n    updateLastMessageCount(lastMessage) {\n        const lastMessageDom = document.querySelectorAll(\".message:last-child\")[0];\n        const amountDom = lastMessageDom.querySelectorAll(\".message__amount\")[0];\n\n        if (amountDom) {\n            amountDom.innerText = \"x\" + lastMessage.count;\n        } else {\n            lastMessageDom.appendChild(lastMessage.getCountHtml());\n        }\n    }\n\n    addNewMessage() {\n        const lastMessage = this.messages[this.messages.length - 1];\n        this.messagesInnerDom.appendChild(lastMessage.getHtml());\n    }\n\n    close() {\n        super.close();\n\n        this.dom.classList.remove(\"animate\");\n    }\n}\n\nconst messageConsole = new MessageConsole();\nexport default messageConsole;","import Action from \"./_Action\";\n\nexport default class NoAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        return this;\n    }\n}","import html from \"../../html/ui/Details.html\";\nimport engine from \"../Engine\";\nimport UIElement from \"./UIElement\";\n\nclass Details extends UIElement {\n    constructor() {\n        super(html);\n    }\n\n    updatePlayerDetails() {\n        this.updatePositionDetails(engine.player, true);\n    }\n\n    getPosition(entity) {\n        const position = entity.getComponent(\"positionalobject\");\n        const x = position.x;\n        const y = position.y;\n        return \"<span class='details__line'>Looking at: X:\" + x + \" - Y:\" + y + \"</span>\";\n    }\n\n    updatePositionOnly(entity) {\n        this.dom.innerHTML = this.getPosition(entity);\n    }\n\n    updatePositionDetails(entity, skipPlayer = false) {\n        if (!entity) {\n            return;\n        }\n        const position = entity.getComponent(\"positionalobject\");\n        const x = position.x;\n        const y = position.y;\n        const z = position.z;\n        let zStart = z - 1;\n        if (entity !== engine.player) {\n            zStart = z;\n        }\n        let text = this.getPosition(entity);\n        const tiles = engine.gameMap.tiles;\n        for (let i = zStart; i <= z; i++) {\n            if (tiles.get(i) && tiles.get(i)[x]) {\n                const tile = tiles.get(i)[x][y];\n                if (tile) {\n                    text += \"<span class='details__line'>\" + tile.name + \"</span>\";\n                }\n            }\n        }\n\n        for (const actor of engine.gameMap.actors) {\n            if (skipPlayer && actor === engine.player) {\n                continue;\n            }\n\n            const position = actor.getComponent(\"positionalobject\");\n            if (position && position.isVisible() && x === position.x && y === position.y && Math.abs(z - position.z) < 2) {\n                text += \"<span class='details__line'><span style='color:\" + position.color + \"'>\" + position.letter + \"</span>: \" + actor.name;\n\n                const fighter = actor.getComponent(\"fighter\");\n                if (fighter) {\n                    text += \" \" + fighter.getHealthDescription();\n                }\n                text += \"</span>\";\n            }\n        }\n\n\n        const itemLines = [];\n        for (const item of engine.gameMap.items) {\n            const position = item.getComponent(\"positionalobject\");\n            if (position && position.isVisible() && x === position.x && y === position.y && Math.abs(z - position.z) < 2) {\n                itemLines.push(\"<span class='details__line'><span style='color:\" + position.color + \"'>\" + position.letter + \"</span>: \" + item.name + \"</span>\");\n            }\n        }\n\n        if (itemLines.length > 0) {\n            text += \"<span class='details__line details__header'>Items:</span>\";\n        }\n\n        for (const line of itemLines) {\n            text += line;\n        }\n\n\n        const nearby = [];\n        for (const actor of engine.fov.visibleActors) {\n            if (actor === engine.player || !actor.isAlive()) {\n                continue;\n            }\n\n            const position = actor.getComponent(\"positionalobject\");\n            if (position) {\n                nearby.push(actor);\n            }\n        }\n\n        if (nearby.length > 0) {\n            text += \"<span class='details__line details__header'>Nearby:</span>\";\n\n            for (const actor of nearby) {\n                const position = actor.getComponent(\"positionalobject\");\n                if (position) {\n                    text += \"<span class='details__line'>\";\n                    text += \"<span style='color:\" + position.color + \"'>\" + position.letter + \"</span>: \" + actor.name;\n\n                    const fighter = actor.getComponent(\"fighter\");\n                    if (fighter) {\n                        text += \" \" + fighter.getHealthDescription();\n                    }\n\n                    text += \"</span>\";\n                }\n            }\n        }\n\n        this.dom.innerHTML = text;\n    }\n}\n\nconst details = new Details();\nexport default details;","import * as THREE from \"three\";\nimport sceneState from \"../SceneState\";\nimport details from \"../ui/Details\";\nimport engine from \"../Engine\";\n\nexport default class EventHandler {\n    constructor() {\n        this.raycaster = new THREE.Raycaster();\n        this.mouse = new THREE.Vector2();\n        this.mouseDown = false;\n\n        window.addEventListener(\"mousemove\", this);\n        window.addEventListener(\"mousedown\", this);\n        window.addEventListener(\"mouseup\", this);\n        window.addEventListener(\"click\", this);\n        window.addEventListener(\"contextmenu\", this);\n        window.addEventListener(\"change\", this);\n        window.addEventListener(\"keydown\", this);\n\n        this.isPlayerTurn = true;\n        this.highlightedTiles = [];\n    }\n\n    teardown() {\n        window.removeEventListener(\"mousemove\", this);\n        window.removeEventListener(\"mousedown\", this);\n        window.removeEventListener(\"mouseup\", this);\n        window.removeEventListener(\"click\", this);\n        window.removeEventListener(\"contextmenu\", this);\n        window.removeEventListener(\"change\", this);\n        window.removeEventListener(\"keydown\", this);\n\n        this.clearHighlights();\n    }\n\n    handleEvent(e) {\n        switch(e.type) {\n            case \"mousemove\":\n                this.onMouseMove(e);\n                break;\n            case \"mousedown\":\n                this.onMouseDown(e);\n                break;\n            case \"mouseup\":\n                this.onMouseUp(e);\n                break;\n            case \"click\":\n                this.onLeftClick(e);\n                break;\n            case \"contextmenu\":\n                this.onRightClick(e);\n                break;\n            case \"change\":\n                this.onChange(e);\n                break;\n            case \"keydown\":\n                this.onKeydown(e);\n                break;\n        }\n    }\n\n    handleInput() {}\n\n    onMouseMove(/*e*/) {}\n\n    onMouseDown(/*e*/) {\n        this.mouseDown = true;\n    }\n\n    onMouseUp(/*e*/) {\n        this.mouseDown = false;\n    }\n\n    onLeftClick(/*e*/) {}\n\n    onRightClick(/*e*/) {}\n\n    onChange(/*e*/) {}\n\n    onKeydown(/*e*/) {}\n\n    getMouseIntersectingObjects(e) {\n        this.mouse.x = (e.clientX / sceneState.canvasDom.offsetWidth) * 2 - 1;\n        this.mouse.y = -(e.clientY / sceneState.canvasDom.offsetHeight) * 2 + 1;\n\n        this.raycaster.setFromCamera(this.mouse, sceneState.camera);\n\n        return this.raycaster.intersectObject(sceneState.scene, true);\n    }\n\n    isHighlighted(tile) {\n        for (const highlightedTile of this.highlightedTiles) {\n            if (tile === highlightedTile) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    clearAndSetHighlights(tiles) {\n        this.clearHighlights();\n        for (const tile of tiles) {\n            const position = tile.getComponent(\"positionalobject\");\n            if (position) {\n                position.highlight();\n                this.highlightedTiles.push(tile);\n            }\n        }\n        engine.needsMapUpdate = true;\n    }\n\n    clearAndSetHighlight(tile) {\n        this.clearHighlights();\n        const position = tile.getComponent(\"positionalobject\");\n        if (position) {\n            position.highlight();\n            this.highlightedTiles.push(tile);\n        }\n\n        details.updatePositionDetails(tile);\n        engine.needsMapUpdate = true;\n    }\n\n    clearHighlights(updatePlayer = false) {\n        for (const highlightedTile of this.highlightedTiles) {\n            const position = highlightedTile.getComponent(\"positionalobject\");\n            if (position) {\n                position.removeHighlight();\n            }\n        }\n\n        this.highlightedTiles = [];\n\n        if (updatePlayer) {\n            details.updatePlayerDetails();\n        }\n\n        engine.needsMapUpdate = true;\n    }\n}","const Key = {\n    LEFT: \"ArrowLeft\",\n    RIGHT: \"ArrowRight\",\n    UP: \"ArrowUp\",\n    DOWN: \"ArrowDown\",\n    BACKSPACE: \"Backspace\",\n    TAB: \"Tab\",\n    ENTER: \"Enter\",\n    SHIFT_LEFT: \"Left Shift\",\n    SHIFT_RIGHT: \"Right Shift\",\n    CONTROL_LEFT: \"Left Control\",\n    CONTROL_RIGHT: \"Right Control\",\n    ALT_LEFT: \"Left Alt\",\n    ALT_RIGHT: \"Right Alt\",\n    PAUSE_BREAK: \"Pause\",\n    CAPS_LOCK: \"CapsLock\",\n    ESCAPE: \"Escape\",\n    SPACE: \" \",\n    PAGE_UP: \"PageUp\",\n    PAGE_DOWN: \"PageDown\",\n    END: \"End\",\n    HOME: \"Home\",\n    INSERT: \"Insert\",\n    DELETE: \"Delete\",\n    OS_LEFT: \"Left OS\",\n    OS_RIGHT: \"Right OS\",\n    CONTEXT_MENU: \"ContextMenu\",\n    SCROLL_LOCK: \"ScrollLock\",\n    NUM_LOCK: \"NumLock\",\n    NUMPAD_DIVIDE: \"Numpad /\",\n    NUMPAD_MULTIPLY: \"Numpad *\",\n    NUMPAD_SUBTRACT: \"Numpad -\",\n    NUMPAD_ADD: \"Numpad +\",\n    NUMPAD_ENTER: \"Numpad Enter\",\n\n    NUMPAD_PERIOD: \"Numpad .\",\n    NUMPAD_0: \"Numpad 0\",\n    NUMPAD_1: \"Numpad 1\",\n    NUMPAD_2: \"Numpad 2\",\n    NUMPAD_3: \"Numpad 3\",\n    NUMPAD_4: \"Numpad 4\",\n    NUMPAD_5: \"Numpad 5\",\n    NUMPAD_6: \"Numpad 6\",\n    NUMPAD_7: \"Numpad 7\",\n    NUMPAD_8: \"Numpad 8\",\n    NUMPAD_9: \"Numpad 9\",\n\n    NUMPAD_DELETE: \"Numpad Delete\",\n    NUMPAD_INSERT: \"Numpad Insert\",\n    NUMPAD_END: \"Numpad End\",\n    NUMPAD_ARROW_DOWN: \"Numpad ArrowDown\",\n    NUMPAD_PAGE_DOWN: \"Numpad PageDown\",\n    NUMPAD_ARROW_LEFT: \"Numpad ArrowLeft\",\n    NUMPAD_CLEAR: \"Numpad Clear\",\n    NUMPAD_ARROW_RIGHT: \"Numpad ArrowRight\",\n    NUMPAD_HOME: \"Numpad Home\",\n    NUMPAD_ARROW_UP: \"Numpad ArrowUp\",\n    NUMPAD_PAGE_UP: \"Numpad PageUp\",\n};\n\nexport default Key;","import Key from \"./Key\";\n\nclass Controls {\n    constructor() {\n        const self = this;\n\n        self.defaultDelay = 25;\n        self.lastShiftUp = null;\n        self.treatShiftNumpadEqual = true;\n        self.keysDown = [];\n        self.keysDelayed = [];\n        self.defaults = new Map();\n\n        self.controls = new Map();\n        self.defaults.set(\"left\", [Key.NUMPAD_4, Key.LEFT]);\n        self.defaults.set(\"right\", [Key.NUMPAD_6, Key.RIGHT]);\n        self.defaults.set(\"up\", [Key.NUMPAD_8, Key.UP]);\n        self.defaults.set(\"down\", [Key.NUMPAD_2, Key.DOWN]);\n\n        self.defaults.set(\"editor-left\", [Key.LEFT]);\n        self.defaults.set(\"editor-right\", [Key.RIGHT]);\n        self.defaults.set(\"editor-up\", [Key.UP]);\n        self.defaults.set(\"editor-down\", [Key.DOWN]);\n\n        self.defaults.set(\"nw\", [Key.NUMPAD_7]);\n        self.defaults.set(\"ne\", [Key.NUMPAD_9]);\n        self.defaults.set(\"sw\", [Key.NUMPAD_1]);\n        self.defaults.set(\"se\", [Key.NUMPAD_3]);\n        self.defaults.set(\"wait\", [Key.NUMPAD_5]);\n\n        //self.defaults.set(\"drop\", [\"d\"]);\n        self.defaults.set(\"get\", [\"g\"]);\n        self.defaults.set(\"inventory\", [\"i\"]);\n        self.defaults.set(\"character\", [\"c\"]);\n        self.defaults.set(\"closeall\", [\"`\"]);\n        self.defaults.set(\"look\", [\"/\"]);\n        self.defaults.set(\"pause\", [\"p\", Key.ESCAPE]);\n        self.defaults.set(\"interact\", [Key.ENTER, Key.NUMPAD_ENTER]);\n\n        self.defaults.set(\"confirm\", [Key.ENTER, Key.NUMPAD_ENTER]);\n        self.defaults.set(\"cancel\", [Key.ESCAPE, Key.BACKSPACE]);\n        self.defaults.set(\"modifier-speed1\", [Key.SHIFT_LEFT, Key.SHIFT_RIGHT]);\n        self.defaults.set(\"modifier-speed2\", [Key.CONTROL_LEFT, Key.CONTROL_RIGHT]);\n        self.defaults.set(\"modifier-speed3\", [Key.ALT_LEFT, Key.ALT_RIGHT]);\n\n        self.defaults.set(\"quicksave\", [\"F8\"]);\n        self.defaults.set(\"quickload\", [\"F9\"]);\n\n        self.defaults.set(\"debug\", [\"F2\"]);\n        self.defaults.set(\"debug2\", [\"F4\"]);\n        self.defaults.set(\"reset\", [\"r\"]);\n\n        self.load();\n\n        addEventListener(\"keydown\", function (e) {\n            // TODO: Evaluate if this should be generalized. I don't want to prevent all keys necessarily.\n            if (e.key === \"/\") {\n                e.preventDefault();\n            }\n\n            if (self.treatShiftNumpadEqual) {\n                const numLockOn = e.getModifierState(\"NumLock\");\n                // Re-add Shift key from Numpad press\n                if (numLockOn && !e.shiftKey && e.code.startsWith(\"Numpad\") && e.keyCode < 90) {\n                    if (self.lastShiftUp) {\n                        self.keysDown[self.lastShiftUp] = true;\n                        //console.log(\"Bonus Key Down: \", self.lastShiftUp);\n                    }\n                }\n            }\n\n            const key = self.getKey(e.key, e.code);\n            //console.log(\"Key Down: \", key);\n            self.keysDown[key] = true;\n        }, false);\n\n\n        addEventListener(\"keyup\", function (e) {\n            const key = self.getKey(e.key, e.code);\n            if (key === Key.SHIFT_LEFT || key === Key.SHIFT_RIGHT) {\n                self.lastShiftUp = key;\n            }\n\n            //console.log(\"Key Up: \", key);\n            delete self.keysDown[key];\n            delete self.keysDelayed[key];\n        }, false);\n    }\n\n    getKey(key, code) {\n        if (!code.startsWith(\"Arrow\")) {\n            if (code.endsWith(\"Left\")) {\n                key = \"Left \" + key;\n            } else if (code.endsWith(\"Right\")) {\n                key = \"Right \" + key;\n            } else if (code.startsWith(\"Numpad\")) {\n                key = \"Numpad \" + key;\n            }\n        }\n\n        if (this.treatShiftNumpadEqual) {\n            switch(key) {\n                case Key.NUMPAD_DELETE: key = Key.NUMPAD_PERIOD; break;\n                case Key.NUMPAD_INSERT: key = Key.NUMPAD_0; break;\n                case Key.NUMPAD_END: key = Key.NUMPAD_1; break;\n                case Key.NUMPAD_ARROW_DOWN: key = Key.NUMPAD_2; break;\n                case Key.NUMPAD_PAGE_DOWN: key = Key.NUMPAD_3; break;\n                case Key.NUMPAD_ARROW_LEFT: key = Key.NUMPAD_4; break;\n                case Key.NUMPAD_CLEAR: key = Key.NUMPAD_5; break;\n                case Key.NUMPAD_ARROW_RIGHT: key = Key.NUMPAD_6; break;\n                case Key.NUMPAD_HOME: key = Key.NUMPAD_7; break;\n                case Key.NUMPAD_ARROW_UP: key = Key.NUMPAD_8; break;\n                case Key.NUMPAD_PAGE_UP: key = Key.NUMPAD_9; break;\n            }\n        }\n\n        return key;\n    }\n\n    load() {\n        const controls = localStorage.getItem(\"controls\");\n        if (controls) {\n            this.controls = new Map(JSON.parse(controls));\n        } else {\n            this.resetToDefault();\n        }\n    }\n\n    save() {\n        localStorage.setItem(\"controls\", JSON.stringify(Array.from(this.controls.entries())));\n    }\n\n    setControls(controlsMap) {\n        this.controls = new Map();\n        for (const [key, value] of controlsMap.entries()) {\n            const keys = [];\n            for (const val of value) {\n                keys.push(val);\n            }\n            this.controls.set(key, keys);\n        }\n        this.save();\n    }\n\n    resetToDefault() {\n        this.setControls(this.defaults);\n    }\n\n    clone() {\n        const clone = new Map();\n        for (const [key, value] of this.controls.entries()) {\n            const keys = [];\n            for (const val of value) {\n                keys.push(val);\n            }\n            clone.set(key, keys);\n        }\n        return clone;\n    }\n\n    isPressed(key) {\n        const self = this;\n        let pressed = false;\n\n        let keys = self.controls.get(key);\n        if (!keys) {\n            const defaultKeys = self.defaults.get(key);\n            if (defaultKeys) {\n                self.controls.set(key, defaultKeys);\n                self.save();\n                keys = defaultKeys;\n            } else {\n                console.error(\"Missing keybindings for: \", key, keys);\n            }\n        }\n        keys.forEach(function(keyToTest) {\n            if (keyToTest in self.keysDown) {\n                pressed = true;\n            }\n        });\n\n        return pressed;\n    }\n\n    isDelayed(key) {\n        const self = this;\n        let delayed = false;\n\n        this.controls.get(key).forEach(function(keyToTest) {\n            if (keyToTest in self.keysDelayed) {\n                delayed = true;\n            }\n        });\n\n        return delayed;\n    }\n\n    deleteKey(key, delay) {\n        const self = this;\n        self.controls.get(key).forEach(function(keyToTest) {\n            delete self.keysDown[keyToTest];\n            if (delay) {\n                self.keysDelayed[keyToTest] = true;\n            }\n        });\n\n        if (delay) {\n            setTimeout(function() {\n                self.controls.get(key).forEach(function(keyToTest) {\n                    delete self.keysDelayed[keyToTest];\n                });\n            }, delay);\n        }\n    }\n\n    /**\n     *  Returns true if press succeeds\n     *          false if press does not succeed\n     */\n    testPressed(key, delay) {\n        delay = delay || this.defaultDelay;\n\n        const self = this;\n        let succeeded = false;\n\n        if (self.isPressed(key) && !self.isDelayed(key)) {\n            self.deleteKey(key, delay);\n            succeeded = true;\n        }\n\n        return succeeded;\n    }\n/*\n    hasControllerSupport() {\n        return \"getGamepads\" in navigator;\n    }\n\n    checkForGamepads() {\n        const self = this;\n        if (this.hasControllerSupport()) {\n            const numGamepads = navigator.getGamepads().length;\n            for (let i = 0; i < numGamepads; i++) {\n                const gamepad = navigator.getGamepads()[i];\n                if (gamepad) {\n                    gamepad.axes.forEach(function(axis, axisIndex) {\n                        if (axis <= -0.5) {\n                            //console.log(\"axis\" + axisIndex + \"-left\");\n                            self.keysDown[\"axis\" + axisIndex + \"-left\"] = true;\n                        } else if (axis >= 0.5) {\n                            //console.log(\"axis\" + axisIndex + \"-right\");\n                            self.keysDown[\"axis\" + axisIndex + \"-right\"] = true;\n                        } else {\n                            delete self.keysDown[\"axis\" + axisIndex + \"-left\"];\n                            delete self.keysDown[\"axis\" + axisIndex + \"-right\"];\n                            delete self.keysDelayed[\"axis\" + axisIndex + \"-left\"];\n                            delete self.keysDelayed[\"axis\" + axisIndex + \"-right\"];\n                        }\n                    });\n\n                    gamepad.buttons.forEach(function(button, buttonIndex) {\n                        if (button.pressed) {\n                            //console.log(\"gamepad\" + buttonIndex);\n                            self.keysDown[\"gamepad\"+ buttonIndex] = true;\n                        } else {\n                            delete self.keysDown[\"gamepad\" + buttonIndex];\n                            delete self.keysDelayed[\"gamepad\" + buttonIndex];\n                        }\n                    });\n                }\n            }\n        }\n    }\n*/\n}\n\nconst controls = new Controls();\nexport default controls;\n\n\n// window.addEventListener(\"gamepadconnected\", function(e) {\n//     const gamepad = navigator.getGamepads()[e.gamepad.index];\n//     console.log(\"Gamepad connected at index %d: %s. %d buttons, %d axes.\", gamepad.index, gamepad.id, gamepad.buttons.length, gamepad.axes.length);\n//     console.log(gamepad.buttons);\n// });\n//\n// window.addEventListener(\"gamepaddisconnected\", function(e) {\n//     /*\n//     var gamepad = navigator.getGamepads()[e.gamepad.index];\n//     console.log(\"Gamepad disconnected at index %d: %s. %d buttons, %d axes.\", gamepad.index, gamepad.id, gamepad.buttons.length, gamepad.axes.length);\n//     */\n// });","export default class ArrayUtil {\n    constructor() {\n\n    }\n\n    static create2dArray(numRows) {\n        const array = [];\n\n        for (let i = 0; i < numRows; i++) {\n            array[i] = [];\n        }\n        return array;\n    }\n}","import engine from \"../Engine\";\nimport {MathUtils} from \"three\";\n\nexport default class _Component {\n    constructor(args = {}, baseType, type) {\n        this.baseType = baseType || \"component\";\n        this.type = type || this.baseType;\n        this.parentEntity = args.parentEntity;\n\n        this.cachedSave = null;\n    }\n\n    save() {\n        return null;\n    }\n\n    clearSaveCache() {\n        this.cachedSave = null;\n\n        if (this.parentEntity) {\n            this.parentEntity.clearSaveCache();\n        }\n    }\n\n    getDescription() {\n        return \"\";\n    }\n\n    isPlayer() {\n        return this.parentEntity === engine.player;\n    }\n\n    parseRandFloat(value, defaultValue) {\n        let returnValue;\n        if (typeof value === \"string\") {\n            if (value.indexOf(\",\") !== -1) {\n                const valueSplit = value.split(\",\");\n                returnValue = parseFloat(MathUtils.randFloat(parseFloat(valueSplit[0].trim()), parseFloat(valueSplit[1].trim())).toFixed(2));\n            } else {\n                returnValue = parseFloat(value) || defaultValue;\n            }\n        } else {\n            returnValue = value || defaultValue;\n        }\n\n        return returnValue;\n    }\n\n\n    parseRandInt(value, defaultValue) {\n        let returnValue;\n        if (typeof value === \"string\") {\n            if (value.indexOf(\",\") !== -1) {\n                const valueSplit = value.split(\",\");\n                returnValue = MathUtils.randInt(parseInt(valueSplit[0].trim()), parseInt(valueSplit[1].trim()));\n            } else {\n                returnValue = parseInt(value) || defaultValue;\n            }\n        } else {\n            returnValue = value || defaultValue;\n        }\n\n        return returnValue;\n    }\n\n    parseRandIntBetween(value) {\n        if (typeof value === \"string\") {\n            const split = value.trim().split(\"-\");\n            if (split.length > 1) {\n                return MathUtils.randInt(parseInt(split[0].trim()), parseInt(split[1].trim()));\n            } else {\n                return parseInt(split[0].trim());\n            }\n        } else {\n            return value;\n        }\n    }\n}","import _Component from \"../_Component\";\nimport sceneState from \"../../SceneState\";\nimport Tile from \"../../entity/Tile\";\nimport {Vector3} from \"three\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport engine from \"../../Engine\";\n\nexport default class _PositionalObject extends _Component {\n    constructor(args = {}, type) {\n        super(args, \"positionalobject\", type);\n        const hasComponent = args.components && args.components.positionalobject;\n\n        this.object = null;\n        this.meshes = [];\n        this.highlighted = false;\n        this.width = 5;\n        this.height = 5;\n        this.depth = 5;\n\n        this.scale = 1;\n        this.x = 0;\n        this.y = 0;\n        this.z = 0;\n        this.color = \"#ffffff\";\n        this.opacity = 1;\n        this.xRot = 0;\n        this.yRot = 0;\n        this.zRot = 0;\n        this.xOffset = 0;\n        this.yOffset = 0;\n        this.zOffset = 0;\n        this.size = 1;\n        this.actorZOffset = 0;\n\n        this.deathAnimation = null;\n\n        if (hasComponent) {\n            const positionalobject = args.components.positionalobject;\n            this.x = positionalobject.x || 0;\n            this.y = positionalobject.y || 0;\n            this.z = positionalobject.z || 0;\n            this.color = positionalobject.color || \"#ffffff\";\n            if (positionalobject.opacity !== undefined) {\n                this.opacity = positionalobject.opacity;\n            }\n\n            this.scale = this.parseRandFloat(positionalobject.scale, 1);\n            this.xRot = this.parseRandFloat(positionalobject.xRot, 0);\n            this.yRot = this.parseRandFloat(positionalobject.yRot, 0);\n            this.zRot = this.parseRandFloat(positionalobject.zRot, 0);\n\n            this.xOffset = this.parseRandFloat(positionalobject.xOffset, 0);\n            this.yOffset = this.parseRandFloat(positionalobject.yOffset, 0);\n            this.zOffset = this.parseRandFloat(positionalobject.zOffset, 0);\n            this.size = this.parseRandFloat(positionalobject.size, 1);\n            this.actorZOffset = this.parseRandFloat(positionalobject.actorZOffset, 0);\n        }\n\n        this.transparency = 1; // for quick reference on mousemove\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            positionalobject: {}\n        };\n\n        if (this.parentEntity && this.parentEntity instanceof Tile) {\n            if (this.actorZOffset !== 0) {\n                saveJson.positionalobject.actorZOffset = this.actorZOffset;\n            }\n        } else {\n            saveJson.positionalobject.x = this.x;\n            saveJson.positionalobject.y = this.y;\n            saveJson.positionalobject.z = this.z;\n        }\n\n        if (this.xRot !== 0) {\n            saveJson.positionalobject.xRot = this.xRot;\n        }\n\n        if (this.yRot !== 0) {\n            saveJson.positionalobject.yRot = this.yRot;\n        }\n\n        if (this.zRot !== 0) {\n            saveJson.positionalobject.zRot = this.zRot;\n        }\n\n        if (this.xOffset !== 0) {\n            saveJson.positionalobject.xOffset = this.xOffset;\n        }\n\n        if (this.yOffset !== 0) {\n            saveJson.positionalobject.yOffset = this.yOffset;\n        }\n\n        if (this.zOffset !== 0) {\n            saveJson.positionalobject.zOffset = this.zOffset;\n        }\n\n        if (this.color !== \"#ffffff\") {\n            saveJson.positionalobject.color = this.color;\n        }\n\n        if (this.opacity !== 1) {\n            saveJson.positionalobject.opacity = this.opacity;\n        }\n\n        if (this.scale !== 1) {\n            saveJson.positionalobject.scale = this.scale;\n        }\n\n        if (this.size !== 1) {\n            saveJson.positionalobject.size = this.size;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    createObject() {}\n\n    teardown() {\n        if (this.deathAnimation) {\n            this.deathAnimation.stop();\n        }\n\n        if (this.hasObject()) {\n            sceneState.scene.remove(this.object);\n        }\n\n        this.object = undefined;\n        this.meshes = [];\n    }\n\n    onMapTeardown() {\n        this.teardown();\n    }\n\n    resetColor() {\n        for (const mesh of this.meshes) {\n            mesh.material.color.set(mesh.originalColor);\n        }\n    }\n\n    shiftColor(scalar) {\n        for (const mesh of this.meshes) {\n            mesh.material.transparent = true;\n            mesh.material.color.multiplyScalar(scalar);\n        }\n    }\n\n    setTransparency(opacity = 1) {\n        this.transparency = opacity;\n\n        const actualOpacity = opacity * this.opacity;\n        for (const mesh of this.meshes) {\n            mesh.material.transparent = actualOpacity < 1;\n            mesh.material.opacity = actualOpacity;\n        }\n    }\n\n    getObjectPosition() {\n        return new Vector3((this.x + this.xOffset) * this.width, (this.y + this.yOffset) * this.height, (this.z + this.zOffset) * this.depth - ((this.depth - (this.scale * this.depth)) / 2));\n    }\n\n    updateObjectPosition() {\n        if (this.hasObject()) {\n            let zOffset = this.zOffset;\n            if (this.parentEntity.type === \"actor\" || this.parentEntity.type === \"item\") {\n                const tile = engine.gameMap.tiles.get(this.z)[this.x][this.y];\n                if (tile) {\n                    const position = tile.getComponent(\"positionalobject\");\n                    zOffset += position.actorZOffset;\n                }\n            }\n\n            this.object.position.set((this.x + this.xOffset) * this.width, (this.y + this.yOffset) * this.height, (this.z + zOffset) * this.depth - ((this.depth - (this.scale * this.depth)) / 2));\n            this.object.rotation.set(Math.PI * this.xRot, Math.PI * this.yRot, Math.PI * this.zRot);\n        }\n    }\n\n    hasObject() {\n        return this.object !== null && this.object !== undefined;\n    }\n\n    setVisible(visible = true) {\n        if (visible && !this.hasObject()) {\n            this.createObject();\n            sceneState.scene.add(this.object);\n        }\n\n        if (this.hasObject()) {\n            if (visible && !this.object.visible) {\n                this.object.visible = true;\n            } else if (!visible && this.object.visible) {\n                this.object.visible = false;\n            }\n        }\n    }\n\n    isVisible() {\n        return this.hasObject() && this.object.visible;\n    }\n\n    highlight() {\n        if (!this.highlighted) {\n            if (this.hasObject()) {\n                this.shiftColor(2.5);\n            }\n            this.highlighted = true;\n        }\n    }\n\n    removeHighlight() {\n        if (this.highlighted) {\n            if (this.hasObject()) {\n                for (const mesh of this.meshes) {\n                    mesh.material.color.set(mesh.originalColor);\n                }\n\n                const parent = this.parentEntity;\n                if (parent) {\n                    const fov = parent.getComponent(\"fov\");\n                    if (fov && fov.explored && !fov.visible) {\n                        this.shiftColor(.5);\n                    }\n                }\n            }\n            this.highlighted = false;\n        }\n    }\n\n    move(x, y = 0, z = 0) {\n        this.x += x;\n        this.y += y;\n        this.z += z;\n\n        this.clearSaveCache();\n        this.updateObjectPosition();\n\n        this.parentEntity.callEvent(\"onEntityMove\");\n    }\n\n    /**\n     *\n     * @param x\n     * @param y\n     * @param z\n     * @param callEvent Set to false when this is being called from the parent entity to prevent infinite calls\n     */\n    moveTo(x, y = this.y, z = this.z, callEvent = true) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n\n        this.clearSaveCache();\n        this.updateObjectPosition();\n\n        if (callEvent) {\n            this.parentEntity.callEvent(\"onEntityMove\");\n        }\n    }\n\n    updateRotation(xRot, yRot = this.yRot, zRot = this.zRot) {\n        this.xRot = xRot;\n        this.yRot = yRot;\n        this.zRot = zRot;\n        this.clearSaveCache();\n    }\n\n    updateOffsets(xOffset, yOffset = this.yOffset, zOffset = this.zOffset) {\n        this.xOffset = xOffset;\n        this.yOffset = yOffset;\n        this.zOffset = zOffset;\n        this.clearSaveCache();\n    }\n\n    updateZOffset(zOffset) {\n        this.zOffset = zOffset;\n        this.clearSaveCache();\n    }\n\n    /**\n     *\n     * @param {_PositionalObject} other\n     */\n    distance(other) {\n        return Math.abs(this.x - other.x) + Math.abs(this.y - other.y) + Math.abs(this.z - other.z);\n    }\n\n    /**\n     *\n     * @param {_PositionalObject} other\n     */\n    horizontalDistance(other) {\n        return Math.max(Math.abs(this.x - other.x), Math.abs(this.y - other.y));\n    }\n\n    /**\n     *\n     * @param {_PositionalObject} other\n     */\n    isSamePosition(other) {\n        if (!other) {\n            return false;\n        }\n\n        return this.x === other.x && this.y === other.y && this.z === other.z;\n    }\n\n    onEntityDeath() {\n        const self = this;\n        const rotation = {\n            xRot: this.xRot,\n            yRot: this.yRot,\n            zRot: this.zRot,\n            zOffset: this.zOffset\n        };\n        const finalRotation = {\n            xRot: 0,\n            yRot: 0,\n            zRot: Math.random() * 2,\n            zOffset: 0\n        };\n\n        this.deathAnimation = new TWEEN.Tween(rotation).to(finalRotation, 200);\n        this.deathAnimation.onUpdate(function () {\n            self.updateRotation(rotation.xRot, rotation.yRot, rotation.zRot);\n            self.updateZOffset(rotation.zOffset);\n            self.updateObjectPosition();\n            engine.needsMapUpdate = true;\n        });\n        this.deathAnimation.start();\n    }\n}","/**\n * Adapted from http://youmightnotneedjquery.com/\n */\nexport default class Extend {\n    constructor() {}\n\n    static extend(out) {\n        out = out || {};\n\n        for (let i = 1; i < arguments.length; i++) {\n            if (!arguments[i]) {\n                continue;\n            }\n\n            for (const key in arguments[i]) {\n                if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {\n                    out[key] = arguments[i][key];\n                }\n            }\n        }\n\n        return out;\n    }\n\n    static deep(out) {\n        out = out || {};\n\n        for (let i = 1; i < arguments.length; i++) {\n            const obj = arguments[i];\n\n            if (!obj) {\n                continue;\n            }\n\n            for (const key in obj) {\n                if (Object.prototype.hasOwnProperty.call(obj, key)) {\n                    if (typeof obj[key] === \"object\") {\n                        if (obj[key] instanceof Array) {\n                            out[key] = obj[key].slice(0);\n                        } else {\n                            out[key] = Extend.deep(out[key], obj[key]);\n                        }\n                    } else {\n                        if (typeof out === \"boolean\" && out[key] === undefined) {\n                            out = obj[key];\n                        } else {\n                            out[key] = obj[key];\n                        }\n                    }\n                }\n            }\n        }\n\n        return out;\n    }\n}","import _PositionalObject from \"./_PositionalObject\";\nimport * as THREE from \"three\";\nimport Extend from \"../../util/Extend\";\n\nconst cachedSolidGeometries = [];\nexport default class SolidObject extends _PositionalObject {\n    constructor(args = {}) {\n        const hasComponent = args.components && args.components.solidobject;\n        if (hasComponent) {\n            args.components.positionalobject = args.components.positionalobject || {};\n            args.components.positionalobject = Extend.extend(args.components.positionalobject, args.components.solidobject);\n        }\n        super(args, \"solidobject\");\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            solidobject: {}\n        };\n\n        this.cachedSave = Extend.deep(super.save(), saveJson);\n        return this.cachedSave;\n    }\n\n    createObject() {\n        this.meshes = [];\n        const newDepth = this.scale * this.depth;\n\n        let anyFound = false;\n        for (const geometry of cachedSolidGeometries) {\n            if (geometry.parameters.depth === newDepth) {\n                this.geometry = geometry;\n                anyFound = true;\n                break;\n            }\n        }\n\n        if (!anyFound) {\n            this.geometry = new THREE.BoxBufferGeometry(this.width, this.height, newDepth);\n            cachedSolidGeometries.push(this.geometry);\n        }\n        this.object = new THREE.Mesh(\n            this.geometry,\n            new THREE.MeshLambertMaterial({color: this.color})\n        );\n        this.object.originalColor = this.color;\n        this.meshes.push(this.object);\n\n        this.updateObjectPosition();\n        this.object.parentEntity = this.parentEntity;\n    }\n}","import _PositionalObject from \"./_PositionalObject\";\nimport * as THREE from \"three\";\nimport Extend from \"../../util/Extend\";\nimport helvetikerFont from \"../../../fonts/helvetiker_regular.typeface.json\";\nimport jetbrainsFont from \"../../../fonts/JetBrains Mono_Regular.json\";\nimport mplusCustomFont from \"../../../fonts/mplus_custom.json\";\n//import mplus from \"../../../fonts/Rounded Mplus 1c_Regular.json\";\nimport pressStartFont from \"../../../fonts/Press Start 2P_Regular.json\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport engine from \"../../Engine\";\n\nconst cachedTextGeometries = [];\nconst fontCache = new Map();\nexport default class CharacterObject extends _PositionalObject {\n    constructor(args = {}) {\n        const hasComponent = args.components && args.components.characterobject;\n        if (hasComponent) {\n            args.components.positionalobject = args.components.positionalobject || {};\n            args.components.positionalobject = Extend.extend(args.components.characterobject, args.components.positionalobject);\n        }\n\n        super(args, \"characterobject\");\n\n        this.fontName = \"helvetiker\";\n        this.letter = \"@\";\n        this.centered = true;\n        this.characters = [];\n\n        if (hasComponent) {\n            const characterobject = args.components.characterobject;\n            this.fontName = characterobject.fontName || \"helvetiker\";\n            this.letter = characterobject.letter || \"@\";\n            if (characterobject.centered !== undefined) {\n                this.centered = characterobject.centered;\n            }\n\n            if (characterobject.characters !== undefined) {\n                this.characters = characterobject.characters;\n            }\n        }\n\n        switch(this.fontName) {\n            case \"mplus\":\n                if (!fontCache.has(this.fontName)) {\n                    fontCache.set(this.fontName, new THREE.Font(mplusCustomFont));\n                }\n\n                this.font = fontCache.get(this.fontName);\n                break;\n            case \"helvetiker\":\n                if (!fontCache.has(this.fontName)) {\n                    fontCache.set(this.fontName, new THREE.Font(helvetikerFont));\n                }\n\n                this.font = fontCache.get(this.fontName);\n                break;\n            case \"jetbrains\":\n                if (!fontCache.has(this.fontName)) {\n                    fontCache.set(this.fontName, new THREE.Font(jetbrainsFont));\n                }\n\n                this.font = fontCache.get(this.fontName);\n                break;\n            case \"pressStart\":\n            default:\n                if (!fontCache.has(this.fontName)) {\n                    fontCache.set(this.fontName, new THREE.Font(pressStartFont));\n                }\n\n                this.font = fontCache.get(this.fontName);\n                break;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            characterobject: {}\n        };\n\n        if (this.fontName !== \"helvetiker\") {\n            saveJson.characterobject.fontName = this.fontName;\n        }\n\n        if (this.letter !== \"@\") {\n            saveJson.characterobject.letter = this.letter;\n        }\n\n        if (this.centered !== true) {\n            saveJson.characterobject.centered = this.centered;\n        }\n\n        if (this.characters.length > 0) {\n            saveJson.characterobject.characters = JSON.stringify(this.characters);\n        }\n\n        this.cachedSave = Extend.deep(super.save(), saveJson);\n        return this.cachedSave;\n    }\n\n    createObject() {\n        super.createObject();\n        this.meshes = [];\n\n        if (this.characters.length > 0) {\n            this.object = new THREE.Group();\n            this.object.originalColor = this.color;\n\n            for (const character of this.characters) {\n                const letter = character.letter || this.letter;\n                const color = character.color || this.color;\n                let scale;\n                if (character.scale !== undefined) {\n                    scale = character.scale;\n                } else {\n                    scale = this.scale;\n                }\n\n                let depth;\n                if (character.depth !== undefined) {\n                    depth = character.depth;\n                } else {\n                    depth = this.depth;\n                }\n\n                let size;\n                if (character.size !== undefined) {\n                    size = character.size;\n                } else {\n                    size = this.size;\n                }\n\n                let font;\n                if (character.fontName) {\n                    font = fontCache.get(character.fontName);\n                } else {\n                    font = this.font;\n                }\n\n                this.object.add(this.createMesh(scale, depth, size, font, letter, color, character));\n            }\n        } else {\n            this.object = this.createMesh(this.scale, this.depth, this.size, this.font, this.letter, this.color);\n        }\n\n        this.setTransparency();\n\n        this.updateObjectPosition();\n    }\n\n    createMesh(scale, depth, size, font, letter, color, options) {\n        const newHeight = scale * depth;\n        const newSize = 4.1 / 5 * depth * size;\n\n        let anyFound = false;\n        for (const geometry of cachedTextGeometries) {\n            const sameFont = geometry.cachedFamilyName === font.data.familyName;\n            const sameSize = geometry.cachedSize === newSize;\n\n            if (sameFont && sameSize && geometry.cachedHeight === newHeight && geometry.cachedLetter === letter && geometry.cachedCentered === this.centered) {\n                this.geometry = geometry;\n                anyFound = true;\n                break;\n            }\n        }\n\n        if (!anyFound) {\n            this.geometry = new THREE.TextGeometry(letter, {\n                font: font,\n                size: newSize,\n                height: newHeight,\n                curveSegments: 12,\n                bevelEnabled: true,\n                bevelThickness: .05,\n                bevelSize: .05,\n                bevelOffset: 0,\n                bevelSegments: 1\n            });\n            this.geometry.cachedFamilyName = font.data.familyName;\n            this.geometry.cachedSize = newSize;\n            this.geometry.cachedHeight = newHeight;\n            this.geometry.cachedLetter = letter;\n            this.geometry.cachedCentered = this.centered;\n            if (this.centered) {\n                this.geometry.center();\n            }\n\n            cachedTextGeometries.push(this.geometry);\n        }\n\n        const mesh = new THREE.Mesh(\n            this.geometry,\n            new THREE.MeshLambertMaterial({color: color})\n        );\n\n        if (options) {\n            if (options.xOffset !== undefined) {\n                mesh.translateX(options.xOffset * this.width);\n            }\n\n            if (options.yOffset !== undefined) {\n                mesh.translateY(options.yOffset * this.height);\n            }\n\n            if (options.zOffset !== undefined) {\n                mesh.translateZ(options.zOffset * this.depth);\n            }\n\n            if (options.xRot !== undefined) {\n                mesh.rotateX(options.xRot * Math.PI);\n            }\n\n            if (options.yRot !== undefined) {\n                mesh.rotateY(options.yRot * Math.PI);\n            }\n\n            if (options.zRot !== undefined) {\n                mesh.rotateZ(options.zRot * Math.PI);\n            }\n\n\n            let lastAnimation;\n            let animateInTween;\n            if (options.animateIn !== undefined) {\n                const animation = options.animateIn;\n                const startScale = animation.start.scale;\n                if (startScale !== undefined) {\n                    mesh.scale.x = startScale;\n                    mesh.scale.y = startScale;\n                    mesh.scale.z = startScale;\n                }\n                animateInTween = this.setupAnimation(mesh, animation);\n                lastAnimation = animateInTween;\n            }\n\n            if (options.animations !== undefined) {\n                let firstAnimation;\n                for (const animation of options.animations) {\n                    const newAnimation = this.setupAnimation(mesh, animation);\n                    if (lastAnimation) {\n                        lastAnimation.chain(newAnimation);\n                    }\n\n                    lastAnimation = newAnimation;\n\n                    if (!firstAnimation) {\n                        firstAnimation = newAnimation;\n                    }\n                }\n\n                lastAnimation.chain(firstAnimation);\n\n                if (!animateInTween) {\n                    firstAnimation.start();\n                }\n            }\n\n            if (animateInTween) {\n                animateInTween.start();\n            }\n        }\n        mesh.originalColor = color;\n        mesh.parentEntity = this.parentEntity;\n        this.meshes.push(mesh);\n\n        return mesh;\n    }\n\n    setupAnimation(mesh, options) {\n        let time;\n        if (options.time !== undefined) {\n            time = options.time;\n        } else {\n            time = 500;\n        }\n\n        const end = {\n            x: options.end.scale,\n            y: options.end.scale,\n            z: options.end.scale\n        };\n\n        const tween = new TWEEN.Tween(mesh.scale).to(end, time);\n        tween.onUpdate(function() {\n            const percent = ((TWEEN.now() - this._startTime) / this._duration);\n\n            if (options.zRotation !== undefined) {\n                mesh.rotation.z = options.zRotation * percent * 2 * Math.PI;\n            }\n\n            engine.needsMapUpdate = true;\n        });\n\n        return tween;\n    }\n}","import _Component from \"./_Component\";\n\nexport default class BlocksMovement extends _Component {\n    constructor(args = {}) {\n        super(args, \"blocksMovement\");\n        const hasComponent = args.components && args.components.blocksMovement !== undefined;\n\n        // Whether the tile can moved into\n        this.blocksMovement = false;\n\n        if (hasComponent) {\n            const type = typeof args.components.blocksMovement;\n            if (type === \"boolean\") {\n                this.blocksMovement = args.components.blocksMovement;\n            } else if (type === \"object\") {\n                if (args.components.blocksMovement) {\n                    this.blocksMovement = args.components.blocksMovement.blocksMovement;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson;\n        if (this.blocksMovement) {\n            saveJson = {\n                blocksMovement: this.blocksMovement\n            };\n        } else {\n            saveJson = {};\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    onEntityDeath() {\n        this.blocksMovement = false;\n\n        this.clearSaveCache();\n    }\n}","import _Component from \"./_Component\";\n\nexport default class Walkable extends _Component {\n    constructor(args = {}) {\n        super(args, \"walkable\");\n        const hasComponent = args.components && args.components.walkable !== undefined;\n\n        // Can walk on top of\n        this.walkable = false;\n\n        if (hasComponent) {\n            const type = typeof args.components.walkable;\n            if (type === \"boolean\") {\n                this.walkable = args.components.walkable;\n            } else if (type === \"object\") {\n                if (args.components.walkable) {\n                    this.walkable = args.components.walkable.walkable;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            walkable: this.walkable\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n}","import _Component from \"./_Component\";\n\nexport default class Fov extends _Component {\n    constructor(args = {}) {\n        super(args, \"fov\");\n        const hasComponent = args.components && args.components.fov;\n\n        this.explored = false;\n        this.visible = false;\n\n        if (hasComponent) {\n            this.explored = args.components.fov.explored || false;\n            this.visible = args.components.fov.visible || false;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson;\n        if (this.explored) {\n            saveJson = {\n                fov: {\n                    explored: this.explored\n                }\n            };\n        } else {\n            saveJson = {};\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    setExplored(explored) {\n        this.explored = explored;\n        this.clearSaveCache();\n    }\n\n    setVisible(visible) {\n        this.visible = visible;\n    }\n}","import _Component from \"./_Component\";\n\nexport default class BlocksFov extends _Component {\n    constructor(args = {}) {\n        super(args, \"blocksFov\");\n        const hasComponent = args.components && args.components.blocksFov !== undefined;\n\n        // Whether the tile can be seen through\n        this.blocksFov = false;\n\n        if (hasComponent) {\n            const type = typeof args.components.blocksFov;\n            if (type === \"boolean\") {\n                this.blocksFov = args.components.blocksFov;\n            } else if (type === \"object\") {\n                if (args.components.blocksFov) {\n                    this.blocksFov = args.components.blocksFov.blocksFov;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson;\n        if (this.blocksFov) {\n            saveJson = {\n                blocksFov: this.blocksFov\n            };\n        } else {\n            saveJson = {};\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n}","const MapLayer = Object.freeze({\n    Floor: 0,\n    Wall: 1,\n    DecorativeBG: 2,\n    Decorative: 2.05\n});\n\nexport default MapLayer;\n\n","import _Component from \"./_Component\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport engine from \"../Engine\";\nimport MapLayer from \"../map/MapLayer\";\n\nexport default class Openable extends _Component {\n    constructor(args = {}) {\n        super(args, \"openable\");\n        const hasComponent = args.components && args.components.openable;\n\n        this.isOpen = false;\n        this.openEntity = null;\n        this.closedEntity = null;\n\n        if (hasComponent) {\n            this.isOpen = args.components.openable.isOpen || false;\n            this.openEntity = args.components.openable.openEntity;\n            this.closedEntity = args.components.openable.closedEntity;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            openable: {\n                isOpen: this.isOpen,\n                openEntity: this.openEntity,\n                closedEntity: this.closedEntity\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    open() {\n        if (!this.isOpen) {\n            this.isOpen = true;\n\n            const position = this.parentEntity.getComponent(\"positionalobject\");\n            if (position) {\n                position.teardown();\n                this.parentEntity = entityLoader.createFromTemplate(this.openEntity, {components: {positionalobject: {x: position.x, y: position.y, z: position.z}}});\n                engine.gameMap.tiles.get(MapLayer.Wall)[position.x][position.y] = this.parentEntity;\n            }\n\n            this.clearSaveCache();\n            return true;\n        }\n\n        return false;\n    }\n\n    close() {\n        if (this.isOpen) {\n            this.isOpen = false;\n\n            const position = this.parent.getComponent(\"positionalobject\");\n            if (position) {\n                position.teardown();\n                this.parentEntity = entityLoader.create(this.closedEntity, {components: {positionalobject: {x: position.x, y: position.y, z: position.z}}});\n                engine.gameMap.tiles.get(MapLayer.Wall)[position.x][position.y] = this.parent;\n            }\n\n            this.clearSaveCache();\n            return true;\n        }\n\n        return false;\n    }\n}","import _Component from \"./_Component\";\n\nexport default class VisibilityModifier extends _Component {\n    constructor(args = {}) {\n        super(args, \"visibilityModifier\");\n        const hasComponent = args.components && args.components.visibilityModifier !== undefined;\n\n        this.modifier = \"+\";\n        this.amount = 0;\n\n        if (hasComponent) {\n            const arg = args.components.visibilityModifier;\n            if (arg.modifier) {\n                this.modifier = arg.modifier;\n            }\n\n            this.amount = arg.amount;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"visibilityModifier\": {\n                \"modifier\": this.modifier,\n                \"amount\": this.amount\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getVisibility(visibility) {\n        switch (this.modifier) {\n            case \"+\":\n            default:\n                return visibility + this.amount;\n            case \"-\": return visibility - this.amount;\n            case \"*\": return visibility * this.amount;\n            case \"/\": return visibility / this.amount;\n        }\n    }\n}","import _Component from \"../_Component\";\nimport {Vector3} from \"three\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport engine from \"../../Engine\";\n\nexport default class AI extends _Component {\n    constructor(args = {}, type) {\n        super(args, \"ai\", type);\n    }\n\n    save() {\n        return null;\n    }\n\n    perform() {\n        console.error(\"Not Implemented\");\n    }\n\n    onMeleeAttack(blockingActor) {\n        const entity = this.parentEntity;\n        const position = entity.getComponent(\"positionalobject\");\n        if (position) {\n            entity.stopCombatAnimations();\n\n            const blockingPosition = blockingActor.getComponent(\"positionalobject\");\n            if (position && position.hasObject() && blockingPosition && blockingPosition.hasObject()) {\n                const originalPosition = new Vector3(position.object.position.x, position.object.position.y, position.object.position.z);\n                const attackPosition = new Vector3((position.object.position.x + blockingPosition.object.position.x) / 2, (position.object.position.y + blockingPosition.object.position.y) / 2, (position.object.position.z + blockingPosition.object.position.z) / 2);\n                const currentPosition = originalPosition.clone();\n\n                const tweenAttack = new TWEEN.Tween(currentPosition).to(attackPosition, 100);\n                tweenAttack.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                const tweenReturn = new TWEEN.Tween(currentPosition).to(originalPosition, 100);\n                tweenReturn.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                tweenAttack.chain(tweenReturn);\n                tweenAttack.start();\n\n                entity.combatTweens.push(tweenAttack);\n                entity.combatTweens.push(tweenReturn);\n            }\n        }\n    }\n\n    onEntityMove() {\n        const entity = this.parentEntity;\n        entity.stopCombatAnimations();\n    }\n}","import AI from \"./_AI\";\n\nexport default class AIDead extends AI {\n    constructor(args = {}) {\n        super(args, \"aiDead\");\n        const hasComponent = args.components && args.components.aiDead !== undefined;\n\n        this.previousAI = \"\";\n\n        if (hasComponent) {\n            const aiDead = args.components.aiDead;\n            if (aiDead && aiDead.previousAI) {\n                this.previousAI = aiDead.previousAI;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiDead\": {\n                \"previousAI\": this.previousAI\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {}\n}","import html from \"../../../html/menu/GameOver.html\";\nimport UIElement from \"../UIElement\";\n\nclass GameOverMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst gameOverMenu = new GameOverMenu();\nexport default gameOverMenu;","import EventHandler from \"./_EventHandler\";\nimport gameOverMenu from \"../ui/menu/GameOverMenu\";\nimport engine from \"../Engine\";\nimport MainMenuEventHandler from \"./MainMenuEventHandler\";\n\nexport default class GameOverEventHandler extends EventHandler {\n    constructor() {\n        super();\n\n        engine.player = null;\n        gameOverMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        gameOverMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (classList.contains(\"menu__return\")) {\n            this.returnToMainMenu();\n        }\n    }\n\n    returnToMainMenu() {\n        engine.setEventHandler(new MainMenuEventHandler());\n    }\n}","import html from \"../../html/ui/CharacterHealth.html\";\nimport UIElement from \"./UIElement\";\n\nclass CharacterHealth extends UIElement {\n    constructor() {\n        super(html);\n\n        this.fgDom = this.dom.getElementsByClassName(\"character-info__fg\")[0];\n        this.textDom = this.dom.getElementsByClassName(\"character-info__text\")[0];\n    }\n\n    update(current, max) {\n        const percent = current / max;\n        const height = percent * 80.5;\n        this.fgDom.style.height = height + \"%\";\n\n        this.textDom.innerText = current + \" / \" + max;\n    }\n}\n\nconst characterHealth = new CharacterHealth();\nexport default characterHealth;","import html from \"../../html/ui/CharacterMana.html\";\nimport UIElement from \"./UIElement\";\n\nclass CharacterMana extends UIElement {\n    constructor() {\n        super(html);\n\n        this.fgDom = this.dom.getElementsByClassName(\"character-info__fg\")[0];\n        this.textDom = this.dom.getElementsByClassName(\"character-info__text\")[0];\n    }\n\n    update(current, max) {\n        const percent = current / max;\n        const height = percent * 76.5;\n        this.fgDom.style.height = (100 - height) + \"%\";\n\n        this.textDom.innerText = current + \" / \" + max;\n    }\n}\n\nconst characterMana = new CharacterMana();\nexport default characterMana;","import html from \"../../html/ui/Character.html\";\nimport UIElement from \"./UIElement\";\nimport engine from \"../Engine\";\n\nclass Character extends UIElement {\n    constructor() {\n        super(html);\n\n        this.strengthDom = this.dom.getElementsByClassName(\"stat--strength\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.damageDom = this.dom.getElementsByClassName(\"attribute--damage\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.agilityDom = this.dom.getElementsByClassName(\"stat--agility\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.defenseDom = this.dom.getElementsByClassName(\"attribute--defense\")[0].getElementsByClassName(\"attribute__value\")[0];\n        this.blockChanceDom = this.dom.getElementsByClassName(\"attribute--blockchance\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.constitutionDom = this.dom.getElementsByClassName(\"stat--constitution\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.healthDom = this.dom.getElementsByClassName(\"attribute--health\")[0].getElementsByClassName(\"attribute__value\")[0];\n        this.healingBonusDom = this.dom.getElementsByClassName(\"attribute--healing-bonus\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.wisomDom = this.dom.getElementsByClassName(\"stat--wisdom\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.manaDom = this.dom.getElementsByClassName(\"attribute--mana\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.availableStatPointsDom = this.dom.getElementsByClassName(\"available-stats__value\")[0];\n\n        this.levelDom = this.dom.getElementsByClassName(\"character__level-value\")[0];\n        this.currentXpDom = this.dom.getElementsByClassName(\"character__current-xp\")[0];\n        this.neededXpDom = this.dom.getElementsByClassName(\"character__needed-xp\")[0];\n\n        this.xpFilledDom = this.dom.getElementsByClassName(\"character__xp-filled\")[0];\n    }\n\n    populate(player) {\n        const fighter = player.getComponent(\"fighter\");\n        this.strengthDom.innerText = fighter.strength;\n        this.damageDom.innerText = fighter.getDamageDisplay();\n\n        this.agilityDom.innerText = fighter.agility;\n        this.defenseDom.innerText = fighter.defense;\n        this.blockChanceDom.innerText = fighter.blockChance + \"%\";\n\n        this.constitutionDom.innerText = fighter.constitution;\n        this.healthDom.innerText = fighter.hp + \" / \" + fighter.maxHp;\n        this.healingBonusDom.innerText = fighter.healingBonus;\n\n        this.wisomDom.innerText = fighter.wisdom;\n        this.manaDom.innerText = fighter.mana + \" / \" + fighter.maxMana;\n\n        const level = player.getComponent(\"level\");\n        if (level.statPointsAvailable) {\n            this.dom.classList.add(\"has-statpoint\");\n        } else {\n            this.dom.classList.remove(\"has-statpoint\");\n        }\n\n        this.availableStatPointsDom.innerText = level.statPointsAvailable;\n\n        this.levelDom.innerText = level.level;\n        this.currentXpDom.innerText = level.xp;\n        this.neededXpDom.innerText = level.xpForLevel(level.level);\n        this.xpFilledDom.style.width = level.getPercentXPTowardsLevel() + \"%\";\n    }\n\n    toggle() {\n        if (this.isOpen()) {\n            this.close();\n        } else {\n            this.populate(engine.player);\n            this.open();\n        }\n    }\n}\n\nconst character = new Character();\nexport default character;","import _Component from \"./_Component\";\nimport engine from \"../Engine\";\nimport AIDead from \"./ai/AIDead\";\nimport GameOverEventHandler from \"../event/GameOverEventHandler\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport characterHealth from \"../ui/CharacterHealth\";\nimport characterMana from \"../ui/CharacterMana\";\nimport {MathUtils, Vector3} from \"three\";\nimport CharacterObject from \"./positionalObject/CharacterObject\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport sceneState from \"../SceneState\";\nimport character from \"../ui/Character\";\n\nexport default class Fighter extends _Component {\n    constructor(args = {}) {\n        super(args, \"fighter\");\n        const hasComponent = args.components && args.components.fighter !== undefined;\n\n        this.baseStrength = 0;\n        this.baseDamage = 0;\n\n        this.baseAgility = 0;\n        this.baseDefense = 0;\n\n        this.baseConstitution = 0;\n        this.baseHp = 0;\n        this.hp = null;\n\n        this.baseWisdom = 0;\n        this.baseMana = 0;\n        this.mana = null;\n\n        if (hasComponent) {\n            const fighter = args.components.fighter;\n            if (fighter.strength !== undefined) {\n                this.baseStrength = fighter.strength;\n            }\n\n            if (fighter.agility !== undefined) {\n                this.baseAgility = fighter.agility;\n            }\n\n            if (fighter.constitution !== undefined) {\n                this.baseConstitution = fighter.constitution;\n            }\n\n            if (fighter.wisdom !== undefined) {\n                this.baseWisdom = fighter.wisdom;\n            }\n\n            if (fighter.baseDamage !== undefined) {\n                this.baseDamage = fighter.baseDamage;\n            }\n\n            if (fighter.baseDefense !== undefined) {\n                this.baseDefense = fighter.baseDefense;\n            }\n\n            if (fighter.baseHp !== undefined) {\n                this.baseHp = fighter.baseHp;\n            }\n\n            if (fighter.hp !== undefined) {\n                this.hp = fighter.hp;\n            }\n\n            if (fighter.baseMana !== undefined) {\n                this.baseMana = fighter.baseMana;\n            }\n\n            if (fighter.mana !== undefined) {\n                this.mana = fighter.mana;\n            }\n        }\n\n        this.minDamage = 0;\n        this.maxDamage = 0;\n        this.defense = 0;\n        this.blockChance = 0;\n        this.healingBonus = 0;\n        this.strength = 0;\n        this.agility = 0;\n        this.constitution = 0;\n        this.wisdom = 0;\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            fighter: {\n                hp: this.hp,\n                mana: this.mana\n            }\n        };\n\n        if (this.baseStrength > 0) {\n            saveJson.fighter.strength = this.baseStrength;\n        }\n        if (this.baseAgility > 0) {\n            saveJson.fighter.agility = this.baseAgility;\n        }\n        if (this.baseConstitution > 0) {\n            saveJson.fighter.constitution = this.baseConstitution;\n        }\n        if (this.baseWisdom > 0) {\n            saveJson.fighter.wisdom = this.baseWisdom;\n        }\n        if (this.baseDamage > 0) {\n            saveJson.fighter.baseDamage = this.baseDamage;\n        }\n        if (this.baseDefense > 0) {\n            saveJson.fighter.baseDefense = this.baseDefense;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    recalculateStats() {\n        this.calculateStats();\n        this.healingBonus = Math.floor(this.constitution / 2);\n\n        const newMax = this.getMaxHp();\n        if (this.hp === null || this.hp >= this.maxHp) {\n            this.hp = newMax;\n        }\n        this.maxHp = newMax;\n\n        const newMaxMana = this.getMaxMana();\n        if (this.mana === null || this.mana >= this.maxMana) {\n            this.mana = newMaxMana;\n        }\n        this.maxMana = newMaxMana;\n\n        this.calculateDamage();\n        this.calculateDefense();\n        this.calculateBlockChance();\n\n        this.updateUI();\n        this.clearSaveCache();\n    }\n\n    calculateStats() {\n        let equipmentStrength = 0;\n        let equipmentAgility = 0;\n        let equipmentConstitution = 0;\n        let equipmentWisdom = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentStrength += equippable.strength;\n                equipmentAgility += equippable.agility;\n                equipmentConstitution += equippable.constitution;\n                equipmentWisdom += equippable.wisdom;\n            }\n        }\n\n        this.strength = this.baseStrength + equipmentStrength;\n        this.agility = this.baseAgility + equipmentAgility;\n        this.constitution = this.baseConstitution + equipmentConstitution;\n        this.wisdom = this.baseWisdom + equipmentWisdom;\n    }\n\n    calculateDamage() {\n        const statDamage = this.baseDamage + this.strength;\n\n        let equipmentMinDamage = 0;\n        let equipmentMaxDamage = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentMinDamage += equippable.minDamage;\n                equipmentMaxDamage += equippable.maxDamage;\n            }\n        }\n\n        this.minDamage = statDamage + equipmentMinDamage;\n        this.maxDamage = Math.floor(statDamage * 1.5) + equipmentMaxDamage;\n    }\n\n    calculateDefense() {\n        const statDefense = this.baseDefense + (this.agility * 10);\n\n        let equipmentDefense = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentDefense += equippable.defense;\n            }\n        }\n\n        this.defense = statDefense + equipmentDefense;\n    }\n\n    calculateBlockChance() {\n        const statBlockChance = this.agility * 2;\n\n        let equipmentBlockChance = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentBlockChance += equippable.blockChance;\n            }\n        }\n\n        this.blockChance = Math.min(statBlockChance + equipmentBlockChance, 90);\n    }\n\n    getDamage() {\n        if (this.minDamage === this.maxDamage) {\n            return this.minDamage;\n        } else {\n            return MathUtils.randInt(this.minDamage, this.maxDamage);\n        }\n    }\n\n    getDamageDisplay() {\n        if (this.minDamage === this.maxDamage) {\n            return this.minDamage;\n        } else {\n            return this.minDamage + \" - \" + this.maxDamage;\n        }\n    }\n\n    getBlockedDamage() {\n        return Math.floor(MathUtils.randFloat(this.defense / 10, this.defense) / 10);\n    }\n\n    getMaxHp() {\n        const statHp = this.baseHp + this.constitution * 15;\n\n        let equipmentHp = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentHp += equippable.health;\n            }\n        }\n\n        return statHp + equipmentHp;\n    }\n\n    getMaxMana() {\n        const statMana = this.baseMana + this.wisdom * 10;\n\n        let equipmentMana = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentMana += equippable.mana;\n            }\n        }\n\n        return statMana + equipmentMana;\n    }\n\n    createDamageIndicator(damage, color) {\n        const position = this.parentEntity.getComponent(\"positionalobject\");\n        if (position) {\n            const xRand = position.x + MathUtils.randFloat(-.25, .25);\n            const yRand = position.y + MathUtils.randFloat(-.25, .25);\n            const zRand = position.z + 1.1 + MathUtils.randFloat(0, 1);\n            const args = {\n                components: {\n                    characterobject: {\n                        letter: \"\" + damage,\n                        x: xRand,\n                        y: yRand,\n                        z: zRand,\n                        xRot: .5,\n                        yRot: .25,\n                        zRot: 0,\n                        color: color,\n                        scale: .05,\n                        size: .5\n                    }\n                }\n            };\n\n            const indicator = new CharacterObject(args);\n            indicator.parentEntity = this;\n            indicator.setVisible();\n            const current = new Vector3(position.x, position.y, zRand);\n            const target = new Vector3(position.x, position.y, zRand + 3);\n\n            const tween = new TWEEN.Tween(current).to(target, 500);\n            tween.easing(TWEEN.Easing.Cubic.In);\n            tween.onUpdate(function () {\n                indicator.z = current.z;\n                indicator.updateObjectPosition();\n                engine.needsMapUpdate = true;\n            });\n            tween.onComplete(function () {\n                sceneState.scene.remove(indicator.object);\n            });\n            tween.start();\n        }\n    }\n\n    takeDamage(damage) {\n        this.hp -= damage;\n\n        this.updateUI();\n        if (this.isPlayer()) {\n            this.createDamageIndicator(damage, \"#C00\");\n        } else {\n            this.createDamageIndicator(damage, \"#999\");\n        }\n\n        if (this.hp <= 0) {\n            this.die();\n        }\n\n        this.clearSaveCache();\n    }\n\n    heal(amount) {\n        if (this.hp === this.maxHp) {\n            return 0;\n        }\n\n        const newHp = Math.min(this.maxHp, this.hp + amount);\n        const healedHp = newHp - this.hp;\n        this.hp = newHp;\n\n        this.updateUI();\n\n        this.createDamageIndicator(healedHp, \"#090\");\n        this.clearSaveCache();\n\n        return healedHp;\n    }\n\n    consumeMana(amount) {\n        if (this.mana < amount) {\n            return false;\n        }\n\n        this.mana -= amount;\n\n        this.updateUI();\n\n        this.clearSaveCache();\n    }\n\n    recoverMana(amount) {\n        if (this.mana === this.maxMana) {\n            return 0;\n        }\n\n        const newMana = Math.min(this.maxMana, this.mana + amount);\n        const recoveredMana = newMana - this.mana;\n        this.mana = newMana;\n\n        this.updateUI();\n\n        this.clearSaveCache();\n\n        return recoveredMana;\n    }\n\n    die() {\n        const entity = this.parentEntity;\n        if (this.isPlayer()) {\n            messageConsole.text(\"You died!\", \"#f00\");\n            engine.setEventHandler(new GameOverEventHandler());\n        } else {\n            messageConsole.text(entity.name + \" dies!\", \"#ffa030\");\n        }\n        messageConsole.build();\n\n        entity.callEvent(\"onEntityDeath\");\n\n        const ai = entity.getComponent(\"ai\");\n        if (ai) {\n            const aiType = ai.type;\n            const aiArgs = {\n                components: {\n                    aiDead: {\n                        previousAI: aiType\n                    }\n                }\n            };\n            entity.removeComponent(\"ai\");\n            const newAI = new AIDead(aiArgs);\n            entity.setComponent(newAI);\n        }\n\n        this.clearSaveCache();\n    }\n\n    getHealthDescription() {\n        const percent = (this.hp / this.maxHp) * 100;\n        let description = \"\";\n\n        if (percent >= 90 && percent < 100) {\n            description = \"(Barely Scratched)\";\n        } else if (percent >= 75 && percent < 90) {\n            description = \"(Lightly Damaged)\";\n        } else if (percent >= 50 && percent < 75) {\n            description = \"(Damaged)\";\n        } else if (percent >= 25 && percent < 50) {\n            description = \"(Very Damaged)\";\n        } else if (percent >= 10 && percent < 25) {\n            description = \"(Extremely Damaged)\";\n        } else if (percent > 0 && percent < 10) {\n            description = \"(Nearly Dead)\";\n        }\n\n        return description;\n    }\n\n    updateUI() {\n        if (this.isPlayer()) {\n            characterHealth.update(this.hp, this.maxHp);\n            characterMana.update(this.mana, this.maxMana);\n            character.populate(engine.player);\n        }\n    }\n\n    onComponentsLoaded() {\n        this.recalculateStats();\n    }\n\n    onEquipmentChange() {\n        this.recalculateStats();\n    }\n}","import Action from \"../_Action\";\n\nexport default class ActionWithDirection extends Action {\n    constructor(entity, dx = 0, dy = 0, dz = 0) {\n        super(entity);\n\n        this.dx = dx;\n        this.dy = dy;\n        this.dz = dz;\n    }\n\n    perform() {\n        console.error(\"Not Implemented\");\n    }\n}","import UnableToPerformAction from \"../UnableToPerformAction\";\nimport engine from \"../../Engine\";\nimport ActionWithDirection from \"./_ActionWithDirection\";\n\nexport default class MovementAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n        const destZ = position.z + this.dz;\n\n        const gameMap = engine.gameMap;\n        if (!gameMap.isInBounds(destX, destY)) {\n            return new UnableToPerformAction(this.entity, \"Location is outside the map!\");\n        }\n\n        const ground = this.tryMoveTo(gameMap, destX, destY, destZ);\n        if (!(ground instanceof UnableToPerformAction)) {\n            position.move(this.dx, this.dy, this.dz);\n            return ground;\n        }\n\n        const below = this.tryMoveTo(gameMap, destX, destY, destZ - 1);\n        if (!(below instanceof UnableToPerformAction)) {\n            position.move(this.dx, this.dy, this.dz - 1);\n            return below;\n        }\n\n        const above = this.tryMoveTo(gameMap, destX, destY, destZ + 1);\n        if (!(above instanceof UnableToPerformAction)) {\n            position.move(this.dx, this.dy, this.dz + 1);\n            return above;\n        }\n\n        return ground;\n    }\n\n    tryMoveTo(gameMap, destX, destY, destZ) {\n        const blockingActor = gameMap.getBlockingActorAtLocation(destX, destY, destZ);\n        if (blockingActor) {\n            return new UnableToPerformAction(this.entity, \"There's something in the way!\");\n        }\n\n        if (gameMap.tiles.has(destZ)) {\n            const wallTile = gameMap.tiles.get(destZ)[destX][destY];\n            if (wallTile) {\n                const blocksMovementComponent = wallTile.getComponent(\"blocksMovement\");\n                if (blocksMovementComponent && blocksMovementComponent.blocksMovement) {\n                    return new UnableToPerformAction(this.entity, \"There's a \" + wallTile.name + \" in the way!\");\n                }\n            }\n        }\n\n        if (!gameMap.tiles.has(destZ - 1)) {\n            return new UnableToPerformAction(this.entity, \"No level to walk on!\");\n        }\n\n        const floorTile = gameMap.tiles.get(destZ - 1)[destX][destY];\n        if (!floorTile) {\n            return new UnableToPerformAction(this.entity, \"No floor to walk on.\");\n        }\n\n        const walkableComponent = floorTile.getComponent(\"walkable\");\n        if (walkableComponent && walkableComponent.walkable) {\n            return this;\n        } else {\n            return new UnableToPerformAction(this.entity, \"There's nothing to walk on.\");\n        }\n    }\n}","import Action from \"./_Action\";\n\nexport default class WaitAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        return this;\n    }\n}","import MovementAction from \"./actionWithDirection/MovementAction\";\nimport {MathUtils} from \"three\";\nimport Action from \"./_Action\";\nimport WaitAction from \"./WaitAction\";\n\nexport default class WanderAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        const x = MathUtils.randInt(-1, 1);\n        const y = MathUtils.randInt(-1, 1);\n\n        if (x === 0 && y === 0) {\n            return new WaitAction(this.entity).perform();\n        } else {\n            return new MovementAction(this.entity, x, y, 0).perform();\n        }\n    }\n}","import ActionWithDirection from \"./_ActionWithDirection\";\nimport UnableToPerformAction from \"../UnableToPerformAction\";\nimport engine from \"../../Engine\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport {MathUtils} from \"three\";\n\nexport default class MeleeAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n        const destZ = position.z + this.dz;\n\n        const blockingActor = engine.gameMap.getBlockingActorAtLocation(destX, destY, destZ);\n        if (blockingActor) {\n            const entityFighter = this.entity.getComponent(\"fighter\");\n            const blockingFighter = blockingActor.getComponent(\"fighter\");\n            if (entityFighter && blockingFighter) {\n                let name;\n                let plural;\n                if (this.isPlayer()) {\n                    name = \"You\";\n                    plural = \"\";\n                } else {\n                    name = this.entity.name;\n                    plural = \"s\";\n                }\n\n                let blockingName;\n                let attackColor;\n                if (blockingActor === engine.player) {\n                    blockingName = \"You\";\n                    attackColor = \"#C00\";\n                } else {\n                    blockingName = blockingActor.name;\n                    attackColor = \"#999\";\n                }\n\n                const description = name + \" attack\" + plural + \" \" + blockingName;\n                const blockRandom = MathUtils.randInt(0, 100);\n                if (blockingFighter.blockChance > blockRandom) {\n                    const blockedColor = \"#000\";\n                    messageConsole.text(description + \", but is blocked.\", blockedColor).build();\n                    blockingFighter.takeDamage(0);\n                } else {\n                    const damage = entityFighter.getDamage() - blockingFighter.getBlockedDamage();\n                    if (damage > 0) {\n                        messageConsole.text(description + \" for \" + damage + \" hit points.\", attackColor).build();\n                        blockingFighter.takeDamage(damage);\n                    } else {\n                        messageConsole.text(description + \", but does no damage.\", attackColor).build();\n                    }\n                }\n\n                this.entity.callEvent(\"onMeleeAttack\", blockingActor);\n            }\n        } else {\n            return new UnableToPerformAction(this.entity, \"There's nothing to attack there!\");\n        }\n    }\n}","export default class BinaryHeap {\n    constructor(scoreFunction) {\n        this.content = [];\n        this.scoreFunction = scoreFunction;\n    }\n\n    push(element) {\n        // Add the new element to the end of the array.\n        this.content.push(element);\n\n        // Allow it to sink down.\n        this.sinkDown(this.content.length - 1);\n    }\n\n    pop() {\n        // Store the first element so we can return it later.\n        const result = this.content[0];\n        // Get the element at the end of the array.\n        const end = this.content.pop();\n        // If there are any elements left, put the end element at the\n        // start, and let it bubble up.\n        if (this.content.length > 0) {\n            this.content[0] = end;\n            this.bubbleUp(0);\n        }\n        return result;\n    }\n\n    remove(node) {\n        const i = this.content.indexOf(node);\n\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        const end = this.content.pop();\n\n        if (i !== this.content.length - 1) {\n            this.content[i] = end;\n\n            if (this.scoreFunction(end) < this.scoreFunction(node)) {\n                this.sinkDown(i);\n            } else {\n                this.bubbleUp(i);\n            }\n        }\n    }\n    size() {\n        return this.content.length;\n    }\n\n    rescoreElement(node) {\n        this.sinkDown(this.content.indexOf(node));\n    }\n\n    sinkDown(n) {\n        // Fetch the element that has to be sunk.\n        const element = this.content[n];\n\n        // When at 0, an element can not sink any further.\n        while (n > 0) {\n            // Compute the parent element's index, and fetch it.\n            const parentN = ((n + 1) >> 1) - 1;\n            const parent = this.content[parentN];\n            // Swap the elements if the parent is greater.\n            if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n                this.content[parentN] = element;\n                this.content[n] = parent;\n                // Update 'n' to continue at the new position.\n                n = parentN;\n            }\n            // Found a parent that is less, no need to sink any further.\n            else {\n                break;\n            }\n        }\n    }\n\n    bubbleUp(n) {\n        // Look up the target element and its score.\n        const length = this.content.length;\n        const element = this.content[n];\n        const elemScore = this.scoreFunction(element);\n\n        let isDone = false;\n        while (!isDone) {\n            // Compute the indices of the child elements.\n            const child2N = (n + 1) << 1;\n            const child1N = child2N - 1;\n            // This is used to store the new position of the element, if any.\n            let swap = null;\n            let child1Score;\n            // If the first child exists (is inside the array)...\n            if (child1N < length) {\n                // Look it up and compute its score.\n                const child1 = this.content[child1N];\n                child1Score = this.scoreFunction(child1);\n\n                // If the score is less than our element's, we need to swap.\n                if (child1Score < elemScore) {\n                    swap = child1N;\n                }\n            }\n\n            // Do the same checks for the other child.\n            if (child2N < length) {\n                const child2 = this.content[child2N];\n                const child2Score = this.scoreFunction(child2);\n                if (child2Score < (swap === null ? elemScore : child1Score)) {\n                    swap = child2N;\n                }\n            }\n\n            // If the element needs to be moved, swap it, and continue.\n            if (swap !== null) {\n                this.content[n] = this.content[swap];\n                this.content[swap] = element;\n                n = swap;\n            } else { // Otherwise, we are done.\n                isDone = true;\n                break;\n            }\n        }\n    }\n}","// Modified from http://github.com/bgrins/javascript-astar\nimport BinaryHeap from \"./BinaryHeap\";\n\nexport default class AStar {\n    constructor() {}\n\n    static pathTo(node) {\n        let curr = node;\n        const path = [];\n        while (curr.parent) {\n            path.unshift(curr);\n            curr = curr.parent;\n        }\n        return path;\n    }\n\n    static getHeap() {\n        return new BinaryHeap(function(node) {\n            return node.f;\n        });\n    }\n\n    /**\n     * Perform an A* Search on a graph given a start and end node.\n     * @param {Graph} graph\n     * @param {GridNode} start\n     * @param {GridNode} end\n     * @param {Object} [options]\n     * @param {bool} [options.closest] Specifies whether to return the\n     path to the closest node if the target is unreachable.\n     * @param {string} [options.heuristic] Heuristic function (see\n     *          astar.heuristics).\n     */\n    static search(graph, start, end, options) {\n        graph.cleanDirty();\n        options = options || {};\n        this.heuristicType = options.heuristic || \"manhattan\";\n        const closest = options.closest || false;\n\n        const openHeap = this.getHeap();\n        let closestNode = start; // set the start node to be the closest if required\n\n        if (this.heuristicType === \"manhattan\") {\n            start.h = this.heuristicManhattan(start, end);\n        } else if (this.heuristicType === \"diagonal\") {\n            this.heuristicDiagonal(start, end);\n        }\n        graph.markDirty(start);\n\n        openHeap.push(start);\n\n        while (openHeap.size() > 0) {\n            // Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n            const currentNode = openHeap.pop();\n\n            // End case -- result has been found, return the traced path.\n            if (currentNode === end) {\n                return this.pathTo(currentNode);\n            }\n\n            // Normal case -- move currentNode from open to closed, process each of its neighbors.\n            currentNode.closed = true;\n\n            // Find all neighbors for the current node.\n            const neighbors = graph.neighbors(currentNode);\n\n            for (let i = 0, il = neighbors.length; i < il; ++i) {\n                const neighbor = neighbors[i];\n                if (neighbor.closed || neighbor.isWall()) {\n                    // Not a valid node to process, skip to next neighbor.\n                    continue;\n                }\n\n                // The g score is the shortest distance from start to current node.\n                // We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n                const gScore = currentNode.g + neighbor.getCost(currentNode);\n                const beenVisited = neighbor.visited;\n\n                if (!beenVisited || gScore < neighbor.g) {\n                    // Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n                    neighbor.visited = true;\n                    neighbor.parent = currentNode;\n\n                    if (this.heuristicType === \"manhattan\") {\n                        neighbor.h = neighbor.h || this.heuristicManhattan(neighbor, end);\n                    } else if (this.heuristicType === \"diagonal\") {\n                        neighbor.h = neighbor.h || this.heuristicDiagonal(neighbor, end);\n                    }\n                    neighbor.g = gScore;\n                    neighbor.f = neighbor.g + neighbor.h;\n                    graph.markDirty(neighbor);\n                    if (closest) {\n                        // If the neighbour is closer than the current closestNode or if it's equally close but has\n                        // a cheaper path than the current closest node then it becomes the closest node\n                        if (neighbor.h < closestNode.h || (neighbor.h === closestNode.h && neighbor.g < closestNode.g)) {\n                            closestNode = neighbor;\n                        }\n                    }\n\n                    if (!beenVisited) {\n                        // Pushing to heap will put it in proper place based on the 'f' value.\n                        openHeap.push(neighbor);\n                    } else {\n                        // Already seen the node, but since it has been rescored we need to reorder it in the heap\n                        openHeap.rescoreElement(neighbor);\n                    }\n                }\n            }\n        }\n\n        if (closest) {\n            return this.pathTo(closestNode);\n        }\n\n        // No result was found - empty array signifies failure to find path.\n        return [];\n    }\n    // See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html\n    static heuristicManhattan(pos0, pos1) {\n        const d1 = Math.abs(pos1.x - pos0.x);\n        const d2 = Math.abs(pos1.y - pos0.y);\n        return d1 + d2;\n    }\n\n    static heuristicDiagonal(pos0, pos1) {\n        const D = 1;\n        const D2 = Math.sqrt(2);\n        const d1 = Math.abs(pos1.x - pos0.x);\n        const d2 = Math.abs(pos1.y - pos0.y);\n        return (D * (d1 + d2)) + ((D2 - (2 * D)) * Math.min(d1, d2));\n    }\n\n    static cleanNode(node) {\n        node.f = 0;\n        node.g = 0;\n        node.h = 0;\n        node.visited = false;\n        node.closed = false;\n        node.parent = null;\n    }\n}","export default class GridNode {\n    constructor(x, y, weight) {\n        this.x = x;\n        this.y = y;\n        this.weight = weight;\n    }\n\n    toString() {\n        return \"[\" + this.x + \" \" + this.y + \"]\";\n    }\n\n    getCost(fromNeighbor) {\n        // Take diagonal weight into consideration.\n        if (fromNeighbor && fromNeighbor.x !== this.x && fromNeighbor.y !== this.y) {\n            return this.weight * 1.41421;\n        }\n        return this.weight;\n    }\n\n    isWall() {\n        return this.weight === 0;\n    }\n}","import AStar from \"./AStar\";\nimport GridNode from \"./GridNode\";\n\nexport default class Graph {\n    /**\n     * A graph memory structure\n     * @param {Array} gridIn 2D array of input weights\n     * @param {Object} [options]\n     * @param {bool} [options.diagonal] Specifies whether diagonal moves are allowed\n     */\n    constructor(gridIn, options) {\n        options = options || {};\n        this.nodes = [];\n        this.diagonal = !!options.diagonal;\n        this.grid = [];\n        for (let x = 0; x < gridIn.length; x++) {\n            this.grid[x] = [];\n\n            for (let y = 0, row = gridIn[x]; y < row.length; y++) {\n                const node = new GridNode(x, y, row[y]);\n                this.grid[x][y] = node;\n                this.nodes.push(node);\n            }\n        }\n        this.init();\n    }\n\n    init() {\n        this.dirtyNodes = [];\n        for (let i = 0; i < this.nodes.length; i++) {\n            AStar.cleanNode(this.nodes[i]);\n        }\n    }\n\n    cleanDirty() {\n        for (let i = 0; i < this.dirtyNodes.length; i++) {\n            AStar.cleanNode(this.dirtyNodes[i]);\n        }\n        this.dirtyNodes = [];\n    }\n\n    markDirty(node) {\n        this.dirtyNodes.push(node);\n    }\n\n    neighbors(node) {\n        const ret = [];\n        const x = node.x;\n        const y = node.y;\n        const grid = this.grid;\n\n        // West\n        if (grid[x - 1] && grid[x - 1][y]) {\n            ret.push(grid[x - 1][y]);\n        }\n\n        // East\n        if (grid[x + 1] && grid[x + 1][y]) {\n            ret.push(grid[x + 1][y]);\n        }\n\n        // South\n        if (grid[x] && grid[x][y - 1]) {\n            ret.push(grid[x][y - 1]);\n        }\n\n        // North\n        if (grid[x] && grid[x][y + 1]) {\n            ret.push(grid[x][y + 1]);\n        }\n\n        if (this.diagonal) {\n            // Southwest\n            if (grid[x - 1] && grid[x - 1][y - 1]) {\n                ret.push(grid[x - 1][y - 1]);\n            }\n\n            // Southeast\n            if (grid[x + 1] && grid[x + 1][y - 1]) {\n                ret.push(grid[x + 1][y - 1]);\n            }\n\n            // Northwest\n            if (grid[x - 1] && grid[x - 1][y + 1]) {\n                ret.push(grid[x - 1][y + 1]);\n            }\n\n            // Northeast\n            if (grid[x + 1] && grid[x + 1][y + 1]) {\n                ret.push(grid[x + 1][y + 1]);\n            }\n        }\n\n        return ret;\n    }\n\n    toString() {\n        const graphString = [];\n        const nodes = this.grid;\n        for (let x = 0; x < nodes.length; x++) {\n            const rowDebug = [];\n            const row = nodes[x];\n            for (let y = 0; y < row.length; y++) {\n                rowDebug.push(row[y].weight);\n            }\n            graphString.push(rowDebug.join(\" \"));\n        }\n        return graphString.join(\"\\n\");\n    }\n}\n","import UnableToPerformAction from \"../UnableToPerformAction\";\nimport ActionWithDirection from \"./_ActionWithDirection\";\nimport engine from \"../../Engine\";\nimport MapLayer from \"../../map/MapLayer\";\n\nexport default class OpenAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n\n        const gameMap = engine.gameMap;\n        if (!gameMap.isInBounds(destX, destY)) {\n            return new UnableToPerformAction(this.entity, \"Location is outside the map!\");\n        }\n\n        const wallTile = gameMap.tiles.get(MapLayer.Wall)[destX][destY];\n        if (wallTile) {\n            const openable = wallTile.getComponent(\"openable\");\n            if (openable) {\n                if (openable.open()) {\n                    return this;\n                } else {\n                    return new UnableToPerformAction(this.entity, \"That cannot be opened.\");\n                }\n            }\n        }\n\n        return new UnableToPerformAction(this.entity, \"There's nothing to open there!\");\n    }\n}","import ActionWithDirection from \"./_ActionWithDirection\";\nimport UnableToPerformAction from \"../UnableToPerformAction\";\nimport engine from \"../../Engine\";\nimport MeleeAction from \"./MeleeAction\";\nimport MovementAction from \"./MovementAction\";\nimport MapLayer from \"../../map/MapLayer\";\nimport OpenAction from \"./OpenAction\";\n\nexport default class BumpAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n        const destZ = position.z + this.dz;\n\n        const blockingActor = engine.gameMap.getBlockingActorAtLocation(destX, destY, destZ);\n        if (blockingActor) {\n            return new MeleeAction(this.entity, this.dx, this.dy, this.dz).perform();\n        } else {\n            const tileX = engine.gameMap.tiles.get(MapLayer.Wall)[destX];\n            if (tileX) {\n                const wallTile = tileX[destY];\n                if (wallTile) {\n                    const openable = wallTile.getComponent(\"openable\");\n                    if (openable && !openable.isOpen) {\n                        return new OpenAction(this.entity, this.dx, this.dy, this.dz).perform();\n                    }\n                }\n                return new MovementAction(this.entity, this.dx, this.dy, this.dz).perform();\n            } else {\n                return new UnableToPerformAction(this.entity, \"Nowhere to move.\");\n            }\n        }\n    }\n}","import AI from \"./_AI\";\nimport AdamMilazzoFov from \"../../map/fov/AdamMilazzoFov\";\nimport {MathUtils, Vector3} from \"three\";\nimport WanderAction from \"../../actions/WanderAction\";\nimport MeleeAction from \"../../actions/actionWithDirection/MeleeAction\";\nimport AStar from \"../../pathfinding/AStar\";\nimport Graph from \"../../pathfinding/Graph\";\nimport engine from \"../../Engine\";\nimport WaitAction from \"../../actions/WaitAction\";\nimport BumpAction from \"../../actions/actionWithDirection/BumpAction\";\n\nexport default class AIMeleeChase extends AI {\n    constructor(args = {}) {\n        super(args, \"aiMeleeChase\");\n        const hasComponent = args.components && args.components.aiMeleeChase !== undefined;\n\n        this.fov = new AdamMilazzoFov();\n        this.chaseLocation = null;\n        this.radius = 5;\n        this.movementActions = 1;\n        this.currentMovement = 0;\n\n        if (hasComponent) {\n            const aiMeleeChase = args.components.aiMeleeChase;\n\n            if (aiMeleeChase.radius !== undefined) {\n                this.radius = aiMeleeChase.radius;\n            }\n\n            if (aiMeleeChase.movementActions !== undefined) {\n                this.movementActions = aiMeleeChase.movementActions;\n            }\n\n            if (aiMeleeChase.currentMovement !== undefined) {\n                this.currentMovement = aiMeleeChase.currentMovement;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiMeleeChase\": {}\n        };\n\n        if (this.radius !== 5) {\n            saveJson.aiMeleeChase.radius = this.radius;\n        }\n\n        if (this.movementActions !== 1) {\n            saveJson.aiMeleeChase.movementActions = this.movementActions;\n        }\n\n        if (this.currentMovement !== 0) {\n            saveJson.aiMeleeChase.currentMovement = this.currentMovement;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {\n        const entity = this.parentEntity;\n        const entityPosition = entity.getComponent(\"positionalobject\");\n        if (entityPosition) {\n            this.fov.compute(entityPosition.x, entityPosition.y, entityPosition.z, this.radius, entityPosition.z - 10, entityPosition.z + 10);\n\n            let closestEnemies = [];\n            let closestDistance = null;\n            const entityFaction = entity.getComponent(\"faction\");\n            if (entityFaction) {\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorFaction = actor.getComponent(\"faction\");\n                        if (entityFaction.isEnemyOf(actorFaction)) {\n                            const actorPosition = actor.getComponent(\"positionalobject\");\n\n                            if (actorPosition) {\n                                const dx = Math.abs(actorPosition.x - entityPosition.x);\n                                const dy = Math.abs(actorPosition.y - entityPosition.y);\n                                const distance = Math.max(dx, dy);\n\n                                if (closestDistance === null || distance < closestDistance) {\n                                    closestEnemies = [];\n                                    closestEnemies.push(actor);\n                                    closestDistance = distance;\n                                } else if (distance === closestDistance) {\n                                    closestEnemies.push(actor);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            let closestEnemy;\n            if (closestEnemies.length === 1) {\n                closestEnemy = closestEnemies[0];\n            } else if (closestEnemies.length > 1) {\n                const index = MathUtils.randInt(0, closestEnemies.length - 1);\n                closestEnemy = closestEnemies[index];\n            }\n\n            if (closestEnemy) {\n                const closestEnemyPosition = closestEnemy.getComponent(\"positionalobject\");\n                this.chaseLocation = new Vector3(closestEnemyPosition.x, closestEnemyPosition.y, closestEnemyPosition.z);\n\n                if (closestDistance <= 1) {\n                    return new MeleeAction(entity, closestEnemyPosition.x - entityPosition.x, closestEnemyPosition.y - entityPosition.y, closestEnemyPosition.z - entityPosition.z).perform();\n                }\n            } else {\n                if (this.chaseLocation !== null && this.chaseLocation.x === entityPosition.x && this.chaseLocation.y === entityPosition.y && this.chaseLocation.z === entityPosition.z) {\n                    this.chaseLocation = null;\n                }\n\n                if (this.chaseLocation === null) {\n                    return new WanderAction(entity).perform();\n                }\n            }\n\n            this.currentMovement += this.movementActions;\n\n            if (this.currentMovement >= 1) {\n                // Move towards enemy\n                const gameMap = engine.gameMap;\n                const fovWidth = this.fov.right - this.fov.left;\n                const fovHeight = this.fov.bottom - this.fov.top;\n                const cost = Array(fovWidth).fill().map(() => Array(fovHeight).fill(0));\n\n                for (let i = this.fov.left; i < this.fov.right; i++) {\n                    for (let j = this.fov.top; j < this.fov.bottom; j++) {\n                        const wallTile = gameMap.tiles.get(entityPosition.z)[i][j];\n                        if (wallTile) {\n                            const blocksMovementComponent = wallTile.getComponent(\"blocksMovement\");\n                            if (blocksMovementComponent && blocksMovementComponent.blocksMovement) {\n                                continue;\n                            }\n                        }\n\n                        if (!gameMap.tiles.has(entityPosition.z - 1)) {\n                            continue;\n                        }\n\n                        const floorTile = gameMap.tiles.get(entityPosition.z - 1)[i][j];\n\n                        if (floorTile) {\n                            const walkableComponent = floorTile.getComponent(\"walkable\");\n                            if (walkableComponent && walkableComponent.walkable) {\n                                cost[i - this.fov.left][j - this.fov.top] += 10;\n                            }\n                        }\n                    }\n                }\n\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorPosition = actor.getComponent(\"positionalobject\");\n                        if (actorPosition) {\n                            cost[actorPosition.x - this.fov.left][actorPosition.y - this.fov.top] += 100;\n                        }\n                    }\n                }\n\n                const costGraph = new Graph(cost, {diagonal: true});\n\n                const start = costGraph.grid[entityPosition.x - this.fov.left][entityPosition.y - this.fov.top];\n                const end = costGraph.grid[this.chaseLocation.x - this.fov.left][this.chaseLocation.y - this.fov.top];\n                const path = AStar.search(costGraph, start, end);\n                let lastAction;\n                while (this.currentMovement >= 1) {\n                    if (path && path.length > 0) {\n                        const next = path.shift();\n                        if (next) {\n                            lastAction = new BumpAction(entity, next.x + this.fov.left - entityPosition.x, next.y + this.fov.top - entityPosition.y, entityPosition.z).perform();\n                        }\n                    } else {\n                        lastAction = new WaitAction(entity).perform();\n                    }\n\n                    this.currentMovement -= 1;\n                }\n\n                return lastAction;\n            }\n        }\n    }\n}","import _Component from \"./_Component\";\n\nexport default class Faction extends _Component {\n    constructor(args = {}) {\n        super(args, \"faction\");\n        const hasComponent = args.components && args.components.faction !== undefined;\n\n        this.factions = [];\n        this.enemies = [];\n\n        if (hasComponent) {\n            const faction = args.components.faction;\n            if (faction.factions) {\n                this.setFactions(faction.factions.split(\",\"));\n            }\n\n            if (faction.enemies) {\n                this.setEnemies(faction.enemies.split(\",\"));\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"faction\": {\n                factions: this.factions.toString(),\n                enemies: this.enemies.toString()\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    setFactions(factionList) {\n        for (const faction of factionList) {\n            this.factions.push(faction.trim());\n        }\n\n        this.clearSaveCache();\n    }\n\n    setEnemies(enemyList) {\n        for (const enemy of enemyList) {\n            this.enemies.push(enemy.trim());\n        }\n\n        this.clearSaveCache();\n    }\n\n    /**\n     *\n     * @param {Faction} otherFaction\n     */\n    isEnemyOf(otherFaction) {\n        if (!otherFaction) {\n            return false;\n        }\n\n        for (const faction of this.factions) {\n            if (otherFaction.enemies.indexOf(faction) > -1) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}","import _Component from \"./_Component\";\n\nexport default class Remnant extends _Component {\n    constructor(args = {}) {\n        super(args, \"remnant\");\n\n        const hasComponent = args.components && args.components.remnant !== undefined;\n\n        this.isRemnant = false;\n        this.x = -1;\n        this.y = -1;\n        this.z = -1;\n\n        if (hasComponent) {\n            const remnant = args.components.remnant;\n            if (remnant.isRemnant !== undefined) {\n                this.isRemnant = remnant.isRemnant;\n            }\n\n            if (remnant.x !== undefined) {\n                this.x = remnant.x;\n            }\n\n            if (remnant.y !== undefined) {\n                this.y = remnant.y;\n            }\n\n            if (remnant.z !== undefined) {\n                this.z = remnant.z;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            remnant: {}\n        };\n\n        if (this.isRemnant) {\n            saveJson.remnant.isRemnant = this.isRemnant;\n        }\n\n        if (this.x !== -1) {\n            saveJson.remnant.x = this.x;\n        }\n\n        if (this.y !== -1) {\n            saveJson.remnant.y = this.y;\n        }\n\n        if (this.z !== -1) {\n            saveJson.remnant.z = this.z;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n}","import Action from \"../_Action\";\nimport engine from \"../../Engine\";\nimport {Vector3} from \"three\";\n\nexport default class ItemAction extends Action {\n    /**\n     *\n     * @param entity\n     * @param item\n     * @param {Vector3} targetPosition\n     */\n    constructor(entity, item, targetPosition) {\n        super(entity);\n\n        this.item = item;\n        this.targetPosition = targetPosition;\n    }\n\n    perform() {\n        const consumable = this.item.getComponent(\"consumable\");\n        if (consumable) {\n            return consumable.activate(this, this.targetPosition);\n        }\n    }\n\n    getTargetActor() {\n        const actorPosition = new Vector3(this.targetPosition.x, this.targetPosition.y, this.targetPosition.z + 1);\n        return engine.gameMap.getAliveActorAtLocation(actorPosition);\n    }\n}","import _Component from \"../_Component\";\nimport engine from \"../../Engine\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\n\nexport default class Consumable extends _Component {\n    constructor(args = {}, type) {\n        super(args, \"consumable\", type);\n    }\n\n    save() {\n        return null;\n    }\n\n    consume() {\n        const item = this.getItem();\n        const parentStorage = item.parentEntity;\n        if (parentStorage) {\n            parentStorage.use(item, 1);\n        }\n    }\n\n    /**\n     *\n     * @returns {Action}\n     */\n    getAction() {\n        const consumer = this.getConsumer();\n        const item = this.getItem();\n\n        return new ItemAction(consumer, item);\n    }\n\n    activate(/*action*/) {\n        console.error(\"Not Implemented\");\n    }\n\n    getItem() {\n        return this.parentEntity;\n    }\n\n    getConsumer() {\n        let parent = this.parentEntity;\n        while (parent && parent.type !== \"actor\") {\n            parent = parent.parentEntity;\n        }\n        return parent;\n    }\n\n    isPlayer() {\n        return this.getConsumer() === engine.player;\n    }\n}","import Consumable from \"./_Consumable\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport engine from \"../../Engine\";\n\nexport default class HealingConsumable extends Consumable {\n    constructor(args = {}) {\n        super(args, \"healingConsumable\");\n        const hasComponent = args.components && args.components.healingConsumable !== undefined;\n\n        this.amount = 0;\n\n        if (hasComponent) {\n            const healingConsumable = args.components.healingConsumable;\n            if (healingConsumable && healingConsumable.amount !== undefined) {\n                this.amount = healingConsumable.amount;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"healingConsumable\": {\n                amount: this.amount\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n        const fighter = consumer.getComponent(\"fighter\");\n        if (fighter) {\n            const amountHealed = fighter.heal(this.getModifiedAmount());\n\n            if (amountHealed > 0) {\n                this.consume();\n                if (this.isPlayer()) {\n                    messageConsole.text(\"You consume the \" + this.parentEntity.name + \", and recover \" + amountHealed + \" HP!\").build();\n                }\n                return this;\n            } else {\n                return new UnableToPerformAction(action.entity, \"Your health is already full\");\n            }\n        }\n    }\n\n    getModifiedAmount() {\n        let healingBonus = 0;\n        let consumer = this.getConsumer();\n        if (!consumer) {\n            consumer = engine.player;\n        }\n\n        const fighter = consumer.getComponent(\"fighter\");\n        if (fighter) {\n            healingBonus = fighter.healingBonus;\n        }\n\n        return this.amount + healingBonus;\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Recovers <span style='color: #c00;'>\" + this.getModifiedAmount() + \"</span> health</span>\";\n    }\n}","import html from \"../../html/ui/Inventory.html\";\nimport UIElement from \"./UIElement\";\nimport engine from \"../Engine\";\n\nclass Inventory extends UIElement {\n    constructor() {\n        super(html);\n\n        this.equipmentDom = this.dom.getElementsByClassName(\"inventory__equipment\")[0];\n        this.equipmentSlots = [];\n        for (let i = 0; i < 12; i++ ) {\n            const slot = document.createElement(\"div\");\n            slot.classList.add(\"slot\", \"inventory__equipment-slot\");\n            slot.setAttribute(\"data-index\", i);\n            this.equipmentSlots.push(slot);\n            this.equipmentDom.appendChild(slot);\n        }\n\n        this.storageWrapDom = this.dom.getElementsByClassName(\"inventory__storage-wrap\")[0];\n        this.goldCountDom = this.dom.getElementsByClassName(\"inventory__gold-count\")[0];\n\n        this.itemTooltipDom = document.createElement(\"div\");\n        this.itemTooltipDom.classList.add(\"item__tooltip\");\n\n        this.itemDragDom = document.createElement(\"div\");\n        this.itemDragDom.classList.add(\"item__drag\");\n\n        document.body.appendChild(this.itemTooltipDom);\n        document.body.appendChild(this.itemDragDom);\n\n        this.openStorages = [];\n        this.itemsOnGround = [];\n    }\n\n    populateInventory(entity) {\n        const equipment = entity.getComponent(\"equipment\");\n        if (equipment) {\n            this.storageWrapDom.innerHTML = \"\";\n            for (let i = 0; i < this.equipmentSlots.length; i++) {\n                const slot = this.equipmentSlots[i];\n\n                const equipmentSlot = equipment.items[i];\n                const item = equipmentSlot.item;\n                this.populateSlot(slot, item);\n            }\n\n            this.openStorages = [];\n\n            // Get storage\n            const equipmentStorageItem = equipment.items[9];\n            const storageItem = equipmentStorageItem.item;\n            if (storageItem) {\n                this.openEquipmentStorage(storageItem);\n            }\n\n            // Get belt\n            const equipmentBeltItem = equipment.items[7];\n            const beltItem = equipmentBeltItem.item;\n            if (beltItem) {\n                this.openEquipmentStorage(beltItem);\n            }\n\n            for (let i = 0; i < this.equipmentSlots.length; i++) {\n                if (i === 7 || i === 9) {\n                    continue;\n                }\n\n                const equipmentItem = equipment.items[i];\n                const item = equipmentItem.item;\n                if (item) {\n                    this.openEquipmentStorage(item);\n                }\n            }\n        }\n\n        this.openGroundItems();\n\n        const inventory = entity.getComponent(\"inventory\");\n        if (inventory) {\n            this.goldCountDom.innerText = inventory.gold;\n        }\n    }\n\n    openEquipmentStorage(item) {\n        this.openStorages.push(item);\n        const equippable = item.getComponent(\"equippable\");\n        if (equippable && equippable.maxStorage !== 0) {\n            let maxItems;\n            if (equippable.maxStorage === -1) {\n                maxItems = equippable.storage.length + 1;\n            } else {\n                maxItems = equippable.maxStorage;\n            }\n            const inventoryStorageDom = document.createElement(\"div\");\n            inventoryStorageDom.classList.add(\"inventory__storage\");\n            inventoryStorageDom.setAttribute(\"data-index\", this.openStorages.length - 1);\n            const inventoryStorageTitleDom = document.createElement(\"div\");\n            inventoryStorageTitleDom.classList.add(\"inventory__storage-title\");\n            inventoryStorageTitleDom.innerText = item.name;\n            inventoryStorageDom.appendChild(inventoryStorageTitleDom);\n            this.inventorySlots = [];\n            for (let i = 0; i < maxItems; i++) {\n                const slot = document.createElement(\"div\");\n                slot.classList.add(\"slot\", \"inventory__storage-slot\");\n                slot.setAttribute(\"data-index\", i);\n\n                this.populateSlot(slot, equippable.storage[i]);\n                this.inventorySlots.push(slot);\n                inventoryStorageDom.appendChild(slot);\n            }\n            this.storageWrapDom.appendChild(inventoryStorageDom);\n        }\n    }\n\n    populateItemsAtGround() {\n        const position = engine.player.getComponent(\"positionalobject\");\n        this.itemsOnGround = [];\n        for (const item of engine.gameMap.items) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (position.x === itemPosition.x && position.y === itemPosition.y && position.z === itemPosition.z) {\n                this.itemsOnGround.push(item);\n            }\n        }\n    }\n\n    openGroundItems() {\n        if (this.isOpen()) {\n            this.populateItemsAtGround();\n\n            const maxItems = Math.ceil((this.itemsOnGround.length + 1) / 10) * 10;\n\n            const inventoryStorageDom = document.createElement(\"div\");\n            inventoryStorageDom.classList.add(\"inventory__storage\");\n            const inventoryStorageTitleDom = document.createElement(\"div\");\n            inventoryStorageTitleDom.classList.add(\"inventory__storage-title\");\n            inventoryStorageTitleDom.innerText = \"On Ground\";\n            inventoryStorageDom.appendChild(inventoryStorageTitleDom);\n            this.inventorySlots = [];\n            for (let i = 0; i < maxItems; i++) {\n                const slot = document.createElement(\"div\");\n                slot.classList.add(\"slot\", \"pickup-slot\");\n                slot.setAttribute(\"data-index\", i);\n\n                this.populateSlot(slot, this.itemsOnGround[i]);\n                this.inventorySlots.push(slot);\n                inventoryStorageDom.appendChild(slot);\n            }\n            this.storageWrapDom.appendChild(inventoryStorageDom);\n        }\n    }\n\n    populateSlot(slot, item) {\n        if (item) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (itemPosition) {\n                let rotation = \"\";\n                if (itemPosition.zRot !== 0) {\n                    rotation = \"transform: rotate(\" + (itemPosition.zRot * 180) + \"deg);\";\n                }\n                slot.classList.add(\"has-item\");\n                let html = \"<div class='item' style='color:\" + itemPosition.color + \";\" + rotation + \"'><div class='item__icon'>\" + itemPosition.letter + \"</div>\";\n\n                if (item.amount > 1) {\n                    html += \"<span class='item__amount'>\" + item.amount + \"</span>\";\n                }\n\n                html += \"<div class='item__details'>\"\n                    + \"<span class='item__details-line item__name'>\" + item.name + \"</span>\";\n                if (item.description) {\n                    html += \"<span class='item__details-line item__description'>\" + item.description + \"</span>\";\n                }\n\n                html += \"<span class='item__details-line'><hr/></span>\";\n\n                html += item.getComponentDescriptions();\n\n                html += \"</div></div>\";\n\n                slot.innerHTML = html;\n            }\n        } else {\n            slot.classList.remove(\"has-item\");\n            slot.innerHTML = \"\";\n        }\n    }\n\n    toggle() {\n        if (this.isOpen()) {\n            this.close();\n        } else {\n            this.open();\n            this.populateInventory(engine.player);\n        }\n    }\n}\n\nconst inventory = new Inventory();\nexport default inventory;","import _Component from \"./_Component\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport engine from \"../Engine\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport inventory from \"../ui/Inventory\";\n\nexport default class Inventory extends _Component {\n    constructor(args = {}) {\n        super(args, \"inventory\");\n        const hasComponent = args.components && args.components.inventory;\n\n        this.gold = 0;\n\n        if (hasComponent) {\n            const inventory = args.components.inventory;\n\n            this.gold = this.parseRandInt(inventory.gold, 0);\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            inventory: {\n                gold: this.gold\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    add(item) {\n        this.clearSaveCache();\n\n        if (item.id === \"gold\") {\n            this.gold += item.amount;\n            return true;\n        }\n\n        return false;\n    }\n\n    dropAll() {\n        const gold = this.gold;\n        if (gold > 0) {\n            const goldItem = entityLoader.createFromTemplate(\"gold\");\n            goldItem.amount = gold;\n            this.drop(goldItem);\n        }\n\n        this.clearSaveCache();\n    }\n\n    drop(item) {\n        if (item) {\n            const parentPosition = this.parentEntity.getComponent(\"positionalobject\");\n            engine.gameMap.addItem(item, parentPosition);\n\n            if (this.isPlayer()) {\n                messageConsole.text(\"You dropped the \" + item.name).build();\n            }\n\n            this.clearSaveCache();\n            if (this.isPlayer()) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n\n    onEntityDeath() {\n        this.dropAll();\n    }\n}","import Consumable from \"./_Consumable\";\nimport engine from \"../../Engine\";\nimport {MathUtils} from \"three\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\n\nexport default class DamageNearestConsumable extends Consumable {\n    constructor(args = {}) {\n        super(args, \"damageNearestConsumable\");\n        const hasComponent = args.components && args.components.damageNearestConsumable !== undefined;\n\n        this.damage = 20;\n        this.maxRange = 5;\n\n        if (hasComponent) {\n            const damageNearestConsumable = args.components.damageNearestConsumable;\n            if (damageNearestConsumable) {\n                if (damageNearestConsumable.damage !== undefined) {\n                    this.damage = damageNearestConsumable.damage;\n                }\n\n                if (damageNearestConsumable.maxRange !== undefined) {\n                    this.maxRange = damageNearestConsumable.maxRange;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"damageNearestConsumable\": {\n                damage: this.damage,\n                maxRange: this.maxRange\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n        const target = this.getClosestActor(consumer);\n\n        if (target) {\n            const fighter = target.getComponent(\"fighter\");\n            const actualDamage = Math.max(0, this.damage - fighter.getBlockedDamage());\n            if (this.isPlayer()) {\n                messageConsole.text(target.name + \" is struck for \" + actualDamage + \" damage!\").build();\n            }\n            fighter.takeDamage(actualDamage);\n\n            this.consume();\n            return this;\n        } else {\n            return new UnableToPerformAction(action.entity, \"No enemy is close enough to strike.\");\n        }\n    }\n\n    getClosestActor(consumer) {\n        let closestEnemies = [];\n        let closestDistance = null;\n        const airActors = engine.airFov.visibleActors;\n        const actors = engine.fov.visibleActors;\n\n        const consumerPosition = consumer.getComponent(\"positionalobject\");\n        const consumerFaction = consumer.getComponent(\"faction\");\n\n        if (consumerPosition && consumerFaction) {\n            for (const actor of airActors) {\n                if (actor.isAlive()) {\n                    if (consumerFaction.isEnemyOf(actor.getComponent(\"faction\"))) {\n                        const position = actor.getComponent(\"positionalobject\");\n                        if (position) {\n                            const distance = consumerPosition.distance(position);\n                            if (closestDistance === null || distance < closestDistance) {\n                                closestEnemies = [];\n                                closestEnemies.push(actor);\n                                closestDistance = distance;\n                            } else if (distance === closestDistance) {\n                                closestEnemies.push(actor);\n                            }\n                        }\n                    }\n                }\n            }\n\n            for (const actor of actors) {\n                if (actor.isAlive()) {\n                    if (consumerFaction.isEnemyOf(actor.getComponent(\"faction\"))) {\n                        const position = actor.getComponent(\"positionalobject\");\n                        if (position) {\n                            const distance = consumerPosition.distance(position);\n                            if (closestDistance === null || distance < closestDistance) {\n                                closestEnemies = [];\n                                closestEnemies.push(actor);\n                                closestDistance = distance;\n                            } else if (distance === closestDistance) {\n                                closestEnemies.push(actor);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        let closestEnemy;\n        if (closestEnemies.length === 1) {\n            closestEnemy = closestEnemies[0];\n        } else if (closestEnemies.length > 1) {\n            const index = MathUtils.randInt(0, closestEnemies.length - 1);\n            closestEnemy = closestEnemies[index];\n        }\n\n        return closestEnemy;\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Lightning Damage: <span style='color: #aa6;'>\" + this.damage + \"</span></span>\" +\n                \"<span class='item__details-line'>Range: <span style='color: #666;'>\" + this.maxRange + \"</span></span>\";\n    }\n}","import EventHandler from \"../_EventHandler\";\nimport engine from \"../../Engine\";\nimport {Vector3} from \"three\";\nimport controls from \"../../controls/Controls\";\nimport DefaultPlayerEventHandler from \"../DefaultPlayerEventHandler\";\nimport details from \"../../ui/Details\";\nimport sceneState from \"../../SceneState\";\nimport Tile from \"../../entity/Tile\";\n\nexport default class SelectIndexHandler extends EventHandler {\n    constructor() {\n        super();\n\n        this.resetPosition();\n        this.initted = false;\n    }\n\n    init() {\n        if (!this.initted) {\n            this.selectIndex();\n            this.initted = true;\n        }\n    }\n\n    resetPosition() {\n        this.player = engine.player;\n        const position = this.player.getComponent(\"positionalobject\");\n        this.position = new Vector3(position.x, position.y, position.z - 1);\n    }\n\n    exit() {\n        sceneState.updateCameraPosition(engine.player);\n        engine.setEventHandler(new DefaultPlayerEventHandler());\n    }\n\n    handleInput() {\n        this.init();\n\n        if (controls.testPressed(\"cancel\")) {\n            this.exit();\n        } else if (controls.testPressed(\"confirm\")) {\n            this.confirmIndex();\n        } else if (controls.testPressed(\"reset\") || controls.testPressed(\"wait\")) {\n            this.resetPosition();\n        } else {\n            let modifier = 1;\n            if (controls.isPressed(\"modifier-speed1\")) {\n                modifier *= 5;\n            }\n\n            if (controls.isPressed(\"modifier-speed2\")) {\n                modifier *= 10;\n            }\n\n            if (controls.isPressed(\"modifier-speed3\")) {\n                modifier *= 20;\n            }\n\n            let dx = 0;\n            let dy = 0;\n            if (controls.testPressed(\"up\")) {\n                dy = 1;\n            } else if (controls.testPressed(\"down\")) {\n                dy = -1;\n            } else if (controls.testPressed(\"left\")) {\n                dx = -1;\n            } else if (controls.testPressed(\"right\")) {\n                dx = 1;\n            } else if (controls.testPressed(\"nw\")) {\n                dx = -1;\n                dy = 1;\n            } else if (controls.testPressed(\"ne\")) {\n                dx = 1;\n                dy = 1;\n            } else if (controls.testPressed(\"sw\")) {\n                dx = -1;\n                dy = -1;\n            } else if (controls.testPressed(\"se\")) {\n                dx = 1;\n                dy = -1;\n            }\n\n            if (dx !== 0 || dy !== 0) {\n                const x = this.position.x + (dx * modifier);\n                const y = this.position.y + (dy * modifier);\n\n                this.position.x = Math.max(0, Math.min(x, engine.gameMap.width - 1));\n                this.position.y = Math.max(0, Math.min(y, engine.gameMap.height - 1));\n                this.selectIndex();\n            }\n        }\n    }\n\n    selectIndex(moveCamera = true) {\n        let obscuredTile = null;\n        let visibleTile = null;\n        const tiles = engine.gameMap.tiles.get(this.position.z);\n        if (tiles) {\n            const tilesX = tiles[this.position.x];\n            if (tilesX) {\n                const tile = tilesX[this.position.y];\n                if (tile) {\n                    const position = tile.getComponent(\"positionalobject\");\n                    if (position) {\n                        // Skip invisible/unseen items\n                        if (position.transparency === 1 && position.hasObject()) {\n                            if (!this.isHighlighted(tile)) {\n                                visibleTile = tile;\n                            }\n                        } else {\n                            obscuredTile = tile;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (obscuredTile) {\n            this.clearHighlights(false);\n            if (moveCamera) {\n                sceneState.updateCameraPosition(engine.player, obscuredTile);\n            }\n            details.updatePositionOnly(obscuredTile);\n        } else if (visibleTile) {\n            if (moveCamera) {\n                sceneState.updateCameraPosition(engine.player, visibleTile);\n            }\n            this.clearAndSetHighlight(visibleTile);\n        } else {\n            this.clearHighlights(true);\n        }\n    }\n\n    confirmIndex() {\n        console.error(\"Not Implemented\");\n    }\n\n    onMouseMove(e) {\n        this.mouse.x = (e.clientX / sceneState.canvasDom.offsetWidth) * 2 - 1;\n        this.mouse.y = -(e.clientY / sceneState.canvasDom.offsetHeight) * 2 + 1;\n\n        this.raycaster.setFromCamera(this.mouse, sceneState.camera);\n\n        const intersects = this.raycaster.intersectObject(sceneState.scene, true);\n\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity && parentEntity instanceof Tile) {\n                const parentPosition = parentEntity.getComponent(\"positionalobject\");\n                if (parentPosition) {\n                    // Skip invisible/unseen items\n                    if (parentPosition.transparency === 0 || !parentPosition.hasObject()) {\n                        continue;\n                    }\n\n                    if (this.position.x !== parentPosition.x || this.position.y !== parentPosition.y) {\n                        this.position.x = parentPosition.x;\n                        this.position.y = parentPosition.y;\n\n                        this.selectIndex(false);\n                        engine.needsMapUpdate = true;\n                    }\n\n                    break;\n                }\n            }\n        }\n    }\n\n    onLeftClick(/*e*/) {\n        this.confirmIndex();\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport engine from \"../../Engine\";\n\nexport default class SingleRangedAttackHandler extends SelectIndexHandler {\n    constructor(callback) {\n        super();\n\n        this.callback = callback;\n    }\n\n    confirmIndex() {\n        engine.processAction(this.callback(this.position));\n        this.exit();\n    }\n}","import AI from \"./_AI\";\nimport WanderAction from \"../../actions/WanderAction\";\nimport componentLoader from \"../ComponentLoader\";\n\nexport default class AIConfusedEnemy extends AI {\n    constructor(args = {}) {\n        super(args, \"aiConfusedEnemy\");\n        const hasComponent = args.components && args.components.aiConfusedEnemy !== undefined;\n\n        this.previousAI = \"\";\n        this.turnsRemaining = 10;\n\n        if (hasComponent) {\n            const aiConfusedEnemy = args.components.aiConfusedEnemy;\n            if (aiConfusedEnemy) {\n                if (aiConfusedEnemy.previousAI) {\n                    this.previousAI = aiConfusedEnemy.previousAI;\n                }\n\n                if (aiConfusedEnemy.turnsRemaining !== undefined) {\n                    this.turnsRemaining = aiConfusedEnemy.turnsRemaining;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiConfusedEnemy\": {\n                \"previousAI\": this.previousAI,\n                \"turnsRemaining\": this.turnsRemaining\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    setTurnsRemaining(turns) {\n        if (turns > this.turnsRemaining) {\n            this.turnsRemaining = turns;\n            this.clearSaveCache();\n        }\n    }\n\n    perform() {\n        if (this.turnsRemaining <= 0) {\n            this.parentEntity.removeComponent(\"ai\");\n            const newAI = componentLoader.create(this.parentEntity, this.previousAI);\n            this.parentEntity.setComponent(newAI);\n        } else {\n            this.setTurnsRemaining(this.turnsRemaining - 1);\n\n            return new WanderAction(this.parentEntity).perform();\n        }\n    }\n}","import Consumable from \"./_Consumable\";\nimport engine from \"../../Engine\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport componentLoader from \"../ComponentLoader\";\nimport SingleRangedAttackHandler from \"../../event/selectIndexHandler/SingleRangedAttackHandler\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\nimport NoAction from \"../../actions/NoAction\";\nimport AIConfusedEnemy from \"../ai/AIConfusedEnemy\";\n\nexport default class ConfusionConsumable extends Consumable {\n    constructor(args = {}) {\n        super(args, \"confusionConsumable\");\n        const hasComponent = args.components && args.components.confusionConsumable !== undefined;\n\n        this.turns = 0;\n\n        if (hasComponent) {\n            const confusionConsumable = args.components.confusionConsumable;\n            if (confusionConsumable && confusionConsumable.turns !== undefined) {\n                this.turns = confusionConsumable.turns;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"confusionConsumable\": {\n                turns: this.turns\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getAction() {\n        const self = this;\n        if (this.isPlayer()) {\n            messageConsole.text(\"Select a target location.\", \"#3fffff\").build();\n        }\n\n        engine.setEventHandler(new SingleRangedAttackHandler(function(targetPosition) {\n            return new ItemAction(self.getConsumer(), self.getItem(), targetPosition);\n        }));\n\n        return new NoAction(this.parentEntity);\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n\n        const target = action.getTargetActor();\n        if (!target) {\n            return new UnableToPerformAction(this.parentEntity, \"You must select an enemy to target.\");\n        }\n\n        if (target === consumer) {\n            return new UnableToPerformAction(this.parentEntity, \"You cannot confuse yourself.\");\n        }\n\n        if (engine.fov.visibleActors.indexOf(target) === -1 && engine.airFov.visibleActors.indexOf(target) === -1) {\n            return new UnableToPerformAction(this.parentEntity, \"You cannot target an area that you cannot see.\");\n        }\n\n        if (this.isPlayer()) {\n            messageConsole.text(\"The eyes of the \" + target.name + \" look vacant, as it starts to stumble around!\", \"#3fff3f\").build();\n        }\n\n        const ai = target.getComponent(\"ai\");\n        if (ai) {\n            if (ai instanceof AIConfusedEnemy) {\n                ai.setTurnsRemaining(this.turns);\n            } else {\n                const aiType = ai.type;\n                const aiArgs = {\n                    components: {\n                        aiConfusedEnemy: {\n                            previousAI: aiType,\n                            turnsRemaining: this.turns\n                        }\n                    }\n                };\n                target.removeComponent(\"ai\");\n                const newAI = componentLoader.create(target, \"aiConfusedEnemy\", aiArgs);\n                target.setComponent(newAI);\n            }\n\n            this.consume();\n        }\n\n        return this;\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Confuses for: <span style='color: #cf3fff;'>\" + this.turns + \"</span> turns</span>\";\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport engine from \"../../Engine\";\nimport sceneState from \"../../SceneState\";\nimport details from \"../../ui/Details\";\n\nexport default class AreaRangedAttackHandler extends SelectIndexHandler {\n    constructor(callback, radius) {\n        super();\n\n        this.callback = callback;\n        this.radius = radius;\n    }\n\n    selectIndex(moveCamera = true) {\n        let centerIsObscured = true;\n        let centerTile = null;\n        const visibleTiles = [];\n        const tiles = engine.gameMap.tiles.get(this.position.z);\n        if (tiles) {\n            const left = Math.max(0, this.position.x - this.radius);\n            const right = Math.min(engine.gameMap.width, this.position.x + this.radius + 1);\n            const top = Math.max(0, this.position.y - this.radius);\n            const bottom = Math.min(engine.gameMap.height, this.position.y + this.radius + 1);\n\n            for (let i = left; i < right; i++) {\n                const tilesX = tiles[i];\n                if (tilesX) {\n                    for (let j = top; j < bottom; j++) {\n                        const tile = tilesX[j];\n\n                        const position = tile.getComponent(\"positionalobject\");\n                        if (position) {\n                            // Skip invisible/unseen items\n                            if (position.transparency === 1 && position.hasObject()) {\n                                visibleTiles.push(tile);\n                            }\n\n                            if (i === this.position.x && j === this.position.y) {\n                                centerTile = tile;\n\n                                if (position.transparency === 1 && position.hasObject()) {\n                                    centerIsObscured = false;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        if (centerTile) {\n            if (moveCamera) {\n                sceneState.updateCameraPosition(engine.player, centerTile);\n            }\n\n            if (centerIsObscured) {\n                details.updatePositionOnly(centerTile);\n            } else {\n                details.updatePositionDetails(centerTile);\n            }\n        }\n\n        if (visibleTiles.length > 0) {\n            this.clearAndSetHighlights(visibleTiles);\n        } else {\n            this.clearHighlights(true);\n        }\n    }\n\n    confirmIndex() {\n        engine.processAction(this.callback(this.position));\n        this.exit();\n    }\n}","import Consumable from \"./_Consumable\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport engine from \"../../Engine\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\nimport NoAction from \"../../actions/NoAction\";\nimport AreaRangedAttackHandler from \"../../event/selectIndexHandler/AreaRangedAttackHandler\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\n\nexport default class AOEDamageConsumable extends Consumable {\n    constructor(args = {}) {\n        super(args, \"aoeDamageConsumable\");\n        const hasComponent = args.components && args.components.aoeDamageConsumable !== undefined;\n\n        this.damage = 12;\n        this.radius = 1;\n\n        if (hasComponent) {\n            const aoeDamageConsumable = args.components.aoeDamageConsumable;\n            if (aoeDamageConsumable) {\n                if (aoeDamageConsumable.damage !== undefined) {\n                    this.damage = aoeDamageConsumable.damage;\n                }\n\n                if (aoeDamageConsumable.radius !== undefined) {\n                    this.radius = aoeDamageConsumable.radius;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aoeDamageConsumable\": {\n                damage: this.damage,\n                radius: this.radius\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getAction() {\n        const self = this;\n        if (this.isPlayer()) {\n            messageConsole.text(\"Select a target location.\", \"#3fffff\").build();\n        }\n\n        engine.setEventHandler(new AreaRangedAttackHandler(function(targetPosition) {\n            return new ItemAction(self.getConsumer(), self.getItem(), targetPosition);\n        }, self.radius));\n\n        return new NoAction(this.parentEntity);\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const targetPosition = action.targetPosition;\n\n        if (!engine.gameMap.isPositionVisible(targetPosition)) {\n            return new UnableToPerformAction(this.parentEntity, \"You cannot target an area that you cannot see.\");\n        }\n\n        const fovHit = this.targetActors(targetPosition, engine.fov.visibleActors);\n        const airFovHit = this.targetActors(targetPosition, engine.airFov.visibleActors);\n\n        if (fovHit || airFovHit) {\n            this.consume();\n            return this;\n        } else {\n            return new UnableToPerformAction(this.parentEntity, \"There are no targets in range.\");\n        }\n    }\n\n    targetActors(targetPosition, actors) {\n        let targetsHit = false;\n        for (const actor of actors) {\n            if (actor.isAlive()) {\n                const position = actor.getComponent(\"positionalobject\");\n                if (position.horizontalDistance(targetPosition) <= this.radius) {\n                    const fighter = actor.getComponent(\"fighter\");\n                    if (fighter) {\n                        const actualDamage = Math.max(0, this.damage - fighter.getBlockedDamage());\n                        if (this.isPlayer()) {\n                            messageConsole.text(\"The \" + actor.name + \" is engulfed in a fiery explosion, taking \" + actualDamage + \" damage!\").build();\n                        }\n\n                        fighter.takeDamage(actualDamage);\n                        targetsHit = true;\n                    }\n                }\n            }\n        }\n\n        return targetsHit;\n    }\n\n    getDescription() {\n        const areaOfEffect = (this.radius * 2) + 1;\n        const areaOfEffectText = areaOfEffect + \"x\" + areaOfEffect;\n        return \"<span class='item__details-line'>Fire Damage: <span style='color: #c00;'>\" + this.damage + \"</span></span>\" +\n            \"<span class='item__details-line'>Area of effect: <span style='color: #ccc;'>\" + areaOfEffectText + \"</span></span>\";\n    }\n}","import Consumable from \"./_Consumable\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport messageConsole from \"../../ui/MessageConsole\";\n\nexport default class ManaConsumable extends Consumable {\n    constructor(args = {}) {\n        super(args, \"manaConsumable\");\n        const hasComponent = args.components && args.components.manaConsumable !== undefined;\n\n        this.amount = 0;\n\n        if (hasComponent) {\n            const manaConsumable = args.components.manaConsumable;\n            if (manaConsumable && manaConsumable.amount !== undefined) {\n                this.amount = manaConsumable.amount;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"manaConsumable\": {\n                amount: this.amount\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n        const fighter = consumer.getComponent(\"fighter\");\n        if (fighter) {\n            const amountRecovered = fighter.recoverMana(this.amount);\n\n            if (amountRecovered > 0) {\n                this.consume();\n                if (this.isPlayer()) {\n                    messageConsole.text(\"You consume the \" + this.parentEntity.name + \", and recover \" + amountRecovered + \" mana!\").build();\n                }\n                return this;\n            } else {\n                return new UnableToPerformAction(action.entity, \"Your mana is already full\");\n            }\n        }\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Recovers <span style='color: #c00;'>\" + this.amount + \"</span> mana</span>\";\n    }\n}","import engine from \"../../Engine\";\nimport AdamMilazzoFov from \"../../map/fov/AdamMilazzoFov\";\nimport {MathUtils, Vector3} from \"three\";\nimport MeleeAction from \"../../actions/actionWithDirection/MeleeAction\";\nimport WanderAction from \"../../actions/WanderAction\";\nimport Graph from \"../../pathfinding/Graph\";\nimport AStar from \"../../pathfinding/AStar\";\nimport BumpAction from \"../../actions/actionWithDirection/BumpAction\";\nimport WaitAction from \"../../actions/WaitAction\";\nimport AI from \"./_AI\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport entityLoader from \"../../entity/EntityLoader\";\n\nexport default class AIGelatinousCube extends AI {\n    constructor(args = {}) {\n        super(args, \"aiGelatinousCube\");\n\n        this.fov = new AdamMilazzoFov();\n        this.chaseLocation = null;\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiGelatinousCube\": {}\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {\n        let performAction = null;\n        // Normal Melee Chase behaviour\n        const entity = this.parentEntity;\n        const entityPosition = entity.getComponent(\"positionalobject\");\n        if (entityPosition) {\n            this.fov.compute(entityPosition.x, entityPosition.y, entityPosition.z, 5, entityPosition.z - 10, entityPosition.z + 10);\n\n            let closestEnemies = [];\n            let closestDistance = null;\n            const entityFaction = entity.getComponent(\"faction\");\n            if (entityFaction) {\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorFaction = actor.getComponent(\"faction\");\n                        if (entityFaction.isEnemyOf(actorFaction)) {\n                            const actorPosition = actor.getComponent(\"positionalobject\");\n\n                            if (actorPosition) {\n                                const dx = Math.abs(actorPosition.x - entityPosition.x);\n                                const dy = Math.abs(actorPosition.y - entityPosition.y);\n                                const distance = Math.max(dx, dy);\n\n                                if (closestDistance === null || distance < closestDistance) {\n                                    closestEnemies = [];\n                                    closestEnemies.push(actor);\n                                    closestDistance = distance;\n                                } else if (distance === closestDistance) {\n                                    closestEnemies.push(actor);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            let closestEnemy;\n            if (closestEnemies.length === 1) {\n                closestEnemy = closestEnemies[0];\n            } else if (closestEnemies.length > 1) {\n                const index = MathUtils.randInt(0, closestEnemies.length - 1);\n                closestEnemy = closestEnemies[index];\n            }\n\n            if (closestEnemy) {\n                const closestEnemyPosition = closestEnemy.getComponent(\"positionalobject\");\n                this.chaseLocation = new Vector3(closestEnemyPosition.x, closestEnemyPosition.y, closestEnemyPosition.z);\n\n                if (closestDistance <= 1) {\n                    performAction = new MeleeAction(entity, closestEnemyPosition.x - entityPosition.x, closestEnemyPosition.y - entityPosition.y, closestEnemyPosition.z - entityPosition.z);\n                }\n            } else {\n                if (this.chaseLocation !== null && this.chaseLocation.x === entityPosition.x && this.chaseLocation.y === entityPosition.y && this.chaseLocation.z === entityPosition.z) {\n                    this.chaseLocation = null;\n                }\n\n                if (this.chaseLocation === null) {\n                    performAction = new WanderAction(entity);\n                }\n            }\n\n            if (!performAction) {\n                // Move towards enemy\n                const gameMap = engine.gameMap;\n                const fovWidth = this.fov.right - this.fov.left;\n                const fovHeight = this.fov.bottom - this.fov.top;\n                const cost = Array(fovWidth).fill().map(() => Array(fovHeight).fill(0));\n\n                for (let i = this.fov.left; i < this.fov.right; i++) {\n                    for (let j = this.fov.top; j < this.fov.bottom; j++) {\n                        const wallTile = gameMap.tiles.get(entityPosition.z)[i][j];\n                        if (wallTile) {\n                            const blocksMovementComponent = wallTile.getComponent(\"blocksMovement\");\n                            if (blocksMovementComponent && blocksMovementComponent.blocksMovement) {\n                                continue;\n                            }\n                        }\n\n                        if (!gameMap.tiles.has(entityPosition.z - 1)) {\n                            continue;\n                        }\n\n                        const floorTile = gameMap.tiles.get(entityPosition.z - 1)[i][j];\n\n                        if (floorTile) {\n                            const walkableComponent = floorTile.getComponent(\"walkable\");\n                            if (walkableComponent && walkableComponent.walkable) {\n                                cost[i - this.fov.left][j - this.fov.top] += 10;\n                            }\n                        }\n                    }\n                }\n\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorPosition = actor.getComponent(\"positionalobject\");\n                        if (actorPosition) {\n                            cost[actorPosition.x - this.fov.left][actorPosition.y - this.fov.top] += 100;\n                        }\n                    }\n                }\n\n                const costGraph = new Graph(cost, {diagonal: true});\n\n                const start = costGraph.grid[entityPosition.x - this.fov.left][entityPosition.y - this.fov.top];\n                const end = costGraph.grid[this.chaseLocation.x - this.fov.left][this.chaseLocation.y - this.fov.top];\n\n                const path = AStar.search(costGraph, start, end);\n                if (path && path.length > 0) {\n                    const next = path.shift();\n                    performAction = new BumpAction(entity, next.x + this.fov.left - entityPosition.x, next.y + this.fov.top - entityPosition.y, entityPosition.z);\n                } else {\n                    performAction = new WaitAction(entity);\n                }\n            }\n\n            performAction.perform();\n\n            const attachedItems = entity.getComponent(\"attachedItems\");\n            if (attachedItems) {\n                const itemsPickedUp = [];\n\n                // Pickup all items in spot\n                for (const item of this.fov.visibleItems) {\n                    const remnant = item.getComponent(\"remnant\");\n                    if (remnant && remnant.isRemnant) {\n                        continue;\n                    }\n\n                    const itemPosition = item.getComponent(\"positionalobject\");\n                    if (entityPosition.isSamePosition(itemPosition)) {\n                        if (attachedItems.add(item)) {\n                            itemsPickedUp.push(item);\n\n                            const position = {\n                                xOffset: itemPosition.xOffset,\n                                yOffset: itemPosition.yOffset,\n                                zOffset: itemPosition.zOffset,\n                                xRot: itemPosition.xRot,\n                                yRot: itemPosition.yRot,\n                                zRot: itemPosition.zRot\n                            };\n\n                            const finalPosition = {\n                                xOffset: position.xOffset + MathUtils.randFloat(0, .1),\n                                yOffset: position.yOffset + MathUtils.randFloat(0, .1),\n                                zOffset: position.zOffset + MathUtils.randFloat(.2, .7),\n                                xRot: MathUtils.randFloat(0, 2),\n                                yRot: MathUtils.randFloat(0, 2),\n                                zRot: MathUtils.randFloat(0, 2)\n                            };\n\n                            if (remnant && !remnant.isRemnant) {\n                                itemPosition.updateRotation(finalPosition.xRot, finalPosition.yRot, finalPosition.zRot);\n                                itemPosition.updateOffsets(finalPosition.xOffset, finalPosition.yOffset, finalPosition.zOffset);\n                                itemPosition.updateObjectPosition();\n                                engine.needsMapUpdate = true;\n                            } else {\n                                const tween = new TWEEN.Tween(position).to(finalPosition, 200);\n                                tween.start();\n                                tween.onUpdate(function() {\n                                    itemPosition.updateRotation(position.xRot, position.yRot, position.zRot);\n                                    itemPosition.updateOffsets(position.xOffset, position.yOffset, position.zOffset);\n                                    itemPosition.updateObjectPosition();\n                                    engine.needsMapUpdate = true;\n                                });\n                            }\n                        }\n                    }\n                }\n\n                for (const item of itemsPickedUp) {\n                    engine.gameMap.removeItem(item);\n                    engine.fov.remove(item);\n                }\n            }\n        }\n    }\n\n    onEntityDeath() {\n        const entity = this.parentEntity;\n        const attachedItems = entity.getComponent(\"attachedItems\");\n        if (attachedItems) {\n            for (const item of attachedItems.items) {\n                if (engine.gameMap.addItem(item)) {\n\n                    const itemPosition = item.getComponent(\"positionalobject\");\n                    if (itemPosition) {\n                        const template = entityLoader.createFromTemplate(item.id);\n                        const templatePosition = template.getComponent(\"positionalobject\");\n                        const position = {\n                            xOffset: itemPosition.xOffset,\n                            yOffset: itemPosition.yOffset,\n                            zOffset: itemPosition.zOffset,\n                            xRot: itemPosition.xRot,\n                            yRot: itemPosition.yRot\n                        };\n\n                        const finalPosition = {\n                            xOffset: templatePosition.xOffset,\n                            yOffset: templatePosition.yOffset,\n                            zOffset: templatePosition.zOffset,\n                            xRot: templatePosition.xRot,\n                            yRot: templatePosition.yRot\n                        };\n\n                        const tween = new TWEEN.Tween(position).to(finalPosition, 200);\n                        tween.start();\n                        tween.onUpdate(function () {\n                            itemPosition.updateRotation(position.xRot, position.yRot);\n                            itemPosition.updateOffsets(position.xOffset, position.yOffset, position.zOffset);\n                            itemPosition.updateObjectPosition();\n                            engine.needsMapUpdate = true;\n                        });\n                    }\n                }\n            }\n\n            attachedItems.clearItems();\n        }\n    }\n}","import AI from \"./_AI\";\n\nexport default class AIPlayer extends AI {\n    constructor(args = {}) {\n        super(args, \"aiPlayer\");\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiPlayer\": {}\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {}\n}","import _Component from \"./_Component\";\nimport engine from \"../Engine\";\n\nexport default class ExplodeOnDeath extends _Component {\n    constructor(args = {}) {\n        super(args, \"explodeOnDeath\");\n        const hasComponent = args.components && args.components.explodeOnDeath !== undefined;\n\n        this.damage = 0;\n        this.radius = 0;\n\n        if (hasComponent) {\n            const explodeOnDeath = args.components.explodeOnDeath;\n            if (explodeOnDeath.damage !== undefined) {\n                this.damage = explodeOnDeath.damage;\n            }\n\n            if (explodeOnDeath.radius !== undefined) {\n                this.radius = explodeOnDeath.radius;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"explodeOnDeath\": {\n                damage: this.damage,\n                radius: this.radius\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    onEntityDeath() {\n        const entity = this.parentEntity;\n\n        const position = entity.getComponent(\"positionalobject\");\n        if (position) {\n            position.teardown();\n\n            engine.gameMap.removeActor(entity);\n\n            if (this.damage > 0) {\n                for (const actor of engine.gameMap.actors) {\n                    const actorPosition = actor.getComponent(\"positionalobject\");\n                    if (position.horizontalDistance(actorPosition) <= this.radius) {\n                        const fighter = actor.getComponent(\"fighter\");\n                        if (fighter) {\n                            fighter.takeDamage(Math.max(0, this.damage - fighter.getBlockedDamage()));\n                        }\n                    }\n                }\n            }\n        }\n    }\n}","import _Component from \"./_Component\";\nimport {Vector3} from \"three\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport engine from \"../Engine\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport Remnant from \"./Remnant\";\n\nexport default class AttachedItems extends _Component {\n    constructor(args = {}) {\n        super(args, \"attachedItems\");\n\n        this.items = [];\n        const hasComponent = args.components && args.components.attachedItems !== undefined;\n\n        if (hasComponent) {\n            const attachedItems = args.components.attachedItems;\n            if (attachedItems.items !== undefined) {\n                for (let i = 0; i < attachedItems.items.length; i++) {\n                    const item = attachedItems.items[i];\n                    if (item !== null) {\n                        this.items[i] = entityLoader.create(item);\n                        this.items[i].parentEntity = this;\n                    }\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const itemJson = [];\n        for (const item of this.items) {\n            if (!item) {\n                itemJson.push(null);\n            } else {\n                itemJson.push(JSON.stringify(item.save()));\n            }\n        }\n\n        const saveJson = {\n            attachedItems: {\n                items: itemJson\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    add(item) {\n        if (this.items.indexOf(item) === -1) {\n            this.items.push(item);\n            this.clearSaveCache();\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    clearItems() {\n        this.items = [];\n        this.clearSaveCache();\n    }\n\n    remove(item) {\n        const index = this.items.indexOf(item);\n        if (index > -1) {\n            this.items.splice(index, 1);\n        }\n        this.clearSaveCache();\n    }\n\n    onMeleeAttack(blockingActor) {\n        for (const item of this.items) {\n            this.animateEntity(item, blockingActor);\n        }\n    }\n\n    animateEntity(entity, blockingActor) {\n        const position = entity.getComponent(\"positionalobject\");\n        if (position && position.hasObject()) {\n            entity.stopCombatAnimations();\n\n            const blockingPosition = blockingActor.getComponent(\"positionalobject\");\n            if (position && position.hasObject() && blockingPosition && blockingPosition.hasObject()) {\n                const originalPosition = new Vector3(position.object.position.x, position.object.position.y, position.object.position.z);\n                const attackPosition = new Vector3((position.object.position.x + blockingPosition.object.position.x) / 2, (position.object.position.y + blockingPosition.object.position.y) / 2, (position.object.position.z + blockingPosition.object.position.z) / 2);\n                const currentPosition = originalPosition.clone();\n\n                const tweenAttack = new TWEEN.Tween(currentPosition).to(attackPosition, 100);\n                tweenAttack.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                const tweenReturn = new TWEEN.Tween(currentPosition).to(originalPosition, 100);\n                tweenReturn.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                tweenAttack.chain(tweenReturn);\n                tweenAttack.start();\n\n                entity.combatTweens.push(tweenAttack);\n                entity.combatTweens.push(tweenReturn);\n            }\n        }\n    }\n\n    onEntityMove() {\n        for (const item of this.items) {\n            item.stopCombatAnimations();\n        }\n\n        const entity = this.parentEntity;\n        const entityPosition = entity.getComponent(\"positionalobject\");\n        if (entityPosition) {\n            for (const item of this.items) {\n                const itemPosition = item.getComponent(\"positionalobject\");\n                if (itemPosition) {\n                    itemPosition.moveTo(entityPosition.x, entityPosition.y, entityPosition.z, false);\n                    engine.needsMapUpdate = true;\n                }\n            }\n        }\n\n        this.clearSaveCache();\n    }\n\n    onAddToScene() {\n        for (const item of this.items) {\n            const position = item.getComponent(\"positionalobject\");\n            if (position) {\n                if (!position.isVisible()) {\n                    position.setVisible();\n                } else {\n                    position.resetColor();\n                }\n            }\n        }\n    }\n\n    onMapTeardown() {\n        for (const item of this.items) {\n            item.callEvent(\"onMapTeardown\");\n        }\n    }\n\n    onCreateRemnant() {\n        for (const item of this.items) {\n            const position = item.getComponent(\"positionalobject\");\n            if (position) {\n                const remnant = item.clone();\n                remnant.setComponent(new Remnant({components: {remnant: {isRemnant: true, x: position.x, y: position.y, z: position.z}}}));\n\n                const remnantPosition = remnant.getComponent(\"positionalobject\");\n                remnantPosition.setVisible();\n                remnantPosition.shiftColor(.5);\n                engine.gameMap.items.push(remnant);\n\n                item.setComponent(new Remnant({components: {remnant: {isRemnant: false, x: position.x, y: position.y, z: position.z}}}));\n                position.setVisible(false);\n            }\n        }\n    }\n\n    onDestroyRemnant() {\n        for (const item of this.items) {\n            const itemRemnant = item.getComponent(\"remnant\");\n            if (itemRemnant) {\n                item.removeComponent(\"remnant\");\n            }\n        }\n    }\n}","import _Component from \"../_Component\";\n\nexport default class Interactable extends _Component {\n    constructor(args = {}, type) {\n        super(args, \"interactable\", type);\n    }\n\n    save() {\n        return null;\n    }\n\n    interact() {}\n}","import Interactable from \"./_Interactable\";\nimport engine from \"../../Engine\";\n\nexport default class StairsInteractable extends Interactable {\n    constructor(args = {}) {\n        super(args, \"stairsInteractable\");\n        const hasComponent = args.components && args.components.stairsInteractable !== undefined;\n\n        this.map = null;\n        this.x = null;\n        this.y = null;\n        this.z = null;\n        this.generator = null;\n\n        if (hasComponent) {\n            const stairsInteractable = args.components.stairsInteractable;\n            if (stairsInteractable) {\n                if (stairsInteractable.map !== undefined) {\n                    this.map = stairsInteractable.map;\n                }\n\n                if (stairsInteractable.x !== undefined) {\n                    this.x = stairsInteractable.x;\n                }\n\n                if (stairsInteractable.y !== undefined) {\n                    this.y = stairsInteractable.y;\n                }\n\n                if (stairsInteractable.z !== undefined) {\n                    this.z = stairsInteractable.z;\n                }\n\n                if (stairsInteractable.generator !== undefined) {\n                    this.generator = stairsInteractable.generator;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"stairsInteractable\": {}\n        };\n\n        if (this.map) {\n            saveJson.stairsInteractable.map = this.map;\n        }\n\n        if (this.x !== null) {\n            saveJson.stairsInteractable.x = this.x;\n        }\n        if (this.y !== null) {\n            saveJson.stairsInteractable.y = this.y;\n        }\n        if (this.z !== null) {\n            saveJson.stairsInteractable.z = this.z;\n        }\n\n        if (this.generator) {\n            saveJson.stairsInteractable.generator = this.generator;\n        }\n\n        this.cachedSave = saveJson;\n\n        return saveJson;\n    }\n\n    setPosition(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.clearSaveCache();\n    }\n\n    interact() {\n        if (this.map) {\n            const playerPosition = engine.player.getComponent(\"positionalobject\");\n            playerPosition.x = this.x;\n            playerPosition.y = this.y;\n            playerPosition.z = this.z;\n            engine.setMap(engine.gameMaps.get(this.map), this);\n        } else if (this.generator) {\n            const args = {};\n            if (engine.gameMap.level) {\n                args.level = engine.gameMap.level + 1;\n            }\n            const newMap = engine.mapLoader.loadMap(this.generator, args);\n            this.map = newMap.name;\n            this.generator = null;\n            engine.setMap(newMap, this);\n        }\n    }\n}","import html from \"../../html/ui/BottomContainer.html\";\nimport UIElement from \"./UIElement\";\nimport characterHealth from \"./CharacterHealth\";\nimport characterMana from \"./CharacterMana\";\nimport engine from \"../Engine\";\n\nclass BottomContainer extends UIElement {\n    constructor() {\n        super(html);\n\n        this.dom.getElementsByClassName(\"bottom-container__left\")[0].appendChild(characterHealth.dom);\n        this.dom.getElementsByClassName(\"bottom-container__right\")[0].appendChild(characterMana.dom);\n\n        this.xpFilledDom = this.dom.getElementsByClassName(\"character__xp-filled\")[0];\n\n        this.openCharacter = this.dom.getElementsByClassName(\"hotbar__open-character\")[0];\n        this.openSkills = this.dom.getElementsByClassName(\"hotbar__open-skill\")[0];\n\n        this.beltSlotsDom = this.dom.getElementsByClassName(\"belt-slots\")[0];\n    }\n\n    updateAll() {\n        this.updateXp();\n        this.updateStatPointsIndicator();\n        this.updateSkillPointsIndicator();\n        this.updateBeltSlots();\n    }\n\n    updateXp() {\n        const level = engine.player.getComponent(\"level\");\n        this.xpFilledDom.style.width = level.getPercentXPTowardsLevel() + \"%\";\n    }\n\n    updateStatPointsIndicator() {\n        const level = engine.player.getComponent(\"level\");\n        const statPointsAvailable = level.statPointsAvailable;\n        if (statPointsAvailable > 0) {\n            this.openCharacter.classList.add(\"has-statpoint\");\n        } else {\n            this.openCharacter.classList.remove(\"has-statpoint\");\n        }\n    }\n\n    updateSkillPointsIndicator() {\n        const level = engine.player.getComponent(\"level\");\n        const skillPointsAvailable = level.skillPointsAvailable;\n        if (skillPointsAvailable > 0) {\n            this.openSkills.classList.add(\"has-skillpoint\");\n        } else {\n            this.openSkills.classList.remove(\"has-skillpoint\");\n        }\n    }\n\n    updateBeltSlots() {\n        this.beltSlotsDom.innerHTML = \"\";\n        const playerEquipment = engine.player.getComponent(\"equipment\");\n        if (playerEquipment) {\n            // Get belt\n            const equipmentBeltItem = playerEquipment.items[7];\n            const beltItem = equipmentBeltItem.item;\n            if (beltItem) {\n                const beltEquippable = beltItem.getComponent(\"equippable\");\n                if (beltEquippable) {\n                    for (let i = 0; i < beltEquippable.maxStorage; i++) {\n                        const beltSlotDom = document.createElement(\"div\");\n                        beltSlotDom.classList.add(\"slot\", \"belt-slot\");\n                        beltSlotDom.setAttribute(\"data-index\", i);\n\n                        if (beltEquippable.storage.length >= i) {\n                            const storageItem = beltEquippable.storage[i];\n                            this.populateSlot(beltSlotDom, storageItem);\n                        }\n\n                        this.beltSlotsDom.appendChild(beltSlotDom);\n                    }\n                }\n            }\n        }\n    }\n\n    populateSlot(slot, item) {\n        if (item) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (itemPosition) {\n                let rotation = \"\";\n                if (itemPosition.zRot !== 0) {\n                    rotation = \"transform: rotate(\" + (itemPosition.zRot * 180) + \"deg);\";\n                }\n                slot.classList.add(\"has-item\");\n                let html = \"<div class='item' style='color:\" + itemPosition.color + \";\" + rotation + \"'><div class='item__icon'>\" + itemPosition.letter + \"</div>\";\n\n                if (item.amount > 1) {\n                    html += \"<span class='item__amount'>\" + item.amount + \"</span>\";\n                }\n\n                html += \"<div class='item__details'>\"\n                    + \"<span class='item__details-line item__name'>\" + item.name + \"</span>\";\n                if (item.description) {\n                    html += \"<span class='item__details-line item__description'>\" + item.description + \"</span>\";\n                }\n\n                html += \"<span class='item__details-line'><hr/></span>\";\n\n                html += item.getComponentDescriptions();\n\n                html += \"</div></div>\";\n\n                slot.innerHTML = html;\n            }\n        } else {\n            slot.classList.remove(\"has-item\");\n            slot.innerHTML = \"\";\n        }\n    }\n}\n\nconst bottomContainer = new BottomContainer();\nexport default bottomContainer;","import _Component from \"./_Component\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport engine from \"../Engine\";\nimport character from \"../ui/Character\";\nimport bottomContainer from \"../ui/BottomContainer\";\n\nexport default class Level extends _Component {\n    constructor(args = {}) {\n        super(args, \"level\");\n        const hasComponent = args.components && args.components.level !== undefined;\n\n        this.level = 1;\n        this.xp = 0;\n        this.xpGiven = 0;\n        this.statPointsAvailable = 0;\n        this.skillPointsAvailable = 0;\n\n        this.statPointsPerLevel = 1;\n        this.skillPointsPerLevel = 1;\n\n        if (hasComponent) {\n            const level = args.components.level;\n            if (level.level !== undefined) {\n                this.level = level.level;\n            }\n\n            if (level.xp !== undefined) {\n                this.xp = level.xp;\n            }\n\n            if (level.xpGiven !== undefined) {\n                this.xpGiven = level.xpGiven;\n            }\n\n            if (level.statPointsAvailable !== undefined) {\n                this.statPointsAvailable = level.statPointsAvailable;\n            }\n\n            if (level.skillPointsAvailable !== undefined) {\n                this.skillPointsAvailable = level.skillPointsAvailable;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            level: {}\n        };\n\n        if (this.level > 1) {\n            saveJson.level = this.level;\n        }\n\n        if (this.xp > 0) {\n            saveJson.xp = this.xp;\n        }\n\n        if (this.xpGiven > 0) {\n            saveJson.xpGiven = this.xpGiven;\n        }\n\n        if (this.statPointsAvailable > 0) {\n            saveJson.statPointsAvailable = this.statPointsAvailable;\n        }\n\n        if (this.skillPointsAvailable > 0) {\n            saveJson.skillPointsAvailable = this.skillPointsAvailable;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    xpForLevel(level) {\n        return 75 * ((level * level) + level);\n    }\n\n    requiresLevelUp() {\n        return this.xp >= this.xpForLevel(this.level);\n    }\n\n    getPercentXPTowardsLevel() {\n        const previousLevelXp = this.xpForLevel(this.level - 1);\n        const levelXpAdjusted = this.xpForLevel(this.level) - previousLevelXp;\n        const xpAdjusted = this.xp - previousLevelXp;\n        return (xpAdjusted / levelXpAdjusted) * 100;\n    }\n\n    levelUp() {\n        this.level += 1;\n        this.statPointsAvailable += this.statPointsPerLevel;\n        this.skillPointsAvailable += this.skillPointsPerLevel;\n        messageConsole.text(\"You are now level \" + this.level + \"!\").build();\n\n        const fighter = this.parentEntity.getComponent(\"fighter\");\n        fighter.heal(fighter.maxHp);\n        fighter.recoverMana(fighter.maxMana);\n\n        bottomContainer.updateStatPointsIndicator();\n        bottomContainer.updateSkillPointsIndicator();\n        this.clearSaveCache();\n    }\n\n    useStatPoint() {\n        this.statPointsAvailable -= 1;\n        character.populate(engine.player);\n\n        bottomContainer.updateStatPointsIndicator();\n        this.clearSaveCache();\n    }\n\n    useSkillPoint() {\n        this.skillPointsAvailable -= 1;\n        //skills.populate(engine.player);\n\n        bottomContainer.updateSkillPointsIndicator();\n        this.clearSaveCache();\n    }\n\n    addXp(amount) {\n        if (amount <= 0) {\n            return;\n        }\n\n        this.xp += amount;\n        messageConsole.text(\"You gain \" + amount + \" xp.\").build();\n\n        if (this.requiresLevelUp()) {\n            this.levelUp();\n        }\n\n        if (character.isOpen()) {\n            character.populate(engine.player);\n        }\n\n        bottomContainer.updateXp();\n        this.clearSaveCache();\n    }\n\n    onEntityDeath() {\n        if (engine.player && !this.isPlayer()) {\n            const level = engine.player.getComponent(\"level\");\n            level.addXp(this.xpGiven);\n        }\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport engine from \"../../Engine\";\n\nexport default class EmptyTileTargetHandler extends SelectIndexHandler {\n    constructor(callback) {\n        super();\n\n        this.callback = callback;\n    }\n\n    confirmIndex() {\n        engine.processAction(this.callback(this.position));\n        this.exit();\n    }\n}","import Consumable from \"./_Consumable\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport engine from \"../../Engine\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\nimport NoAction from \"../../actions/NoAction\";\nimport EmptyTileTargetHandler from \"../../event/selectIndexHandler/EmptyTileTargetHandler\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport entityLoader from \"../../entity/EntityLoader\";\n\nexport default class SummonPortalConsumable extends Consumable {\n    constructor(args = {}) {\n        super(args, \"summonPortalConsumable\");\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"summonPortalConsumable\": {}\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getAction() {\n        const self = this;\n\n        if (engine.gameMap && engine.gameMap.name === \"town\") {\n            return new UnableToPerformAction(this.parentEntity, \"You can't summon a portal in town!\");\n        }\n\n        if (this.isPlayer()) {\n            messageConsole.text(\"Select a target location.\", \"#3fffff\").build();\n        }\n\n        engine.setEventHandler(new EmptyTileTargetHandler(function(targetPosition) {\n            return new ItemAction(self.getConsumer(), self.getItem(), targetPosition);\n        }));\n\n        return new NoAction(this.parentEntity);\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     * @param {Vector3} targetPosition\n     */\n    activate(action, targetPosition) {\n        const wallTiles = engine.gameMap.tiles.get(targetPosition.z + 1);\n        if (wallTiles) {\n            const tilesX = wallTiles[targetPosition.x];\n            if (tilesX) {\n                const tile = tilesX[targetPosition.y];\n                if (tile) {\n                    const blocksMovement = tile.getComponent(\"walkable\");\n                    if (blocksMovement && blocksMovement.blocksMovement) {\n                        return new UnableToPerformAction(this.parentEntity, tile.name + \" is in the way.\");\n                    }\n                }\n            }\n        }\n\n        let hasFloorTile = false;\n        const floorTiles = engine.gameMap.tiles.get(targetPosition.z);\n        if (floorTiles) {\n            const tilesX = floorTiles[targetPosition.x];\n            if (tilesX) {\n                const tile = tilesX[targetPosition.y];\n                if (tile) {\n                    const walkable = tile.getComponent(\"walkable\");\n                    const position = tile.getComponent(\"positionalobject\");\n                    if (position && walkable && walkable.walkable) {\n                        if (position.transparency === 1 && position.hasObject()) {\n                            hasFloorTile = true;\n                        } else {\n                            return new UnableToPerformAction(this.parentEntity, \"You can't see there!\");\n                        }\n                    }\n                }\n            }\n        }\n\n        if (!hasFloorTile) {\n            return new UnableToPerformAction(this.parentEntity, \"No floor there to support the portal.\");\n        }\n\n        const target = action.getTargetActor();\n        if (target) {\n            return new UnableToPerformAction(this.parentEntity, target.name + \" is in the way.\");\n        }\n\n        engine.gameMap.tiles.get(targetPosition.z + 1)[targetPosition.x][targetPosition.y] = entityLoader.createFromTemplate(\"portal\", {components: {positionalobject: {x: targetPosition.x, y: targetPosition.y, z: targetPosition.z + 1}, portalInteractable: {map: \"town\", x: 34, y:36, z:1}}});\n        const town = engine.gameMaps.get(\"town\");\n        town.tiles.get(1)[34][36] = entityLoader.createFromTemplate(\"portal\", {components: {positionalobject: {x: 34, y: 36, z: 1}, portalInteractable: {map: engine.gameMap.name, x: targetPosition.x, y: targetPosition.y, z: targetPosition.z + 1}}});\n\n        this.consume();\n    }\n}","import Interactable from \"./_Interactable\";\nimport engine from \"../../Engine\";\nimport entityLoader from \"../../entity/EntityLoader\";\n\nexport default class PortalInteractable extends Interactable {\n    constructor(args = {}) {\n        super(args, \"portalInteractable\");\n        const hasComponent = args.components && args.components.portalInteractable !== undefined;\n\n        this.map = null;\n        this.x = null;\n        this.y = null;\n        this.z = null;\n\n        if (hasComponent) {\n            const portalInteractable = args.components.portalInteractable;\n            if (portalInteractable) {\n                if (portalInteractable.map !== undefined) {\n                    this.map = portalInteractable.map;\n                }\n\n                if (portalInteractable.x !== undefined) {\n                    this.x = portalInteractable.x;\n                }\n\n                if (portalInteractable.y !== undefined) {\n                    this.y = portalInteractable.y;\n                }\n\n                if (portalInteractable.z !== undefined) {\n                    this.z = portalInteractable.z;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"portalInteractable\": {}\n        };\n\n        if (this.map) {\n            saveJson.portalInteractable.map = this.map;\n        }\n\n        if (this.x !== null) {\n            saveJson.portalInteractable.x = this.x;\n        }\n        if (this.y !== null) {\n            saveJson.portalInteractable.y = this.y;\n        }\n        if (this.z !== null) {\n            saveJson.portalInteractable.z = this.z;\n        }\n\n        this.cachedSave = saveJson;\n\n        return saveJson;\n    }\n\n    setPosition(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.clearSaveCache();\n    }\n\n    interact() {\n        if (this.map) {\n            const playerPosition = engine.player.getComponent(\"positionalobject\");\n\n            if (this.map.name !== \"town\") {\n                const town = engine.gameMaps.get(\"town\");\n                town.tiles.get(1)[34][36] = entityLoader.createFromTemplate(\"portal\", {components: {positionalobject: {x: 34, y: 36, z: 1}, portalInteractable: {map: engine.gameMap.name, x: playerPosition.x, y: playerPosition.y, z: playerPosition.z}}});\n            }\n            this.parentEntity.getComponent(\"positionalobject\").teardown();\n            engine.gameMap.tiles.get(playerPosition.z)[playerPosition.x][playerPosition.y] = null;\n\n            playerPosition.x = this.x;\n            playerPosition.y = this.y;\n            playerPosition.z = this.z;\n            engine.setMap(engine.gameMaps.get(this.map), this);\n        }\n    }\n}","const EquipmentType = Object.freeze({\n    MAIN_HAND: \"mainhand\",\n    OFF_HAND: \"offhand\",\n    BODY: \"body\",\n    HELMET: \"helmet\",\n    GLOVES: \"gloves\",\n    SHOULDER: \"shoulder\",\n    BELT: \"belt\",\n    BOOTS: \"boots\",\n    STORAGE: \"storage\",\n    AMULET: \"amulet\",\n    RING: \"ring\"\n});\n\nexport default EquipmentType;","export default class EquipmentSlot {\n    constructor(slot, item) {\n        this.slot = slot;\n        this.item = item;\n    }\n}","import _Component from \"../_Component\";\nimport EquipmentType from \"./EquipmentType\";\nimport EquipmentSlot from \"./EquipmentSlot\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport engine from \"../../Engine\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport inventory from \"../../ui/Inventory\";\n\nexport default class Equipment extends _Component {\n    constructor(args = {}) {\n        super(args, \"equipment\");\n        const hasComponent = args.components && args.components.equipment !== undefined;\n\n        this.items = [];\n        this.items.push(new EquipmentSlot(EquipmentType.SHOULDER));\n        this.items.push(new EquipmentSlot(EquipmentType.HELMET));\n        this.items.push(new EquipmentSlot(EquipmentType.AMULET));\n        this.items.push(new EquipmentSlot(EquipmentType.MAIN_HAND));\n        this.items.push(new EquipmentSlot(EquipmentType.BODY));\n        this.items.push(new EquipmentSlot(EquipmentType.OFF_HAND));\n        this.items.push(new EquipmentSlot(EquipmentType.RING));\n        this.items.push(new EquipmentSlot(EquipmentType.BELT));\n        this.items.push(new EquipmentSlot(EquipmentType.RING));\n        this.items.push(new EquipmentSlot(EquipmentType.STORAGE));\n        this.items.push(new EquipmentSlot(EquipmentType.BOOTS));\n        this.items.push(new EquipmentSlot(EquipmentType.GLOVES));\n\n        if (hasComponent) {\n            const equipment = args.components.equipment;\n            if (equipment.items !== undefined) {\n                for (let i = 0; i < equipment.items.length; i++) {\n                    const item = equipment.items[i];\n                    if (item !== null) {\n                        if (item.load !== undefined) {\n                            this.items[i].item = entityLoader.createFromTemplate(item.load, item);\n                        } else {\n                            this.items[i].item = entityLoader.create(item);\n                        }\n                        this.items[i].item.parentEntity = this;\n                    }\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const itemJson = [];\n        for (const equipmentSlot of this.items) {\n            const item = equipmentSlot.item;\n            if (!item) {\n                itemJson.push(null);\n            } else {\n                itemJson.push(JSON.stringify(item.save()));\n            }\n        }\n\n        const saveJson = {\n            equipment: {\n                items: itemJson\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getEquippables() {\n        const equippables = [];\n        for (const equipmentItem of this.items) {\n            const item = equipmentItem.item;\n            if (item) {\n                const equippable = item.getComponent(\"equippable\");\n                if (equippable) {\n                    equippables.push(equippable);\n                }\n            }\n        }\n\n        return equippables;\n    }\n\n    move(fromIndex, toIndex) {\n        if (fromIndex !== toIndex) {\n            const fromItem = this.items[fromIndex].item;\n\n            this.items[fromIndex].item = this.items[toIndex].item;\n            this.items[toIndex].item = fromItem;\n\n            this.clearSaveCache();\n        }\n    }\n\n    dropAll() {\n        for (const equipmentItem of this.items) {\n            if (equipmentItem.item) {\n                this.drop(equipmentItem.item);\n            }\n        }\n\n        const gold = this.gold;\n        if (gold > 0) {\n            const goldItem = entityLoader.createFromTemplate(\"gold\");\n            goldItem.amount = gold;\n            this.drop(goldItem);\n        }\n\n        this.clearSaveCache();\n    }\n\n    drop(item) {\n        if (item) {\n            const parentPosition = this.parentEntity.getComponent(\"positionalobject\");\n            engine.gameMap.addItem(item, parentPosition);\n\n            if (this.isPlayer()) {\n                messageConsole.text(\"You dropped the \" + item.name).build();\n            }\n\n            this.remove(item);\n            this.clearSaveCache();\n            if (this.isPlayer()) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n\n    remove(item) {\n        for (let i = 0; i < this.items.length; i++) {\n            const equipmentItem = this.items[i];\n            if (equipmentItem && equipmentItem.item === item) {\n                equipmentItem.item = null;\n                this.clearSaveCache();\n                engine.needsMapUpdate = true;\n                break;\n            }\n        }\n    }\n\n    addItem(item) {\n        const belt = this.items[7].item;\n        const storage = this.items[9].item;\n\n        let success = false;\n        if (belt) {\n            const beltEquippable = belt.getComponent(\"equippable\");\n            success = beltEquippable.addPartialStacks(item);\n        }\n\n        if (!success && storage) {\n            const storageEquippable = storage.getComponent(\"equippable\");\n            success = storageEquippable.addPartialStacks(item);\n        }\n\n        if (!success) {\n            for (let i = 0; i < this.items.length; i++) {\n                if (i === 7 || i === 9) {\n                    continue;\n                }\n\n                const item = this.items[i].item;\n                if (item) {\n                    const itemEquippable = item.getComponent(\"equippable\");\n                    success = itemEquippable.addPartialStacks(item);\n                    if (success) {\n                        break;\n                    }\n                }\n            }\n        }\n\n        if (!success && storage) {\n            const storageEquippable = storage.getComponent(\"equippable\");\n            success = storageEquippable.addFullStacks(item);\n        }\n\n        return success;\n    }\n\n    setItem(index, item) {\n        this.items[index].item = item;\n        this.clearSaveCache();\n    }\n\n    getItem(index) {\n        return this.items[index].item;\n    }\n\n    onEntityDeath() {\n        this.dropAll();\n    }\n}","import _Component from \"../_Component\";\nimport EquipmentType from \"./EquipmentType\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport engine from \"../../Engine\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport inventory from \"../../ui/Inventory\";\n\nexport default class Equippable extends _Component {\n    constructor(args = {}) {\n        super(args, \"equippable\");\n        const hasComponent = args.components && args.components.equippable !== undefined;\n        this.slot = EquipmentType.MAIN_HAND;\n        this.minDamage = 0;\n        this.maxDamage = 0;\n        this.defense = 0;\n        this.blockChance = 0;\n        this.health = 0;\n        this.mana = 0;\n        this.strength = 0;\n        this.agility = 0;\n        this.constitution = 0;\n        this.wisdom = 0;\n        this.lightRadius = 0;\n        this.maxStorage = 0;\n        this.storage = [];\n\n        if (hasComponent) {\n            const equippable = args.components.equippable;\n            if (equippable.slot !== undefined) {\n                this.slot = equippable.slot;\n            }\n\n            const damage = equippable.damage;\n            if (damage !== undefined) {\n                if (typeof damage === \"string\") {\n                    const damageSplit = damage.split(\",\");\n                    this.minDamage = this.parseRandIntBetween(damageSplit[0]);\n\n                    if (damageSplit.length > 1) {\n                        this.maxDamage = this.parseRandIntBetween(damageSplit[1]);\n                    } else {\n                        this.maxDamage = this.minDamage;\n                    }\n                } else {\n                    this.minDamage = damage;\n                    this.maxDamage = this.minDamage;\n                }\n            }\n\n            if (equippable.defense !== undefined) {\n                this.defense = this.parseRandIntBetween(equippable.defense);\n            }\n\n            if (equippable.blockChance !== undefined) {\n                this.blockChance = this.parseRandIntBetween(equippable.blockChance);\n            }\n\n            if (equippable.health !== undefined) {\n                this.health = this.parseRandIntBetween(equippable.health);\n            }\n\n            if (equippable.mana !== undefined) {\n                this.mana = this.parseRandIntBetween(equippable.mana);\n            }\n\n            if (equippable.strength !== undefined) {\n                this.strength = this.parseRandIntBetween(equippable.strength);\n            }\n\n            if (equippable.agility !== undefined) {\n                this.agility = this.parseRandIntBetween(equippable.agility);\n            }\n\n            if (equippable.constitution !== undefined) {\n                this.constitution = this.parseRandIntBetween(equippable.constitution);\n            }\n\n            if (equippable.wisdom !== undefined) {\n                this.wisdom = this.parseRandIntBetween(equippable.wisdom);\n            }\n\n            if (equippable.lightRadius !== undefined) {\n                this.lightRadius = this.parseRandIntBetween(equippable.lightRadius);\n            }\n\n            if (equippable.maxStorage !== undefined) {\n                this.maxStorage = equippable.maxStorage;\n            }\n\n            if (equippable.storage !== undefined) {\n                for (let i = 0; i < equippable.storage.length; i++) {\n                    const item = equippable.storage[i];\n                    if (item !== null) {\n                        if (item.load !== undefined) {\n                            this.storage[i] = entityLoader.createFromTemplate(item.load, item);\n                        } else {\n                            this.storage[i] = entityLoader.create(item);\n                        }\n                        this.storage[i].parentEntity = this;\n                    }\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            equippable: {}\n        };\n\n        if (this.slot !== EquipmentType.MAIN_HAND) {\n            saveJson.equippable.slot = this.slot;\n        }\n\n        if (this.minDamage !== 0 || this.maxDamage !== 0) {\n            if (this.minDamage === this.maxDamage) {\n                saveJson.equippable.damage = this.minDamage;\n            } else {\n                saveJson.equippable.damage = this.minDamage + \",\" + this.maxDamage;\n            }\n        }\n\n        if (this.defense !== 0) {\n            saveJson.equippable.defense = this.defense;\n        }\n\n        if (this.blockChance !== 0) {\n            saveJson.equippable.blockChance = this.blockChance;\n        }\n\n        if (this.health !== 0) {\n            saveJson.equippable.health = this.health;\n        }\n\n        if (this.mana !== 0) {\n            saveJson.equippable.mana = this.mana;\n        }\n\n        if (this.strength !== 0) {\n            saveJson.equippable.strength = this.strength;\n        }\n\n        if (this.agility !== 0) {\n            saveJson.equippable.agility = this.agility;\n        }\n\n        if (this.constitution !== 0) {\n            saveJson.equippable.constitution = this.constitution;\n        }\n\n        if (this.wisdom !== 0) {\n            saveJson.equippable.wisdom = this.wisdom;\n        }\n\n        if (this.lightRadius !== 0) {\n            saveJson.equippable.lightRadius = this.lightRadius;\n        }\n\n        if (this.maxStorage !== 0) {\n            saveJson.equippable.maxStorage = this.maxStorage;\n        }\n\n        const storageJson = [];\n        for (const item of this.storage) {\n            if (!item) {\n                storageJson.push(null);\n            } else {\n                storageJson.push(JSON.stringify(item.save()));\n            }\n        }\n\n        if (storageJson.length > 0) {\n            saveJson.equippable.storage = storageJson;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getDescription() {\n        let description = \"<span class='item__details-line'>Type: <span style='color: #fff;'>\" + this.slot + \"</span></span>\";\n\n        if (this.minDamage !== 0 || this.maxDamage !== 0) {\n            description += \"<span class='item__details-line'>Damage: <span style='color: #f00;'>\";\n            if (this.minDamage === this.maxDamage) {\n                description += this.minDamage;\n            } else {\n                description += this.minDamage + \" - \" + this.maxDamage;\n            }\n            description += \"</span></span>\";\n        }\n\n        if (this.defense !== 0) {\n            description += \"<span class='item__details-line'>Defense: <span style='color: #fff;'>\" + this.defense + \"</span></span>\";\n        }\n\n        if (this.blockChance !== 0) {\n            description += \"<span class='item__details-line'>Block Chance: <span style='color: #fff;'>\" + this.blockChance + \"</span></span>\";\n        }\n\n        if (this.health !== 0) {\n            description += \"<span class='item__details-line'>Health: <span style='color: #fff;'>+\" + this.health + \"</span></span>\";\n        }\n\n        if (this.mana !== 0) {\n            description += \"<span class='item__details-line'>Mana: <span style='color: #fff;'>+\" + this.mana + \"</span></span>\";\n        }\n\n        if (this.strength !== 0) {\n            description += \"<span class='item__details-line'>Strength: <span style='color: #fff;'>+\" + this.strength + \"</span></span>\";\n        }\n\n        if (this.agility !== 0) {\n            description += \"<span class='item__details-line'>Agility: <span style='color: #fff;'>+\" + this.agility + \"</span></span>\";\n        }\n\n        if (this.constitution !== 0) {\n            description += \"<span class='item__details-line'>Constitution: <span style='color: #fff;'>+\" + this.constitution + \"</span></span>\";\n        }\n\n        if (this.wisdom !== 0) {\n            description += \"<span class='item__details-line'>Wisdom: <span style='color: #fff;'>+\" + this.wisdom + \"</span></span>\";\n        }\n\n        if (this.lightRadius !== 0) {\n            description += \"<span class='item__details-line'>Light Radius: <span style='color: #fff;'>+\" + this.lightRadius + \"</span></span>\";\n        }\n\n        if (this.maxStorage === -1) {\n            description += \"<span class='item__details-line'>Storage: <span style='color: #fff;'>Unlimited</span></span>\";\n        } else if (this.maxStorage > 0) {\n            description += \"<span class='item__details-line'>Storage: <span style='color: #fff;'>\" + this.maxStorage + \"</span></span>\";\n        }\n\n        return description;\n    }\n\n    addFullStacks(item) {\n        this.clearSaveCache();\n\n        // Add full stack\n        if (this.maxStorage === -1) {\n            this.storage[this.storage.length] = item;\n            item.parentEntity = this;\n        } else {\n            for (let i = 0; i < this.maxStorage; i++) {\n                if (!this.storage[i]) {\n                    this.storage[i] = item;\n                    item.parentEntity = this;\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    addPartialStacks(item) {\n        if (item.amount <= 0) {\n            return false;\n        }\n        this.clearSaveCache();\n\n        const originalAmount = item.amount;\n        let amountToAdd = item.amount;\n\n        let partialMax;\n        if (this.maxStorage === -1) {\n            partialMax = this.storage.length;\n        } else {\n            partialMax = this.maxStorage;\n        }\n        // Add partial stack\n        for (let i = 0; i < partialMax; i++) {\n            const inventoryItem = this.storage[i];\n            if (inventoryItem) {\n                if (item.id === inventoryItem.id) {\n                    const amountCanAdd = inventoryItem.maxStackSize - inventoryItem.amount;\n                    if (amountCanAdd >= amountToAdd) {\n                        inventoryItem.setAmount(inventoryItem.amount + amountToAdd);\n                        return true;\n                    } else {\n                        inventoryItem.setAmount(inventoryItem.amount + amountCanAdd);\n                        item.setAmount(item.amount - amountCanAdd);\n                        amountToAdd -= amountCanAdd;\n                    }\n                }\n            }\n        }\n\n        return originalAmount !== amountToAdd;\n    }\n\n    use(item, amount) {\n        item.setAmount(item.amount - amount);\n        if (item.amount <= 0) {\n            this.remove(item);\n        }\n\n        this.clearSaveCache();\n    }\n\n    remove(item) {\n        const index = this.storage.indexOf(item);\n        if (index > -1) {\n            this.storage.splice(index, 1, null);\n        }\n\n        this.clearSaveCache();\n        engine.needsMapUpdate = true;\n    }\n\n    setItem(index, item) {\n        this.storage[index] = item;\n        this.clearSaveCache();\n    }\n\n    move(fromIndex, toIndex) {\n        if (fromIndex !== toIndex) {\n            const fromItem = this.storage[fromIndex];\n\n            this.storage[fromIndex] = this.storage[toIndex];\n            this.storage[toIndex] = fromItem;\n\n            this.clearSaveCache();\n            if (this.isPlayer()) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n\n    drop(item) {\n        if (item) {\n            let parent = this.parentEntity;\n            while (parent.type !== \"actor\") {\n                parent = parent.parentEntity;\n            }\n            const parentPosition = parent.getComponent(\"positionalobject\");\n            engine.gameMap.addItem(item, parentPosition);\n\n            if (parent === engine.player) {\n                messageConsole.text(\"You dropped the \" + item.name).build();\n            }\n\n            this.remove(item);\n            this.clearSaveCache();\n            if (parent === engine.player) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n}","import SolidObject from \"./positionalObject/SolidObject\";\nimport CharacterObject from \"./positionalObject/CharacterObject\";\nimport BlocksMovement from \"./BlocksMovement\";\nimport Walkable from \"./Walkable\";\nimport Fov from \"./Fov\";\nimport BlocksFov from \"./BlocksFov\";\nimport Openable from \"./Openable\";\nimport VisibilityModifier from \"./VisibilityModifier\";\nimport Fighter from \"./Fighter\";\nimport AIMeleeChase from \"./ai/AIMeleeChase\";\nimport Faction from \"./Faction\";\nimport Remnant from \"./Remnant\";\nimport AIDead from \"./ai/AIDead\";\nimport HealingConsumable from \"./consumable/HealingConsumable\";\nimport Inventory from \"./Inventory\";\nimport DamageNearestConsumable from \"./consumable/DamageNearestConsumable\";\nimport ConfusionConsumable from \"./consumable/ConfusionConsumable\";\nimport AIConfusedEnemy from \"./ai/AIConfusedEnemy\";\nimport AOEDamageConsumable from \"./consumable/AOEDamageConsumable\";\nimport ManaConsumable from \"./consumable/ManaConsumable\";\nimport AIGelatinousCube from \"./ai/AIGelatinousCube\";\nimport AIPlayer from \"./ai/AIPlayer\";\nimport ExplodeOnDeath from \"./ExplodeOnDeath\";\nimport AttachedItems from \"./AttachedItems\";\nimport StairsInteractable from \"./interactable/StairsInteractable\";\nimport Level from \"./Level\";\nimport SummonPortalConsumable from \"./consumable/SummonPortalConsumable\";\nimport PortalInteractable from \"./interactable/PortalInteractable\";\nimport Equipment from \"./equipment/Equipment\";\nimport Equippable from \"./equipment/Equippable\";\n\nclass ComponentLoader {\n    constructor() {\n        this.types = new Map();\n\n        // AI\n        this.load(new AIConfusedEnemy());\n        this.load(new AIDead());\n        this.load(new AIGelatinousCube());\n        this.load(new AIMeleeChase());\n        this.load(new AIPlayer());\n\n        // Consumables\n        this.load(new AOEDamageConsumable());\n        this.load(new ConfusionConsumable());\n        this.load(new DamageNearestConsumable());\n        this.load(new HealingConsumable());\n        this.load(new ManaConsumable());\n        this.load(new SummonPortalConsumable());\n\n        // Equipment\n        this.load(new Equipment());\n        this.load(new Equippable());\n\n        // Interactables\n        this.load(new StairsInteractable());\n        this.load(new PortalInteractable());\n\n        // Positionalobjects\n        this.load(new CharacterObject());\n        this.load(new SolidObject());\n\n        // Default components\n        this.load(new AttachedItems());\n        this.load(new BlocksFov());\n        this.load(new BlocksMovement());\n        this.load(new ExplodeOnDeath());\n        this.load(new Faction());\n        this.load(new Fighter());\n        this.load(new Fov());\n        this.load(new Inventory());\n        this.load(new Level());\n        this.load(new Openable());\n        this.load(new Remnant());\n        this.load(new VisibilityModifier());\n        this.load(new Walkable());\n    }\n\n    load(component) {\n        this.types.set(component.type, component);\n    }\n\n    create(entity, type, args) {\n        const component = this.types.get(type);\n        const constructor = component.constructor;\n        return new constructor(args);\n    }\n}\n\nconst componentLoader = new ComponentLoader();\nexport default componentLoader;","import _Component from \"../components/_Component\";\nimport componentLoader from \"../components/ComponentLoader\";\nimport Extend from \"../util/Extend\";\n\nexport default class _Entity {\n    constructor(args, type) {\n        if (type) {\n            args.type = type;\n        }\n        this.type = args.type || \"entity\";\n        this.id = args.id;\n        this.name = args.name || \"\";\n        this.description = args.description || \"\";\n        this.componentArray = [];\n        this.components = {};\n        this.parent = null;\n        this.combatTweens = [];\n\n        if (args.components) {\n            this.loadComponents(args, args.components);\n            this.callEvent(\"onComponentsLoaded\");\n        }\n\n        this.cachedSave = null;\n    }\n\n    loadComponents(args, components) {\n        const self = this;\n        Object.keys(components).forEach(function(key) {\n            const type = componentLoader.types.get(key);\n            if (type) {\n                const baseType = type.baseType;\n                const existingComponent = self.getComponent(baseType);\n                if (!existingComponent) {\n                    self.setComponent(componentLoader.create(this, key, args));\n                }\n            }\n        });\n    }\n\n    setComponent(component) {\n        if (!(component instanceof _Component)) {\n            console.error(\"Invalid component: \", component);\n        }\n\n        component.parentEntity = this;\n        this.components[component.baseType] = component;\n        this.componentArray.push(component);\n\n        this.clearSaveCache();\n    }\n\n    getComponent(baseType) {\n        return this.components[baseType];\n    }\n\n    removeComponent(baseType) {\n        if (!this.components[baseType]) {\n            return;\n        }\n\n        this.components[baseType] = undefined;\n        for (const component of this.componentArray) {\n            if (component.baseType === baseType) {\n                const index = this.componentArray.indexOf(component);\n                this.componentArray.splice(index, 1);\n                break;\n            }\n        }\n\n        this.clearSaveCache();\n    }\n\n    clearSaveCache() {\n        this.cachedSave = null;\n    }\n\n    save() {\n        if (this.cachedSave !== null) {\n            return this.cachedSave;\n        }\n\n        const json = {\n            id: this.id,\n            type: this.type,\n            name: this.name,\n            description: this.description\n        };\n\n        json.components = {};\n        for (const component of this.componentArray) {\n            const save = component.save();\n            if (save !== null && save !== {}) {\n                Extend.deep(json.components, save);\n            }\n        }\n\n        this.cachedSave = json;\n        return json;\n    }\n\n    /**\n     * @returns {_Entity}\n     */\n    clone() {\n        console.error(\"Not implemented\");\n    }\n\n    callEvent(event, args) {\n        for (const component of this.componentArray) {\n            if (component[event]) {\n                component[event](args);\n            }\n        }\n\n        if (this[event]) {\n            this[event](args);\n        }\n    }\n\n    getComponentDescriptions() {\n        let description = \"\";\n        for (const component of this.componentArray) {\n            description += component.getDescription();\n        }\n\n        return description;\n    }\n\n    stopCombatAnimations() {\n        for (const tween of this.combatTweens) {\n            tween.stop();\n        }\n\n        const position = this.getComponent(\"positionalobject\");\n        if (position) {\n            position.updateObjectPosition();\n        }\n    }\n\n    setName(newName) {\n        this.name = newName;\n        this.clearSaveCache();\n    }\n\n    onEntityDeath() {\n        this.setName(\"Remains of \" + this.name);\n    }\n}","import _Entity from \"./_Entity\";\n\nexport default class Tile extends _Entity {\n    constructor(args = {}) {\n        super(args, \"tile\");\n    }\n\n    clone() {\n        return new Tile(this.save());\n    }\n}","import _Entity from \"./_Entity\";\n\nexport default class Actor extends _Entity {\n    constructor(args = {}) {\n        super(args, \"actor\");\n    }\n\n    isAlive() {\n        const fighter = this.getComponent(\"fighter\");\n        return fighter && fighter.hp > 0;\n    }\n\n    clone() {\n        return new Actor(this.save());\n    }\n}","import _Entity from \"./_Entity\";\nimport Extend from \"../util/Extend\";\n\nexport default class Item extends _Entity {\n    constructor(args = {}) {\n        super(args, \"item\");\n\n        this.amount = 1;\n        this.maxStackSize = 1;\n        if (args.amount !== undefined) {\n            this.amount = args.amount;\n        }\n\n        if (args.maxStackSize !== undefined) {\n            this.maxStackSize = args.maxStackSize;\n        }\n    }\n\n    save() {\n        return Extend.deep(super.save(), {\n            amount: this.amount,\n            maxStackSize: this.maxStackSize\n        });\n    }\n\n    clone() {\n        return new Item(this.save());\n    }\n\n    setAmount(amount) {\n        this.amount = amount;\n        this.clearSaveCache();\n    }\n}","import Tile from \"./Tile\";\nimport Actor from \"./Actor\";\nimport Item from \"./Item\";\nimport baseActorsList from \"../../json/actors/_base.json\";\nimport playerList from \"../../json/actors/player.json\";\nimport enemyList from \"../../json/actors/enemies.json\";\nimport placeholderList from \"../../json/actors/placeholder.json\";\nimport npcsList from \"../../json/actors/npcs.json\";\nimport baseTilesList from \"../../json/tiles/_base.json\";\nimport foliageList from \"../../json/tiles/foliage.json\";\nimport furnitureList from \"../../json/tiles/furniture.json\";\nimport baseItemsList from \"../../json/items/_base.json\";\nimport amuletsList from \"../../json/items/amulets.json\";\nimport armorList from \"../../json/items/armor.json\";\nimport beltsList from \"../../json/items/belts.json\";\nimport bootsList from \"../../json/items/boots.json\";\nimport glovesList from \"../../json/items/gloves.json\";\nimport helmetsList from \"../../json/items/helmets.json\";\nimport miscList from \"../../json/items/misc.json\";\nimport potionsList from \"../../json/items/potions.json\";\nimport ringsList from \"../../json/items/rings.json\";\nimport scrollsList from \"../../json/items/scrolls.json\";\nimport shieldsList from \"../../json/items/shields.json\";\nimport shoulderList from \"../../json/items/shoulder.json\";\nimport storageList from \"../../json/items/storage.json\";\nimport weaponsList from \"../../json/items/weapons.json\";\nimport Extend from \"../util/Extend\";\n\nclass EntityLoader {\n    constructor() {\n        this.types = new Map();\n        this.templates = new Map();\n\n        this.load(new Tile());\n        this.load(new Actor());\n        this.load(new Item());\n\n        this.loadTemplates();\n    }\n\n    load(entity) {\n        this.types.set(entity.type, entity);\n    }\n\n    create(json, args = {}) {\n        let parsedJson;\n        if (typeof json === \"object\") {\n            parsedJson = json;\n        } else {\n            parsedJson = JSON.parse(json);\n        }\n\n        if (parsedJson.extends !== undefined) {\n            const template = JSON.parse(this.templates.get(parsedJson.extends));\n\n            delete parsedJson[\"extends\"];\n            return this.create(Extend.deep(template, parsedJson), args);\n        }\n\n        const entity = this.types.get(parsedJson.type);\n        return new entity.constructor(Extend.deep(parsedJson, args));\n    }\n\n    loadTemplates() {\n        this.loadTemplate(baseActorsList);\n        this.loadTemplate(playerList);\n        this.loadTemplate(enemyList);\n        this.loadTemplate(placeholderList);\n        this.loadTemplate(npcsList);\n\n        this.loadTemplate(baseTilesList);\n        this.loadTemplate(foliageList);\n        this.loadTemplate(furnitureList);\n\n        this.loadTemplate(baseItemsList);\n        this.loadTemplate(amuletsList);\n        this.loadTemplate(armorList);\n        this.loadTemplate(beltsList);\n        this.loadTemplate(bootsList);\n        this.loadTemplate(glovesList);\n        this.loadTemplate(helmetsList);\n        this.loadTemplate(miscList);\n        this.loadTemplate(potionsList);\n        this.loadTemplate(ringsList);\n        this.loadTemplate(scrollsList);\n        this.loadTemplate(shieldsList);\n        this.loadTemplate(shoulderList);\n        this.loadTemplate(storageList);\n        this.loadTemplate(weaponsList);\n    }\n\n    loadTemplate(entities) {\n        for (const entity of entities) {\n            const id = entity.id;\n            if (this.templates.has(id)) {\n                console.error(\"Template for entity id '\" + id + \"' already exists.\");\n            } else {\n                this.templates.set(id, JSON.stringify(entity));\n            }\n        }\n    }\n\n    createFromTemplate(id, args = {}) {\n        if (this.templates.has(id)) {\n            const template = this.templates.get(id);\n\n            return this.create(template, args);\n        } else {\n            console.error(\"Json template for id '\" + id + \"' is missing.\");\n        }\n\n        return null;\n    }\n}\n\nconst entityLoader = new EntityLoader();\nexport default entityLoader;","import ArrayUtil from \"../util/ArrayUtil\";\nimport sceneState from \"../SceneState\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport engine from \"../Engine\";\nimport Tile from \"../entity/Tile\";\nimport Fov from \"../components/Fov\";\nimport characterHealth from \"../ui/CharacterHealth\";\nimport details from \"../ui/Details\";\nimport characterMana from \"../ui/CharacterMana\";\nimport Actor from \"../entity/Actor\";\nimport Remnant from \"../components/Remnant\";\nimport inventory from \"../ui/Inventory\";\nimport {Vector3} from \"three\"; // eslint-disable-line no-unused-vars\nimport Item from \"../entity/Item\";\nimport bottomContainer from \"../ui/BottomContainer\";\n\nexport default class GameMap {\n    constructor(name, width, height) {\n        this.name = name;\n        this.width = width;\n        this.height = height;\n\n        this.timeout = null;\n        this.saveCache = null;\n\n        this.init();\n    }\n\n    init() {\n        this.tiles = new Map();\n        for (let i = -1; i <= 2; i++) {\n            this.tiles.set(i, ArrayUtil.create2dArray(this.width));\n        }\n\n        this.actors = [];\n        this.items = [];\n    }\n\n    create() {}\n\n    teardown() {\n        if (this.timeout) {\n            clearTimeout(this.timeout);\n        }\n\n        engine.fov.teardown();\n        engine.airFov.teardown();\n\n        const tilesIter = this.tiles.entries();\n        for (const entry of tilesIter) {\n            const tilesArray = entry[1];\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = tilesArray[i][j];\n                    if (tile) {\n                        tile.callEvent(\"onMapTeardown\");\n                    }\n                }\n            }\n        }\n\n        for (const actor of this.actors) {\n            actor.callEvent(\"onMapTeardown\");\n        }\n\n        for (const item of this.items) {\n            item.callEvent(\"onMapTeardown\");\n        }\n    }\n\n    removeEntity(entity) {\n        if (entity instanceof Actor) {\n            this.removeActor(entity);\n        } else if (entity instanceof Item) {\n            this.removeItem(entity);\n        }\n\n    }\n\n    removeItem(item) {\n        const index = this.items.indexOf(item);\n        if (index > -1) {\n            this.items.splice(index, 1);\n        }\n    }\n\n    /**\n     *\n     * @param item\n     * @param groundPosition\n     * @returns {boolean} true if item added <br/>\n     *                    false if item merged and item is deleted\n     */\n    addItem(item, groundPosition) {\n        const itemPosition = item.getComponent(\"positionalobject\");\n        if (!groundPosition) {\n            groundPosition = itemPosition;\n        }\n\n        let amountToAdd = item.amount;\n        for (const mapItem of this.items) {\n            if (mapItem.id === item.id) {\n                const position = mapItem.getComponent(\"positionalobject\");\n                const remnant = mapItem.getComponent(\"remnant\");\n                if (position && groundPosition.isSamePosition(position) && (!remnant || !remnant.isRemnant)) {\n                    if (mapItem.maxStackSize === -1) {\n                        mapItem.setAmount(mapItem.amount + item.amount);\n                        itemPosition.teardown();\n                        return false;\n                    }\n\n                    const amountCanAdd = mapItem.maxStackSize - mapItem.amount;\n                    if (amountCanAdd >= amountToAdd) {\n                        mapItem.setAmount(mapItem.amount + amountToAdd);\n                        itemPosition.teardown();\n                        return false;\n                    } else {\n                        mapItem.setAmount(mapItem.amount + amountCanAdd);\n                        item.setAmount(item.amount - amountCanAdd);\n\n                        amountToAdd -= amountCanAdd;\n                    }\n                }\n            }\n        }\n\n\n        if (amountToAdd > 0) {\n            item.setAmount(amountToAdd);\n\n            itemPosition.moveTo(groundPosition.x, groundPosition.y, groundPosition.z, false);\n            item.parent = null;\n            this.items.push(item);\n            itemPosition.setVisible();\n            return true;\n        } else {\n            itemPosition.teardown();\n            return false;\n        }\n    }\n\n    removeActor(actor) {\n        const index = this.actors.indexOf(actor);\n        if (index > -1) {\n            this.actors.splice(index, 1);\n        }\n    }\n\n    save() {\n        if (engine.gameMap !== this && this.saveCache) {\n            return this.saveCache;\n        }\n\n        const saveData = {\n            name: this.name,\n            width: this.width,\n            height: this.height\n        };\n\n        saveData[\"tiles\"] = {};\n        const entries = this.tiles.entries();\n        for (const entry of entries) {\n            const tileMap = new Map();\n            let key = \"\";\n            let charCode = 65;\n\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = entry[1][i][j];\n                    if (tile) {\n                        const tileJson = JSON.stringify(tile.save());\n                        if (tileMap.has(tileJson)) {\n                            key += String.fromCharCode(tileMap.get(tileJson));\n                        } else {\n                            tileMap.set(tileJson, charCode);\n                            key += String.fromCharCode(charCode);\n\n                            charCode++;\n                            if (String.fromCharCode(charCode) === \" \") {\n                                charCode++;\n                            }\n                        }\n                    } else {\n                        key += \" \";\n                    }\n                }\n            }\n\n            const mapKey = entry[0];\n            saveData[\"tiles\"][mapKey] = {};\n            saveData[\"tiles\"][mapKey][\"key\"] = key;\n            saveData[\"tiles\"][mapKey][\"map\"] = {};\n\n            const tileMapIter = tileMap.entries();\n            for (const tileMapEntry of tileMapIter) {\n                saveData[\"tiles\"][mapKey][\"map\"][String.fromCharCode(tileMapEntry[1])] = tileMapEntry[0];\n            }\n        }\n\n        const actorJson = [];\n        for (const actor of this.actors) {\n            actorJson.push(JSON.stringify(actor.save()));\n        }\n        saveData[\"actors\"] = actorJson;\n\n        const itemJson = [];\n        for (const item of this.items) {\n            itemJson.push(JSON.stringify(item.save()));\n        }\n        saveData[\"items\"] = itemJson;\n\n        this.saveCache = saveData;\n        return saveData;\n    }\n\n    load(json) {\n        const tiles = json.tiles;\n        const entries = this.tiles.entries();\n        for (const entry of entries) {\n            const tileLayer = entry[1];\n            const tilesToLoad = tiles[entry[0]];\n            if (tilesToLoad) {\n                const key = tilesToLoad.key;\n                const map = tilesToLoad.map;\n\n                for (let i = 0; i < this.width; i++) {\n                    for (let j = 0; j < this.height; j++) {\n                        const index = i*this.height + j;\n                        const tile = map[key[index]];\n\n                        if (tile) {\n                            tileLayer[i][j] = entityLoader.create(tile, {components: {positionalobject: {x: i, y: j, z: entry[0]}}});\n                        }\n                    }\n                }\n            }\n        }\n\n        const actors = json.actors;\n        for (const actor of actors) {\n            const createdActor = entityLoader.create(actor);\n            this.actors.push(createdActor);\n        }\n\n        const items = json.items;\n        for (const item of items) {\n            const createdItem = entityLoader.create(item);\n            this.items.push(createdItem);\n        }\n    }\n\n    isInBounds(x, y) {\n        return 0 <= x && x < this.width && 0 <= y && y < this.height;\n    }\n\n    revealPreviouslyExplored() {\n        const tileIter = this.tiles.entries();\n        for (const entry of tileIter) {\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = entry[1][i][j];\n                    if (tile) {\n                        const position = tile.getComponent(\"positionalobject\");\n                        if (position && !position.isVisible()) {\n                            const fov = tile.getComponent(\"fov\");\n                            if (fov && fov.explored) {\n                                position.setVisible();\n                                this.setTransparency(position, -5, -5, position.z);\n                                position.shiftColor(.5);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                position.setVisible();\n                position.shiftColor(.5);\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                position.setVisible();\n                position.shiftColor(.5);\n            }\n        }\n    }\n\n    revealFromPosition(x, y, radius, delay = 25) {\n        const self = this;\n        const minX = Math.max(0, x - radius);\n        const maxX = Math.min(engine.gameMap.width, x + radius);\n        const minY = Math.max(0, y - radius);\n        const maxY = Math.min(engine.gameMap.height, y + radius);\n\n        if (delay === 0) {\n            self._revealGradually(minX, maxX, minY, maxY, x, y, 1, radius, delay);\n        } else {\n            self.timeout = setTimeout(function () {\n                self._revealGradually(minX, maxX, minY, maxY, x, y, 1, radius, delay);\n            }, delay);\n        }\n    }\n\n    _revealGradually(minX, maxX, minY, maxY, x, y, radius, maxRadius, delay) {\n        const self = this;\n        self.timeout = null;\n\n        if (radius <= maxRadius) {\n            self.timeout = setTimeout(function () {\n                self._revealGradually(minX, maxX, minY, maxY, x, y, radius + 1, maxRadius, delay);\n            }, delay);\n        }\n\n        const xRadiusMin = x - radius;\n        const xRadiusMax = x + radius;\n        const yRadiusMin = y - radius;\n        const yRadiusMax = y + radius;\n        for (let i = xRadiusMin; i <= xRadiusMax; i++) {\n            const xIsEdge = i === xRadiusMin || i === xRadiusMax;\n            for (let j = yRadiusMin; j <= yRadiusMax; j++) {\n                if (xIsEdge || j === yRadiusMin || j === yRadiusMax) {\n                    this._revealAtPosition(i, j);\n                    engine.needsMapUpdate = true;\n                }\n            }\n        }\n\n        if (xRadiusMin <= minX && xRadiusMax >= maxX && yRadiusMin <= minY && yRadiusMax >= maxY) {\n            return true;\n        }\n\n        return true;\n    }\n\n    _revealAtPosition(x, y) {\n        const tileIter = this.tiles.entries();\n        for (const entry of tileIter) {\n            const tileX = entry[1][x];\n            if (tileX) {\n                const tile = entry[1][x][y];\n                if (tile) {\n                    const position = tile.getComponent(\"positionalobject\");\n                    if (position && !position.isVisible()) {\n                        position.setVisible();\n                        this.setTransparency(position, -5, -5, position.z);\n                        position.shiftColor(.5);\n\n                        const fov = tile.getComponent(\"fov\");\n                        if (!fov) {\n                            tile.setComponent(new Fov({components: {fov: {explored: true, visible: false}}}));\n                        }\n                    }\n                }\n            }\n        }\n\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y) {\n                    entity.getComponent(\"positionalobject\").teardown();\n                }\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y) {\n                    entity.getComponent(\"positionalobject\").teardown();\n                }\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n    }\n\n    reveal() {\n        const tileIter = this.tiles.entries();\n        for (const entry of tileIter) {\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = entry[1][i][j];\n                    if (tile) {\n                        const position = tile.getComponent(\"positionalobject\");\n                        if (position && !position.isVisible()) {\n                            position.setVisible();\n                            this.setTransparency(position, -5, -5, position.z);\n                            position.shiftColor(.5);\n\n                            const fov = tile.getComponent(\"fov\");\n                            if (!fov) {\n                                tile.setComponent(new Fov({components: {fov: {explored: true, visible: false}}}));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                entity.getComponent(\"positionalobject\").teardown();\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                entity.getComponent(\"positionalobject\").teardown();\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n    }\n\n    updateFOV(x, y, z, range) {\n        engine.fov.compute(x, y, z, range, z-2, z+1);\n        engine.airFov.compute(x, y, z,range * 2, z+2, z+8);\n    }\n\n    draw(x, y, z) {\n        this.drawItemsInFov(engine.fov, x, y, z);\n        this.drawItemsInFov(engine.airFov, x, y, z);\n    }\n\n    drawItemsInFov(fov, x, y, z) {\n        const newObjects = fov.newObjects;\n\n        const newObjectsRemoved = [];\n        for (const newObject of newObjects) {\n            if (newObject instanceof Tile) {\n                const fovComponent = newObject.getComponent(\"fov\");\n                if (fovComponent) {\n                    fovComponent.setExplored(true);\n                    fovComponent.setVisible(true);\n                } else {\n                    newObject.setComponent(new Fov({components: {fov: {explored: true, visible: true}}}));\n                }\n            } else if (newObject instanceof Item) {\n                const remnant = newObject.getComponent(\"remnant\");\n                if (remnant && remnant.isRemnant) {\n                    const position = newObject.getComponent(\"positionalobject\");\n                    if (position) {\n                        position.teardown();\n                    }\n                    this.removeItem(newObject);\n\n                    newObjectsRemoved.push(newObject);\n\n                    fov.removeVisible(newObject);\n                }\n            } else if (newObject instanceof Actor) {\n                const remnant = newObject.getComponent(\"remnant\");\n                if (remnant) {\n                    if (remnant.isRemnant) {\n                        newObject.getComponent(\"positionalobject\").teardown();\n                        this.removeActor(newObject);\n\n                        newObjectsRemoved.push(newObject);\n\n                        const visibleIndex = fov.visibleObjects.indexOf(newObject);\n                        if (visibleIndex > -1 ) {\n                            fov.visibleObjects.splice(visibleIndex, 1);\n                        }\n                    } else {\n                        const actorsRemoved = [];\n                        // Remove remnant of now visible actor\n                        for (const actor of this.actors) {\n                            if (actor === newObject) {\n                                continue;\n                            }\n\n                            const actorRemnant = actor.getComponent(\"remnant\");\n                            if (actorRemnant && actorRemnant.isRemnant) {\n                                if (remnant.x === actorRemnant.x && remnant.y === actorRemnant.y && remnant.z === actorRemnant.z) {\n                                    actor.getComponent(\"positionalobject\").teardown();\n                                    actorsRemoved.push(actor);\n\n                                    newObjectsRemoved.push(actor);\n\n                                    const visibleIndex = fov.visibleObjects.indexOf(actor);\n                                    if (visibleIndex > -1 ) {\n                                        fov.visibleObjects.splice(visibleIndex, 1);\n                                    }\n\n                                    actor.callEvent(\"onDestroyRemnant\");\n\n                                    const itemsRemoved = [];\n                                    for (const item of this.items) {\n                                        const itemRemnant = item.getComponent(\"remnant\");\n                                        if (itemRemnant && itemRemnant.isRemnant) {\n                                            if (remnant.x === itemRemnant.x && remnant.y === itemRemnant.y && remnant.z === itemRemnant.z) {\n                                                itemsRemoved.push(item);\n                                                const itemPosition = item.getComponent(\"positionalobject\");\n                                                if (itemPosition) {\n                                                    itemPosition.teardown();\n                                                }\n                                                newObjectsRemoved.push(item);\n                                                fov.removeVisible(item);\n                                            }\n                                        }\n                                    }\n\n                                    for (const item of itemsRemoved) {\n                                        this.removeItem(item);\n                                    }\n\n                                    break;\n                                }\n                            }\n                        }\n\n                        for (const actor of actorsRemoved) {\n                            this.removeActor(actor);\n                        }\n\n                        newObject.removeComponent(\"remnant\");\n                    }\n                }\n            }\n        }\n\n        for (const newObject of newObjectsRemoved) {\n            const newIndex = newObjects.indexOf(newObject);\n            if (newIndex > -1) {\n                newObjects.splice(newIndex, 1);\n            }\n        }\n\n        for (const object of fov.previousVisibleObjects) {\n            const index = fov.visibleObjects.indexOf(object);\n            if (index === -1) {\n                const fovComponent = object.getComponent(\"fov\");\n                if (fovComponent) {\n                    fovComponent.setVisible(false);\n                }\n                fov.oldObjects.push(object);\n            }\n        }\n\n        for (const newObject of newObjects) {\n            const object = newObject.getComponent(\"positionalobject\");\n            if (object) {\n                if (!object.isVisible()) {\n                    object.setVisible();\n                } else {\n                    object.resetColor();\n                }\n            }\n\n            newObject.callEvent(\"onAddToScene\");\n        }\n\n        const visibleObjects = fov.visibleObjects;\n        for (const visibleObject of visibleObjects) {\n            if (visibleObject instanceof Tile) {\n                const object = visibleObject.getComponent(\"positionalobject\");\n\n                if (object) {\n                    this.setTransparency(object, x, y, z);\n                }\n            }\n        }\n\n        const oldObjects = fov.oldObjects;\n        for (const oldObject of oldObjects) {\n            const position = oldObject.getComponent(\"positionalobject\");\n            if (position) {\n                const isActor = oldObject instanceof Actor;\n                if (isActor || oldObject instanceof Item) {\n                    const remnant = oldObject.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({components: {remnant: {isRemnant: true, x: position.x, y: position.y, z: position.z}}}));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (isActor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    oldObject.setComponent(new Remnant({components: {remnant: {isRemnant: false, x: position.x, y: position.y, z: position.z}}}));\n                    position.setVisible(false);\n\n                    oldObject.callEvent(\"onCreateRemnant\");\n                } else {\n                    this.setTransparency(position, x, y, z);\n\n                    if (position.hasObject()) {\n                        position.shiftColor(.5);\n                    }\n                }\n            }\n        }\n    }\n\n    setTransparency(object, x, y, z) {\n        if (object.z >= z) {\n            const xDiff = Math.abs(x - object.x);\n            const yDiff = Math.abs(y - object.y);\n            if (object.z > z) {\n                if (object.x >= x && object.y <= y && Math.max(xDiff, yDiff) < object.z + 3) {\n                    if (object.z > z + 1) {\n                        object.setTransparency(0);\n                    } else {\n                        object.setTransparency(.1);\n                    }\n                } else {\n                    object.setTransparency(1);\n                }\n            } else {\n                if (object.z <= z + 1 && xDiff <= 1 && yDiff <= 1) {\n                    object.setTransparency(.5);\n                } else {\n                    object.setTransparency(1);\n                }\n            }\n        } else {\n            object.setTransparency(1);\n        }\n    }\n\n    /**\n     * @param {Vector3} location\n     */\n    getAliveActorAtLocation(location) {\n        let aliveActor = null;\n        for (const actor of this.actors) {\n            if (actor.isAlive()) {\n                const position = actor.getComponent(\"positionalobject\");\n                if (position && location.x === position.x && location.y === position.y && location.z === position.z) {\n                    aliveActor = actor;\n                    break;\n                }\n            }\n        }\n\n        return aliveActor;\n    }\n\n    getBlockingActorAtLocation(x, y, z) {\n        let blockingActor = null;\n        for (const actor of this.actors) {\n            const position = actor.getComponent(\"positionalobject\");\n            if (position && x === position.x && y === position.y && z === position.z) {\n                const component = actor.getComponent(\"blocksMovement\");\n                if (component && component.blocksMovement) {\n                    blockingActor = actor;\n                    break;\n                }\n            }\n        }\n\n        return blockingActor;\n    }\n\n    /**\n     *\n     * @param {Vector3} position\n     */\n    isPositionVisible(position) {\n        let isVisible = false;\n\n        for (let z = position.z - 1; z <= position.z + 1; z++) {\n            const tiles = this.tiles.get(position.z);\n            if (tiles) {\n                const tileX = tiles[position.x];\n                if (tileX) {\n                    const tile = tileX[position.y];\n                    if (tile) {\n                        const fov = tile.getComponent(\"fov\");\n                        if (fov) {\n                            if (fov.visible) {\n                                isVisible = true;\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n\n        return isVisible;\n    }\n\n    addPlayer(x, y, z = 1) {\n        if (!engine.player) {\n            engine.player = entityLoader.createFromTemplate(\"player\");\n        }\n\n        this.actors.push(engine.player);\n\n        const positionalObject = engine.player.getComponent(\"positionalobject\");\n        positionalObject.x = x;\n        positionalObject.y = y;\n        positionalObject.z = z;\n        positionalObject.setVisible();\n        sceneState.updateCameraPosition(engine.player);\n\n        this.updatePlayerUI();\n    }\n\n    updatePlayerUI() {\n        const playerFighter = engine.player.getComponent(\"fighter\");\n        bottomContainer.updateAll();\n        characterHealth.update(playerFighter.hp, playerFighter.maxHp);\n        characterMana.update(playerFighter.mana, playerFighter.maxMana);\n        details.updatePlayerDetails();\n        inventory.populateInventory(engine.player);\n    }\n}","import GameMap from \"./GameMap\";\nimport MapLayer from \"./MapLayer\";\nimport engine from \"../Engine\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport ArrayUtil from \"../util/ArrayUtil\";\n\nexport default class TutorialMap extends GameMap {\n    constructor() {\n        super(\"tutorial-map\", 35, 15);\n\n        this.floor = [\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"#################################\",\n            \"#################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\"\n        ];\n\n        this.wall = [\n            \"###################################\",\n            \"###################################\",\n            \"####====###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"##===  =########################===\",\n            \"##=    =#################======#= >\",\n            \"##=    =#########=======#=    =#= =\",\n            \"##=    ===========     ===    === =\",\n            \"##=                    + +        =\",\n            \"##=       ==== ===     ===    =====\",\n            \"##=========##= =#=======#=    =####\",\n            \"#############= =#########======####\"\n        ];\n\n        this.overlay = [\n            \"###################################\",\n            \"########## RoguelikeDev ######v5_0#\",\n            \"###################################\",\n            \"############ does the ####2021#6-8#\",\n            \"###################################\",\n            \"### Complete Roguelike Tutorial ###\",\n            \"#####..############################\",\n            \"#####..############################\",\n            \"###....##########################.#\",\n            \"###....###################....###.#\",\n            \"###....###########.....###....###.#\",\n            \"###....................#.#........#\",\n            \"###.......####.###.....###....#####\",\n            \"##############.###########....#####\",\n            \"##############.####################\"\n        ];\n    }\n\n    init() {\n        super.init();\n\n        this.tiles.set(MapLayer.Decorative, ArrayUtil.create2dArray(this.width));\n    }\n\n    create() {\n        super.create();\n        const overlayColors = [\n            0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff, 0x66b2ff, 0x66d9ff, 0x66ffd9, 0x66ffb2, 0x66ff66, 0xb2ff66, 0xd9ff66, 0xffff66, 0xffd966, 0xffb266, 0xff8c66, 0xff668c, 0xff66b2, 0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff,\n            0x00ffbf, 0x00ff80, 0x00ff00, 0x80ff00, 0xffff00, 0xffbf00, 0xff8000, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333,\n            0x00a3d9, 0x00d9d9, 0x00d9a3, 0x00d96c, 0x00d900, 0x6cd900, 0xa3d900, 0xd9d900, 0xd9a300, 0xd96c00, 0xd93600, 0xd90000, 0x333333, 0x333333, 0x333333, 0x333333\n        ];\n        let overlayColorIndex = 0;\n        for (let j = 0; j < this.height; j++) {\n            for (let i = 0; i < this.width; i++) {\n                const floorChar = this.floor[this.height - j - 1].charAt(i);\n                switch(floorChar) {\n                    case \"#\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                    case \"\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"water\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                }\n\n                const wallChar = this.wall[this.height - j - 1].charAt(i);\n                switch(wallChar) {\n                    case \"#\":\n                    case \"=\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \"+\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"door\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \">\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"stairs_north\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                }\n\n                let overlayChar = this.overlay[this.height - j - 1].charAt(i);\n                if (overlayChar !== \"#\") {\n                    if (overlayChar !== \".\") {\n                        this.tiles.get(MapLayer.DecorativeBG)[i][j] = entityLoader.createFromTemplate(\"art_backing\", {components: {positionalobject: {x: i, y: j, z: 2}}});\n                    }\n\n                    if (overlayChar !== \" \" && overlayChar !== \".\") {\n                        if (overlayChar === \"_\") {\n                            overlayChar = \".\";\n                        }\n\n                        this.tiles.get(MapLayer.Decorative)[i][j] = entityLoader.createFromTemplate(\"art\", {components: {characterobject: {x: i, y: j, z: 2.05, letter: overlayChar, color: overlayColors[overlayColorIndex]}}});\n                        overlayColorIndex ++;\n                    }\n                }\n            }\n        }\n\n        this.addPlayer(21, 3);\n        /*\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('ant', {components: {positionalobject: {x: 27, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('dragon_red', {components: {positionalobject: {x: 18, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('goblin', {components: {positionalobject: {x: 5, y: 2, z: 1}}}));\n\n        engine.gameMap.items.push(entityLoader.createFromTemplate('potion_health', {components: {positionalobject: {x: 3, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('^', {components: {positionalobject: {x: 6, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('tower_shield', {components: {positionalobject: {x: 28, y: 1, z: 1}}}));\n         */\n\n        engine.gameMap.actors.push(entityLoader.createFromTemplate(\"gelatinous_cube\", {components: {positionalobject: {x: 18, y: 4, z: 1}}}));\n        for (let i = 0; i < 2; i++) {\n            engine.gameMap.items.push(entityLoader.createFromTemplate(\"scroll_confusion\", {components: {positionalobject: {x: 21, y: 3, z: 1}}}));\n        }\n        engine.gameMap.items.push(entityLoader.createFromTemplate(\"potion_health\", {components: {positionalobject: {x: 19, y: 4, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate(\"tower_shield\", {components: {positionalobject: {x: 19, y: 4, z: 1}}}));\n\n\n        for (let i = 18; i <= 22; i++) {\n            for (let j = 2; j <= 4; j++) {\n                engine.gameMap.items.push(entityLoader.createFromTemplate(\"gold\", {amount: 5, components: {positionalobject: {x: i, y: j, z: 1}}}));\n            }\n        }\n    }\n}","import entityGroups from \"../../../json/generation/_entityGroups.json\";\nimport itemGroups from \"../../../json/generation/_itemGroups.json\";\nimport basicDungeon from \"../../../json/generation/basic-dungeon.json\";\nimport {MathUtils} from \"three\";\n\nclass ChanceLoader {\n    constructor() {\n        this.entityGroups = new Map();\n        this.itemGroups = new Map();\n        this.generators = new Map();\n\n        this.loadEntityGroups(entityGroups);\n        this.loadItemGroups(itemGroups);\n\n        this.loadGenerator(\"basic-dungeon\", basicDungeon);\n    }\n\n    loadEntityGroups(entityGroups) {\n        for (const group of entityGroups) {\n            this.entityGroups.set(group.id, group.entities);\n        }\n    }\n\n    loadItemGroups(itemGroups) {\n        for (const group of itemGroups) {\n            this.itemGroups.set(group.id, group.items);\n        }\n    }\n\n    loadGenerator(name, generator) {\n        this.generators.set(name, generator);\n    }\n\n    getChancesForLevel(name, level) {\n        let chances;\n        const generator = this.generators.get(name);\n        for (const group of generator) {\n            if (group.level > level) {\n                break;\n            }\n\n            chances = group;\n        }\n\n        return chances;\n    }\n\n    getActorForLevel(name, level) {\n        const chances = this.getChancesForLevel(name, level);\n        const actors = chances.actors;\n\n        let actorOrGroup = this.getRandomFromGroup(actors);\n        while (actorOrGroup.group !== undefined) {\n            const actorGroup = this.entityGroups.get(actorOrGroup.group);\n            actorOrGroup = this.getRandomFromGroup(actorGroup);\n        }\n\n        return actorOrGroup.id;\n    }\n\n    getItemForLevel(name, level) {\n        const chances = this.getChancesForLevel(name, level);\n        const items = chances.items;\n\n        let itemOrGroup = this.getRandomFromGroup(items);\n        while (itemOrGroup.group !== undefined) {\n            const itemGroup = this.itemGroups.get(itemOrGroup.group);\n            itemOrGroup = this.getRandomFromGroup(itemGroup);\n        }\n\n        return itemOrGroup.id;\n    }\n\n    getRandomFromGroup(group) {\n        let totalWeight = 0;\n        for (const chance of group) {\n            totalWeight += chance.weight;\n        }\n\n        let returnChance;\n        let currentWeight = 0;\n        const rand = MathUtils.randFloat(0, totalWeight);\n        for (const chance of group) {\n            currentWeight += chance.weight;\n\n            if (rand < currentWeight) {\n                returnChance = chance;\n                break;\n            }\n        }\n\n        return returnChance;\n    }\n}\n\nconst chanceLoader = new ChanceLoader();\nexport default chanceLoader;","import MapLayer from \"../MapLayer\";\nimport {MathUtils} from \"three\";\nimport engine from \"../../Engine\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport chanceLoader from \"../mapGeneration/ChanceLoader\";\nimport Room from \"./_Room\";\n\nexport default class RectangularRoom extends Room {\n    constructor(x, y, width, height) {\n        super();\n        this.x1 = x;\n        this.y1 = y;\n        this.x2 = x + width;\n        this.y2 = y + height;\n        this.width = width;\n        this.height = height;\n    }\n\n    getCenterX() {\n        return Math.round((this.x1 + this.x2) / 2);\n    }\n\n    getCenterY() {\n        return Math.round((this.y1 + this.y2) / 2);\n    }\n\n    intersects(otherRoom) {\n        return this.x1 <= otherRoom.x2\n            && this.x2 >= otherRoom.x1\n            && this.y1 <= otherRoom.y2\n            && this.y2 >= otherRoom.y1;\n    }\n\n    createRoom(gameMap) {\n        const left = Math.max(0, this.x1);\n        const right = Math.min(gameMap.width, this.x2 + 1);\n        const top = Math.max(0, this.y1);\n        const bottom = Math.min(gameMap.height, this.y2 + 1);\n        for (let i = left; i < right; i++) {\n            for (let j = top; j < bottom; j++) {\n                const previousFloorTile = gameMap.tiles.get(MapLayer.Floor)[i][j];\n                if (!previousFloorTile) {\n                    gameMap.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                }\n\n                const isVerticalEdge = (i === this.x1 || i === this.x2) && j >= this.y1 && j <= this.y2;\n                const isHorizontalEdge = (j === this.y1 || j === this.y2) && i >= this.x1 && i <= this.x2;\n                const wallTile = gameMap.tiles.get(MapLayer.Wall)[i][j];\n                if (isHorizontalEdge || isVerticalEdge) {\n                    if (!previousFloorTile && !wallTile) {\n                        gameMap.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    }\n                } else {\n                    if (wallTile) {\n                        gameMap.tiles.get(MapLayer.Wall)[i][j] = null;\n                    }\n                }\n            }\n        }\n    }\n\n    placeEntities(name, level, maxMonsters) {\n        const numMonsters = MathUtils.randInt(0, maxMonsters);\n        for (let i = 0; i < numMonsters; i++) {\n            const x = MathUtils.randInt(this.x1 + 1, this.x2 -1);\n            const y = MathUtils.randInt(this.y1 + 1, this.y2 -1);\n\n            const blockingActor = engine.gameMap.getBlockingActorAtLocation(x, y, 1);\n            if (!blockingActor) {\n                const position = {components: {positionalobject: {x: x, y: y, z: 1}}};\n\n                const actorId = chanceLoader.getActorForLevel(name, level);\n                const actor = entityLoader.createFromTemplate(actorId, position);\n\n                engine.gameMap.actors.push(actor);\n            }\n        }\n    }\n\n    placeItems(name, level, maxItems) {\n        const numItems = MathUtils.randInt(0, maxItems);\n        for (let i = 0; i < numItems; i++) {\n            const x = MathUtils.randInt(this.x1 + 1, this.x2 -1);\n            const y = MathUtils.randInt(this.y1 + 1, this.y2 -1);\n\n            const position = {components: {positionalobject: {x: x, y: y, z: 1}}};\n            const itemId = chanceLoader.getItemForLevel(name, level);\n            const item = entityLoader.createFromTemplate(itemId, position);\n\n            engine.gameMap.items.push(item);\n        }\n\n        const numGoldItems = MathUtils.randInt(0, maxItems);\n        for (let i = 0; i < numGoldItems; i++) {\n            const x = MathUtils.randInt(this.x1 + 1, this.x2 -1);\n            const y = MathUtils.randInt(this.y1 + 1, this.y2 -1);\n            const amount = MathUtils.randInt(1, 25);\n            const position = {amount: amount, components: {positionalobject: {x: x, y: y, z: 1}}};\n            const item = entityLoader.createFromTemplate(\"gold\", position);\n\n            engine.gameMap.items.push(item);\n        }\n    }\n}","export default class Room {\n    constructor() {}\n\n    placeEntities() { }\n}","import entityLoader from \"../../entity/EntityLoader\";\n\nexport default class MapGeneration {\n    static floorEntity = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: 0, y: 0, z: 0}}});\n    static wallEntity = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: 0, y: 0, z: 0}}});\n\n    constructor() {}\n\n    static tunnelBetween(gameMap, x1, y1, x2, y2) {\n        let cornerX;\n        let cornerY;\n        if (Math.random() < 0.5) {\n            cornerX = x2;\n            cornerY = y1;\n        } else {\n            cornerX = x1;\n            cornerY = y2;\n        }\n\n        this.bresenham(gameMap, x1, y1, cornerX, cornerY);\n        this.bresenham(gameMap, cornerX, cornerY, x2, y2);\n    }\n\n    static bresenham(gameMap, x1, y1, x2, y2) {\n        if (x1 === x2) {\n            if (y1 === y2) {\n                return;\n            }\n\n            let startY = y1;\n            let endY = y2;\n            if (y1 > y2) {\n                startY = y2;\n                endY = y1;\n            }\n            for (let i = x1 - 1; i <= x1 + 1; i++) {\n                for (let j = startY; j <= endY; j++) {\n                    this.bresenhamCreateTiles(gameMap, i === x1, i, j);\n                }\n            }\n        } else {\n            let startX = x1;\n            let endX = x2;\n            if (x1 > x2) {\n                startX = x2;\n                endX = x1;\n            }\n\n            for (let j = y1 - 1; j <= y1 + 1; j++) {\n                for (let i = startX; i <= endX; i++) {\n                    this.bresenhamCreateTiles(gameMap, j === y1, i, j);\n                }\n            }\n        }\n    }\n\n\n    static bresenhamCreateTiles(gameMap, createWall, i, j) {\n        if (createWall) {\n            const wallTile = gameMap.tiles.get(1)[i][j];\n            if (wallTile) {\n                const blocksMovement = wallTile.getComponent(\"blocksMovement\");\n                if (blocksMovement && blocksMovement.blocksMovement) {\n                    gameMap.tiles.get(1)[i][j] = null;\n                }\n            }\n        } else {\n            const floorTile = gameMap.tiles.get(0)[i][j];\n            if (!floorTile) {\n                const wall = this.wallEntity.clone();\n                wall.getComponent(\"positionalobject\").moveTo(i, j, 1, false);\n                gameMap.tiles.get(1)[i][j] = wall;\n            }\n        }\n\n        const floor = this.floorEntity.clone();\n        floor.getComponent(\"positionalobject\").moveTo(i, j, 0, false);\n        gameMap.tiles.get(0)[i][j] = floor;\n    }\n}","import GameMap from \"./GameMap\";\nimport RectangularRoom from \"./room/RectangularRoom\";\nimport MapGeneration from \"./mapGeneration/MapGeneration\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport {MathUtils} from \"three\";\nimport engine from \"../Engine\";\nimport Extend from \"../util/Extend\";\n\nexport default class BasicDungeon extends GameMap {\n    constructor(width, height, args = {}) {\n        const level = args.level || 1;\n        const name = \"basic-dungeon-\" + level;\n        super(name, width, height);\n\n        this.maxRooms = args.maxRooms || 30;\n        this.roomMinSize = args.roomMinSize || 6;\n        this.roomMaxSize = args.roomMaxSize || 10;\n        this.level = level;\n\n        this.maxMonstersByFloor = [\n            {level: 1, amount: 2},\n            {level: 4, amount: 3},\n            {level: 7, amount: 4}\n        ];\n        this.maxItemsByFloor = [\n            {level: 1, amount: 2},\n            {level: 4, amount: 3},\n            {level: 6, amount: 5}\n        ];\n    }\n\n    getFloorAmount(weights) {\n        let amount = 0;\n        for (const weight of weights) {\n            if (weight.level > this.level) {\n                break;\n            }\n\n            amount = weight.amount;\n        }\n\n        return amount;\n    }\n\n    save() {\n        if (engine.gameMap !== this && this.saveCache) {\n            return this.saveCache;\n        }\n\n        const saveJson = {\n            level: this.level\n        };\n\n        this.saveCache = Extend.deep(super.save(), saveJson);\n        return saveJson;\n    }\n\n    create(previousMapName, stairsInteractable) {\n        super.create();\n\n        const floorEntity = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: 0, y: 0, z: 0}}});\n        const wallEntity = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: 0, y: 0, z: 0}}});\n        // Pre-fill with floor and walls\n        for (let j = 0; j < this.height; j++) {\n            for (let i = 0; i < this.width; i++) {\n                const below = floorEntity.clone();\n                below.getComponent(\"positionalobject\").moveTo(i, j, -1, false);\n                const floor = floorEntity.clone();\n                floor.getComponent(\"positionalobject\").moveTo(i, j, 0, false);\n                const wall = wallEntity.clone();\n                wall.getComponent(\"positionalobject\").moveTo(i, j, 1, false);\n                this.tiles.get(-1)[i][j] = below;\n                this.tiles.get(0)[i][j] = floor;\n                this.tiles.get(1)[i][j] = wall;\n            }\n        }\n\n        const rooms = [];\n        for (let i = 0; i < this.maxRooms; i++) {\n            const roomWidth = MathUtils.randInt(this.roomMinSize, this.roomMaxSize);\n            const roomHeight = MathUtils.randInt(this.roomMinSize, this.roomMaxSize);\n\n            const x = MathUtils.randInt(0, this.width - roomWidth - 1);\n            const y = MathUtils.randInt(0, this.height - roomHeight - 1);\n\n            const newRoom = new RectangularRoom(x, y, roomWidth, roomHeight);\n            let intersectsOtherRoom = false;\n            for (const room of rooms) {\n                if (newRoom.intersects(room)) {\n                    intersectsOtherRoom = true;\n                    break;\n                }\n            }\n\n            if (intersectsOtherRoom) {\n                continue;\n            }\n\n            newRoom.createRoom(this);\n\n            if (rooms.length === 0) {\n                const centerX = newRoom.getCenterX();\n                const centerY = newRoom.getCenterY();\n\n                if (stairsInteractable) {\n                    stairsInteractable.setPosition(centerX, centerY, 1);\n                }\n\n                this.addPlayer(centerX, centerY);\n\n                const playerPosition = engine.player.getComponent(\"positionalobject\");\n                if (playerPosition) {\n                    this.tiles.get(1)[centerX][centerY] = entityLoader.createFromTemplate(\"stairs_north\", {components: {positionalobject: {x: centerX, y: centerY, z: 1}, stairsInteractable: {map: previousMapName, x: playerPosition.x, y: playerPosition.y, z: playerPosition.z}}});\n                }\n            } else {\n                const lastRoom = rooms[rooms.length - 1];\n                MapGeneration.tunnelBetween(this, lastRoom.getCenterX(), lastRoom.getCenterY(), newRoom.getCenterX(), newRoom.getCenterY());\n            }\n\n            newRoom.placeEntities(\"basic-dungeon\", this.level, this.getFloorAmount(this.maxMonstersByFloor));\n            newRoom.placeItems(\"basic-dungeon\", this.level, this.getFloorAmount(this.maxItemsByFloor));\n\n            rooms.push(newRoom);\n        }\n\n        const lastRoom = rooms[rooms.length - 1];\n        const lastRoomCenterX = lastRoom.getCenterX();\n        const lastRoomCenterY = lastRoom.getCenterY();\n        this.tiles.get(0)[lastRoomCenterX][lastRoomCenterY] = entityLoader.createFromTemplate(\"stairs_north\", {components: {positionalobject: {x: lastRoomCenterX, y: lastRoomCenterY, z: 0}, stairsInteractable: {generator: \"basic-dungeon\"}}});\n    }\n}","import html from \"../../../html/ui/editor/EditorControls.html\";\nimport UIElement from \"../UIElement\";\n\nclass EditorControls extends UIElement {\n    constructor() {\n        super(html);\n\n        this.addAction(\"select\", \"\", true);\n        this.addAction(\"paint\", \"\");\n        this.addAction(\"delete\", \"\");\n\n        this.activeAction = \"select\";\n\n        this.dom.addEventListener(\"click\", this);\n    }\n\n    handleEvent(e) {\n        switch(e.type) {\n            case \"click\":\n                this.setControl(e);\n                break;\n        }\n    }\n\n    addAction(subId, char, active) {\n        const action = document.createElement(\"button\");\n        action.id = \"editor-controls-\" + subId;\n        action.setAttribute(\"data-action\", subId);\n        action.classList.add(\"editor-controls__action\");\n        if (active) {\n            action.classList.add(\"active\");\n        }\n        action.innerHTML = char;\n\n        this.dom.appendChild(action);\n    }\n\n    setControl(e) {\n        const target = e.target;\n        if (target.type === \"submit\") {\n            if (!target.classList.contains(\"active\")) {\n                const allActions = target.parentNode.children;\n                for (const action of allActions) {\n                    action.classList.remove(\"active\");\n                }\n\n                this.activeAction = target.getAttribute(\"data-action\");\n                target.classList.add(\"active\");\n            }\n        }\n\n    }\n}\n\nconst editorControls = new EditorControls();\nexport default editorControls;","import html from \"../../../html/ui/editor/EditorInfo.html\";\nimport engine from \"../../Engine\";\nimport UIElement from \"../UIElement\";\n\nclass EditorInfo extends UIElement {\n    constructor() {\n        super(html);\n\n        this.dataMap = new Map();\n\n        const entityDom = document.createElement(\"div\");\n        entityDom.classList.add(\"editor-info__component\", \"active\");\n        this.addData(\"entity\", entityDom);\n        this.addData(\"name\", entityDom);\n        this.dom.appendChild(entityDom);\n\n        this.positionalObject = document.createElement(\"div\");\n        this.positionalObject.classList.add(\"editor-info__component\");\n        this.addData(\"baseType\", this.positionalObject);\n        this.addData(\"x\", this.positionalObject);\n        this.addData(\"y\", this.positionalObject);\n        this.addData(\"z\", this.positionalObject);\n        this.addData(\"color\", this.positionalObject);\n        this.addDataInput(\"scale\", this.positionalObject);\n\n        this.addData(\"xRot\", this.positionalObject);\n        this.addData(\"yRot\", this.positionalObject);\n        this.addData(\"zRot\", this.positionalObject);\n\n        this.addData(\"xOffset\", this.positionalObject);\n        this.addData(\"yOffset\", this.positionalObject);\n        this.addData(\"zOffset\", this.positionalObject);\n        this.dom.appendChild(this.positionalObject);\n\n        this.walkable = document.createElement(\"div\");\n        this.walkable.classList.add(\"editor-info__component\");\n        this.addData(\"walkable\", this.walkable);\n        this.dom.appendChild(this.walkable);\n\n        this.blocksMovement = document.createElement(\"div\");\n        this.blocksMovement.classList.add(\"editor-info__component\");\n        this.addData(\"blocksMovement\", this.blocksMovement);\n        this.dom.appendChild(this.blocksMovement);\n    }\n\n    addDataInput(id, domElement) {\n        this.addData(id, domElement, \"input\");\n    }\n\n    addData(id, domElement, type = \"text\") {\n        const self = this;\n        const data = document.createElement(\"div\");\n        data.classList.add(\"editor-info__data\");\n\n        const label = document.createElement(\"span\");\n        label.classList.add(\"editor-info__label\");\n        label.innerHTML = id + \": \";\n        data.appendChild(label);\n\n        let dataDom;\n        if (type === \"text\") {\n            dataDom = document.createElement(\"span\");\n        } else if (type === \"input\") {\n            dataDom = document.createElement(\"input\");\n            dataDom.setAttribute(\"tabindex\", \"-1\");\n\n            dataDom.onchange = function(e) {\n                self.updateScale(self, e);\n            };\n\n            dataDom.onblur = function(e) {\n                self.updateScale(self, e);\n            };\n        }\n        dataDom.classList.add(\"editor-info__\" + type);\n        dataDom.id = \"editor-info-\" + id;\n        data.appendChild(dataDom);\n\n        domElement.appendChild(data);\n\n        this.dataMap.set(id, dataDom);\n    }\n\n    updateScale(self, e) {\n        let value = e.target.value;\n        if (value < 0.1) {\n            value = 0.1;\n            e.target.value = value;\n        } else if (value > 1) {\n            value = 1;\n            e.target.value = value;\n        }\n\n        if (self.entity) {\n            const positionalObject = self.entity.getComponent(\"positionalobject\");\n            if (positionalObject) {\n                positionalObject.scale = value;\n                positionalObject.teardown();\n                positionalObject.setVisible();\n                engine.needsMapUpdate = true;\n            }\n        }\n    }\n\n    setData(id, data) {\n        const domElement = this.dataMap.get(id);\n        if (domElement.tagName === \"INPUT\") {\n            domElement.value = data;\n        } else {\n            domElement.innerHTML = data;\n        }\n    }\n\n    setDataForEntity(entity) {\n        this.entity = entity;\n        this.setData(\"entity\", entity.type);\n        this.setData(\"name\", entity.name);\n\n        const positionalObject = entity.getComponent(\"positionalobject\");\n        if (positionalObject) {\n            this.positionalObject.classList.add(\"active\");\n            this.setData(\"x\", positionalObject.x);\n            this.setData(\"y\", positionalObject.y);\n            this.setData(\"z\", positionalObject.z);\n\n            this.setData(\"baseType\", positionalObject.type);\n            this.setData(\"color\", positionalObject.color);\n            this.setData(\"scale\", positionalObject.scale);\n\n            this.setData(\"xRot\", positionalObject.xRot);\n            this.setData(\"yRot\", positionalObject.yRot);\n            this.setData(\"zRot\", positionalObject.zRot);\n\n            this.setData(\"xOffset\", positionalObject.xOffset);\n            this.setData(\"yOffset\", positionalObject.yOffset);\n            this.setData(\"zOffset\", positionalObject.zOffset);\n        } else {\n            this.positionalObject.classList.remove(\"active\");\n        }\n\n        const walkable = entity.getComponent(\"walkable\");\n        if (walkable) {\n            this.walkable.classList.add(\"active\");\n            this.setData(\"walkable\", walkable.walkable);\n        } else {\n            this.walkable.classList.remove(\"active\");\n        }\n\n        const blocksMovement = entity.getComponent(\"blocksMovement\");\n        if (blocksMovement) {\n            this.blocksMovement.classList.add(\"active\");\n            this.setData(\"blocksMovement\", blocksMovement.blocksMovement);\n        } else {\n            this.blocksMovement.classList.remove(\"active\");\n        }\n    }\n}\n\nconst editorInfo = new EditorInfo();\nexport default editorInfo;","import engine from \"../Engine\";\nimport controls from \"../controls/Controls\";\nimport TutorialMap from \"../map/TutorialMap\";\nimport EventHandler from \"./_EventHandler\";\nimport editorControls from \"../ui/editor/EditorControls\";\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\nimport Tile from \"../entity/Tile\";\nimport Actor from \"../entity/Actor\";\nimport Item from \"../entity/Item\";\nimport editorInfo from \"../ui/editor/EditorInfo\";\nimport BumpAction from \"../actions/actionWithDirection/BumpAction\";\n\nexport default class EditorEventHandler extends EventHandler {\n    constructor() {\n        super();\n        this.selectedEntity = null;\n\n        editorControls.open();\n        editorInfo.open();\n    }\n\n    teardown() {\n        super.teardown();\n        this.clearSelected();\n\n        editorControls.close();\n        editorInfo.close();\n    }\n\n    clearSelected() {\n        if (this.selectedEntity !== null) {\n            const object = this.selectedEntity.getComponent(\"positionalobject\");\n            if (object) {\n                object.removeHighlight();\n            }\n        }\n    }\n\n    handleInput() {\n        let action = null;\n        if (controls.testPressed(\"editor-up\")) {\n            action = new BumpAction(engine.player, 0, 1);\n        } else if (controls.testPressed(\"editor-down\")) {\n            action = new BumpAction(engine.player, 0, -1);\n        } else if (controls.testPressed(\"editor-left\")) {\n            action = new BumpAction(engine.player, -1);\n        } else if (controls.testPressed(\"editor-right\")) {\n            action = new BumpAction(engine.player, 1);\n        } else if (controls.testPressed(\"debug\")) {\n            engine.gameMap.reveal();\n            engine.needsMapUpdate = true;\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n            editorControls.close();\n            editorInfo.close();\n        } else if (controls.testPressed(\"debug2\")) {\n            engine.clearMaps();\n            engine.setMap(new TutorialMap());\n        }\n\n        return action;\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        if (target.tagName === \"CANVAS\") {\n            if (editorControls.activeAction === \"select\") {\n                const intersects = this.getMouseIntersectingObjects(e);\n                let anyFound = false;\n                for (let i = 0; i < intersects.length; i++) {\n                    const object = intersects[i].object;\n                    const parentEntity = object.parentEntity;\n                    if (parentEntity) {\n                        const parentObject = parentEntity.getComponent(\"positionalobject\");\n                        if (parentObject) {\n                            // Skip invisible items\n                            if (parentObject.transparency === 0) {\n                                continue;\n                            }\n\n                            this.clearSelected();\n                            this.selectedEntity = parentEntity;\n                            editorInfo.setDataForEntity(this.selectedEntity);\n                            parentObject.highlight();\n                        }\n\n                        anyFound = true;\n                        break;\n                    }\n                }\n\n                if (!anyFound) {\n                    this.clearSelected();\n                }\n            } else if (editorControls.activeAction === \"delete\") {\n                this.removeEntityFromMouseEvent(e);\n            }\n        }\n\n        engine.needsMapUpdate = true;\n    }\n\n    onMouseMove(e) {\n        const intersects = this.getMouseIntersectingObjects(e);\n\n        let anyFound = false;\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity) {\n                const parentObject = parentEntity.getComponent(\"positionalobject\");\n                if (parentObject && !parentObject.highlighted) {\n                    // Skip invisible items\n                    if (parentObject.transparency === 0) {\n                        continue;\n                    }\n\n                    if (!this.isHighlighted(parentEntity)) {\n                        this.clearAndSetHighlight(parentEntity);\n                    }\n                }\n\n                anyFound = true;\n                break;\n            }\n        }\n\n        if (!anyFound) {\n            this.clearHighlights(true);\n        }\n\n        if (this.mouseDown && editorControls.activeAction === \"delete\") {\n            this.removeEntityFromMouseEvent(e);\n        }\n\n        engine.needsMapUpdate = true;\n    }\n\n    removeEntityFromMouseEvent(e) {\n        const intersects = this.getMouseIntersectingObjects(e);\n\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity) {\n                const parentObject = parentEntity.getComponent(\"positionalobject\");\n\n                if (parentEntity instanceof Tile) {\n                    engine.gameMap.tiles.get(parentObject.z)[parentObject.x][parentObject.y] = null;\n                } else if (parentEntity instanceof Actor) {\n                    engine.gameMap.removeActor(parentEntity);\n                } else if (parentEntity instanceof Item) {\n                    engine.gameMap.removeItem(parentEntity);\n                }\n                parentObject.teardown();\n\n                break;\n            }\n        }\n    }\n}","import Action from \"./_Action\";\nimport engine from \"../Engine\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport UnableToPerformAction from \"./UnableToPerformAction\";\nimport inventory from \"../ui/Inventory\";\nimport NoAction from \"./NoAction\";\n\nexport default class PickupAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        const entityInventory = this.entity.getComponent(\"inventory\");\n\n        const itemsToPickup = [];\n        let anyGoldPickedUp = false;\n        for (const item of engine.gameMap.items) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (position.x === itemPosition.x && position.y === itemPosition.y && position.z === itemPosition.z) {\n                if (entityInventory.add(item)) {\n                    anyGoldPickedUp = true;\n                    item.parentEntity = entityInventory;\n                    engine.gameMap.removeItem(item);\n                    itemPosition.teardown();\n\n                    engine.fov.remove(item);\n                    engine.needsMapUpdate = true;\n\n                    if (this.isPlayer()) {\n                        inventory.populateInventory(engine.player);\n\n                        if (item.amount > 1) {\n                            messageConsole.text(\"You picked up \" + item.amount + \" \" + item.name);\n                        } else {\n                            messageConsole.text(\"You picked up the \" + item.name);\n                        }\n                        messageConsole.build();\n                    }\n                } else {\n                    itemsToPickup.push(item);\n                }\n            }\n        }\n\n        const entityEquipment = this.entity.getComponent(\"equipment\");\n        for (const item of itemsToPickup) {\n            if (entityEquipment.addItem(item)) {\n                const itemPosition = item.getComponent(\"positionalobject\");\n                engine.gameMap.removeItem(item);\n                itemPosition.teardown();\n\n                engine.fov.remove(item);\n                engine.needsMapUpdate = true;\n\n                if (this.isPlayer()) {\n                    inventory.populateInventory(engine.player);\n\n                    if (item.amount > 1) {\n                        messageConsole.text(\"You picked up \" + item.amount + \" \" + item.name);\n                    } else {\n                        messageConsole.text(\"You picked up the \" + item.name);\n                    }\n                    messageConsole.build();\n                }\n\n                return this;\n            } else {\n                if (!anyGoldPickedUp) {\n                    return new UnableToPerformAction(this.entity, \"Nothing to pick up here.\");\n                }\n            }\n        }\n\n        return new NoAction(this.entity);\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport controls from \"../../controls/Controls\";\n\nexport default class LookHandler extends SelectIndexHandler {\n    constructor() {\n        super();\n    }\n\n    handleInput() {\n        if (controls.testPressed(\"look\")) {\n            this.exit();\n        }\n\n        super.handleInput();\n    }\n\n    confirmIndex() {\n        this.exit();\n    }\n}","import html from \"../../../html/menu/PauseMenu.html\";\nimport UIElement from \"../UIElement\";\n\nclass PauseMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst pauseMenu = new PauseMenu();\nexport default pauseMenu;","import engine from \"./Engine\";\nimport messageConsole from \"./ui/MessageConsole\";\n\nclass SaveManager {\n    constructor() {\n        this.saveName = \"default\";\n        this.autosaveTurnCounter = 0;\n        this.loadSaves();\n    }\n\n    getCurrentSaveName() {\n        return \"save-\" + this.saveName;\n    }\n\n    save() {\n        this.saveSaves();\n        engine.save(this.getCurrentSaveName());\n    }\n\n    delete(saveToDelete) {\n        delete this.saves[saveToDelete];\n        this.save();\n\n        if (this.saveName === saveToDelete) {\n            this.saveName = \"default\";\n        }\n    }\n\n    autosave() {\n        const settings = engine.settings;\n        if (settings.autosavesEnabled) {\n            if (this.autosaveTurnCounter < settings.autosaveTurns) {\n                this.autosaveTurnCounter ++;\n                return;\n            }\n\n            this.autosaveTurnCounter = 0;\n\n            let autosave;\n            const lastAutosave = this.getLastAutosave();\n            if (lastAutosave === -1) {\n                autosave = 1;\n            } else if (lastAutosave < settings.autosaveAmount) {\n                autosave = lastAutosave + 1;\n            } else {\n                autosave = 1;\n            }\n\n            engine.save(this.getCurrentSaveName() + \"-autosave\" + autosave);\n\n            this.setLastAutosave(autosave);\n            messageConsole.text(\"Game autosaved.\").build();\n        }\n    }\n\n    loadSaves() {\n        const saves = localStorage.getItem(\"saves\");\n        if (saves) {\n            this.saves = JSON.parse(saves);\n        } else {\n            this.saves = {};\n        }\n    }\n\n    saveSaves() {\n        const save = this.saves[this.saveName];\n        if (save === undefined) {\n            this.saves[this.saveName] = {\"name\": this.getCurrentSaveName(), \"lastAutosave\": -1, \"date\": new Date()};\n        }\n\n        localStorage.setItem(\"saves\", JSON.stringify(this.saves));\n    }\n\n    getLastAutosave() {\n        const save = this.saves[this.saveName];\n        if (save === undefined) {\n            return -1;\n        } else {\n            return save.lastAutosave;\n        }\n    }\n\n    setLastAutosave(autosave) {\n        const save = this.saves[this.saveName];\n        if (save === undefined) {\n            this.saves[this.saveName] = {\"name\": this.getCurrentSaveName(), \"lastAutosave\": autosave};\n        } else {\n            save.lastAutosave = autosave;\n        }\n\n        this.saveSaves();\n    }\n}\n\nconst saveManager = new SaveManager();\nexport default saveManager;","import html from \"../../../html/menu/LoadGame.html\";\nimport UIElement from \"../UIElement\";\nimport saveManager from \"../../SaveManager\";\nimport saveHtml from \"../../../html/template/Save.html\";\n\nclass LoadGameMenu extends UIElement {\n    constructor() {\n        super(html);\n\n        this.oldSavesDom = this.dom.getElementsByClassName(\"loadgame__oldsaves\")[0];\n        this.loadSaves();\n    }\n\n    loadSaves() {\n        const self = this;\n        this.oldSavesDom.innerHTML = \"\";\n        for (const [key, value] of Object.entries(saveManager.saves)) {\n            const saveElement = this.htmlToElement(saveHtml);\n            saveElement.getElementsByClassName(\"save__text\")[0].innerText = key;\n            saveElement.getElementsByClassName(\"save__date\")[0].innerText = this.formatDate(value.date);\n            saveElement.getElementsByClassName(\"save__time\")[0].innerText = this.formatTime(value.date);\n            self.oldSavesDom.appendChild(saveElement);\n        }\n    }\n\n\n    formatDate(date) {\n        const formatted = new Date(date);\n        return formatted.getFullYear() + \"-\" + (formatted.getMonth() + 1) + \"-\" + formatted.getDate();\n    }\n\n    formatTime(date) {\n        const formatted = new Date(date);\n        return formatted.getHours() + \":\" + formatted.getMinutes() + \":\" + formatted.getSeconds();\n    }\n}\n\nconst loadGameMenu = new LoadGameMenu();\nexport default loadGameMenu;","import EventHandler from \"./_EventHandler\";\nimport engine from \"../Engine\";\n\nexport default class MenuEventHandler extends EventHandler {\n    constructor(eventHandler) {\n        super();\n\n        this.previousEventHandler = eventHandler;\n    }\n\n    returnToPreviousMenu() {\n        engine.setEventHandler(new this.previousEventHandler.constructor());\n    }\n}","import loadGameMenu from \"../ui/menu/LoadGameMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport engine from \"../Engine\";\nimport saveManager from \"../SaveManager\";\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\n\nexport default class LoadGameMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        loadGameMenu.loadSaves();\n        loadGameMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        loadGameMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (classList.contains(\"menu__back\")) {\n            this.returnToPreviousMenu();\n        } else if (classList.contains(\"save__title\")) {\n            const textDom = target.getElementsByClassName(\"save__text\")[0];\n            saveManager.saveName = textDom.innerText;\n            engine.load(saveManager.getCurrentSaveName());\n\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n        } else if (classList.contains(\"save__delete\")) {\n            const saveToDelete = target.parentNode.getElementsByClassName(\"save__text\")[0].innerText;\n            saveManager.delete(saveToDelete);\n            loadGameMenu.loadSaves();\n        }\n    }\n}","import html from \"../../../html/menu/Controls.html\";\nimport UIElement from \"../UIElement\";\n\nclass ControlsMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst controlsMenu = new ControlsMenu();\nexport default controlsMenu;","import controlsMenu from \"../ui/menu/ControlsMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport controls from \"../controls/Controls\";\n\nexport default class ControlsMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        this.isEditingKey = false;\n        this.editingDom = null;\n        this.tempValue = null;\n\n        this.tempControls = controls.clone();\n        this.populateControls();\n        controlsMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        controlsMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (this.editingDom) {\n            this.editingDom.value = this.tempValue;\n            this.editingDom = null;\n            this.isEditingKey = false;\n        }\n\n        if (classList.contains(\"menu__save\")) {\n            this.saveAndExit();\n        } else if (classList.contains(\"menu__cancel\")) {\n            this.cancel();\n        } else if (classList.contains(\"menu__reset\")) {\n            this.resetControls();\n        } else {\n            if (target.tagName === \"INPUT\") {\n                this.tempValue = target.value;\n                target.value = \"\";\n                this.editingDom = target;\n                this.isEditingKey = true;\n            }\n        }\n    }\n\n    onKeydown(e) {\n        const target = e.target;\n        if (this.isEditingKey && target.tagName === \"INPUT\") {\n            const key = target.getAttribute(\"data-key\");\n            const index = target.getAttribute(\"data-index\");\n\n            const newKey = controls.getKey(e.key, e.code);\n            target.value = newKey;\n            e.preventDefault();\n            target.blur();\n\n            this.setKey(key, index, newKey);\n\n            this.isEditingKey = false;\n            this.editingDom = null;\n        }\n    }\n\n    setKey(key, index, value) {\n        const keys = this.tempControls.get(key);\n        keys[index] = value;\n    }\n\n    saveAndExit() {\n        controls.setControls(this.tempControls);\n        this.returnToPreviousMenu();\n    }\n\n    cancel() {\n        this.returnToPreviousMenu();\n    }\n\n    resetControls() {\n        controls.resetToDefault();\n        this.tempControls = controls.clone();\n        this.populateControls();\n    }\n\n    populateControls() {\n        // Movement\n        this.populateControl(\"up\", \"control-moveup\");\n        this.populateControl(\"down\", \"control-movedown\");\n        this.populateControl(\"left\", \"control-moveleft\");\n        this.populateControl(\"right\", \"control-moveright\");\n        this.populateControl(\"nw\", \"control-movenw\");\n        this.populateControl(\"ne\", \"control-movene\");\n        this.populateControl(\"sw\", \"control-movesw\");\n        this.populateControl(\"se\", \"control-movese\");\n        this.populateControl(\"wait\", \"control-movewait\");\n\n        // Actions\n        this.populateControl(\"inventory\", \"control-inventory\");\n        this.populateControl(\"character\", \"control-character\");\n        this.populateControl(\"closeall\", \"control-closeall\");\n        this.populateControl(\"get\", \"control-get\");\n        this.populateControl(\"look\", \"control-look\");\n        this.populateControl(\"pause\", \"control-pause\");\n        this.populateControl(\"interact\", \"control-interact\");\n        this.populateControl(\"quicksave\", \"control-quicksave\");\n        this.populateControl(\"quickload\", \"control-quickload\");\n\n        // Other\n        this.populateControl(\"confirm\", \"control-confirm\");\n        this.populateControl(\"cancel\", \"control-cancel\");\n        this.populateControl(\"modifier-speed1\", \"control-targetingmodifier1\");\n        this.populateControl(\"modifier-speed2\", \"control-targetingmodifier2\");\n        this.populateControl(\"modifier-speed3\", \"control-targetingmodifier3\");\n\n        // Debug\n        this.populateControl(\"debug\", \"control-revealmap\");\n        this.populateControl(\"debug2\", \"control-debugroom\");\n        this.populateControl(\"reset\", \"control-generatemap\");\n    }\n\n    populateControl(keyName, id) {\n        const keys = controls.controls.get(keyName);\n\n        const primaryKey = document.getElementById(id);\n        primaryKey.setAttribute(\"data-key\", keyName);\n        primaryKey.setAttribute(\"data-index\", \"0\");\n        if (keys.length > 0) {\n            primaryKey.value = keys[0];\n        } else {\n            primaryKey.value = \"\";\n        }\n\n        const secondaryKey = document.getElementById(id + \"-alt\");\n        secondaryKey.setAttribute(\"data-key\", keyName);\n        secondaryKey.setAttribute(\"data-index\", \"1\");\n        if (keys.length > 1) {\n            secondaryKey.value = keys[1];\n        } else {\n            secondaryKey.value = \"\";\n        }\n    }\n}","import html from \"../../../html/menu/Settings.html\";\nimport UIElement from \"../UIElement\";\n\nclass SettingsMenu extends UIElement {\n    constructor() {\n        super(html);\n\n        this.showStats = true;\n    }\n}\n\nconst settingsMenu = new SettingsMenu();\nexport default settingsMenu;","export default class Settings {\n    constructor() {\n        this.messageConsolePosition = \"\";\n\n        this.autosavesEnabled = true;\n        this.autosaveAmount = 3;\n        this.autosaveTurns = 100;\n        this.displayFPS = false;\n        this.debugControlsEnabled = false;\n\n        this.load();\n    }\n\n    load() {\n        const settings = localStorage.getItem(\"settings\");\n        if (settings) {\n            const json = JSON.parse(settings);\n            if (json.messageConsolePosition !== undefined) {\n                this.messageConsolePosition = json.messageConsolePosition;\n            }\n            if (json.autosavesEnabled !== undefined) {\n                this.autosavesEnabled = json.autosavesEnabled;\n            }\n            if (json.autosaveAmount !== undefined) {\n                this.autosaveAmount = json.autosaveAmount;\n            }\n            if (json.autosaveTurns !== undefined) {\n                this.autosaveTurns = json.autosaveTurns;\n            }\n            if (json.displayFPS !== undefined) {\n                this.displayFPS = json.displayFPS;\n            }\n            if (json.debugControlsEnabled !== undefined) {\n                this.debugControlsEnabled = json.debugControlsEnabled;\n            }\n        }\n    }\n\n    save() {\n        const toSave = {\n            messageConsolePosition: this.messageConsolePosition,\n            autosavesEnabled: this.autosavesEnabled,\n            autosaveAmount: this.autosaveAmount,\n            autosaveTurns: this.autosaveTurns,\n            displayFPS: this.displayFPS,\n            debugControlsEnabled: this.debugControlsEnabled\n        };\n\n        localStorage.setItem(\"settings\", JSON.stringify(toSave));\n    }\n}","import settingsMenu from \"../ui/menu/SettingsMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport Settings from \"../settings/Settings\";\nimport engine from \"../Engine\";\nimport sceneState from \"../SceneState\";\n\nexport default class SettingsMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        this.tempSettings = new Settings();\n        this.populateSettings();\n        settingsMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        settingsMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const id = target.id;\n        const classList = target.classList;\n\n        if (classList.contains(\"menu__save\")) {\n            this.saveAndExit();\n        } else if (classList.contains(\"menu__cancel\")) {\n            this.cancel();\n        } else if (id === \"setting-displayfps\") {\n            this.tempSettings.displayFPS = target.checked;\n            this.applyDisplayFPS(this.tempSettings);\n        } else if (id === \"setting-autosavesenabled\") {\n            this.tempSettings.autosavesEnabled = target.checked;\n            this.applyAutosavesEnabled(this.tempSettings);\n        } else if (id === \"setting-debugcontrolsenabled\") {\n            this.tempSettings.debugControlsEnabled = target.checked;\n        }\n    }\n\n    onChange(e) {\n        const target = e.target;\n        const id = target.id;\n\n        if (id === \"setting-autosaveamount\") {\n            let newSaveAmount = parseInt(target.value);\n            if (newSaveAmount) {\n                if (newSaveAmount < 1) {\n                    target.value = 1;\n                    newSaveAmount = 1;\n                } else if (newSaveAmount > 9) {\n                    target.value = 9;\n                    newSaveAmount = 9;\n                }\n            } else {\n                target.value = 3;\n                newSaveAmount = 3;\n            }\n\n            this.tempSettings.autosaveAmount = newSaveAmount;\n        } else if (id === \"setting-autosaveturns\") {\n            let newTurnsAmount = parseInt(target.value);\n            if (newTurnsAmount) {\n                if (newTurnsAmount < 10) {\n                    target.value = 10;\n                    newTurnsAmount = 10;\n                } else if (newTurnsAmount > 1000) {\n                    target.value = 1000;\n                    newTurnsAmount = 1000;\n                }\n            } else {\n                target.value = 100;\n                newTurnsAmount = 100;\n            }\n\n            this.tempSettings.autosaveTurns = newTurnsAmount;\n        }\n    }\n\n    saveAndExit() {\n        engine.settings = this.tempSettings;\n        engine.settings.save();\n        this.returnToPreviousMenu();\n    }\n\n    cancel() {\n        this.applyAllSettings(engine.settings);\n        this.returnToPreviousMenu();\n    }\n\n    populateSettings() {\n        const displayFPSCheckbox = document.getElementById(\"setting-displayfps\");\n        displayFPSCheckbox.checked = this.tempSettings.displayFPS;\n\n        const debugControlsEnabledCheckbox = document.getElementById(\"setting-debugcontrolsenabled\");\n        debugControlsEnabledCheckbox.checked = this.tempSettings.debugControlsEnabled;\n\n        const autosavesEnabledCheckbox = document.getElementById(\"setting-autosavesenabled\");\n        autosavesEnabledCheckbox.checked = this.tempSettings.autosavesEnabled;\n\n        const autosaveAmountInput = document.getElementById(\"setting-autosaveamount\");\n        autosaveAmountInput.value = this.tempSettings.autosaveAmount;\n\n        const autosaveTurnsInput = document.getElementById(\"setting-autosaveturns\");\n        autosaveTurnsInput.value = this.tempSettings.autosaveTurns;\n    }\n\n    applyAllSettings(settings) {\n        this.applyDisplayFPS(settings);\n        this.applyAutosavesEnabled(settings);\n    }\n\n    applyDisplayFPS(settings) {\n        sceneState.updateStatsVisibility(settings);\n    }\n\n    applyAutosavesEnabled(settings) {\n        const autosaveAmountInput = document.getElementById(\"setting-autosaveamount\");\n        const autosaveTurnsInput = document.getElementById(\"setting-autosaveturns\");\n        if (settings.autosavesEnabled) {\n            autosaveAmountInput.removeAttribute(\"disabled\");\n            autosaveTurnsInput.removeAttribute(\"disabled\");\n        } else {\n            autosaveAmountInput.setAttribute(\"disabled\", \"disabled\");\n            autosaveTurnsInput.setAttribute(\"disabled\", \"disabled\");\n        }\n    }\n}","import html from \"../../../html/menu/Credits.html\";\nimport UIElement from \"../UIElement\";\n\nclass CreditsMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst creditsMenu = new CreditsMenu();\nexport default creditsMenu;","import creditsMenu from \"../ui/menu/CreditsMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\n\nexport default class CreditsMenuEventsHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n        const self = this;\n\n        creditsMenu.open();\n        this.timeout = setTimeout(function() {\n            self.onLeftClick();\n        }, 31000);\n    }\n\n    teardown() {\n        super.teardown();\n\n        clearTimeout(this.timeout);\n        creditsMenu.close();\n    }\n\n    onLeftClick(/*e*/) {\n        this.returnToPreviousMenu();\n    }\n}","import html from \"../../../html/menu/SaveGame.html\";\nimport saveHtml from \"../../../html/template/Save.html\";\nimport UIElement from \"../UIElement\";\nimport saveManager from \"../../SaveManager\";\n\nclass SaveGameMenu extends UIElement {\n    constructor() {\n        super(html);\n\n        this.overwriteDom = this.dom.getElementsByClassName(\"savegame__overwrite\")[0];\n        this.oldSavesDom = this.dom.getElementsByClassName(\"savegame__oldsaves\")[0];\n    }\n\n    loadSaves() {\n        const self = this;\n        this.oldSavesDom.innerHTML = \"\";\n        for (const [key, value] of Object.entries(saveManager.saves)) {\n            const saveElement = this.htmlToElement(saveHtml);\n            saveElement.getElementsByClassName(\"save__text\")[0].innerText = key;\n            saveElement.getElementsByClassName(\"save__date\")[0].innerText = this.formatDate(value.date);\n            saveElement.getElementsByClassName(\"save__time\")[0].innerText = this.formatTime(value.date);\n            self.oldSavesDom.appendChild(saveElement);\n        }\n    }\n\n    formatDate(date) {\n        const formatted = new Date(date);\n        return formatted.getFullYear() + \"-\" + (formatted.getMonth() + 1) + \"-\" + formatted.getDate();\n    }\n\n    formatTime(date) {\n        const formatted = new Date(date);\n        return formatted.getHours() + \":\" + formatted.getMinutes() + \":\" + formatted.getSeconds();\n    }\n}\n\nconst saveGameMenu = new SaveGameMenu();\nexport default saveGameMenu;","import saveGameMenu from \"../ui/menu/SaveGameMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport saveManager from \"../SaveManager\";\n\nexport default class SaveGameMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        this.overwriteName = \"\";\n        saveGameMenu.loadSaves();\n        saveGameMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        saveGameMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (saveGameMenu.overwriteDom.classList.contains(\"active\")) {\n            if (classList.contains(\"save__overwrite\")) {\n                saveManager.saveName = this.overwriteName;\n                saveManager.save();\n\n                saveGameMenu.loadSaves();\n                saveGameMenu.overwriteDom.classList.remove(\"active\");\n            } else if (classList.contains(\"save__overwrite-cancel\")) {\n                saveGameMenu.overwriteDom.classList.remove(\"active\");\n            }\n        } else {\n            if (classList.contains(\"menu__back\")) {\n                this.returnToPreviousMenu();\n            } else if (classList.contains(\"save__confirm\")) {\n                const input = saveGameMenu.dom.getElementsByClassName(\"savegame__newsave-input\")[0];\n                const newSaveName = input.value;\n\n                if (saveManager.saves[newSaveName] !== undefined) {\n                    const overwriteTitleDom = saveGameMenu.overwriteDom.getElementsByClassName(\"savegame__overwrite-title\")[0];\n                    overwriteTitleDom.innerText = newSaveName + \" already exists. Overwrite?\";\n                    this.overwriteName = newSaveName;\n                    saveGameMenu.overwriteDom.classList.add(\"active\");\n                } else {\n                    saveManager.saveName = newSaveName;\n                    saveManager.save();\n                    saveGameMenu.loadSaves();\n                }\n            } else if (classList.contains(\"save__title\")) {\n                const textDom = target.getElementsByClassName(\"save__text\")[0];\n                const saveName = textDom.innerText;\n                const overwriteTitleDom = saveGameMenu.overwriteDom.getElementsByClassName(\"savegame__overwrite-title\")[0];\n                overwriteTitleDom.innerText = \"Overwrite \" + saveName + \"?\";\n                this.overwriteName = saveName;\n                saveGameMenu.overwriteDom.classList.add(\"active\");\n            } else if (classList.contains(\"save__delete\")) {\n                const saveToDelete = target.parentNode.getElementsByClassName(\"save__text\")[0].innerText;\n                saveManager.delete(saveToDelete);\n                saveGameMenu.loadSaves();\n            }\n        }\n    }\n}","import EventHandler from \"./_EventHandler\";\nimport pauseMenu from \"../ui/menu/PauseMenu\";\nimport controls from \"../controls/Controls\";\nimport engine from \"../Engine\";\n\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\nimport LoadGameMenuEventHandler from \"./LoadGameMenuEventHandler\";\nimport ControlsMenuEventHandler from \"./ControlsMenuEventHandler\";\nimport SettingsMenuEventHandler from \"./SettingsMenuEventHandler\";\nimport CreditsMenuEventsHandler from \"./CreditsMenuEventsHandler\";\nimport SaveGameMenuEventHandler from \"./SaveGameMenuEventHandler\";\nimport MainMenuEventHandler from \"./MainMenuEventHandler\";\n\nexport default class PauseMenuEventHandler extends EventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        pauseMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        pauseMenu.close();\n    }\n\n    handleInput() {\n        if (controls.testPressed(\"pause\")) {\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n        }\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const id = target.id;\n\n        switch(id) {\n            case \"pausemenu__savegame\":\n                this.openSaveGameMenu();\n                break;\n            case \"pausemenu__loadgame\":\n                this.openLoadGameMenu();\n                break;\n            case \"pausemenu__controls\":\n                this.openControlsMenu();\n                break;\n            case \"pausemenu__settings\":\n                this.openSettingsMenu();\n                break;\n            case \"pausemenu__credits\":\n                this.openCreditsMenu();\n                break;\n            case \"pausemenu__quit\":\n                this.quit();\n                break;\n            default:\n                break;\n        }\n\n        if (target.classList.contains(\"menu__returntogame\")) {\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n        }\n    }\n\n    openSaveGameMenu() {\n        engine.setEventHandler(new SaveGameMenuEventHandler(this));\n    }\n\n    openLoadGameMenu() {\n        engine.setEventHandler(new LoadGameMenuEventHandler(this));\n    }\n\n    openControlsMenu() {\n        engine.setEventHandler(new ControlsMenuEventHandler(this));\n    }\n\n    openSettingsMenu() {\n        engine.setEventHandler(new SettingsMenuEventHandler(this));\n    }\n\n    openCreditsMenu() {\n        engine.setEventHandler(new CreditsMenuEventsHandler(this));\n    }\n\n    quit() {\n        engine.player = null;\n        engine.setEventHandler(new MainMenuEventHandler());\n    }\n}","import Action from \"./_Action\";\nimport UnableToPerformAction from \"./UnableToPerformAction\";\nimport engine from \"../Engine\";\nimport NoAction from \"./NoAction\";\n\nexport default class InteractAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const gameMap = engine.gameMap;\n        const wallTile = gameMap.tiles.get(position.z)[position.x][position.y];\n        if (wallTile) {\n            const wallInteractable = wallTile.getComponent(\"interactable\");\n            if (wallInteractable) {\n                wallInteractable.interact();\n                return new NoAction(this.entity);\n            }\n        }\n\n        const floorTile = gameMap.tiles.get(position.z - 1)[position.x][position.y];\n        if (floorTile) {\n            const floorInteractable = floorTile.getComponent(\"interactable\");\n            if (floorInteractable) {\n                floorInteractable.interact();\n                return new NoAction(this.entity);\n            }\n        }\n\n        return new UnableToPerformAction(this.entity, \"There is nothing to interact with here.\");\n    }\n}","import ItemAction from \"./ItemAction\";\n\nexport default class DropFromEquipmentAction extends ItemAction {\n    constructor(entity, item, targetPosition) {\n        super(entity, item, targetPosition);\n    }\n\n    perform() {\n        const entityEquipment = this.entity.getComponent(\"equipment\");\n        entityEquipment.drop(this.item);\n    }\n}","import engine from \"../Engine\";\nimport controls from \"../controls/Controls\";\nimport TutorialMap from \"../map/TutorialMap\";\nimport BasicDungeon from \"../map/BasicDungeon\";\nimport Tile from \"../entity/Tile\";\nimport sceneState from \"../SceneState\";\nimport EventHandler from \"./_EventHandler\";\nimport EditorEventHandler from \"./EditorEventHandler\";\nimport BumpAction from \"../actions/actionWithDirection/BumpAction\";\nimport WaitAction from \"../actions/WaitAction\";\nimport PickupAction from \"../actions/PickupAction\";\nimport inventory from \"../ui/Inventory\";\nimport {Vector2} from \"three\";\nimport LookHandler from \"./selectIndexHandler/LookHandler\";\nimport characterHealth from \"../ui/CharacterHealth\";\nimport characterMana from \"../ui/CharacterMana\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport details from \"../ui/Details\";\nimport PauseMenuEventHandler from \"./PauseMenuEventHandler\";\nimport InteractAction from \"../actions/InteractAction\";\nimport character from \"../ui/Character\";\nimport bottomContainer from \"../ui/BottomContainer\";\nimport DropFromEquipmentAction from \"../actions/itemAction/DropFromEquipmentAction\";\n\nexport default class DefaultPlayerEventHandler extends EventHandler {\n    constructor() {\n        super();\n\n        bottomContainer.open();\n        characterHealth.open();\n        characterMana.open();\n        messageConsole.open();\n        details.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        bottomContainer.close();\n        characterHealth.close();\n        characterMana.close();\n        messageConsole.close();\n        details.close();\n    }\n\n    handleInput() {\n        let action = null;\n        if (this.isPlayerTurn) {\n            if (controls.testPressed(\"up\")) {\n                action = new BumpAction(engine.player, 0, 1);\n            } else if (controls.testPressed(\"down\")) {\n                action = new BumpAction(engine.player, 0, -1);\n            } else if (controls.testPressed(\"left\")) {\n                action = new BumpAction(engine.player, -1);\n            } else if (controls.testPressed(\"right\")) {\n                action = new BumpAction(engine.player, 1);\n            } else if (controls.testPressed(\"nw\")) {\n                action = new BumpAction(engine.player, -1, 1);\n            } else if (controls.testPressed(\"ne\")) {\n                action = new BumpAction(engine.player, 1, 1);\n            } else if (controls.testPressed(\"sw\")) {\n                action = new BumpAction(engine.player, -1, -1);\n            } else if (controls.testPressed(\"se\")) {\n                action = new BumpAction(engine.player, 1, -1);\n            } else if (controls.testPressed(\"wait\")) {\n                action = new WaitAction(engine.player);\n            } else if (controls.testPressed(\"get\")) {\n                action = new PickupAction(engine.player);\n            } else if (controls.testPressed(\"interact\")) {\n                action = new InteractAction(engine.player);\n            } else if (controls.testPressed(\"look\")) {\n                engine.setEventHandler(new LookHandler());\n            } else if (controls.testPressed(\"inventory\")) {\n                inventory.toggle();\n\n                this.hideItemTooltip();\n            } else if (controls.testPressed(\"character\")) {\n                character.toggle();\n            } else if (controls.testPressed(\"closeall\")) {\n                if (inventory.isOpen()) {\n                    inventory.close();\n                }\n\n                if (character.isOpen()) {\n                    character.close();\n                }\n            } else if (controls.testPressed(\"pause\")) {\n                engine.setEventHandler(new PauseMenuEventHandler());\n            } else if (controls.testPressed(\"quicksave\", 1000)) {\n                engine.save(\"quicksave\");\n            } else if (controls.testPressed(\"quickload\", 1000)) {\n                engine.load(\"quicksave\");\n            } else if (engine.settings.debugControlsEnabled) {\n                if (controls.testPressed(\"debug\")) {\n                    engine.gameMap.reveal();\n                    engine.needsMapUpdate = true;\n                    engine.setEventHandler(new EditorEventHandler());\n                } else if (controls.testPressed(\"debug2\")) {\n                    engine.clearMaps();\n                    engine.setMap(new TutorialMap());\n                } else if (controls.testPressed(\"reset\")) {\n                    engine.clearMaps();\n                    engine.setMap(new BasicDungeon(100, 100));\n                }\n            }\n        }\n\n        return action;\n    }\n\n    onMouseMove(e) {\n        const target = e.target;\n        this.mouse.x = (e.clientX / sceneState.canvasDom.offsetWidth) * 2 - 1;\n        this.mouse.y = -(e.clientY / sceneState.canvasDom.offsetHeight) * 2 + 1;\n\n        this.raycaster.setFromCamera(this.mouse, sceneState.camera);\n\n        const intersects = this.raycaster.intersectObject(sceneState.scene, true);\n\n        let anyFound = false;\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity && parentEntity instanceof Tile) {\n                const parentPosition = parentEntity.getComponent(\"positionalobject\");\n                if (parentPosition) {\n                    // Skip invisible/unseen items\n                    if (parentPosition.transparency === 0 || !parentPosition.hasObject()) {\n                        continue;\n                    }\n\n                    if (!this.isHighlighted(parentEntity)) {\n                        this.clearAndSetHighlight(parentEntity);\n                    }\n\n                    anyFound = true;\n                    break;\n                }\n            }\n        }\n\n        if (!anyFound) {\n            this.clearHighlights(true);\n        }\n\n        if (this.attemptToDrag) {\n            this.dragDistance = Math.max(Math.abs(this.dragStart.x - e.clientX), Math.abs(this.dragStart.y - e.clientY));\n\n            if (this.dragDistance > 10) {\n                this.attemptToDrag = false;\n                this.startDragging();\n            }\n        }\n\n        if (this.isDragging) {\n            inventory.itemDragDom.style.left = (e.clientX + this.dragOffset.x) + \"px\";\n            inventory.itemDragDom.style.top = (e.clientY + this.dragOffset.y) + \"px\";\n        }\n\n        if (this.attemptToDrag || this.isDragging) {\n            this.hoveringOver = null;\n        } else {\n            const isSlot = target.classList.contains(\"slot\");\n            if (isSlot && target.classList.contains(\"has-item\")) {\n                if (target !== this.hoveringOver) {\n                    this.hoveringOver = e.target;\n                    const details = target.getElementsByClassName(\"item__details\")[0];\n                    const clone = details.cloneNode(true);\n\n                    inventory.itemTooltipDom.innerHTML = \"\";\n                    inventory.itemTooltipDom.appendChild(clone);\n\n                    this.updateToolTipSize(e);\n                    inventory.itemTooltipDom.classList.add(\"active\");\n                } else {\n                    this.updateToolTipSize(e);\n                }\n            } else {\n                this.hideItemTooltip();\n            }\n        }\n\n        engine.needsMapUpdate = true;\n    }\n\n    startDragging() {\n        this.isDragging = true;\n\n        this.slotDragging.classList.add(\"dragging\");\n        inventory.itemDragDom.classList.add(\"active\");\n        this.hideItemTooltip();\n    }\n\n    updateToolTipSize(e) {\n        const tooltipRect = inventory.itemTooltipDom.getBoundingClientRect();\n        inventory.itemTooltipDom.style.left = (e.clientX - tooltipRect.width - 25) + \"px\";\n        inventory.itemTooltipDom.style.top = (e.clientY - (tooltipRect.height / 2)) + \"px\";\n    }\n\n    hideItemTooltip() {\n        this.hoveringOver = null;\n        inventory.itemTooltipDom.classList.remove(\"active\");\n    }\n\n    onLeftClick(e) {\n        if (this.isDragging) {\n            this.isDragging = false;\n        } else {\n            const target = e.target;\n            const classList = target.classList;\n            if (classList.contains(\"has-item\")) {\n                const sourceSlot = target.getAttribute(\"data-index\");\n                let sourceItem;\n                if (classList.contains(\"inventory__storage-slot\")) {\n                    const sourceStorage = target.parentNode.getAttribute(\"data-index\");\n                    const sourceStorageItem = inventory.openStorages[sourceStorage];\n                    const sourceStorageEquippable = sourceStorageItem.getComponent(\"equippable\");\n                    sourceItem = sourceStorageEquippable.storage[sourceSlot];\n                } else if (classList.contains(\"belt-slot\")) {\n                    const sourceSlot = target.getAttribute(\"data-index\");\n                    const playerEquipment = engine.player.getComponent(\"equipment\");\n                    if (playerEquipment) {\n                        const beltItem = playerEquipment.getItem(7);\n                        if (beltItem) {\n                            const beltEquippable = beltItem.getComponent(\"equippable\");\n                            sourceItem = beltEquippable.storage[sourceSlot];\n                        }\n                    }\n                }\n\n                if (sourceItem) {\n                    const consumable = sourceItem.getComponent(\"consumable\");\n                    if (consumable) {\n                        this.hideItemTooltip();\n                        if (engine.processAction(consumable.getAction())) {\n                            inventory.populateInventory(engine.player);\n                        }\n                    }\n                }\n            } else if (classList.contains(\"stat__level\")) {\n                const level = engine.player.getComponent(\"level\");\n                if (level.statPointsAvailable > 0) {\n                    const fighter = engine.player.getComponent(\"fighter\");\n                    const parentClasses = target.parentNode.classList;\n                    if (parentClasses.contains(\"stat--strength\")) {\n                        fighter.baseStrength += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                    } else if (parentClasses.contains(\"stat--agility\")) {\n                        fighter.baseAgility += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                    } else if (parentClasses.contains(\"stat--constitution\")) {\n                        fighter.baseConstitution += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                        characterHealth.update(fighter.hp, fighter.maxHp);\n                    } else if (parentClasses.contains(\"stat--wisdom\")) {\n                        fighter.baseWisdom += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                        characterMana.update(fighter.mana, fighter.maxMana);\n                    }\n                }\n            } else if (classList.contains(\"hotbar__open-inventory\")) {\n                inventory.toggle();\n            } else if (classList.contains(\"hotbar__open-character\")) {\n                character.toggle();\n            } else if (classList.contains(\"hotbar__open-skill\")) {\n                //skills.toggle();\n            }\n        }\n    }\n\n    onMouseDown(e) {\n        const target = e.target;\n        const isSlot = target.classList.contains(\"slot\") && !target.classList.contains(\"belt-slot\");\n        if (isSlot && target.classList.contains(\"has-item\")) {\n            // Handle adding gold to inventory\n            if (target.classList.contains(\"pickup-slot\")) {\n                const index = target.getAttribute(\"data-index\");\n                const item = inventory.itemsOnGround[index];\n                if (item) {\n                    const playerInventory = engine.player.getComponent(\"inventory\");\n                    if (playerInventory.add(item)) {\n                        engine.gameMap.removeItem(item);\n                        item.getComponent(\"positionalobject\").teardown();\n                        engine.fov.remove(item);\n                        inventory.populateInventory(engine.player);\n                        engine.needsMapUpdate = true;\n                        return;\n                    }\n                }\n            }\n\n            this.slotDragging = target;\n            document.body.classList.add(\"disable-select\");\n\n            const targetRect = target.getBoundingClientRect();\n            this.dragStart = new Vector2(e.clientX, e.clientY);\n            this.attemptToDrag = true;\n\n            this.dragOffset = new Vector2(targetRect.left - e.clientX, targetRect.top - e.clientY);\n\n            const item = target.getElementsByClassName(\"item\")[0];\n            const clone = item.cloneNode(true);\n\n            inventory.itemDragDom.innerHTML = \"\";\n            inventory.itemDragDom.appendChild(clone);\n            inventory.itemDragDom.style.width = targetRect.width + \"px\";\n            inventory.itemDragDom.style.height = targetRect.height + \"px\";\n            inventory.itemDragDom.style.left = (e.clientX + this.dragOffset.x) + \"px\";\n            inventory.itemDragDom.style.top = (e.clientY + this.dragOffset.y) + \"px\";\n        }\n    }\n\n    onMouseUp(e) {\n        this.attemptToDrag = false;\n        document.body.classList.remove(\"disable-select\");\n\n        if (this.isDragging) {\n            this.slotDragging.classList.remove(\"dragging\");\n            inventory.itemDragDom.classList.remove(\"active\");\n\n            const playerEquipment = engine.player.getComponent(\"equipment\");\n\n            const target = e.target;\n            const sourceIsGround = this.slotDragging.classList.contains(\"pickup-slot\");\n            const sourceIsInventorySlot = this.slotDragging.classList.contains(\"inventory__storage-slot\");\n            const sourceIsEquipmentSlot = this.slotDragging.classList.contains(\"inventory__equipment-slot\");\n            const targetIsGround = target.classList.contains(\"pickup-slot\");\n            const targetIsInventorySlot = target.classList.contains(\"inventory__storage-slot\");\n            const targetIsEquipmentSlot = target.classList.contains(\"inventory__equipment-slot\");\n\n            const sourceSlot = this.slotDragging.getAttribute(\"data-index\");\n            const targetSlot = target.getAttribute(\"data-index\");\n            if ((targetIsGround || targetIsInventorySlot || targetIsEquipmentSlot) && !target.classList.contains(\"disabled\")) {\n                if (sourceIsGround) {\n                    const sourceItem = inventory.itemsOnGround[sourceSlot];\n                    if (targetIsEquipmentSlot) {\n                        const fromEquippable = sourceItem.getComponent(\"equippable\");\n                        if (fromEquippable && fromEquippable.slot === playerEquipment.items[targetSlot].slot) {\n                            const targetItem = playerEquipment.getItem(targetSlot);\n                            if (targetItem) {\n                                engine.processAction(new DropFromEquipmentAction(engine.player, targetItem));\n                            }\n\n                            playerEquipment.setItem(targetSlot, sourceItem);\n                            sourceItem.parentEntity = playerEquipment;\n                            engine.gameMap.removeItem(sourceItem);\n                            sourceItem.getComponent(\"positionalobject\").teardown();\n                            engine.fov.remove(sourceItem);\n                            engine.needsMapUpdate = true;\n\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                            engine.player.callEvent(\"onEquipmentChange\");\n                        }\n                    } else if (targetIsInventorySlot) {\n                        const targetStorage = target.parentNode.getAttribute(\"data-index\");\n                        const storageItem = inventory.openStorages[targetStorage];\n                        const storageEquippable = storageItem.getComponent(\"equippable\");\n                        const targetItem = storageEquippable.storage[targetSlot];\n                        if (targetItem) {\n                            storageEquippable.drop(targetItem);\n                        }\n\n                        storageEquippable.setItem(targetSlot, sourceItem);\n                        sourceItem.parentEntity = storageEquippable;\n                        engine.gameMap.removeItem(sourceItem);\n                        sourceItem.getComponent(\"positionalobject\").teardown();\n                        engine.fov.remove(sourceItem);\n                        engine.needsMapUpdate = true;\n\n                        inventory.populateInventory(engine.player);\n                        bottomContainer.updateBeltSlots();\n                    }\n                } else if (sourceIsEquipmentSlot) {\n                    const sourceItem = playerEquipment.getItem(sourceSlot);\n                    if (targetIsEquipmentSlot) {\n                        if (targetSlot !== sourceSlot && playerEquipment.items[targetSlot].slot === playerEquipment.items[sourceSlot].slot) {\n                            playerEquipment.move(sourceSlot, targetSlot);\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                            engine.player.callEvent(\"onEquipmentChange\");\n                        }\n                    } else if (targetIsInventorySlot) {\n                        const targetStorage = target.parentNode.getAttribute(\"data-index\");\n                        const storageItem = inventory.openStorages[targetStorage];\n\n                        if (sourceItem === storageItem) {\n                            messageConsole.text(\"You can't put \" + sourceItem.name + \" inside itself!\").build();\n                            return;\n                        }\n\n                        const storageEquippable = storageItem.getComponent(\"equippable\");\n                        const targetItem = storageEquippable.storage[targetSlot];\n                        if (targetItem) {\n                            const fromEquippable = sourceItem.getComponent(\"equippable\");\n                            // Invalid slot\n                            if (fromEquippable && fromEquippable.slot !== playerEquipment.items[targetSlot].slot) {\n                                return;\n                            }\n                        }\n\n                        playerEquipment.setItem(sourceSlot, targetItem);\n                        storageEquippable.setItem(targetSlot, sourceItem);\n                        sourceItem.parentEntity = playerEquipment;\n\n                        inventory.populateInventory(engine.player);\n                        bottomContainer.updateBeltSlots();\n                        engine.player.callEvent(\"onEquipmentChange\");\n                    } else if (targetIsGround) {\n                        engine.processAction(new DropFromEquipmentAction(engine.player, sourceItem));\n                        bottomContainer.updateBeltSlots();\n                        engine.player.callEvent(\"onEquipmentChange\");\n                    }\n                } else if (sourceIsInventorySlot) {\n                    const sourceStorage = this.slotDragging.parentNode.getAttribute(\"data-index\");\n                    const sourceStorageItem = inventory.openStorages[sourceStorage];\n                    const sourceStorageEquippable = sourceStorageItem.getComponent(\"equippable\");\n                    const sourceItem = sourceStorageEquippable.storage[sourceSlot];\n\n                    if (targetIsEquipmentSlot) {\n                        const fromEquippable = sourceItem.getComponent(\"equippable\");\n                        if (fromEquippable && fromEquippable.slot === playerEquipment.items[targetSlot].slot) {\n                            const targetItem = playerEquipment.getItem(targetSlot);\n\n                            let parent = sourceItem.parentEntity;\n                            while(parent) {\n                                if (parent === targetItem) {\n                                    messageConsole.text(\"You can't equip a container from within its parent. Consider moving it elsewhere first.\").build();\n                                    return;\n                                }\n                                parent = parent.parentEntity;\n                            }\n                            playerEquipment.setItem(targetSlot, sourceItem);\n                            sourceStorageEquippable.setItem(sourceSlot, targetItem);\n                            sourceItem.parentEntity = playerEquipment;\n\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                            engine.player.callEvent(\"onEquipmentChange\");\n                        }\n                    } else if (targetIsInventorySlot) {\n                        const targetStorage = target.parentNode.getAttribute(\"data-index\");\n                        const targetStorageItem = inventory.openStorages[targetStorage];\n\n                        if (sourceStorageItem === targetStorageItem) {\n                            sourceStorageEquippable.move(sourceSlot, targetSlot);\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                        } else {\n                            const targetStorageEquippable = targetStorageItem.getComponent(\"equippable\");\n                            const targetItem = targetStorageEquippable.storage[targetSlot];\n\n                            sourceStorageEquippable.setItem(sourceSlot, targetItem);\n                            if (targetItem) {\n                                targetItem.parentEntity = sourceStorageEquippable;\n                            }\n                            targetStorageEquippable.setItem(targetSlot, sourceItem);\n                            sourceItem.parentEntity = targetStorageEquippable;\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                        }\n                    } else if (targetIsGround) {\n                        sourceStorageEquippable.drop(sourceItem);\n                        bottomContainer.updateBeltSlots();\n                    }\n                }\n            } else if (target.tagName === \"CANVAS\") {\n                if (sourceIsInventorySlot) {\n                    const sourceStorage = this.slotDragging.parentNode.getAttribute(\"data-index\");\n                    const sourceStorageItem = inventory.openStorages[sourceStorage];\n                    const sourceStorageEquippable = sourceStorageItem.getComponent(\"equippable\");\n                    const sourceItem = sourceStorageEquippable.storage[sourceSlot];\n\n                    sourceStorageEquippable.drop(sourceItem);\n                } else if (sourceIsEquipmentSlot) {\n                    engine.processAction(new DropFromEquipmentAction(engine.player, playerEquipment.getItem(sourceSlot)));\n                }\n            }\n        }\n    }\n}","import html from \"../../../html/menu/MainMenu.html\";\nimport UIElement from \"../UIElement\";\n\nclass MainMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst mainMenu = new MainMenu();\nexport default mainMenu;","import RectangularRoom from \"./RectangularRoom\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport {MathUtils} from \"three\";\nimport engine from \"../../Engine\";\n\nexport default class Shop extends RectangularRoom {\n    constructor(x, y, width, height) {\n        super(x, y, width, height);\n    }\n\n    createRoom(gameMap) {\n        this.walls = [];\n        const left = Math.max(0, this.x1);\n        const right = Math.min(gameMap.width, this.x2 + 1);\n        const top = Math.max(0, this.y1);\n        const bottom = Math.min(gameMap.height, this.y2 + 1);\n\n        for (let i = left; i < right; i++) {\n            for (let j = top; j < bottom; j++) {\n                const previousFloorTile = gameMap.tiles.get(0)[i][j];\n                if (!previousFloorTile) {\n                    gameMap.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n                    gameMap.tiles.get(0)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                }\n\n                const isVerticalEdge = (i === this.x1 || i === this.x2) && j >= this.y1 && j <= this.y2;\n                const isHorizontalEdge = (j === this.y1 || j === this.y2) && i >= this.x1 && i <= this.x2;\n                const wallTile = gameMap.tiles.get(1)[i][j];\n                if (isHorizontalEdge || isVerticalEdge) {\n                    if (!previousFloorTile && !wallTile) {\n                        gameMap.tiles.get(1)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        gameMap.tiles.get(2)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 2}}});\n\n                        const isCorner = isHorizontalEdge && isVerticalEdge;\n                        if (!isCorner) {\n                            this.walls.push(gameMap.tiles.get(1)[i][j]);\n                        }\n                    }\n                } else {\n                    if (wallTile) {\n                        gameMap.tiles.get(1)[i][j] = null;\n                    }\n                }\n            }\n        }\n\n        const randWall = MathUtils.randInt(0, this.walls.length - 1);\n        const wall = this.walls[randWall];\n        const position = wall.getComponent(\"positionalobject\");\n\n        gameMap.tiles.get(1)[position.x][position.y] = entityLoader.createFromTemplate(\"door\", {components: {positionalobject: {x: position.x, y: position.y, z: 1}}});\n\n        const x = MathUtils.randInt(this.x1 + 1, this.x2 - 1);\n        const y = MathUtils.randInt(this.y1 + 1, this.y2 - 1);\n        const npc = entityLoader.createFromTemplate(\"shop_owner\", {components: {positionalobject: {x: x, y: y, z: 1}}});\n        engine.gameMap.actors.push(npc);\n    }\n}","import RectangularRoom from \"./RectangularRoom\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport {MathUtils} from \"three\";\nimport engine from \"../../Engine\";\n\nexport default class Forge extends RectangularRoom {\n    constructor(x, y, width, height) {\n        super(x, y, width, height);\n    }\n\n    createRoom(gameMap) {\n        this.walls = [];\n        const left = Math.max(0, this.x1);\n        const right = Math.min(gameMap.width, this.x2 + 1);\n        const top = Math.max(0, this.y1);\n        const bottom = Math.min(gameMap.height, this.y2 + 1);\n\n        for (let i = left; i < right; i++) {\n            for (let j = top; j < bottom; j++) {\n                const isRightHalf = i > this.x1 + (this.width / 2);\n                const isBottomHalf = j < this.y1 + (this.height / 2);\n                const previousFloorTile = gameMap.tiles.get(0)[i][j];\n                if (!previousFloorTile) {\n                    gameMap.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n\n                    if (isRightHalf || isBottomHalf) {\n                        gameMap.tiles.get(0)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                    } else {\n                        gameMap.tiles.get(0)[i][j] = entityLoader.createFromTemplate(\"floor_gravel\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                    }\n                }\n\n                const isVerticalEdge = (i === this.x1 || i === this.x2) && j >= this.y1 && j <= this.y2;\n                const isHorizontalEdge = (j === this.y1 || j === this.y2) && i >= this.x1 && i <= this.x2;\n                const wallTile = gameMap.tiles.get(1)[i][j];\n                if (isHorizontalEdge || isVerticalEdge) {\n                    if (!previousFloorTile && !wallTile) {\n                        if (isRightHalf || isBottomHalf) {\n                            gameMap.tiles.get(1)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                            gameMap.tiles.get(2)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 2}}});\n\n                            const isCorner = isHorizontalEdge && isVerticalEdge;\n                            if (!isCorner) {\n                                this.walls.push(gameMap.tiles.get(1)[i][j]);\n                            }\n                        }\n                    }\n                } else {\n                    if (wallTile) {\n                        gameMap.tiles.get(1)[i][j] = null;\n                    }\n                }\n            }\n        }\n\n        const x = MathUtils.randInt(this.x1 + 1, this.x2 - 1);\n        const y = MathUtils.randInt(this.y1 + 1, this.y2 - 1);\n        const npc = entityLoader.createFromTemplate(\"shop_owner\", {components: {positionalobject: {x: x, y: y, z: 1}}});\n        engine.gameMap.actors.push(npc);\n    }\n}","import GameMap from \"./GameMap\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport MapLayer from \"./MapLayer\";\nimport Shop from \"./room/Shop\";\nimport ArrayUtil from \"../util/ArrayUtil\";\nimport {MathUtils} from \"three\";\nimport Forge from \"./room/Forge\";\n\nexport default class Town extends GameMap {\n    constructor() {\n        super(\"town\", 65, 70);\n    }\n\n    init() {\n        this.tiles = new Map();\n        for (let i = -1; i < 10; i++) {\n            this.tiles.set(i, ArrayUtil.create2dArray(this.width));\n        }\n\n        this.actors = [];\n        this.items = [];\n    }\n\n    create() {\n        super.create();\n\n        const shop1 = new Shop(18, 28, 6, 8);\n        shop1.createRoom(this);\n\n        const shop2 = new Shop(16, 40, 7, 7);\n        shop2.createRoom(this);\n\n        const shop3 = new Shop(35, 48, 10, 6);\n        shop3.createRoom(this);\n\n        const shop4 = new Shop(40, 41, 5, 7);\n        shop4.createRoom(this);\n\n        const shop5 = new Forge(37, 26, 10, 10);\n        shop5.createRoom(this);\n\n        let jStart = 10;\n        let jEnd = 15;\n        for (let i = 5; i < this.width - 5; i++) {\n            const jStartRandom = Math.random();\n            if (jStartRandom > .95) {\n                jStart -= 1;\n            } else if (jStartRandom > .9) {\n                jStart += 1;\n            }\n\n\n            const jEndRandom = Math.random();\n            if (jEndRandom > .95) {\n                jEnd -= 1;\n            } else if (jEndRandom > .9) {\n                jEnd += 1;\n            }\n\n            if (jEnd < jStart + 2) {\n                jEnd = jStart + 2;\n            }\n\n            if (jEnd > jStart + 6) {\n                jEnd = jStart + 6;\n            }\n\n            for (let j = jStart; j <= jEnd; j++) {\n                this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n                this.tiles.get(0)[i][j] = entityLoader.createFromTemplate(\"water\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n            }\n        }\n\n        // Fill rest of floors\n        for (let j = 5; j < this.height - 5; j++) {\n            for (let i = 5; i < this.width - 5; i++) {\n                if (i === 44 && j >= 33 && j <= 35) {\n                    this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"table\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                }\n\n                if ((i === 37 && j === 36) || ((i === 42 && j === 31))) {\n                    this.tiles.get(1)[i][j] = entityLoader.createFromTemplate(\"post\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    this.tiles.get(2)[i][j] = entityLoader.createFromTemplate(\"post\", {components: {positionalobject: {x: i, y: j, z: 2}}});\n                }\n\n                const floorTile = this.tiles.get(MapLayer.Floor)[i][j];\n                if (!floorTile) {\n                    this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n\n                    if (i === 31 && j === 31) {\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"stairs_north\", {components: {positionalobject: {x: i, y: j, z: 0}, stairsInteractable: {generator: \"basic-dungeon\"}}});\n                    } else {\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"floor_grass\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                    }\n\n                    if (i === 29 && j >= 35 && j <= 39) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"fence_vertical\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 32 && j === 41) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"well\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if ((i === 36 || i === 37) && j === 47) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"barrel\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 19 && j === 17) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"bench_south\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 20 && j === 17) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"bench_south_left\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 18 && j === 17) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"bench_south_right\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i > 17 && i < 21 && j === 20) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"bench_stone\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else {\n                        const floor = this.tiles.get(MapLayer.Floor)[i][j];\n                        if (floor.components.walkable && floor.components.walkable.walkable) {\n                            if (Math.random() < .01) {\n                                this.createTree(i, j);\n                            } else if (Math.random() < .05) {\n                                this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"stone\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                            } else {\n                                if (Math.random() < .3) {\n                                    const randomGrass = MathUtils.randInt(1, 4);\n                                    this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"grass\" + randomGrass, {components: {positionalobject: {x: i, y: j, z: 1}}});\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        this.addPlayer(33, 36);\n    }\n\n    createTree(x, y) {\n        for (let z = 1; z <= 8; z++) {\n            this.tiles.get(z)[x][y] = entityLoader.createFromTemplate(\"tree_trunk\", {components: {positionalobject: {x: x, y: y, z: z}}});\n        }\n\n        for (let z = 5; z < 10; z++) {\n            for (let i = -2; i <= 2; i++) {\n                for (let j = -2; j <= 2; j++) {\n                    if (i !== 0 || j !== 0) {\n                        const absI = Math.abs(i);\n                        const absJ = Math.abs(j);\n                        if ((absI === 2 || absJ === 2)) {\n                            // Skip corners\n                            if (absI === 2 && absJ === 2) {\n                                continue;\n                            }\n\n                            // Skip top and bottom outsides\n                            if ((z === 5 || z === 9)) {\n                                continue;\n                            }\n\n                            // Skip some leaves\n                            if (Math.random() < .1) {\n                                continue;\n                            }\n                        }\n\n                        if (this.tiles.get(z)[x+i]) {\n                            this.tiles.get(z)[x+i][y+j] = entityLoader.createFromTemplate(\"tree_leaves\", {components: {positionalobject: {x: x+i, y: y+j, z: z}}});\n                        }\n                    }\n                }\n            }\n        }\n\n        this.tiles.get(9)[x][y] = entityLoader.createFromTemplate(\"tree_leaves\", {components: {positionalobject: {x: x, y: y, z: 9}}});\n    }\n}","import EventHandler from \"./_EventHandler\";\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\nimport engine from \"../Engine\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport mainMenu from \"../ui/menu/MainMenu\";\nimport LoadGameMenuEventHandler from \"./LoadGameMenuEventHandler\";\nimport ControlsMenuEventHandler from \"./ControlsMenuEventHandler\";\nimport SettingsMenuEventHandler from \"./SettingsMenuEventHandler\";\nimport CreditsMenuEventsHandler from \"./CreditsMenuEventsHandler\";\nimport Town from \"../map/Town\";\n\nexport default class MainMenuEventHandler extends EventHandler {\n    constructor() {\n        super();\n\n        mainMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        mainMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const id = target.id;\n\n        switch(id) {\n            case \"mainmenu__newgame\":\n                this.startNewGame();\n                break;\n            case \"mainmenu__loadgame\":\n                this.openLoadGameMenu();\n                break;\n            case \"mainmenu__controls\":\n                this.openControlsMenu();\n                break;\n            case \"mainmenu__settings\":\n                this.openSettingsMenu();\n                break;\n            case \"mainmenu__credits\":\n                this.openCreditsMenu();\n                break;\n            default:\n                break;\n        }\n    }\n\n    startNewGame() {\n        engine.clearMaps();\n        engine.setMap(new Town());\n        engine.gameMap.reveal();\n        engine.setEventHandler(new DefaultPlayerEventHandler());\n        messageConsole.clear();\n        messageConsole.text(\"Welcome adventurer!\").build();\n    }\n\n    openLoadGameMenu() {\n        engine.setEventHandler(new LoadGameMenuEventHandler(this));\n    }\n\n    openControlsMenu() {\n        engine.setEventHandler(new ControlsMenuEventHandler(this));\n    }\n\n    openSettingsMenu() {\n        engine.setEventHandler(new SettingsMenuEventHandler(this));\n    }\n\n    openCreditsMenu() {\n        engine.setEventHandler(new CreditsMenuEventsHandler(this));\n    }\n}","import BasicDungeon from \"./BasicDungeon\";\n\nexport default class MapLoader {\n    constructor() {}\n\n    loadMap(mapType, args = {}) {\n        switch(mapType) {\n            case \"basic-dungeon\":\n                return new BasicDungeon(100, 100, args);\n            default:\n                return null;\n        }\n    }\n}","import UnableToPerformAction from \"./actions/UnableToPerformAction\";\nimport sceneState from \"./SceneState\";\nimport AdamMilazzoFov from \"./map/fov/AdamMilazzoFov\";\nimport SimpleFov from \"./map/fov/SimpleFov\";\nimport messageConsole from \"./ui/MessageConsole\";\nimport NoAction from \"./actions/NoAction\";\nimport MainMenuEventHandler from \"./event/MainMenuEventHandler\";\nimport Settings from \"./settings/Settings\";\nimport saveManager from \"./SaveManager\";\nimport GameMap from \"./map/GameMap\";\nimport MapLoader from \"./map/MapLoader\";\n\nclass Engine {\n    constructor() {\n        this.eventHandler = new MainMenuEventHandler();\n        this.settings = new Settings();\n        this.player = null;\n        this.gameMap = null;\n        this.gameMaps = new Map();\n        this.mapLoader = new MapLoader();\n        this.needsMapUpdate = false;\n        this.fov = new AdamMilazzoFov();\n        this.airFov = new SimpleFov();\n    }\n\n    setEventHandler(eventHandler) {\n        if (this.eventHandler) {\n            this.eventHandler.teardown();\n        }\n\n        this.eventHandler = eventHandler;\n    }\n\n    handleEvents() {\n        this.processAction(this.eventHandler.handleInput());\n    }\n\n    processAction(action) {\n        if (action && this.eventHandler.isPlayerTurn) {\n            const performedAction = action.perform();\n            if (performedAction instanceof NoAction) {\n                return false;\n            }\n\n            if (performedAction instanceof UnableToPerformAction) {\n                if (performedAction.reason) {\n                    messageConsole.text(performedAction.reason).build();\n                }\n                return false;\n            } else {\n                sceneState.updateCameraPosition(engine.player);\n\n                engine.gameMap.updatePlayerUI();\n                engine.needsMapUpdate = true;\n\n                this.handleEnemyTurns();\n\n                saveManager.autosave();\n                return true;\n            }\n        }\n    }\n\n    handleEnemyTurns() {\n        this.eventHandler.isPlayerTurn = false;\n        for (const actor of this.gameMap.actors) {\n            if (actor !== this.player) {\n                const ai = actor.getComponent(\"ai\");\n                if (ai) {\n                    ai.perform();\n                }\n            }\n        }\n        this.eventHandler.isPlayerTurn = true;\n    }\n\n    setMap(map, stairsInteractable) {\n        if (this.gameMap === map) {\n            return;\n        }\n\n        let previousMapName = null;\n        if (this.gameMap) {\n            previousMapName = this.gameMap.name;\n            this.gameMap.teardown();\n            const playerIndex = this.gameMap.actors.indexOf(this.player);\n            this.gameMap.actors.splice(playerIndex, 1);\n            this.gameMap.save();\n        }\n\n        this.gameMap = map;\n        this.addMap(map, previousMapName, stairsInteractable);\n        map.save();\n        if (this.gameMap.actors.indexOf(this.player) === -1) {\n            this.gameMap.actors.push(this.player);\n        }\n\n        const positionalObject = this.player.getComponent(\"positionalobject\");\n        positionalObject.setVisible();\n        sceneState.updateCameraPosition(this.player);\n        this.gameMap.revealPreviouslyExplored();\n        this.gameMap.updatePlayerUI();\n        this.needsMapUpdate = true;\n    }\n\n    addMap(map, previousMapName, stairsInteractable) {\n        if (!this.gameMaps.has(map.name)) {\n            this.gameMaps.set(map.name, map);\n            map.create(previousMapName, stairsInteractable);\n        }\n    }\n\n    clearMaps() {\n        this.player = null;\n        this.gameMaps = new Map();\n    }\n\n    save(name) {\n        const maps = [];\n        for (const map of this.gameMaps.values()) {\n            maps.push(map.save());\n        }\n\n        const saveJson = {\n            \"name\": name,\n            \"date\": new Date(),\n            \"currentMap\": this.gameMap.name,\n            \"maps\": maps\n        };\n\n        localStorage.setItem(name, JSON.stringify(saveJson));\n    }\n\n    load(name) {\n        this.clearMaps();\n        const loadData = localStorage.getItem(name);\n        if (loadData) {\n            const json = JSON.parse(loadData);\n            const currentMap = json.currentMap;\n            for (const map of json.maps) {\n                const newMap = new GameMap(map.name, map.width, map.height);\n                newMap.load(map);\n                this.addMap(newMap);\n\n                if (newMap.name === currentMap) {\n                    for (const actor of newMap.actors) {\n                        if (actor.name === \"Player\") {\n                            this.player = actor;\n                            break;\n                        }\n                    }\n\n                    this.setMap(newMap);\n                }\n            }\n        }\n    }\n}\n\nconst engine = new Engine();\nexport default engine;","import html from \"../../../html/ui/editor/EditorLayer.html\";\nimport UIElement from \"../UIElement\";\n\nclass EditorLayer extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst editorLayer = new EditorLayer();\nexport default editorLayer;","import html from \"../../../html/ui/editor/EditorPaint.html\";\nimport UIElement from \"../UIElement\";\n\nclass EditorPaint extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst editorPaint = new EditorPaint();\nexport default editorPaint;","import * as THREE from \"three\";\nimport Stats from \"stats.js\";\nimport engine from \"./Engine\";\nimport messageConsole from \"./ui/MessageConsole\";\nimport details from \"./ui/Details\";\nimport inventory from \"./ui/Inventory\";\nimport editorControls from \"./ui/editor/EditorControls\";\nimport editorLayer from \"./ui/editor/EditorLayer\";\nimport editorInfo from \"./ui/editor/EditorInfo\";\nimport editorPaint from \"./ui/editor/EditorPaint\";\nimport mainMenu from \"./ui/menu/MainMenu\";\nimport controlsMenu from \"./ui/menu/ControlsMenu\";\nimport creditsMenu from \"./ui/menu/CreditsMenu\";\nimport gameOverMenu from \"./ui/menu/GameOverMenu\";\nimport loadGameMenu from \"./ui/menu/LoadGameMenu\";\nimport saveGameMenu from \"./ui/menu/SaveGameMenu\";\nimport settingsMenu from \"./ui/menu/SettingsMenu\";\nimport pauseMenu from \"./ui/menu/PauseMenu\";\nimport character from \"./ui/Character\";\nimport bottomContainer from \"./ui/BottomContainer\";\n\nclass SceneState {\n    constructor() {\n        this.scene = new THREE.Scene();\n\n        this.setupGameHtml();\n\n        this.setupLights();\n        this.updateCamera();\n\n        window.addEventListener( \"resize\", this);\n    }\n\n    setupGameHtml() {\n        const gameDom = document.createElement(\"div\");\n        gameDom.classList.add(\"game\");\n\n        this.canvasDom = document.createElement(\"div\");\n        this.canvasDom.classList.add(\"view\");\n        gameDom.appendChild(this.canvasDom);\n        gameDom.appendChild(details.dom);\n        gameDom.appendChild(bottomContainer.dom);\n        gameDom.appendChild(messageConsole.dom);\n        gameDom.appendChild(inventory.dom);\n        gameDom.appendChild(character.dom);\n\n        gameDom.appendChild(editorControls.dom);\n        gameDom.appendChild(editorInfo.dom);\n        gameDom.appendChild(editorLayer.dom);\n        gameDom.appendChild(editorPaint.dom);\n\n        gameDom.appendChild(controlsMenu.dom);\n        gameDom.appendChild(creditsMenu.dom);\n        gameDom.appendChild(gameOverMenu.dom);\n        gameDom.appendChild(loadGameMenu.dom);\n        gameDom.appendChild(mainMenu.dom);\n        gameDom.appendChild(pauseMenu.dom);\n        gameDom.appendChild(saveGameMenu.dom);\n        gameDom.appendChild(settingsMenu.dom);\n\n        this.renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});\n        this.renderer.setClearColor(0xaaaaaa, 1);\n        this.canvasDom.appendChild(this.renderer.domElement);\n        document.body.appendChild(gameDom);\n\n        this.stats = new Stats();\n        this.stats.showPanel(0);\n        this.stats.dom.classList.add(\"ui\");\n        document.body.appendChild(this.stats.dom);\n        this.updateStatsVisibility(engine.settings);\n    }\n\n    handleEvent(e) {\n        switch(e.type) {\n            case \"resize\":\n                this.updateCamera();\n\n                if (this.player) {\n                    this.updateCameraPosition(this.player);\n                }\n                break;\n        }\n    }\n\n    setupLights() {\n        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\n        this.scene.add(ambientLight);\n\n        const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);\n        dirLight.position.set(100, -300, 400);\n        this.scene.add(dirLight);\n    }\n\n    updateCamera() {\n        const aspectRatio = this.canvasDom.offsetWidth / this.canvasDom.offsetHeight;\n\n        const viewSize = 80;\n        const left = -aspectRatio * viewSize / 2;\n        const right = aspectRatio * viewSize / 2;\n        const top = viewSize / 2;\n        const bottom = -viewSize / 2;\n        this.camera = new THREE.OrthographicCamera(left, right, top, bottom, -10000, 10000);\n        this.renderer.setSize(this.canvasDom.offsetWidth, this.canvasDom.offsetHeight);\n    }\n\n    updateCameraPosition(player, lookAt = player) {\n        this.player = player;\n        this.camera.up.set(0, 0, 1);\n        const positionalObject = lookAt.getComponent(\"positionalobject\");\n        if (positionalObject) {\n            const position = positionalObject.getObjectPosition();\n            this.camera.position.set(200 + position.x, -200 + position.y, 300);\n            this.camera.lookAt(position.x, position.y, 0);\n            engine.needsMapUpdate = true;\n        }\n    }\n\n    updateStatsVisibility(settings) {\n        if (settings.displayFPS) {\n            this.stats.dom.classList.add(\"active\");\n        } else {\n            this.stats.dom.classList.remove(\"active\");\n        }\n    }\n}\n\n\nconst sceneState = new SceneState();\nexport default sceneState;","import GameMap from \"./GameMap\";\nimport MapLayer from \"./MapLayer\";\nimport engine from \"../Engine\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport ArrayUtil from \"../util/ArrayUtil\";\n\nexport default class MainMenuMap extends GameMap {\n    constructor() {\n        super(\"main-menu\", 35, 15);\n\n        this.floor = [\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"#################################\",\n            \"#################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\"\n        ];\n\n        this.wall = [\n            \"###################################\",\n            \"###################################\",\n            \"####====###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"##===  =########################===\",\n            \"##=    =#################======#= >\",\n            \"##=    =#########=======#=    =#= =\",\n            \"##=    ===========     ===    === =\",\n            \"##=                    + +        =\",\n            \"##=       ==== ===     ===    =====\",\n            \"##=========##= =#=======#=    =####\",\n            \"#############= =#########======####\"\n        ];\n\n        this.overlay = [\n            \"###################################\",\n            \"########## RoguelikeDev ######v5_0#\",\n            \"###################################\",\n            \"############ does the ####2021#6-8#\",\n            \"###################################\",\n            \"### Complete Roguelike Tutorial ###\",\n            \"#####..############################\",\n            \"#####..############################\",\n            \"###....##########################.#\",\n            \"###....###################....###.#\",\n            \"###....###########.....###....###.#\",\n            \"###....................#.#........#\",\n            \"###.......####.###.....###....#####\",\n            \"##############.###########....#####\",\n            \"##############.####################\"\n        ];\n    }\n\n    init() {\n        super.init();\n\n        this.tiles.set(MapLayer.Decorative, ArrayUtil.create2dArray(this.width));\n    }\n\n    create() {\n        super.create();\n        const overlayColors = [\n            0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff, 0x66b2ff, 0x66d9ff, 0x66ffd9, 0x66ffb2, 0x66ff66, 0xb2ff66, 0xd9ff66, 0xffff66, 0xffd966, 0xffb266, 0xff8c66, 0xff668c, 0xff66b2, 0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff,\n            0x00ffbf, 0x00ff80, 0x00ff00, 0x80ff00, 0xffff00, 0xffbf00, 0xff8000, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333,\n            0x00a3d9, 0x00d9d9, 0x00d9a3, 0x00d96c, 0x00d900, 0x6cd900, 0xa3d900, 0xd9d900, 0xd9a300, 0xd96c00, 0xd93600, 0xd90000, 0x333333, 0x333333, 0x333333, 0x333333\n        ];\n        let overlayColorIndex = 0;\n        for (let j = 0; j < this.height; j++) {\n            for (let i = 0; i < this.width; i++) {\n                const floorChar = this.floor[this.height - j - 1].charAt(i);\n                switch(floorChar) {\n                    case \"#\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                    case \"\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate(\"floor\", {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"water\", {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                }\n\n                const wallChar = this.wall[this.height - j - 1].charAt(i);\n                switch(wallChar) {\n                    case \"#\":\n                    case \"=\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"wall\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \"+\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"door\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \">\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate(\"stairs_north\", {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                }\n\n                let overlayChar = this.overlay[this.height - j - 1].charAt(i);\n                if (overlayChar !== \"#\") {\n                    if (overlayChar !== \".\") {\n                        this.tiles.get(MapLayer.DecorativeBG)[i][j] = entityLoader.createFromTemplate(\"art_backing\", {components: {positionalobject: {x: i, y: j, z: 2}}});\n                    }\n\n                    if (overlayChar !== \" \" && overlayChar !== \".\") {\n                        if (overlayChar === \"_\") {\n                            overlayChar = \".\";\n                        }\n\n                        this.tiles.get(MapLayer.Decorative)[i][j] = entityLoader.createFromTemplate(\"art\", {components: {characterobject: {x: i, y: j, z: 2.05, letter: overlayChar, color: overlayColors[overlayColorIndex]}}});\n                        overlayColorIndex ++;\n                    }\n                }\n            }\n        }\n\n        this.addPlayer(21, 3);\n        engine.gameMap.actors.push(entityLoader.createFromTemplate(\"ant\", {components: {positionalobject: {x: 27, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate(\"dragon_red\", {components: {positionalobject: {x: 18, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate(\"goblin\", {components: {positionalobject: {x: 5, y: 2, z: 1}}}));\n\n        engine.gameMap.items.push(entityLoader.createFromTemplate(\"potion_health\", {components: {positionalobject: {x: 3, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate(\"^\", {components: {positionalobject: {x: 6, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate(\"tower_shield\", {components: {positionalobject: {x: 28, y: 1, z: 1}}}));\n    }\n}","import \"./styles/style.css\";\nimport sceneState from \"./js/SceneState.js\";\nimport engine from \"./js/Engine\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport details from \"./js/ui/Details\";\nimport MainMenuMap from \"./js/map/MainMenuMap\";\n\n(function () {\n    const init = function() {\n        engine.clearMaps();\n        engine.setMap(new MainMenuMap());\n        const playerPosition = engine.player.getComponent(\"positionalobject\");\n        engine.gameMap.revealFromPosition(playerPosition.x, playerPosition.y, 100, 0);\n        engine.needsMapUpdate = true;\n\n        sceneState.renderer.setAnimationLoop(animation);\n    };\n\n    const animation = function(/*time*/) {\n        sceneState.stats.begin();\n\n        engine.handleEvents();\n        if (engine.needsMapUpdate) {\n            updateRender();\n            engine.needsMapUpdate = false;\n        }\n\n        TWEEN.update();\n\n        sceneState.stats.end();\n    };\n\n    const updateRender = function() {\n        if (engine.player) {\n            const playerPosition = engine.player.getComponent(\"positionalobject\");\n            if (playerPosition) {\n                let playerVisibility = 5;\n                const tileAtPlayer = engine.gameMap.tiles.get(playerPosition.z)[playerPosition.x][playerPosition.y];\n                if (tileAtPlayer) {\n                    const modifier = tileAtPlayer.getComponent(\"visibilityModifier\");\n                    if (modifier) {\n                        playerVisibility = modifier.getVisibility(playerVisibility);\n                    }\n                }\n\n                const isFovNew = engine.fov.visibleObjects.length === 0;\n\n                engine.gameMap.updateFOV(playerPosition.x, playerPosition.y, playerPosition.z, playerVisibility);\n                engine.gameMap.draw(playerPosition.x, playerPosition.y, playerPosition.z);\n\n                if (isFovNew) {\n                    details.updatePlayerDetails();\n                }\n            }\n\n            sceneState.renderer.render(sceneState.scene, sceneState.camera);\n        }\n    };\n\n    init();\n}());"],"sourceRoot":""}