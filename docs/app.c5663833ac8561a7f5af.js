"use strict";(self.webpackChunkroguelikedev_2021=self.webpackChunkroguelikedev_2021||[]).push([[143],{890:(t,e,n)=>{n.d(e,{Z:()=>r});var s=n(4015),o=n.n(s),i=n(3645),a=n.n(i)()(o());a.push([t.id,'* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0 auto;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-size: 1.2vh;\n}\n\nbody.disable-select * {\n    user-select: none;\n}\n\n.ui {\n    display: block;\n    z-index: -1000 !important;\n    opacity: 0;\n    pointer-events: none;\n}\n\n.ui.active {\n    z-index: 0 !important;\n    opacity: 1;\n    pointer-events: all;\n}\n\n.menu {\n    position: fixed;\n    left: 5%;\n    top: 5%;\n    background-color: #000;\n    min-width: 20%;\n    max-width: 30%;\n    text-align: center;\n    padding: 0.5vh 2.5vh 4vh;\n    border-radius: 15px 0;\n    color: #eee;\n}\n\n.menu--full {\n    left: 10%;\n    right: 10%;\n    max-width: none;\n}\n\n.menu hr {\n    margin: 1.5vh 0;\n}\n\n.menu.active {\n    background-color: rgba(0, 0, 0, .7);\n}\n\n.menu__title {\n    font-size: 5vh;\n    color: #fff;\n    margin: 0 0 1.5vh;\n    font-family: Georgia, serif;\n}\n\n.menu__action {\n    margin: 0 auto;\n    display: block;\n    width: 75%;\n    font-family: Lucida Console, serif;\n    font-size: 1.8vh;\n    padding: .5vh;\n}\n\n.menu__action--cancel {\n    background-color: #f33;\n}\n\n.menu__action--cancel:hover {\n    background-color: #f11;\n}\n\n.menu__action--confirm {\n    background-color: #3f3;\n}\n\n.menu__action--confirm:hover {\n    background-color: #3c3;\n}\n\n.menu__action + .menu__action {\n    margin-top: 15px;\n}\n\n.menu--full .menu__action {\n    width: auto;\n    display: inline-block;\n}\n\n.menu--full .menu__action + .menu__action {\n    margin-top: 0;\n    margin-left: 15px;\n}\n\n#editor-controls {\n    position: fixed;\n    top: 50px;\n    right: 50px;\n    background-color: chocolate;\n    padding: 1px;\n}\n\n.editor-controls__action {\n    display: block;\n    padding: 5px 0;\n    background-color: #ccc;\n    font-size: 20px;\n    text-align: center;\n    width: 45px;\n}\n\n.editor-controls__action.active {\n    border-style: inset;\n}\n\n#editor-info {\n    position: fixed;\n    top: 50px;\n    right: 200px;\n    background-color: chocolate;\n    padding: 1px;\n}\n\n.editor-info__component {\n    border: 1px solid #999;\n    padding: 5px;\n    background-color: #ccc;\n    display: none;\n}\n\n.editor-info__component.active {\n    display: block;\n}\n\n.editor-info__component + .editor-info__component {\n    border-top: 0;\n}\n\n.editor-info__label {\n    font-weight: bold;\n    text-transform: capitalize;\n}\n\n.game {\n    width: 100vw;\n    height: 100vh;\n}\n\n.view {\n    display: block;\n    float: left;\n    width: 100%;\n    height: 100%;\n}\n\n.details {\n    padding: 10px 15px;\n    font-size: 2vh;\n    display: block;\n    width: 20%;\n    position: absolute;\n    top: 0;\n    right: 0;\n    background-color: #ddd;\n}\n\n\n.details__header {\n    margin-top: 20px;\n}\n.details__line {\n    display: block;\n}\n\n.console {\n    background-color: #eee;\n    transform: translate(0, 0);\n    position: fixed;\n    left: 0;\n    right: 0;\n    width: 45%;\n    margin: 0 auto;\n    height: 12.25%;\n    bottom: 8%;\n}\n\n.console.active {\n    opacity: .95;\n}\n\n.console.animate {\n    transition: all 1s ease;\n}\n\n.console.full {\n    transform: translate(0, -10%);\n    height: 80%;\n}\n\n.console.active.full {\n    opacity: 1;\n}\n\n.console.collapsed {\n    height: 4.5%;\n}\n\n.console__button {\n    position: absolute;\n    top: 0;\n    z-index: 100;\n    opacity: 1;\n}\n\n.console__increase {\n    right: 40px;\n}\n\n.console.full .console__increase {\n    opacity: 0;\n    z-index: -1;\n}\n\n.console__decrease {\n    right: 64px;\n}\n\n.console.collapsed .console__decrease {\n    opacity: 0;\n    z-index: -1;\n}\n\n.messages__wrap {\n    position: absolute;\n    opacity: 1;\n    padding: 5px;\n    width: 100%;\n    height: 100%;\n}\n\n.messages {\n    display:flex;\n    flex-direction:column-reverse;\n    height: 100%;\n    overflow-y: scroll;\n}\n\n.messages__inn {\n\n}\n\n.message {\n    font-size: 1.66vh;\n    text-shadow: 1px 1px 0 #888;\n}\n\n.message__text {\n\n}\n\n.message__bold {\n    font-weight: bold;\n}\n\n.message__italics {\n    font-style: italic;\n}\n\n.message__amount {\n    margin-left: 1em;\n}\n\n.character-info {\n    font-family: Arial, serif;\n    font-weight: bold;\n    font-size: 15vh;\n    text-align: center;\n}\n#character-health {\n    color: #c00;\n}\n\n#character-mana {\n    color: #00c;\n}\n\n.character-info__wrap {\n    position: absolute;\n    top: 5%;\n    bottom: 5%;\n    left: 0;\n    right: 0;\n}\n\n#character-mana .character-info__wrap {\n    transform: rotate(180deg);\n}\n\n.character-info__bg {\n    position: absolute;\n    bottom: 10%;\n    left: 0;\n    right: 0;\n    z-index: 10;\n    display: flex;\n    flex-direction: column-reverse;\n    overflow: hidden;\n}\n\n#character-health .character-info__bg {\n    color: #ffe0e0;\n}\n\n.character-info__fg {\n    position: absolute;\n    bottom: 10%;\n    left: 0;\n    right: 0;\n    z-index: 20;\n    display: flex;\n    flex-direction: column-reverse;\n    overflow: hidden;\n}\n\n#character-mana .character-info__bg,\n#character-mana .character-info__fg {\n    bottom: -15%;\n    font-size: 18.75vh;\n}\n\n#character-mana .character-info__fg {\n    color: #e0e0ff;\n}\n\n.character-info__text {\n    position: absolute;\n    left: 0;\n    right: 0;\n    font-size: 3vh;\n    color: #000;\n    z-index: 30;\n    text-shadow: 1px 1px 3px #eee;\n}\n\n#character-health .character-info__text {\n    top: 38%;\n    bottom: 0;\n}\n\n#character-mana .character-info__text {\n    transform: rotate(180deg);\n    top: 0;\n    bottom: 38%;\n}\n\n.inventory {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 30%;\n    height: 80%;\n    transform: translateX(100%);\n    transition: transform 1s ease;\n    background: #fff;\n    padding: 15px;\n}\n\n.inventory.active {\n    transform: translateX(0);\n}\n\n.inventory__equipment {\n    width: 100%;\n    height: 55%;\n    display: grid;\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    grid-template-rows: repeat(4, minmax(0, 1fr));\n    background-color: #333;\n    grid-gap: 0.2vw;\n    padding: 1vh 7.5vh\n}\n\n.inventory__storage-wrap {\n    width: 100%;\n    height: 40%;\n    background-color: #333;\n    position: relative;\n    overflow-y: auto;\n}\n\n.inventory__storage {\n    width: 100%;\n    display: grid;\n    grid-template-columns: repeat(10, minmax(0, 1fr));\n    grid-gap: 0.2vw;\n    padding: 0.2vw;\n}\n\n.inventory__storage-title {\n    grid-column: span 10;\n    padding: 5px;\n    background-color: #ccc;\n    font-size: 1.8vh;\n}\n\n.slot {\n    background-color: gray;\n    text-align: center;\n    border-radius: 5px;\n    position: relative;\n    font-family: helvetica, serif;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot .item {\n    font-size: 7.5vh;\n}\n\n.inventory__equipment-slot:before {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    font-size: 7.5vh;\n    opacity: 0.15;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot.has-item:before {\n    display: none;\n}\n\n.inventory__equipment-slot[data-index="0"]:before {\n    content: "⌈";\n}\n\n.inventory__equipment-slot[data-index="1"]:before {\n    content: "∩";\n}\n\n.inventory__equipment-slot[data-index="2"]:before {\n    content: "ᴕ";\n}\n\n.inventory__equipment-slot[data-index="3"]:before {\n    content: "†";\n    transform: rotate(180deg);\n}\n\n.inventory__equipment-slot[data-index="4"]:before {\n    content: "☗";\n}\n\n.inventory__equipment-slot[data-index="5"]:before {\n    content: "●";\n}\n\n.inventory__equipment-slot[data-index="6"]:before,\n.inventory__equipment-slot[data-index="8"]:before {\n    content: "○";\n}\n\n.inventory__equipment-slot[data-index="7"]:before {\n    content: "-";\n}\n\n.inventory__equipment-slot[data-index="9"]:before {\n    content: "ひ";\n}\n\n.inventory__equipment-slot[data-index="10"]:before {\n    content: "◫";\n}\n.inventory__equipment-slot[data-index="11"]:before {\n    content: "″";\n}\n\n.inventory__storage-slot {\n    height: 5.3vh;\n}\n\n.slot.has-item:hover {\n    cursor: pointer;\n    background-color: #999;\n}\n\n.slot.disabled {\n    background-color: #845b5b;\n}\n\n.slot.dragging .item {\n    display: none;\n}\n\n.character {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 30%;\n    height: 80%;\n    transform: translateX(-100%);\n    transition: transform 1s ease;\n    background: #fff;\n    padding: 15px;\n}\n\n.character.active {\n    transform: translateX(0);\n}\n\n.character__title {\n    text-align: center;\n    font-weight: bold;\n    margin-top: 0;\n    margin-bottom: 40px;\n    text-transform: uppercase;\n    font-family: Arial, serif;\n    font-size: 3vh;\n}\n\n.character__xp {\n    width: 80%;\n    margin: 0 auto 40px;\n}\n\n.item {\n    font-family: helvetica, serif;\n    pointer-events: none;\n    position: relative;\n    font-size: 4.5vh;\n    user-select: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n}\n\n.item__icon {\n\n}\n\n.item__amount {\n    position: absolute;\n    right: 5%;\n    bottom: 5%;\n    font-size: 1.1vw;\n    color: #fff;\n    line-height: 0.7vw;\n}\n\n.item__details {\n    display: none;\n}\n\n.item__tooltip .item__details {\n    display: block;\n}\n\n.item__details-line  {\n    display: block;\n}\n\n.item__details-line span {\n    font-weight: bold;\n}\n\n.inventory__golddisplay {\n    width: 100%;\n    height: 5%;\n    font-size: 1.5vw;\n    padding: 1%;\n}\n\n.item__tooltip {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    background: #ccc;\n    padding: 5px 10px;\n    border-radius: 5px;\n    max-width: 30%;\n    font-size: 1.5vh;\n    pointer-events: none;\n}\n\n.item__tooltip.active {\n    display: block;\n}\n\n.item__drag {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    text-align: center;\n    pointer-events: none;\n}\n\n.item__drag.active {\n    display: block;\n}\n\n.item__name {\n    font-weight: bold;\n    font-size: 2.5vh;\n}\n\n.item__description {\n    font-style: italic;\n}\n\n\n.savegame__overwrite {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: #000;\n    display: none;\n    pointer-events: none;\n    padding: 15px;\n    border-radius: 15px 0;\n}\n\n.savegame__overwrite.active {\n    display: block;\n    pointer-events: all;\n}\n\n.savegame__overwrite-title {\n    color: #fff;\n    font-size: 3vh;\n}\n\n.savegame__oldsaves,\n.loadgame__oldsaves {\n    margin-bottom: 15px;\n}\n\n.savegame__newsave-input {\n    font-size: 2.2vh;\n    display: inline-block;\n    float: left;\n    margin-right: 1vh;\n}\n\n.save {\n    text-align: left;\n    position: relative;\n    font-size: 2vh;\n    font-weight: bold;\n}\n\n.save label {\n    font-family: Lucida Console, serif;\n    display: block;\n}\n\n.save + .save {\n    margin-top: 1vh;\n}\n\n.save__title,\n.save__delete {\n    font-size: 2vh;\n}\n.save__title {\n    width: 80%;\n    display: inline-grid;\n    grid-template-columns: 2fr 1fr;\n}\n\n.save__text {\n    grid-column: 1;\n    grid-row: 1 / span 2;\n    pointer-events: none;\n}\n\n.save__date,\n.save__time {\n    font-size: 1.2vh;\n    grid-column: 2;\n    text-align: right;\n    pointer-events: none;\n}\n\n.save__date {\n    grid-row: 1;\n}\n\n.save__time {\n    grid-row: 2;\n}\n\n.save__delete {\n    width: 10%;\n    background-color: #f66;\n    font-size: 3.6vh;\n    line-height: 2.9vh;\n    font-weight: bold;\n    float: right;\n}\n\n.save__confirm {\n    width: auto;\n    display: inline-block;\n}\n\n.credits {\n    font-size: 5vh;\n    width: 100%;\n    left: 0;\n    top: 0;\n    height: 100%;\n    max-width: 100%;\n    border-radius: 0;\n}\n\n.credits .menu__content {\n    transform: translateY(30%);\n}\n\n.credits.active .menu__content {\n    transform: translateY(-100%);\n    transition: all 30s linear;\n}\n\n.credits__title {\n    font-size: 15vh;\n    margin: 0;\n}\n\n.credits__section {\n    padding: 15vh;\n}\n\n.settings input[type=checkbox] {\n    width: 2vh;\n    height: 2vh;\n}\n\n.settings input[type=number] {\n    min-width: 55px;\n    width: 4.5vh;\n}\n\n.settings .menu__actions,\n.controls .menu__actions {\n    margin-top: 3vh;\n}\n\n.controls label {\n    text-align: right;\n    padding-right: 25px;\n}\n\n.settings__section,\n.controls__section {\n    text-align: left;\n    font-size: 2vh;\n}\n\n.settings__section-title,\n.controls__section-title {\n    font-size: 3vh;\n    margin-top: 0;\n    margin-bottom: .5vh;\n    text-decoration: underline;\n}\n\n.settings__section + .settings__section,\n.controls__section + .controls__section {\n    padding-top: 15px;\n    margin-top: 15px;\n}\n\n.settings__section-inn,\n.controls__section-inn{\n    padding: 0 15px;\n}\n\n.control {\n    display: grid;\n    grid-template-columns: 1.3fr 1fr 1fr;\n}\n\n.controls__section {\n    display: inline-block;\n    width: 47%;\n    margin-right: 2%;\n}\n\n.controls__section-inn {\n    display: grid;\n}\n\n.stat__group {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    margin-top: 10px;\n}\n\n.stat {\n    display: grid;\n    grid-template-columns: 4fr 2fr 1fr;\n    text-align: center;\n    width: 97%;\n}\n\n.attribute {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    text-align: center;\n}\n\n.stat__title,\n.stat__text,\n.attribute__title,\n.attribute__value {\n    border: 2px solid #000;\n    padding: 5px;\n}\n\n.attribute + .attribute .attribute__title,\n.attribute + .attribute .attribute__value{\n    border-top: 0;\n}\n\n.stat__text,\n.attribute__value {\n    border-left: 0;\n}\n\n.stat__title {\n    text-transform: uppercase;\n    font-weight: bold;\n}\n.stat__text {\n    margin-right: 7px;\n}\n\n.stat__level {\n    display: none;\n    pointer-events: none;\n    background-color: #3a3;\n    color: #fff;\n    font-weight: bold;\n}\n\n.character.has-statpoint .stat__level {\n    display: block;\n    pointer-events: all;\n}\n\n.available-stats {\n    display: none;\n    text-align: center;\n    margin: 20px 0;\n}\n\n.character.has-statpoint .available-stats {\n    display: block;\n}\n\n.available-stats__inn {\n    border: 1px solid #000;\n    display: inline-block;\n    padding: 10px;\n}\n\n.available-stats__value {\n    margin-right: 10px;\n}\n\n.character__xp-text {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n}\n\n.character__xp-value {\n    text-align: right;\n}\n\n.character__xp-bar {\n    width: 100%;\n    height: 20px;\n    background: repeating-linear-gradient(to right, #ddd, #ddd 10%, #eee 10%, #eee 20%);\n    position: relative;\n    border: 2px solid #333;\n}\n\n.bottom-container .character__xp-bar{\n    position: absolute;\n    bottom: 32%;\n    height: 8%;\n    left: 0;\n    right: 0;\n}\n\n.character__xp-filled {\n    background-color: rgba(210, 210, 0, .6);\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n}\n\n.bottom-container {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: 75%;\n    height: 20%;\n    display: grid;\n    grid-template-columns: 1fr 3fr 1fr;\n    margin: 0 auto;\n}\n\n.bottom-container__left,\n.bottom-container__center,\n.bottom-container__right {\n    position: relative;\n}\n\n.hotbar {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: 100%;\n    height: 32%;\n    display: grid;\n    grid-template-columns: 4.5fr 1fr 4.5fr;\n    background-color: #333;\n}\n\n.spell-slots,\n.belt-slots {\n    display: grid;\n    width: 100%;\n    height: 100%;\n    grid-template-columns: repeat(6, 1fr);\n    grid-gap: 0.2vw;\n    padding: 0.2vw;\n}\n\n.spell-slot,\n.belt-slot {\n    background-color: gray;\n    text-align: center;\n    border-radius: 5px;\n}\n\n.spell-slot + .spell-slot,\n.belt-slot + .belt-slot {\n    border-left: 0;\n}\n\n.hotbar__controls {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    grid-template-rows: 35% 65%;\n    padding: 0.4vh 0 0.6vh;\n    grid-gap: 0.2vh;\n}\n\n.hotbar__controls button {\n    width: 100%;\n    height: 100%;\n    border-radius: 0;\n    font-weight: bold;\n    text-transform: uppercase;\n    line-height: 0;\n}\n\n.hotbar-inventory,\n.hotbar-character,\n.hotbar-skills {\n    width: 100%;\n    height: 100%;\n}\n.hotbar-inventory {\n    grid-row: 1;\n    grid-column: span 2;\n}\n.hotbar-character {\n    grid-row: 2;\n    grid-column: 1;\n}\n.hotbar__open-character.has-statpoint {\n    background-color: #3a3;\n    color: #fff;\n}\n.hotbar-skills {\n    grid-row: 2;\n    grid-column: 2;\n}\n.hotbar__open-skill.has-skillpoint {\n    background-color: #3a3;\n    color: #fff;\n}\n\n.pickup-slot {\n    height: 5.3vh;\n}',"",{version:3,sources:["webpack://./src/styles/style.css"],names:[],mappings:"AAAA;IACI,sBAAsB;AAC1B;;AAEA;IACI,cAAc;IACd,gBAAgB;IAChB,YAAY;IACZ,aAAa;IACb,gBAAgB;AACpB;;AAEA;IACI,iBAAiB;AACrB;;AAEA;IACI,cAAc;IACd,yBAAyB;IACzB,UAAU;IACV,oBAAoB;AACxB;;AAEA;IACI,qBAAqB;IACrB,UAAU;IACV,mBAAmB;AACvB;;AAEA;IACI,eAAe;IACf,QAAQ;IACR,OAAO;IACP,sBAAsB;IACtB,cAAc;IACd,cAAc;IACd,kBAAkB;IAClB,wBAAwB;IACxB,qBAAqB;IACrB,WAAW;AACf;;AAEA;IACI,SAAS;IACT,UAAU;IACV,eAAe;AACnB;;AAEA;IACI,eAAe;AACnB;;AAEA;IACI,mCAAmC;AACvC;;AAEA;IACI,cAAc;IACd,WAAW;IACX,iBAAiB;IACjB,2BAA2B;AAC/B;;AAEA;IACI,cAAc;IACd,cAAc;IACd,UAAU;IACV,kCAAkC;IAClC,gBAAgB;IAChB,aAAa;AACjB;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,WAAW;IACX,qBAAqB;AACzB;;AAEA;IACI,aAAa;IACb,iBAAiB;AACrB;;AAEA;IACI,eAAe;IACf,SAAS;IACT,WAAW;IACX,2BAA2B;IAC3B,YAAY;AAChB;;AAEA;IACI,cAAc;IACd,cAAc;IACd,sBAAsB;IACtB,eAAe;IACf,kBAAkB;IAClB,WAAW;AACf;;AAEA;IACI,mBAAmB;AACvB;;AAEA;IACI,eAAe;IACf,SAAS;IACT,YAAY;IACZ,2BAA2B;IAC3B,YAAY;AAChB;;AAEA;IACI,sBAAsB;IACtB,YAAY;IACZ,sBAAsB;IACtB,aAAa;AACjB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,iBAAiB;IACjB,0BAA0B;AAC9B;;AAEA;IACI,YAAY;IACZ,aAAa;AACjB;;AAEA;IACI,cAAc;IACd,WAAW;IACX,WAAW;IACX,YAAY;AAChB;;AAEA;IACI,kBAAkB;IAClB,cAAc;IACd,cAAc;IACd,UAAU;IACV,kBAAkB;IAClB,MAAM;IACN,QAAQ;IACR,sBAAsB;AAC1B;;;AAGA;IACI,gBAAgB;AACpB;AACA;IACI,cAAc;AAClB;;AAEA;IACI,sBAAsB;IACtB,0BAA0B;IAC1B,eAAe;IACf,OAAO;IACP,QAAQ;IACR,UAAU;IACV,cAAc;IACd,cAAc;IACd,UAAU;AACd;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,uBAAuB;AAC3B;;AAEA;IACI,6BAA6B;IAC7B,WAAW;AACf;;AAEA;IACI,UAAU;AACd;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,YAAY;IACZ,UAAU;AACd;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,UAAU;IACV,WAAW;AACf;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,UAAU;IACV,WAAW;AACf;;AAEA;IACI,kBAAkB;IAClB,UAAU;IACV,YAAY;IACZ,WAAW;IACX,YAAY;AAChB;;AAEA;IACI,YAAY;IACZ,6BAA6B;IAC7B,YAAY;IACZ,kBAAkB;AACtB;;AAEA;;AAEA;;AAEA;IACI,iBAAiB;IACjB,2BAA2B;AAC/B;;AAEA;;AAEA;;AAEA;IACI,iBAAiB;AACrB;;AAEA;IACI,kBAAkB;AACtB;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,yBAAyB;IACzB,iBAAiB;IACjB,eAAe;IACf,kBAAkB;AACtB;AACA;IACI,WAAW;AACf;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,kBAAkB;IAClB,OAAO;IACP,UAAU;IACV,OAAO;IACP,QAAQ;AACZ;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI,kBAAkB;IAClB,WAAW;IACX,OAAO;IACP,QAAQ;IACR,WAAW;IACX,aAAa;IACb,8BAA8B;IAC9B,gBAAgB;AACpB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,kBAAkB;IAClB,WAAW;IACX,OAAO;IACP,QAAQ;IACR,WAAW;IACX,aAAa;IACb,8BAA8B;IAC9B,gBAAgB;AACpB;;AAEA;;IAEI,YAAY;IACZ,kBAAkB;AACtB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,kBAAkB;IAClB,OAAO;IACP,QAAQ;IACR,cAAc;IACd,WAAW;IACX,WAAW;IACX,6BAA6B;AACjC;;AAEA;IACI,QAAQ;IACR,SAAS;AACb;;AAEA;IACI,yBAAyB;IACzB,MAAM;IACN,WAAW;AACf;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,QAAQ;IACR,UAAU;IACV,WAAW;IACX,2BAA2B;IAC3B,6BAA6B;IAC7B,gBAAgB;IAChB,aAAa;AACjB;;AAEA;IACI,wBAAwB;AAC5B;;AAEA;IACI,WAAW;IACX,WAAW;IACX,aAAa;IACb,gDAAgD;IAChD,6CAA6C;IAC7C,sBAAsB;IACtB,eAAe;IACf;AACJ;;AAEA;IACI,WAAW;IACX,WAAW;IACX,sBAAsB;IACtB,kBAAkB;IAClB,gBAAgB;AACpB;;AAEA;IACI,WAAW;IACX,aAAa;IACb,iDAAiD;IACjD,eAAe;IACf,cAAc;AAClB;;AAEA;IACI,oBAAoB;IACpB,YAAY;IACZ,sBAAsB;IACtB,gBAAgB;AACpB;;AAEA;IACI,sBAAsB;IACtB,kBAAkB;IAClB,kBAAkB;IAClB,kBAAkB;IAClB,6BAA6B;IAC7B,aAAa;IACb,uBAAuB;IACvB,mBAAmB;AACvB;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,OAAO;IACP,QAAQ;IACR,SAAS;IACT,WAAW;IACX,YAAY;IACZ,gBAAgB;IAChB,aAAa;IACb,aAAa;IACb,uBAAuB;IACvB,mBAAmB;AACvB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;IACZ,yBAAyB;AAC7B;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;;IAEI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,eAAe;IACf,sBAAsB;AAC1B;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,OAAO;IACP,UAAU;IACV,WAAW;IACX,4BAA4B;IAC5B,6BAA6B;IAC7B,gBAAgB;IAChB,aAAa;AACjB;;AAEA;IACI,wBAAwB;AAC5B;;AAEA;IACI,kBAAkB;IAClB,iBAAiB;IACjB,aAAa;IACb,mBAAmB;IACnB,yBAAyB;IACzB,yBAAyB;IACzB,cAAc;AAClB;;AAEA;IACI,UAAU;IACV,mBAAmB;AACvB;;AAEA;IACI,6BAA6B;IAC7B,oBAAoB;IACpB,kBAAkB;IAClB,gBAAgB;IAChB,iBAAiB;IACjB,aAAa;IACb,uBAAuB;IACvB,mBAAmB;IACnB,WAAW;AACf;;AAEA;;AAEA;;AAEA;IACI,kBAAkB;IAClB,SAAS;IACT,UAAU;IACV,gBAAgB;IAChB,WAAW;IACX,kBAAkB;AACtB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,iBAAiB;AACrB;;AAEA;IACI,WAAW;IACX,UAAU;IACV,gBAAgB;IAChB,WAAW;AACf;;AAEA;IACI,aAAa;IACb,eAAe;IACf,aAAa;IACb,gBAAgB;IAChB,iBAAiB;IACjB,kBAAkB;IAClB,cAAc;IACd,gBAAgB;IAChB,oBAAoB;AACxB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,aAAa;IACb,eAAe;IACf,aAAa;IACb,kBAAkB;IAClB,oBAAoB;AACxB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,iBAAiB;IACjB,gBAAgB;AACpB;;AAEA;IACI,kBAAkB;AACtB;;;AAGA;IACI,kBAAkB;IAClB,MAAM;IACN,OAAO;IACP,WAAW;IACX,YAAY;IACZ,sBAAsB;IACtB,aAAa;IACb,oBAAoB;IACpB,aAAa;IACb,qBAAqB;AACzB;;AAEA;IACI,cAAc;IACd,mBAAmB;AACvB;;AAEA;IACI,WAAW;IACX,cAAc;AAClB;;AAEA;;IAEI,mBAAmB;AACvB;;AAEA;IACI,gBAAgB;IAChB,qBAAqB;IACrB,WAAW;IACX,iBAAiB;AACrB;;AAEA;IACI,gBAAgB;IAChB,kBAAkB;IAClB,cAAc;IACd,iBAAiB;AACrB;;AAEA;IACI,kCAAkC;IAClC,cAAc;AAClB;;AAEA;IACI,eAAe;AACnB;;AAEA;;IAEI,cAAc;AAClB;AACA;IACI,UAAU;IACV,oBAAoB;IACpB,8BAA8B;AAClC;;AAEA;IACI,cAAc;IACd,oBAAoB;IACpB,oBAAoB;AACxB;;AAEA;;IAEI,gBAAgB;IAChB,cAAc;IACd,iBAAiB;IACjB,oBAAoB;AACxB;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,UAAU;IACV,sBAAsB;IACtB,gBAAgB;IAChB,kBAAkB;IAClB,iBAAiB;IACjB,YAAY;AAChB;;AAEA;IACI,WAAW;IACX,qBAAqB;AACzB;;AAEA;IACI,cAAc;IACd,WAAW;IACX,OAAO;IACP,MAAM;IACN,YAAY;IACZ,eAAe;IACf,gBAAgB;AACpB;;AAEA;IACI,0BAA0B;AAC9B;;AAEA;IACI,4BAA4B;IAC5B,0BAA0B;AAC9B;;AAEA;IACI,eAAe;IACf,SAAS;AACb;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,UAAU;IACV,WAAW;AACf;;AAEA;IACI,eAAe;IACf,YAAY;AAChB;;AAEA;;IAEI,eAAe;AACnB;;AAEA;IACI,iBAAiB;IACjB,mBAAmB;AACvB;;AAEA;;IAEI,gBAAgB;IAChB,cAAc;AAClB;;AAEA;;IAEI,cAAc;IACd,aAAa;IACb,mBAAmB;IACnB,0BAA0B;AAC9B;;AAEA;;IAEI,iBAAiB;IACjB,gBAAgB;AACpB;;AAEA;;IAEI,eAAe;AACnB;;AAEA;IACI,aAAa;IACb,oCAAoC;AACxC;;AAEA;IACI,qBAAqB;IACrB,UAAU;IACV,gBAAgB;AACpB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,aAAa;IACb,8BAA8B;IAC9B,gBAAgB;AACpB;;AAEA;IACI,aAAa;IACb,kCAAkC;IAClC,kBAAkB;IAClB,UAAU;AACd;;AAEA;IACI,aAAa;IACb,8BAA8B;IAC9B,kBAAkB;AACtB;;AAEA;;;;IAII,sBAAsB;IACtB,YAAY;AAChB;;AAEA;;IAEI,aAAa;AACjB;;AAEA;;IAEI,cAAc;AAClB;;AAEA;IACI,yBAAyB;IACzB,iBAAiB;AACrB;AACA;IACI,iBAAiB;AACrB;;AAEA;IACI,aAAa;IACb,oBAAoB;IACpB,sBAAsB;IACtB,WAAW;IACX,iBAAiB;AACrB;;AAEA;IACI,cAAc;IACd,mBAAmB;AACvB;;AAEA;IACI,aAAa;IACb,kBAAkB;IAClB,cAAc;AAClB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,sBAAsB;IACtB,qBAAqB;IACrB,aAAa;AACjB;;AAEA;IACI,kBAAkB;AACtB;;AAEA;IACI,aAAa;IACb,8BAA8B;AAClC;;AAEA;IACI,iBAAiB;AACrB;;AAEA;IACI,WAAW;IACX,YAAY;IACZ,mFAAmF;IACnF,kBAAkB;IAClB,sBAAsB;AAC1B;;AAEA;IACI,kBAAkB;IAClB,WAAW;IACX,UAAU;IACV,OAAO;IACP,QAAQ;AACZ;;AAEA;IACI,uCAAuC;IACvC,kBAAkB;IAClB,OAAO;IACP,MAAM;IACN,YAAY;AAChB;;AAEA;IACI,eAAe;IACf,SAAS;IACT,OAAO;IACP,QAAQ;IACR,UAAU;IACV,WAAW;IACX,aAAa;IACb,kCAAkC;IAClC,cAAc;AAClB;;AAEA;;;IAGI,kBAAkB;AACtB;;AAEA;IACI,kBAAkB;IAClB,SAAS;IACT,OAAO;IACP,QAAQ;IACR,WAAW;IACX,WAAW;IACX,aAAa;IACb,sCAAsC;IACtC,sBAAsB;AAC1B;;AAEA;;IAEI,aAAa;IACb,WAAW;IACX,YAAY;IACZ,qCAAqC;IACrC,eAAe;IACf,cAAc;AAClB;;AAEA;;IAEI,sBAAsB;IACtB,kBAAkB;IAClB,kBAAkB;AACtB;;AAEA;;IAEI,cAAc;AAClB;;AAEA;IACI,aAAa;IACb,8BAA8B;IAC9B,2BAA2B;IAC3B,sBAAsB;IACtB,eAAe;AACnB;;AAEA;IACI,WAAW;IACX,YAAY;IACZ,gBAAgB;IAChB,iBAAiB;IACjB,yBAAyB;IACzB,cAAc;AAClB;;AAEA;;;IAGI,WAAW;IACX,YAAY;AAChB;AACA;IACI,WAAW;IACX,mBAAmB;AACvB;AACA;IACI,WAAW;IACX,cAAc;AAClB;AACA;IACI,sBAAsB;IACtB,WAAW;AACf;AACA;IACI,WAAW;IACX,cAAc;AAClB;AACA;IACI,sBAAsB;IACtB,WAAW;AACf;;AAEA;IACI,aAAa;AACjB",sourcesContent:['* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0 auto;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-size: 1.2vh;\n}\n\nbody.disable-select * {\n    user-select: none;\n}\n\n.ui {\n    display: block;\n    z-index: -1000 !important;\n    opacity: 0;\n    pointer-events: none;\n}\n\n.ui.active {\n    z-index: 0 !important;\n    opacity: 1;\n    pointer-events: all;\n}\n\n.menu {\n    position: fixed;\n    left: 5%;\n    top: 5%;\n    background-color: #000;\n    min-width: 20%;\n    max-width: 30%;\n    text-align: center;\n    padding: 0.5vh 2.5vh 4vh;\n    border-radius: 15px 0;\n    color: #eee;\n}\n\n.menu--full {\n    left: 10%;\n    right: 10%;\n    max-width: none;\n}\n\n.menu hr {\n    margin: 1.5vh 0;\n}\n\n.menu.active {\n    background-color: rgba(0, 0, 0, .7);\n}\n\n.menu__title {\n    font-size: 5vh;\n    color: #fff;\n    margin: 0 0 1.5vh;\n    font-family: Georgia, serif;\n}\n\n.menu__action {\n    margin: 0 auto;\n    display: block;\n    width: 75%;\n    font-family: Lucida Console, serif;\n    font-size: 1.8vh;\n    padding: .5vh;\n}\n\n.menu__action--cancel {\n    background-color: #f33;\n}\n\n.menu__action--cancel:hover {\n    background-color: #f11;\n}\n\n.menu__action--confirm {\n    background-color: #3f3;\n}\n\n.menu__action--confirm:hover {\n    background-color: #3c3;\n}\n\n.menu__action + .menu__action {\n    margin-top: 15px;\n}\n\n.menu--full .menu__action {\n    width: auto;\n    display: inline-block;\n}\n\n.menu--full .menu__action + .menu__action {\n    margin-top: 0;\n    margin-left: 15px;\n}\n\n#editor-controls {\n    position: fixed;\n    top: 50px;\n    right: 50px;\n    background-color: chocolate;\n    padding: 1px;\n}\n\n.editor-controls__action {\n    display: block;\n    padding: 5px 0;\n    background-color: #ccc;\n    font-size: 20px;\n    text-align: center;\n    width: 45px;\n}\n\n.editor-controls__action.active {\n    border-style: inset;\n}\n\n#editor-info {\n    position: fixed;\n    top: 50px;\n    right: 200px;\n    background-color: chocolate;\n    padding: 1px;\n}\n\n.editor-info__component {\n    border: 1px solid #999;\n    padding: 5px;\n    background-color: #ccc;\n    display: none;\n}\n\n.editor-info__component.active {\n    display: block;\n}\n\n.editor-info__component + .editor-info__component {\n    border-top: 0;\n}\n\n.editor-info__label {\n    font-weight: bold;\n    text-transform: capitalize;\n}\n\n.game {\n    width: 100vw;\n    height: 100vh;\n}\n\n.view {\n    display: block;\n    float: left;\n    width: 100%;\n    height: 100%;\n}\n\n.details {\n    padding: 10px 15px;\n    font-size: 2vh;\n    display: block;\n    width: 20%;\n    position: absolute;\n    top: 0;\n    right: 0;\n    background-color: #ddd;\n}\n\n\n.details__header {\n    margin-top: 20px;\n}\n.details__line {\n    display: block;\n}\n\n.console {\n    background-color: #eee;\n    transform: translate(0, 0);\n    position: fixed;\n    left: 0;\n    right: 0;\n    width: 45%;\n    margin: 0 auto;\n    height: 12.25%;\n    bottom: 8%;\n}\n\n.console.active {\n    opacity: .95;\n}\n\n.console.animate {\n    transition: all 1s ease;\n}\n\n.console.full {\n    transform: translate(0, -10%);\n    height: 80%;\n}\n\n.console.active.full {\n    opacity: 1;\n}\n\n.console.collapsed {\n    height: 4.5%;\n}\n\n.console__button {\n    position: absolute;\n    top: 0;\n    z-index: 100;\n    opacity: 1;\n}\n\n.console__increase {\n    right: 40px;\n}\n\n.console.full .console__increase {\n    opacity: 0;\n    z-index: -1;\n}\n\n.console__decrease {\n    right: 64px;\n}\n\n.console.collapsed .console__decrease {\n    opacity: 0;\n    z-index: -1;\n}\n\n.messages__wrap {\n    position: absolute;\n    opacity: 1;\n    padding: 5px;\n    width: 100%;\n    height: 100%;\n}\n\n.messages {\n    display:flex;\n    flex-direction:column-reverse;\n    height: 100%;\n    overflow-y: scroll;\n}\n\n.messages__inn {\n\n}\n\n.message {\n    font-size: 1.66vh;\n    text-shadow: 1px 1px 0 #888;\n}\n\n.message__text {\n\n}\n\n.message__bold {\n    font-weight: bold;\n}\n\n.message__italics {\n    font-style: italic;\n}\n\n.message__amount {\n    margin-left: 1em;\n}\n\n.character-info {\n    font-family: Arial, serif;\n    font-weight: bold;\n    font-size: 15vh;\n    text-align: center;\n}\n#character-health {\n    color: #c00;\n}\n\n#character-mana {\n    color: #00c;\n}\n\n.character-info__wrap {\n    position: absolute;\n    top: 5%;\n    bottom: 5%;\n    left: 0;\n    right: 0;\n}\n\n#character-mana .character-info__wrap {\n    transform: rotate(180deg);\n}\n\n.character-info__bg {\n    position: absolute;\n    bottom: 10%;\n    left: 0;\n    right: 0;\n    z-index: 10;\n    display: flex;\n    flex-direction: column-reverse;\n    overflow: hidden;\n}\n\n#character-health .character-info__bg {\n    color: #ffe0e0;\n}\n\n.character-info__fg {\n    position: absolute;\n    bottom: 10%;\n    left: 0;\n    right: 0;\n    z-index: 20;\n    display: flex;\n    flex-direction: column-reverse;\n    overflow: hidden;\n}\n\n#character-mana .character-info__bg,\n#character-mana .character-info__fg {\n    bottom: -15%;\n    font-size: 18.75vh;\n}\n\n#character-mana .character-info__fg {\n    color: #e0e0ff;\n}\n\n.character-info__text {\n    position: absolute;\n    left: 0;\n    right: 0;\n    font-size: 3vh;\n    color: #000;\n    z-index: 30;\n    text-shadow: 1px 1px 3px #eee;\n}\n\n#character-health .character-info__text {\n    top: 38%;\n    bottom: 0;\n}\n\n#character-mana .character-info__text {\n    transform: rotate(180deg);\n    top: 0;\n    bottom: 38%;\n}\n\n.inventory {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 30%;\n    height: 80%;\n    transform: translateX(100%);\n    transition: transform 1s ease;\n    background: #fff;\n    padding: 15px;\n}\n\n.inventory.active {\n    transform: translateX(0);\n}\n\n.inventory__equipment {\n    width: 100%;\n    height: 55%;\n    display: grid;\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    grid-template-rows: repeat(4, minmax(0, 1fr));\n    background-color: #333;\n    grid-gap: 0.2vw;\n    padding: 1vh 7.5vh\n}\n\n.inventory__storage-wrap {\n    width: 100%;\n    height: 40%;\n    background-color: #333;\n    position: relative;\n    overflow-y: auto;\n}\n\n.inventory__storage {\n    width: 100%;\n    display: grid;\n    grid-template-columns: repeat(10, minmax(0, 1fr));\n    grid-gap: 0.2vw;\n    padding: 0.2vw;\n}\n\n.inventory__storage-title {\n    grid-column: span 10;\n    padding: 5px;\n    background-color: #ccc;\n    font-size: 1.8vh;\n}\n\n.slot {\n    background-color: gray;\n    text-align: center;\n    border-radius: 5px;\n    position: relative;\n    font-family: helvetica, serif;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot .item {\n    font-size: 7.5vh;\n}\n\n.inventory__equipment-slot:before {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    font-size: 7.5vh;\n    opacity: 0.15;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot.has-item:before {\n    display: none;\n}\n\n.inventory__equipment-slot[data-index="0"]:before {\n    content: "⌈";\n}\n\n.inventory__equipment-slot[data-index="1"]:before {\n    content: "∩";\n}\n\n.inventory__equipment-slot[data-index="2"]:before {\n    content: "ᴕ";\n}\n\n.inventory__equipment-slot[data-index="3"]:before {\n    content: "†";\n    transform: rotate(180deg);\n}\n\n.inventory__equipment-slot[data-index="4"]:before {\n    content: "☗";\n}\n\n.inventory__equipment-slot[data-index="5"]:before {\n    content: "●";\n}\n\n.inventory__equipment-slot[data-index="6"]:before,\n.inventory__equipment-slot[data-index="8"]:before {\n    content: "○";\n}\n\n.inventory__equipment-slot[data-index="7"]:before {\n    content: "-";\n}\n\n.inventory__equipment-slot[data-index="9"]:before {\n    content: "ひ";\n}\n\n.inventory__equipment-slot[data-index="10"]:before {\n    content: "◫";\n}\n.inventory__equipment-slot[data-index="11"]:before {\n    content: "″";\n}\n\n.inventory__storage-slot {\n    height: 5.3vh;\n}\n\n.slot.has-item:hover {\n    cursor: pointer;\n    background-color: #999;\n}\n\n.slot.disabled {\n    background-color: #845b5b;\n}\n\n.slot.dragging .item {\n    display: none;\n}\n\n.character {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 30%;\n    height: 80%;\n    transform: translateX(-100%);\n    transition: transform 1s ease;\n    background: #fff;\n    padding: 15px;\n}\n\n.character.active {\n    transform: translateX(0);\n}\n\n.character__title {\n    text-align: center;\n    font-weight: bold;\n    margin-top: 0;\n    margin-bottom: 40px;\n    text-transform: uppercase;\n    font-family: Arial, serif;\n    font-size: 3vh;\n}\n\n.character__xp {\n    width: 80%;\n    margin: 0 auto 40px;\n}\n\n.item {\n    font-family: helvetica, serif;\n    pointer-events: none;\n    position: relative;\n    font-size: 4.5vh;\n    user-select: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n}\n\n.item__icon {\n\n}\n\n.item__amount {\n    position: absolute;\n    right: 5%;\n    bottom: 5%;\n    font-size: 1.1vw;\n    color: #fff;\n    line-height: 0.7vw;\n}\n\n.item__details {\n    display: none;\n}\n\n.item__tooltip .item__details {\n    display: block;\n}\n\n.item__details-line  {\n    display: block;\n}\n\n.item__details-line span {\n    font-weight: bold;\n}\n\n.inventory__golddisplay {\n    width: 100%;\n    height: 5%;\n    font-size: 1.5vw;\n    padding: 1%;\n}\n\n.item__tooltip {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    background: #ccc;\n    padding: 5px 10px;\n    border-radius: 5px;\n    max-width: 30%;\n    font-size: 1.5vh;\n    pointer-events: none;\n}\n\n.item__tooltip.active {\n    display: block;\n}\n\n.item__drag {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    text-align: center;\n    pointer-events: none;\n}\n\n.item__drag.active {\n    display: block;\n}\n\n.item__name {\n    font-weight: bold;\n    font-size: 2.5vh;\n}\n\n.item__description {\n    font-style: italic;\n}\n\n\n.savegame__overwrite {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: #000;\n    display: none;\n    pointer-events: none;\n    padding: 15px;\n    border-radius: 15px 0;\n}\n\n.savegame__overwrite.active {\n    display: block;\n    pointer-events: all;\n}\n\n.savegame__overwrite-title {\n    color: #fff;\n    font-size: 3vh;\n}\n\n.savegame__oldsaves,\n.loadgame__oldsaves {\n    margin-bottom: 15px;\n}\n\n.savegame__newsave-input {\n    font-size: 2.2vh;\n    display: inline-block;\n    float: left;\n    margin-right: 1vh;\n}\n\n.save {\n    text-align: left;\n    position: relative;\n    font-size: 2vh;\n    font-weight: bold;\n}\n\n.save label {\n    font-family: Lucida Console, serif;\n    display: block;\n}\n\n.save + .save {\n    margin-top: 1vh;\n}\n\n.save__title,\n.save__delete {\n    font-size: 2vh;\n}\n.save__title {\n    width: 80%;\n    display: inline-grid;\n    grid-template-columns: 2fr 1fr;\n}\n\n.save__text {\n    grid-column: 1;\n    grid-row: 1 / span 2;\n    pointer-events: none;\n}\n\n.save__date,\n.save__time {\n    font-size: 1.2vh;\n    grid-column: 2;\n    text-align: right;\n    pointer-events: none;\n}\n\n.save__date {\n    grid-row: 1;\n}\n\n.save__time {\n    grid-row: 2;\n}\n\n.save__delete {\n    width: 10%;\n    background-color: #f66;\n    font-size: 3.6vh;\n    line-height: 2.9vh;\n    font-weight: bold;\n    float: right;\n}\n\n.save__confirm {\n    width: auto;\n    display: inline-block;\n}\n\n.credits {\n    font-size: 5vh;\n    width: 100%;\n    left: 0;\n    top: 0;\n    height: 100%;\n    max-width: 100%;\n    border-radius: 0;\n}\n\n.credits .menu__content {\n    transform: translateY(30%);\n}\n\n.credits.active .menu__content {\n    transform: translateY(-100%);\n    transition: all 30s linear;\n}\n\n.credits__title {\n    font-size: 15vh;\n    margin: 0;\n}\n\n.credits__section {\n    padding: 15vh;\n}\n\n.settings input[type=checkbox] {\n    width: 2vh;\n    height: 2vh;\n}\n\n.settings input[type=number] {\n    min-width: 55px;\n    width: 4.5vh;\n}\n\n.settings .menu__actions,\n.controls .menu__actions {\n    margin-top: 3vh;\n}\n\n.controls label {\n    text-align: right;\n    padding-right: 25px;\n}\n\n.settings__section,\n.controls__section {\n    text-align: left;\n    font-size: 2vh;\n}\n\n.settings__section-title,\n.controls__section-title {\n    font-size: 3vh;\n    margin-top: 0;\n    margin-bottom: .5vh;\n    text-decoration: underline;\n}\n\n.settings__section + .settings__section,\n.controls__section + .controls__section {\n    padding-top: 15px;\n    margin-top: 15px;\n}\n\n.settings__section-inn,\n.controls__section-inn{\n    padding: 0 15px;\n}\n\n.control {\n    display: grid;\n    grid-template-columns: 1.3fr 1fr 1fr;\n}\n\n.controls__section {\n    display: inline-block;\n    width: 47%;\n    margin-right: 2%;\n}\n\n.controls__section-inn {\n    display: grid;\n}\n\n.stat__group {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    margin-top: 10px;\n}\n\n.stat {\n    display: grid;\n    grid-template-columns: 4fr 2fr 1fr;\n    text-align: center;\n    width: 97%;\n}\n\n.attribute {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    text-align: center;\n}\n\n.stat__title,\n.stat__text,\n.attribute__title,\n.attribute__value {\n    border: 2px solid #000;\n    padding: 5px;\n}\n\n.attribute + .attribute .attribute__title,\n.attribute + .attribute .attribute__value{\n    border-top: 0;\n}\n\n.stat__text,\n.attribute__value {\n    border-left: 0;\n}\n\n.stat__title {\n    text-transform: uppercase;\n    font-weight: bold;\n}\n.stat__text {\n    margin-right: 7px;\n}\n\n.stat__level {\n    display: none;\n    pointer-events: none;\n    background-color: #3a3;\n    color: #fff;\n    font-weight: bold;\n}\n\n.character.has-statpoint .stat__level {\n    display: block;\n    pointer-events: all;\n}\n\n.available-stats {\n    display: none;\n    text-align: center;\n    margin: 20px 0;\n}\n\n.character.has-statpoint .available-stats {\n    display: block;\n}\n\n.available-stats__inn {\n    border: 1px solid #000;\n    display: inline-block;\n    padding: 10px;\n}\n\n.available-stats__value {\n    margin-right: 10px;\n}\n\n.character__xp-text {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n}\n\n.character__xp-value {\n    text-align: right;\n}\n\n.character__xp-bar {\n    width: 100%;\n    height: 20px;\n    background: repeating-linear-gradient(to right, #ddd, #ddd 10%, #eee 10%, #eee 20%);\n    position: relative;\n    border: 2px solid #333;\n}\n\n.bottom-container .character__xp-bar{\n    position: absolute;\n    bottom: 32%;\n    height: 8%;\n    left: 0;\n    right: 0;\n}\n\n.character__xp-filled {\n    background-color: rgba(210, 210, 0, .6);\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n}\n\n.bottom-container {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: 75%;\n    height: 20%;\n    display: grid;\n    grid-template-columns: 1fr 3fr 1fr;\n    margin: 0 auto;\n}\n\n.bottom-container__left,\n.bottom-container__center,\n.bottom-container__right {\n    position: relative;\n}\n\n.hotbar {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: 100%;\n    height: 32%;\n    display: grid;\n    grid-template-columns: 4.5fr 1fr 4.5fr;\n    background-color: #333;\n}\n\n.spell-slots,\n.belt-slots {\n    display: grid;\n    width: 100%;\n    height: 100%;\n    grid-template-columns: repeat(6, 1fr);\n    grid-gap: 0.2vw;\n    padding: 0.2vw;\n}\n\n.spell-slot,\n.belt-slot {\n    background-color: gray;\n    text-align: center;\n    border-radius: 5px;\n}\n\n.spell-slot + .spell-slot,\n.belt-slot + .belt-slot {\n    border-left: 0;\n}\n\n.hotbar__controls {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    grid-template-rows: 35% 65%;\n    padding: 0.4vh 0 0.6vh;\n    grid-gap: 0.2vh;\n}\n\n.hotbar__controls button {\n    width: 100%;\n    height: 100%;\n    border-radius: 0;\n    font-weight: bold;\n    text-transform: uppercase;\n    line-height: 0;\n}\n\n.hotbar-inventory,\n.hotbar-character,\n.hotbar-skills {\n    width: 100%;\n    height: 100%;\n}\n.hotbar-inventory {\n    grid-row: 1;\n    grid-column: span 2;\n}\n.hotbar-character {\n    grid-row: 2;\n    grid-column: 1;\n}\n.hotbar__open-character.has-statpoint {\n    background-color: #3a3;\n    color: #fff;\n}\n.hotbar-skills {\n    grid-row: 2;\n    grid-column: 2;\n}\n.hotbar__open-skill.has-skillpoint {\n    background-color: #3a3;\n    color: #fff;\n}\n\n.pickup-slot {\n    height: 5.3vh;\n}'],sourceRoot:""}]);const r=a},30:(t,e,n)=>{var s=n(3379),o=n.n(s),i=n(890);o()(i.Z,{insert:"head",singleton:!1}),i.Z.locals;var a=n(2212),r=n(3466),l=n.n(r);class c{constructor(t){this.entity=t}perform(){console.error("Not Implemented")}isPlayer(){return this.entity===es.player}}class h extends c{constructor(t,e){super(t),this.reason=e}perform(){return this}}class p{constructor(){this.previousVisibleObjects=[],this.visibleObjects=[],this.visibleActors=[],this.visibleItems=[],this.oldObjects=[],this.newObjects=[],this.left=0,this.right=0,this.top=0,this.bottom=0}teardown(){this.previousVisibleObjects=[],this.visibleObjects=[],this.visibleActors=[],this.visibleItems=[],this.oldObjects=[],this.newObjects=[]}compute(t,e,n,s){this.previousVisibleObjects=this.visibleObjects,this.visibleObjects=[],this.visibleActors=[],this.visibleItems=[],this.oldObjects=[],this.newObjects=[],this.left=Math.max(0,t-s),this.right=Math.min(es.gameMap.width,t+s+1),this.top=Math.max(0,e-s),this.bottom=Math.min(es.gameMap.height,e+s+1)}addVisibleObject(t){-1===this.visibleObjects.indexOf(t)&&this.visibleObjects.push(t),-1===this.previousVisibleObjects.indexOf(t)&&-1===this.newObjects.indexOf(t)&&this.newObjects.push(t)}addVisibleActor(t){-1===this.visibleActors.indexOf(t)&&this.visibleActors.push(t)}addVisibleItem(t){-1===this.visibleItems.indexOf(t)&&this.visibleItems.push(t)}remove(t){const e=this.newObjects.indexOf(t);e>-1&&this.newObjects.splice(e,1);const n=this.oldObjects.indexOf(t);n>-1&&this.oldObjects.splice(n,1),this.removeVisible(t)}removeVisible(t){const e=this.visibleObjects.indexOf(t);e>-1&&this.visibleObjects.splice(e,1);const n=this.visibleItems.indexOf(t);n>-1&&this.visibleItems.splice(n,1);const s=this.previousVisibleObjects.indexOf(t);s>-1&&this.previousVisibleObjects.splice(s,1)}exploreTile(t,e,n,s,o=!1){const i=es.gameMap.tiles.entries();for(const o of i)if(o[0]>=n&&o[0]<=s){const n=o[1][t];if(n){const t=n[e];t&&this.addVisibleObject(t)}}if(!o){for(const n of es.gameMap.actors){const s=n.getComponent("positionalobject");s&&s.x===t&&s.y===e&&(this.addVisibleObject(n),this.addVisibleActor(n))}for(const n of es.gameMap.items){const s=n.getComponent("positionalobject");s&&s.x===t&&s.y===e&&(this.addVisibleObject(n),this.addVisibleItem(n))}}}}class m{constructor(t,e){this.y=t,this.x=e}greater(t,e){return this.y*e>this.x*t}greaterOrEqual(t,e){return this.y*e>=this.x*t}lessOrEqual(t,e){return this.y*e<=this.x*t}}class d extends p{constructor(){super()}compute(t,e,n,s,o,i){super.compute(t,e,n,s),this.exploreTile(t,e,o,i);for(let a=0;a<8;a++)this.computeOctant(a,t,e,n,s,1,new m(1,1),new m(0,1),o,i)}computeOctant(t,e,n,s,o,i,a,r,l,c){for(;i<=o;i++){let h,p;if(1===a.x)h=i;else if(h=Math.round(((2*i-1)*a.y+a.x)/(2*a.x)),this.blocksLight(t,e,n,s,i,h))a.greaterOrEqual(2*h+1,2*i)&&!this.blocksLight(t,e,n,s,i,h+1)&&h++;else{let o=2*i;this.blocksLight(t,e,n,s,i+1,h+1)&&o++,a.greater(2*h+1,o)&&h++}0===r.y?p=0:(p=((2*i-1)*r.y+r.x)/(2*r.x),r.greaterOrEqual(2*p+1,2*i)&&this.blocksLight(t,e,n,s,i,p)&&!this.blocksLight(t,e,n,s,i,p+1)&&p++);let d=-1;for(let A=h;A>=p;A--){const u=this.blocksLight(t,e,n,s,i,A);if((u||(A!==h||a.greaterOrEqual(A,i))&&(A!==p||r.lessOrEqual(A,i)))&&this.setVisible(t,e,n,i,A,l,c),i!==o)if(u){if(0===d){const h=2*i,d=2*A+1;if(a.greater(d,h)){if(A===p){r=new m(d,h);break}this.computeOctant(t,e,n,s,o,i+1,a,new m(d,h),l,c)}else if(A===p)return}d=1}else{if(d>0){const t=2*i,e=2*A+1;if(r.greaterOrEqual(e,t))return;a=new m(e,t)}d=0}}if(0!==d)break}}blocksLight(t,e,n,s,o,i){switch(t){case 0:e+=o,n-=i;break;case 1:e+=i,n-=o;break;case 2:e-=i,n-=o;break;case 3:e-=o,n-=i;break;case 4:e-=o,n+=i;break;case 5:e-=i,n+=o;break;case 6:e+=i,n+=o;break;case 7:e+=o,n+=i}let a=!1;if(es.gameMap.tiles.has(s)){const t=es.gameMap.tiles.get(s);if(t[e]){const s=t[e][n];if(s){const t=s.getComponent("blocksFov");t&&(a=t.blocksFov)}}}return a}setVisible(t,e,n,s,o,i,a){switch(t){case 0:e+=s,n-=o;break;case 1:e+=o,n-=s;break;case 2:e-=o,n-=s;break;case 3:e-=s,n-=o;break;case 4:e-=s,n+=o;break;case 5:e-=o,n+=s;break;case 6:e+=o,n+=s;break;case 7:e+=s,n+=o}this.exploreTile(e,n,i,a)}}class A extends p{constructor(){super()}compute(t,e,n,s,o,i){super.compute(t,e,n,s,o,i);const a=Math.max(0,t-s),r=Math.min(es.gameMap.width,t+s),l=Math.max(0,e-s),c=Math.min(es.gameMap.height,e+s);for(let t=a;t<r;t++)for(let e=l;e<c;e++)this.exploreTile(t,e,o,i,!0)}}var u=n(9224);class g{constructor(t,e,n){this.text=t,this.color=e||"#333",this.bold=!1,this.italics=!1,n&&(this.bold=n.bold||!1,this.italics=n.italics||!1)}isEqual(t){return this.text===t.text&&this.color===t.color&&this.bold===t.bold&&this.italics===t.italics}}class f{constructor(t=[]){this.subMessages=t,this.count=1}isEqual(t){if(this.subMessages.length!==t.length)return!1;for(let e=0;e<this.subMessages.length;e++){const n=this.subMessages[e],s=t[e];if(!n.isEqual(s))return!1}return!0}getHtml(){const t=document.createElement("div");t.classList.add("message");for(const e of this.subMessages){const n=document.createElement("span");n.classList.add("message__text"),e.bold&&n.classList.add("message__bold"),e.italics&&n.classList.add("message__italics"),n.innerText=e.text,n.style.color=e.color,t.appendChild(n)}return this.count>1&&t.appendChild(this.getCountHtml()),t}getCountHtml(){const t=document.createElement("span");return t.classList.add("message__amount"),t.innerText="x"+this.count,t}}class v{constructor(t){this.dom=this.htmlToElement(t)}htmlToElement(t){const e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild}isOpen(){return this.dom.classList.contains("active")}open(){this.dom.classList.contains("active")||this.dom.classList.add("active")}close(){this.dom.classList.remove("active")}}const b=new class extends v{constructor(){super(u),this.messages=[],this.builder=[],this.dom.getElementsByClassName("console__increase")[0].addEventListener("click",(function(t){const e=t.target.parentElement;e.classList.contains("animate")||e.classList.add("animate"),e.classList.contains("collapsed")?e.classList.remove("collapsed"):e.classList.add("full")})),this.dom.getElementsByClassName("console__decrease")[0].addEventListener("click",(function(t){const e=t.target.parentElement;e.classList.contains("animate")||e.classList.add("animate"),e.classList.contains("full")?e.classList.remove("full"):e.classList.add("collapsed")})),this.messagesInnerDom=this.dom.getElementsByClassName("messages__inn")[0]}text(t,e,n){return this.builder.push(new g(t,e,n)),this}build(t=!0){this.addMessage(this.builder.slice(0),t),this.builder=[]}clear(){this.messagesInnerDom.innerHTML="",this.messages=[]}addMessage(t,e=!0){if(e&&this.messages.length>0){const e=this.messages[this.messages.length-1];e.isEqual(t)?(e.count+=1,this.updateLastMessageCount(e)):(this.messages.push(new f(t)),this.addNewMessage())}else this.messages.push(new f(t)),this.addNewMessage()}updateLastMessageCount(t){const e=document.querySelectorAll(".message:last-child")[0],n=e.querySelectorAll(".message__amount")[0];n?n.innerText="x"+t.count:e.appendChild(t.getCountHtml())}addNewMessage(){const t=this.messages[this.messages.length-1];this.messagesInnerDom.appendChild(t.getHtml())}close(){super.close(),this.dom.classList.remove("animate")}};class y extends c{constructor(t){super(t)}perform(){return this}}var C=n(1372);const x=new class extends v{constructor(){super(C)}updatePlayerDetails(){this.updatePositionDetails(es.player,!0)}getPosition(t){const e=t.getComponent("positionalobject");return"<span class='details__line'>Looking at: X:"+e.x+" - Y:"+e.y+"</span>"}updatePositionOnly(t){this.dom.innerHTML=this.getPosition(t)}updatePositionDetails(t,e=!1){if(!t)return;const n=t.getComponent("positionalobject"),s=n.x,o=n.y,i=n.z;let a=i-1;t!==es.player&&(a=i);let r=this.getPosition(t);const l=es.gameMap.tiles;for(let t=a;t<=i;t++)if(l.get(t)&&l.get(t)[s]){const e=l.get(t)[s][o];e&&(r+="<span class='details__line'>"+e.name+"</span>")}for(const t of es.gameMap.actors){if(e&&t===es.player)continue;const n=t.getComponent("positionalobject");if(n&&n.isVisible()&&s===n.x&&o===n.y&&Math.abs(i-n.z)<2){r+="<span class='details__line'><span style='color:"+n.color+"'>"+n.letter+"</span>: "+t.name;const e=t.getComponent("fighter");e&&(r+=" "+e.getHealthDescription()),r+="</span>"}}const c=[];for(const t of es.gameMap.items){const e=t.getComponent("positionalobject");e&&e.isVisible()&&s===e.x&&o===e.y&&Math.abs(i-e.z)<2&&c.push("<span class='details__line'><span style='color:"+e.color+"'>"+e.letter+"</span>: "+t.name+"</span>")}c.length>0&&(r+="<span class='details__line details__header'>Items:</span>");for(const t of c)r+=t;const h=[];for(const t of es.fov.visibleActors)t!==es.player&&t.isAlive()&&t.getComponent("positionalobject")&&h.push(t);if(h.length>0){r+="<span class='details__line details__header'>Nearby:</span>";for(const t of h){const e=t.getComponent("positionalobject");if(e){r+="<span class='details__line'>",r+="<span style='color:"+e.color+"'>"+e.letter+"</span>: "+t.name;const n=t.getComponent("fighter");n&&(r+=" "+n.getHealthDescription()),r+="</span>"}}}this.dom.innerHTML=r}};class I{constructor(){this.raycaster=new a.iMs,this.mouse=new a.FM8,this.mouseDown=!1,window.addEventListener("mousemove",this),window.addEventListener("mousedown",this),window.addEventListener("mouseup",this),window.addEventListener("click",this),window.addEventListener("contextmenu",this),window.addEventListener("change",this),window.addEventListener("keydown",this),this.isPlayerTurn=!0,this.highlightedTiles=[]}teardown(){window.removeEventListener("mousemove",this),window.removeEventListener("mousedown",this),window.removeEventListener("mouseup",this),window.removeEventListener("click",this),window.removeEventListener("contextmenu",this),window.removeEventListener("change",this),window.removeEventListener("keydown",this),this.clearHighlights()}handleEvent(t){switch(t.type){case"mousemove":this.onMouseMove(t);break;case"mousedown":this.onMouseDown(t);break;case"mouseup":this.onMouseUp(t);break;case"click":this.onLeftClick(t);break;case"contextmenu":this.onRightClick(t);break;case"change":this.onChange(t);break;case"keydown":this.onKeydown(t)}}handleInput(){}onMouseMove(){}onMouseDown(){this.mouseDown=!0}onMouseUp(){this.mouseDown=!1}onLeftClick(){}onRightClick(){}onChange(){}onKeydown(){}getMouseIntersectingObjects(t){return this.mouse.x=t.clientX/as.canvasDom.offsetWidth*2-1,this.mouse.y=-t.clientY/as.canvasDom.offsetHeight*2+1,this.raycaster.setFromCamera(this.mouse,as.camera),this.raycaster.intersectObject(as.scene,!0)}isHighlighted(t){for(const e of this.highlightedTiles)if(t===e)return!0;return!1}clearAndSetHighlights(t){this.clearHighlights();for(const e of t){const t=e.getComponent("positionalobject");t&&(t.highlight(),this.highlightedTiles.push(e))}es.needsMapUpdate=!0}clearAndSetHighlight(t){this.clearHighlights();const e=t.getComponent("positionalobject");e&&(e.highlight(),this.highlightedTiles.push(t)),x.updatePositionDetails(t),es.needsMapUpdate=!0}clearHighlights(t=!1){for(const t of this.highlightedTiles){const e=t.getComponent("positionalobject");e&&e.removeHighlight()}this.highlightedTiles=[],t&&x.updatePlayerDetails(),es.needsMapUpdate=!0}}const _="ArrowLeft",w="ArrowRight",B="ArrowUp",E="ArrowDown",k="Backspace",M="Enter",S="Left Shift",z="Right Shift",j="Left Control",D="Right Control",O="Left Alt",T="Right Alt",P="Escape",L="Numpad Enter",R="Numpad .",N="Numpad 0",F="Numpad 1",q="Numpad 2",W="Numpad 3",U="Numpad 4",Y="Numpad 5",H="Numpad 6",V="Numpad 7",X="Numpad 8",G="Numpad 9",Z="Numpad Delete",Q="Numpad Insert",J="Numpad End",K="Numpad ArrowDown",$="Numpad PageDown",tt="Numpad ArrowLeft",et="Numpad Clear",nt="Numpad ArrowRight",st="Numpad Home",ot="Numpad ArrowUp",it="Numpad PageUp",at=new class{constructor(){const t=this;t.defaultDelay=25,t.lastShiftUp=null,t.treatShiftNumpadEqual=!0,t.keysDown=[],t.keysDelayed=[],t.defaults=new Map,t.controls=new Map,t.defaults.set("left",[U,_]),t.defaults.set("right",[H,w]),t.defaults.set("up",[X,B]),t.defaults.set("down",[q,E]),t.defaults.set("editor-left",[_]),t.defaults.set("editor-right",[w]),t.defaults.set("editor-up",[B]),t.defaults.set("editor-down",[E]),t.defaults.set("nw",[V]),t.defaults.set("ne",[G]),t.defaults.set("sw",[F]),t.defaults.set("se",[W]),t.defaults.set("wait",[Y]),t.defaults.set("get",["g"]),t.defaults.set("inventory",["i"]),t.defaults.set("character",["c"]),t.defaults.set("closeall",["`"]),t.defaults.set("look",["/"]),t.defaults.set("pause",["p",P]),t.defaults.set("interact",[M,L]),t.defaults.set("confirm",[M,L]),t.defaults.set("cancel",[P,k]),t.defaults.set("modifier-speed1",[S,z]),t.defaults.set("modifier-speed2",[j,D]),t.defaults.set("modifier-speed3",[O,T]),t.defaults.set("quicksave",["F8"]),t.defaults.set("quickload",["F9"]),t.defaults.set("debug",["F2"]),t.defaults.set("debug2",["F4"]),t.defaults.set("reset",["r"]),t.load(),addEventListener("keydown",(function(e){"/"===e.key&&e.preventDefault(),t.treatShiftNumpadEqual&&e.getModifierState("NumLock")&&!e.shiftKey&&e.code.startsWith("Numpad")&&e.keyCode<90&&t.lastShiftUp&&(t.keysDown[t.lastShiftUp]=!0);const n=t.getKey(e.key,e.code);t.keysDown[n]=!0}),!1),addEventListener("keyup",(function(e){const n=t.getKey(e.key,e.code);n!==S&&n!==z||(t.lastShiftUp=n),delete t.keysDown[n],delete t.keysDelayed[n]}),!1)}getKey(t,e){if(e.startsWith("Arrow")||(e.endsWith("Left")?t="Left "+t:e.endsWith("Right")?t="Right "+t:e.startsWith("Numpad")&&(t="Numpad "+t)),this.treatShiftNumpadEqual)switch(t){case Z:t=R;break;case Q:t=N;break;case J:t=F;break;case K:t=q;break;case $:t=W;break;case tt:t=U;break;case et:t=Y;break;case nt:t=H;break;case st:t=V;break;case ot:t=X;break;case it:t=G}return t}load(){const t=localStorage.getItem("controls");t?this.controls=new Map(JSON.parse(t)):this.resetToDefault()}save(){localStorage.setItem("controls",JSON.stringify(Array.from(this.controls.entries())))}setControls(t){this.controls=new Map;for(const[e,n]of t.entries()){const t=[];for(const e of n)t.push(e);this.controls.set(e,t)}this.save()}resetToDefault(){this.setControls(this.defaults)}clone(){const t=new Map;for(const[e,n]of this.controls.entries()){const s=[];for(const t of n)s.push(t);t.set(e,s)}return t}isPressed(t){const e=this;let n=!1,s=e.controls.get(t);if(!s){const n=e.defaults.get(t);n?(e.controls.set(t,n),e.save(),s=n):console.error("Missing keybindings for: ",t,s)}return s.forEach((function(t){t in e.keysDown&&(n=!0)})),n}isDelayed(t){const e=this;let n=!1;return this.controls.get(t).forEach((function(t){t in e.keysDelayed&&(n=!0)})),n}deleteKey(t,e){const n=this;n.controls.get(t).forEach((function(t){delete n.keysDown[t],e&&(n.keysDelayed[t]=!0)})),e&&setTimeout((function(){n.controls.get(t).forEach((function(t){delete n.keysDelayed[t]}))}),e)}testPressed(t,e){e=e||this.defaultDelay;const n=this;let s=!1;return n.isPressed(t)&&!n.isDelayed(t)&&(n.deleteKey(t,e),s=!0),s}};class rt{constructor(){}static create2dArray(t){const e=[];for(let n=0;n<t;n++)e[n]=[];return e}}class lt{constructor(t={},e,n){this.baseType=e||"component",this.type=n||this.baseType,this.parentEntity=t.parentEntity,this.cachedSave=null}save(){return null}clearSaveCache(){this.cachedSave=null,this.parentEntity&&this.parentEntity.clearSaveCache()}getDescription(){return""}isPlayer(){return this.parentEntity===es.player}parseRandFloat(t,e){let n;if("string"==typeof t)if(-1!==t.indexOf(",")){const e=t.split(",");n=parseFloat(a.M8C.randFloat(parseFloat(e[0].trim()),parseFloat(e[1].trim())).toFixed(2))}else n=parseFloat(t)||e;else n=t||e;return n}parseRandInt(t,e){let n;if("string"==typeof t)if(-1!==t.indexOf(",")){const e=t.split(",");n=a.M8C.randInt(parseInt(e[0].trim()),parseInt(e[1].trim()))}else n=parseInt(t)||e;else n=t||e;return n}parseRandIntBetween(t){if("string"==typeof t){const e=t.trim().split("-");return e.length>1?a.M8C.randInt(parseInt(e[0].trim()),parseInt(e[1].trim())):parseInt(e[0].trim())}return t}}var ct=n(7970);class ht extends lt{constructor(t={},e){super(t,"positionalobject",e);const n=t.components&&t.components.positionalobject;if(this.object=null,this.meshes=[],this.highlighted=!1,this.width=5,this.height=5,this.depth=5,this.scale=1,this.x=0,this.y=0,this.z=0,this.color="#ffffff",this.opacity=1,this.xRot=0,this.yRot=0,this.zRot=0,this.xOffset=0,this.yOffset=0,this.zOffset=0,this.size=1,this.actorZOffset=0,this.deathAnimation=null,n){const e=t.components.positionalobject;this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this.color=e.color||"#ffffff",void 0!==e.opacity&&(this.opacity=e.opacity),this.scale=this.parseRandFloat(e.scale,1),this.xRot=this.parseRandFloat(e.xRot,0),this.yRot=this.parseRandFloat(e.yRot,0),this.zRot=this.parseRandFloat(e.zRot,0),this.xOffset=this.parseRandFloat(e.xOffset,0),this.yOffset=this.parseRandFloat(e.yOffset,0),this.zOffset=this.parseRandFloat(e.zOffset,0),this.size=this.parseRandFloat(e.size,1),this.actorZOffset=this.parseRandFloat(e.actorZOffset,0)}this.transparency=1}save(){if(this.cachedSave)return this.cachedSave;const t={positionalobject:{}};return this.parentEntity&&this.parentEntity instanceof je?0!==this.actorZOffset&&(t.positionalobject.actorZOffset=this.actorZOffset):(t.positionalobject.x=this.x,t.positionalobject.y=this.y,t.positionalobject.z=this.z),0!==this.xRot&&(t.positionalobject.xRot=this.xRot),0!==this.yRot&&(t.positionalobject.yRot=this.yRot),0!==this.zRot&&(t.positionalobject.zRot=this.zRot),0!==this.xOffset&&(t.positionalobject.xOffset=this.xOffset),0!==this.yOffset&&(t.positionalobject.yOffset=this.yOffset),0!==this.zOffset&&(t.positionalobject.zOffset=this.zOffset),"#ffffff"!==this.color&&(t.positionalobject.color=this.color),1!==this.opacity&&(t.positionalobject.opacity=this.opacity),1!==this.scale&&(t.positionalobject.scale=this.scale),1!==this.size&&(t.positionalobject.size=this.size),this.cachedSave=t,t}createObject(){}teardown(){this.deathAnimation&&this.deathAnimation.stop(),this.hasObject()&&as.scene.remove(this.object),this.object=void 0,this.meshes=[]}onMapTeardown(){this.teardown()}resetColor(){for(const t of this.meshes)t.material.color.set(t.originalColor)}shiftColor(t){for(const e of this.meshes)e.material.transparent=!0,e.material.color.multiplyScalar(t)}setTransparency(t=1){this.transparency=t;const e=t*this.opacity;for(const t of this.meshes)t.material.transparent=e<1,t.material.opacity=e}getObjectPosition(){return new a.Pa4((this.x+this.xOffset)*this.width,(this.y+this.yOffset)*this.height,(this.z+this.zOffset)*this.depth-(this.depth-this.scale*this.depth)/2)}updateObjectPosition(){if(this.hasObject()){let t=this.zOffset;if("actor"===this.parentEntity.type||"item"===this.parentEntity.type){const e=es.gameMap.tiles.get(this.z)[this.x][this.y];e&&(t+=e.getComponent("positionalobject").actorZOffset)}this.object.position.set((this.x+this.xOffset)*this.width,(this.y+this.yOffset)*this.height,(this.z+t)*this.depth-(this.depth-this.scale*this.depth)/2),this.object.rotation.set(Math.PI*this.xRot,Math.PI*this.yRot,Math.PI*this.zRot)}}hasObject(){return null!==this.object&&void 0!==this.object}setVisible(t=!0){t&&!this.hasObject()&&(this.createObject(),as.scene.add(this.object)),this.hasObject()&&(t&&!this.object.visible?this.object.visible=!0:!t&&this.object.visible&&(this.object.visible=!1))}isVisible(){return this.hasObject()&&this.object.visible}highlight(){this.highlighted||(this.hasObject()&&this.shiftColor(2.5),this.highlighted=!0)}removeHighlight(){if(this.highlighted){if(this.hasObject()){for(const t of this.meshes)t.material.color.set(t.originalColor);const t=this.parentEntity;if(t){const e=t.getComponent("fov");e&&e.explored&&!e.visible&&this.shiftColor(.5)}}this.highlighted=!1}}move(t,e=0,n=0){this.x+=t,this.y+=e,this.z+=n,this.clearSaveCache(),this.updateObjectPosition(),this.parentEntity.callEvent("onEntityMove")}moveTo(t,e=this.y,n=this.z,s=!0){this.x=t,this.y=e,this.z=n,this.clearSaveCache(),this.updateObjectPosition(),s&&this.parentEntity.callEvent("onEntityMove")}updateRotation(t,e=this.yRot,n=this.zRot){this.xRot=t,this.yRot=e,this.zRot=n,this.clearSaveCache()}updateOffsets(t,e=this.yOffset,n=this.zOffset){this.xOffset=t,this.yOffset=e,this.zOffset=n,this.clearSaveCache()}updateZOffset(t){this.zOffset=t,this.clearSaveCache()}distance(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}horizontalDistance(t){return Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))}isSamePosition(t){return!!t&&this.x===t.x&&this.y===t.y&&this.z===t.z}onEntityDeath(){const t=this,e={xRot:this.xRot,yRot:this.yRot,zRot:this.zRot,zOffset:this.zOffset},n={xRot:0,yRot:0,zRot:2*Math.random(),zOffset:0};this.deathAnimation=new ct.w.Tween(e).to(n,200),this.deathAnimation.onUpdate((function(){t.updateRotation(e.xRot,e.yRot,e.zRot),t.updateZOffset(e.zOffset),t.updateObjectPosition(),es.needsMapUpdate=!0})),this.deathAnimation.start()}}class pt{constructor(){}static extend(t){t=t||{};for(let e=1;e<arguments.length;e++)if(arguments[e])for(const n in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],n)&&(t[n]=arguments[e][n]);return t}static deep(t){t=t||{};for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&("object"==typeof n[e]?n[e]instanceof Array?t[e]=n[e].slice(0):t[e]=pt.deep(t[e],n[e]):"boolean"==typeof t&&void 0===t[e]?t=n[e]:t[e]=n[e])}return t}}const mt=[];class dt extends ht{constructor(t={}){t.components&&t.components.solidobject&&(t.components.positionalobject=t.components.positionalobject||{},t.components.positionalobject=pt.extend(t.components.positionalobject,t.components.solidobject)),super(t,"solidobject")}save(){if(this.cachedSave)return this.cachedSave;const t=super.save();return t.solidobject={},this.cachedSave=t,this.cachedSave}createObject(){this.meshes=[];const t=this.scale*this.depth;let e=!1;for(const n of mt)if(n.parameters.depth===t){this.geometry=n,e=!0;break}e||(this.geometry=new a.nvb(this.width,this.height,t),mt.push(this.geometry)),this.object=new a.Kj0(this.geometry,new a.YBo({color:this.color})),this.object.originalColor=this.color,this.meshes.push(this.object),this.updateObjectPosition(),this.object.parentEntity=this.parentEntity}}var At=n(6456),ut=n(773),gt=n(5306),ft=n(4507);const vt=[],bt=new Map;class yt extends ht{constructor(t={}){const e=t.components&&t.components.characterobject;if(e&&(t.components.positionalobject=t.components.positionalobject||{},t.components.positionalobject=pt.extend(t.components.characterobject,t.components.positionalobject)),super(t,"characterobject"),this.fontName="helvetiker",this.letter="@",this.centered=!0,this.characters=[],e){const e=t.components.characterobject;this.fontName=e.fontName||"helvetiker",this.letter=e.letter||"@",void 0!==e.centered&&(this.centered=e.centered),void 0!==e.characters&&(this.characters=e.characters)}switch(this.fontName){case"mplus":bt.has(this.fontName)||bt.set(this.fontName,new a.Zxw(gt)),this.font=bt.get(this.fontName);break;case"helvetiker":bt.has(this.fontName)||bt.set(this.fontName,new a.Zxw(At)),this.font=bt.get(this.fontName);break;case"jetbrains":bt.has(this.fontName)||bt.set(this.fontName,new a.Zxw(ut)),this.font=bt.get(this.fontName);break;case"pressStart":default:bt.has(this.fontName)||bt.set(this.fontName,new a.Zxw(ft)),this.font=bt.get(this.fontName)}}save(){if(this.cachedSave)return this.cachedSave;const t={};"helvetiker"!==this.fontName&&(t.fontName=this.fontName),"@"!==this.letter&&(t.letter=this.letter),!0!==this.centered&&(t.centered=this.centered),this.characters.length>0&&(t.characters=JSON.stringify(this.characters));const e=super.save();return e.characterobject=t,this.cachedSave=e,this.cachedSave}createObject(){if(super.createObject(),this.meshes=[],this.characters.length>0){this.object=new a.ZAu,this.object.originalColor=this.color;for(const t of this.characters){const e=t.letter||this.letter,n=t.color||this.color;let s,o,i,a;s=void 0!==t.scale?t.scale:this.scale,o=void 0!==t.depth?t.depth:this.depth,i=void 0!==t.size?t.size:this.size,a=t.fontName?bt.get(t.fontName):this.font,this.object.add(this.createMesh(s,o,i,a,e,n,t))}}else this.object=this.createMesh(this.scale,this.depth,this.size,this.font,this.letter,this.color);this.setTransparency(),this.updateObjectPosition()}createMesh(t,e,n,s,o,i,r){const l=t*e,c=.82*e*n;let h=!1;for(const t of vt){const e=t.cachedFamilyName===s.data.familyName,n=t.cachedSize===c;if(e&&n&&t.cachedHeight===l&&t.cachedLetter===o&&t.cachedCentered===this.centered){this.geometry=t,h=!0;break}}h||(this.geometry=new a.MP$(o,{font:s,size:c,height:l,curveSegments:12,bevelEnabled:!0,bevelThickness:.05,bevelSize:.05,bevelOffset:0,bevelSegments:1}),this.geometry.cachedFamilyName=s.data.familyName,this.geometry.cachedSize=c,this.geometry.cachedHeight=l,this.geometry.cachedLetter=o,this.geometry.cachedCentered=this.centered,this.centered&&this.geometry.center(),vt.push(this.geometry));const p=new a.Kj0(this.geometry,new a.YBo({color:i}));if(r){let t,e;if(void 0!==r.xOffset&&p.translateX(r.xOffset*this.width),void 0!==r.yOffset&&p.translateY(r.yOffset*this.height),void 0!==r.zOffset&&p.translateZ(r.zOffset*this.depth),void 0!==r.xRot&&p.rotateX(r.xRot*Math.PI),void 0!==r.yRot&&p.rotateY(r.yRot*Math.PI),void 0!==r.zRot&&p.rotateZ(r.zRot*Math.PI),void 0!==r.animateIn){const n=r.animateIn,s=n.start.scale;void 0!==s&&(p.scale.x=s,p.scale.y=s,p.scale.z=s),e=this.setupAnimation(p,n),t=e}if(void 0!==r.animations){let n;for(const e of r.animations){const s=this.setupAnimation(p,e);t&&t.chain(s),t=s,n||(n=s)}t.chain(n),e||n.start()}e&&e.start()}return p.originalColor=i,p.parentEntity=this.parentEntity,this.meshes.push(p),p}setupAnimation(t,e){let n;n=void 0!==e.time?e.time:500;const s={x:e.end.scale,y:e.end.scale,z:e.end.scale},o=new ct.w.Tween(t.scale).to(s,n);return o.onUpdate((function(){const n=(ct.w.now()-this._startTime)/this._duration;void 0!==e.zRotation&&(t.rotation.z=e.zRotation*n*2*Math.PI),es.needsMapUpdate=!0})),o}}class Ct extends lt{constructor(t={}){super(t,"blocksMovement");const e=t.components&&void 0!==t.components.blocksMovement;if(this.blocksMovement=!1,e){const e=typeof t.components.blocksMovement;"boolean"===e?this.blocksMovement=t.components.blocksMovement:"object"===e&&t.components.blocksMovement&&(this.blocksMovement=t.components.blocksMovement.blocksMovement)}}save(){if(this.cachedSave)return this.cachedSave;let t;return t=this.blocksMovement?{blocksMovement:this.blocksMovement}:{},this.cachedSave=t,t}onEntityDeath(){this.blocksMovement=!1,this.clearSaveCache()}}class xt extends lt{constructor(t={}){super(t,"walkable");const e=t.components&&void 0!==t.components.walkable;if(this.walkable=!1,e){const e=typeof t.components.walkable;"boolean"===e?this.walkable=t.components.walkable:"object"===e&&t.components.walkable&&(this.walkable=t.components.walkable.walkable)}}save(){if(this.cachedSave)return this.cachedSave;const t={walkable:this.walkable};return this.cachedSave=t,t}}class It extends lt{constructor(t={}){super(t,"fov");const e=t.components&&t.components.fov;this.explored=!1,this.visible=!1,e&&(this.explored=t.components.fov.explored||!1,this.visible=t.components.fov.visible||!1)}save(){if(this.cachedSave)return this.cachedSave;let t;return t=this.explored?{fov:{explored:this.explored}}:{},this.cachedSave=t,t}setExplored(t){this.explored=t,this.clearSaveCache()}setVisible(t){this.visible=t}}class _t extends lt{constructor(t={}){super(t,"blocksFov");const e=t.components&&void 0!==t.components.blocksFov;if(this.blocksFov=!1,e){const e=typeof t.components.blocksFov;"boolean"===e?this.blocksFov=t.components.blocksFov:"object"===e&&t.components.blocksFov&&(this.blocksFov=t.components.blocksFov.blocksFov)}}save(){if(this.cachedSave)return this.cachedSave;let t;return t=this.blocksFov?{blocksFov:this.blocksFov}:{},this.cachedSave=t,t}}const wt=Object.freeze({Floor:0,Wall:1,DecorativeBG:2,Decorative:2.05});class Bt extends lt{constructor(t={}){super(t,"openable");const e=t.components&&t.components.openable;this.isOpen=!1,this.openEntity=null,this.closedEntity=null,e&&(this.isOpen=t.components.openable.isOpen||!1,this.openEntity=t.components.openable.openEntity,this.closedEntity=t.components.openable.closedEntity)}save(){if(this.cachedSave)return this.cachedSave;const t={openable:{isOpen:this.isOpen,openEntity:this.openEntity,closedEntity:this.closedEntity}};return this.cachedSave=t,t}open(){if(!this.isOpen){this.isOpen=!0;const t=this.parentEntity.getComponent("positionalobject");return t&&(t.teardown(),this.parentEntity=on.createFromTemplate(this.openEntity,{components:{positionalobject:{x:t.x,y:t.y,z:t.z}}}),es.gameMap.tiles.get(wt.Wall)[t.x][t.y]=this.parentEntity),this.clearSaveCache(),!0}return!1}close(){if(this.isOpen){this.isOpen=!1;const t=this.parent.getComponent("positionalobject");return t&&(t.teardown(),this.parentEntity=on.create(this.closedEntity,{components:{positionalobject:{x:t.x,y:t.y,z:t.z}}}),es.gameMap.tiles.get(wt.Wall)[t.x][t.y]=this.parent),this.clearSaveCache(),!0}return!1}}class Et extends lt{constructor(t={}){super(t,"visibilityModifier");const e=t.components&&void 0!==t.components.visibilityModifier;if(this.modifier="+",this.amount=0,e){const e=t.components.visibilityModifier;e.modifier&&(this.modifier=e.modifier),this.amount=e.amount}}save(){if(this.cachedSave)return this.cachedSave;const t={visibilityModifier:{modifier:this.modifier,amount:this.amount}};return this.cachedSave=t,t}getVisibility(t){switch(this.modifier){case"+":default:return t+this.amount;case"-":return t-this.amount;case"*":return t*this.amount;case"/":return t/this.amount}}}class kt extends lt{constructor(t={},e){super(t,"ai",e)}save(){return null}perform(){console.error("Not Implemented")}onMeleeAttack(t){const e=this.parentEntity,n=e.getComponent("positionalobject");if(n){e.stopCombatAnimations();const s=t.getComponent("positionalobject");if(n&&n.hasObject()&&s&&s.hasObject()){const t=new a.Pa4(n.object.position.x,n.object.position.y,n.object.position.z),o=new a.Pa4((n.object.position.x+s.object.position.x)/2,(n.object.position.y+s.object.position.y)/2,(n.object.position.z+s.object.position.z)/2),i=t.clone(),r=new ct.w.Tween(i).to(o,100);r.onUpdate((function(){n.hasObject()?(n.object.position.x=i.x,n.object.position.y=i.y,n.object.position.z=i.z,es.needsMapUpdate=!0):this.stop()}));const l=new ct.w.Tween(i).to(t,100);l.onUpdate((function(){n.hasObject()?(n.object.position.x=i.x,n.object.position.y=i.y,n.object.position.z=i.z,es.needsMapUpdate=!0):this.stop()})),r.chain(l),r.start(),e.combatTweens.push(r),e.combatTweens.push(l)}}}onEntityMove(){this.parentEntity.stopCombatAnimations()}}class Mt extends kt{constructor(t={}){super(t,"aiDead");const e=t.components&&void 0!==t.components.aiDead;if(this.previousAI="",e){const e=t.components.aiDead;e&&e.previousAI&&(this.previousAI=e.previousAI)}}save(){if(this.cachedSave)return this.cachedSave;const t={aiDead:{previousAI:this.previousAI}};return this.cachedSave=t,t}perform(){}}var St=n(808);const zt=new class extends v{constructor(){super(St)}};class jt extends I{constructor(){super(),zt.open()}teardown(){super.teardown(),zt.close()}onLeftClick(t){t.target.classList.contains("menu__return")&&this.returnToMainMenu()}returnToMainMenu(){es.setEventHandler(new Kn)}}var Dt=n(8286);const Ot=new class extends v{constructor(){super(Dt),this.fgDom=this.dom.getElementsByClassName("character-info__fg")[0],this.textDom=this.dom.getElementsByClassName("character-info__text")[0]}update(t,e){const n=t/e*80.5;this.fgDom.style.height=n+"%",this.textDom.innerText=t+" / "+e}};var Tt=n(9737);const Pt=new class extends v{constructor(){super(Tt),this.fgDom=this.dom.getElementsByClassName("character-info__fg")[0],this.textDom=this.dom.getElementsByClassName("character-info__text")[0]}update(t,e){const n=t/e*76.5;this.fgDom.style.height=100-n+"%",this.textDom.innerText=t+" / "+e}};var Lt=n(3073);const Rt=new class extends v{constructor(){super(Lt),this.strengthDom=this.dom.getElementsByClassName("stat--strength")[0].getElementsByClassName("stat__text")[0],this.damageDom=this.dom.getElementsByClassName("attribute--damage")[0].getElementsByClassName("attribute__value")[0],this.agilityDom=this.dom.getElementsByClassName("stat--agility")[0].getElementsByClassName("stat__text")[0],this.defenseDom=this.dom.getElementsByClassName("attribute--defense")[0].getElementsByClassName("attribute__value")[0],this.blockChanceDom=this.dom.getElementsByClassName("attribute--blockchance")[0].getElementsByClassName("attribute__value")[0],this.constitutionDom=this.dom.getElementsByClassName("stat--constitution")[0].getElementsByClassName("stat__text")[0],this.healthDom=this.dom.getElementsByClassName("attribute--health")[0].getElementsByClassName("attribute__value")[0],this.healingBonusDom=this.dom.getElementsByClassName("attribute--healing-bonus")[0].getElementsByClassName("attribute__value")[0],this.wisomDom=this.dom.getElementsByClassName("stat--wisdom")[0].getElementsByClassName("stat__text")[0],this.manaDom=this.dom.getElementsByClassName("attribute--mana")[0].getElementsByClassName("attribute__value")[0],this.availableStatPointsDom=this.dom.getElementsByClassName("available-stats__value")[0],this.levelDom=this.dom.getElementsByClassName("character__level-value")[0],this.currentXpDom=this.dom.getElementsByClassName("character__current-xp")[0],this.neededXpDom=this.dom.getElementsByClassName("character__needed-xp")[0],this.xpFilledDom=this.dom.getElementsByClassName("character__xp-filled")[0]}populate(t){const e=t.getComponent("fighter");this.strengthDom.innerText=e.strength,this.damageDom.innerText=e.getDamageDisplay(),this.agilityDom.innerText=e.agility,this.defenseDom.innerText=e.defense,this.blockChanceDom.innerText=e.blockChance+"%",this.constitutionDom.innerText=e.constitution,this.healthDom.innerText=e.hp+" / "+e.maxHp,this.healingBonusDom.innerText=e.healingBonus,this.wisomDom.innerText=e.wisdom,this.manaDom.innerText=e.mana+" / "+e.maxMana;const n=t.getComponent("level");n.statPointsAvailable?this.dom.classList.add("has-statpoint"):this.dom.classList.remove("has-statpoint"),this.availableStatPointsDom.innerText=n.statPointsAvailable,this.levelDom.innerText=n.level,this.currentXpDom.innerText=n.xp,this.neededXpDom.innerText=n.xpForLevel(n.level),this.xpFilledDom.style.width=n.getPercentXPTowardsLevel()+"%"}toggle(){this.isOpen()?this.close():(this.populate(es.player),this.open())}};class Nt extends lt{constructor(t={}){super(t,"fighter");const e=t.components&&void 0!==t.components.fighter;if(this.baseStrength=0,this.baseDamage=0,this.baseAgility=0,this.baseDefense=0,this.baseConstitution=0,this.baseHp=0,this.hp=null,this.baseWisdom=0,this.baseMana=0,this.mana=null,e){const e=t.components.fighter;void 0!==e.strength&&(this.baseStrength=e.strength),void 0!==e.agility&&(this.baseAgility=e.agility),void 0!==e.constitution&&(this.baseConstitution=e.constitution),void 0!==e.wisdom&&(this.baseWisdom=e.wisdom),void 0!==e.baseDamage&&(this.baseDamage=e.baseDamage),void 0!==e.baseDefense&&(this.baseDefense=e.baseDefense),void 0!==e.baseHp&&(this.baseHp=e.baseHp),void 0!==e.hp&&(this.hp=e.hp),void 0!==e.baseMana&&(this.baseMana=e.baseMana),void 0!==e.mana&&(this.mana=e.mana)}this.minDamage=0,this.maxDamage=0,this.defense=0,this.blockChance=0,this.healingBonus=0,this.strength=0,this.agility=0,this.constitution=0,this.wisdom=0}save(){if(this.cachedSave)return this.cachedSave;const t={fighter:{hp:this.hp,mana:this.mana}};return this.baseStrength>0&&(t.fighter.strength=this.baseStrength),this.baseAgility>0&&(t.fighter.agility=this.baseAgility),this.baseConstitution>0&&(t.fighter.constitution=this.baseConstitution),this.baseWisdom>0&&(t.fighter.wisdom=this.baseWisdom),this.baseDamage>0&&(t.fighter.baseDamage=this.baseDamage),this.baseDefense>0&&(t.fighter.baseDefense=this.baseDefense),this.cachedSave=t,t}recalculateStats(){this.calculateStats(),this.healingBonus=Math.floor(this.constitution/2);const t=this.getMaxHp();(null===this.hp||this.hp>=this.maxHp)&&(this.hp=t),this.maxHp=t;const e=this.getMaxMana();(null===this.mana||this.mana>=this.maxMana)&&(this.mana=e),this.maxMana=e,this.calculateDamage(),this.calculateDefense(),this.calculateBlockChance(),this.updateUI(),this.clearSaveCache()}calculateStats(){let t=0,e=0,n=0,s=0;const o=this.parentEntity.getComponent("equipment");if(o){const i=o.getEquippables();for(const o of i)t+=o.strength,e+=o.agility,n+=o.constitution,s+=o.wisdom}this.strength=this.baseStrength+t,this.agility=this.baseAgility+e,this.constitution=this.baseConstitution+n,this.wisdom=this.baseWisdom+s}calculateDamage(){const t=this.baseDamage+this.strength;let e=0,n=0;const s=this.parentEntity.getComponent("equipment");if(s){const t=s.getEquippables();for(const s of t)e+=s.minDamage,n+=s.maxDamage}this.minDamage=t+e,this.maxDamage=Math.floor(1.5*t)+n}calculateDefense(){const t=this.baseDefense+10*this.agility;let e=0;const n=this.parentEntity.getComponent("equipment");if(n){const t=n.getEquippables();for(const n of t)e+=n.defense}this.defense=t+e}calculateBlockChance(){const t=2*this.agility;let e=0;const n=this.parentEntity.getComponent("equipment");if(n){const t=n.getEquippables();for(const n of t)e+=n.blockChance}this.blockChance=Math.min(t+e,90)}getDamage(){return this.minDamage===this.maxDamage?this.minDamage:a.M8C.randInt(this.minDamage,this.maxDamage)}getDamageDisplay(){return this.minDamage===this.maxDamage?this.minDamage:this.minDamage+" - "+this.maxDamage}getBlockedDamage(){return Math.floor(a.M8C.randFloat(this.defense/10,this.defense)/10)}getMaxHp(){const t=this.baseHp+15*this.constitution;let e=0;const n=this.parentEntity.getComponent("equipment");if(n){const t=n.getEquippables();for(const n of t)e+=n.health}return t+e}getMaxMana(){const t=this.baseMana+10*this.wisdom;let e=0;const n=this.parentEntity.getComponent("equipment");if(n){const t=n.getEquippables();for(const n of t)e+=n.mana}return t+e}createDamageIndicator(t,e){const n=this.parentEntity.getComponent("positionalobject");if(n){const s=n.x+a.M8C.randFloat(-.25,.25),o=n.y+a.M8C.randFloat(-.25,.25),i=n.z+1.1+a.M8C.randFloat(0,1),r=new yt({components:{characterobject:{letter:""+t,x:s,y:o,z:i,xRot:.5,yRot:.25,zRot:0,color:e,scale:.05,size:.5}}});r.parentEntity=this,r.setVisible();const l=new a.Pa4(n.x,n.y,i),c=new a.Pa4(n.x,n.y,i+3),h=new ct.w.Tween(l).to(c,500);h.easing(ct.w.Easing.Cubic.In),h.onUpdate((function(){r.z=l.z,r.updateObjectPosition(),es.needsMapUpdate=!0})),h.onComplete((function(){as.scene.remove(r.object)})),h.start()}}takeDamage(t){this.hp-=t,this.updateUI(),this.isPlayer()?this.createDamageIndicator(t,"#C00"):this.createDamageIndicator(t,"#999"),this.hp<=0&&this.die(),this.clearSaveCache()}heal(t){if(this.hp===this.maxHp)return 0;const e=Math.min(this.maxHp,this.hp+t),n=e-this.hp;return this.hp=e,this.updateUI(),this.createDamageIndicator(n,"#090"),this.clearSaveCache(),n}consumeMana(t){if(this.mana<t)return!1;this.mana-=t,this.updateUI(),this.clearSaveCache()}recoverMana(t){if(this.mana===this.maxMana)return 0;const e=Math.min(this.maxMana,this.mana+t),n=e-this.mana;return this.mana=e,this.updateUI(),this.clearSaveCache(),n}die(){const t=this.parentEntity;this.isPlayer()?(b.text("You died!","#f00"),es.setEventHandler(new jt)):b.text(t.name+" dies!","#ffa030"),b.build(),t.callEvent("onEntityDeath");const e=t.getComponent("ai");if(e){const n={components:{aiDead:{previousAI:e.type}}};t.removeComponent("ai");const s=new Mt(n);t.setComponent(s)}this.clearSaveCache()}getHealthDescription(){const t=this.hp/this.maxHp*100;let e="";return t>=90&&t<100?e="(Barely Scratched)":t>=75&&t<90?e="(Lightly Damaged)":t>=50&&t<75?e="(Damaged)":t>=25&&t<50?e="(Very Damaged)":t>=10&&t<25?e="(Extremely Damaged)":t>0&&t<10&&(e="(Nearly Dead)"),e}updateUI(){this.isPlayer()&&(Ot.update(this.hp,this.maxHp),Pt.update(this.mana,this.maxMana),Rt.populate(es.player))}onComponentsLoaded(){this.recalculateStats()}onEquipmentChange(){this.recalculateStats()}}class Ft extends c{constructor(t,e=0,n=0,s=0){super(t),this.dx=e,this.dy=n,this.dz=s}perform(){console.error("Not Implemented")}}class qt extends Ft{constructor(t,e,n,s){super(t,e,n,s)}perform(){const t=this.entity.getComponent("positionalobject");if(!t)return new h(this.entity,"Entity doesn't have a position.");const e=t.x+this.dx,n=t.y+this.dy,s=t.z+this.dz,o=es.gameMap;if(!o.isInBounds(e,n))return new h(this.entity,"Location is outside the map!");const i=this.tryMoveTo(o,e,n,s);if(!(i instanceof h))return t.move(this.dx,this.dy,this.dz),i;const a=this.tryMoveTo(o,e,n,s-1);if(!(a instanceof h))return t.move(this.dx,this.dy,this.dz-1),a;const r=this.tryMoveTo(o,e,n,s+1);return r instanceof h?i:(t.move(this.dx,this.dy,this.dz+1),r)}tryMoveTo(t,e,n,s){if(t.getBlockingActorAtLocation(e,n,s))return new h(this.entity,"There's something in the way!");if(t.tiles.has(s)){const o=t.tiles.get(s)[e][n];if(o){const t=o.getComponent("blocksMovement");if(t&&t.blocksMovement)return new h(this.entity,"There's a "+o.name+" in the way!")}}if(!t.tiles.has(s-1))return new h(this.entity,"No level to walk on!");const o=t.tiles.get(s-1)[e][n];if(!o)return new h(this.entity,"No floor to walk on.");const i=o.getComponent("walkable");return i&&i.walkable?this:new h(this.entity,"There's nothing to walk on.")}}class Wt extends c{constructor(t){super(t)}perform(){return this}}class Ut extends c{constructor(t){super(t)}perform(){const t=a.M8C.randInt(-1,1),e=a.M8C.randInt(-1,1);return 0===t&&0===e?new Wt(this.entity).perform():new qt(this.entity,t,e,0).perform()}}class Yt extends Ft{constructor(t,e,n,s){super(t,e,n,s)}perform(){const t=this.entity.getComponent("positionalobject");if(!t)return new h(this.entity,"Entity doesn't have a position.");const e=t.x+this.dx,n=t.y+this.dy,s=t.z+this.dz,o=es.gameMap.getBlockingActorAtLocation(e,n,s);if(!o)return new h(this.entity,"There's nothing to attack there!");{const t=this.entity.getComponent("fighter"),e=o.getComponent("fighter");if(t&&e){let n,s,i,r;this.isPlayer()?(n="You",s=""):(n=this.entity.name,s="s"),o===es.player?(i="You",r="#C00"):(i=o.name,r="#999");const l=n+" attack"+s+" "+i,c=a.M8C.randInt(0,100);if(e.blockChance>c){const t="#000";b.text(l+", but is blocked.",t).build(),e.takeDamage(0)}else{const n=t.getDamage()-e.getBlockedDamage();n>0?(b.text(l+" for "+n+" hit points.",r).build(),e.takeDamage(n)):b.text(l+", but does no damage.",r).build()}this.entity.callEvent("onMeleeAttack",o)}}}}class Ht{constructor(t){this.content=[],this.scoreFunction=t}push(t){this.content.push(t),this.sinkDown(this.content.length-1)}pop(){const t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t}remove(t){const e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}size(){return this.content.length}rescoreElement(t){this.sinkDown(this.content.indexOf(t))}sinkDown(t){const e=this.content[t];for(;t>0;){const n=(t+1>>1)-1,s=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(s)))break;this.content[n]=e,this.content[t]=s,t=n}}bubbleUp(t){const e=this.content.length,n=this.content[t],s=this.scoreFunction(n);let o=!1;for(;!o;){const i=t+1<<1,a=i-1;let r,l=null;if(a<e){const t=this.content[a];r=this.scoreFunction(t),r<s&&(l=a)}if(i<e){const t=this.content[i];this.scoreFunction(t)<(null===l?s:r)&&(l=i)}if(null===l){o=!0;break}this.content[t]=this.content[l],this.content[l]=n,t=l}}}class Vt{constructor(){}static pathTo(t){let e=t;const n=[];for(;e.parent;)n.unshift(e),e=e.parent;return n}static getHeap(){return new Ht((function(t){return t.f}))}static search(t,e,n,s){t.cleanDirty(),s=s||{},this.heuristicType=s.heuristic||"manhattan";const o=s.closest||!1,i=this.getHeap();let a=e;for("manhattan"===this.heuristicType?e.h=this.heuristicManhattan(e,n):"diagonal"===this.heuristicType&&this.heuristicDiagonal(e,n),t.markDirty(e),i.push(e);i.size()>0;){const e=i.pop();if(e===n)return this.pathTo(e);e.closed=!0;const s=t.neighbors(e);for(let r=0,l=s.length;r<l;++r){const l=s[r];if(l.closed||l.isWall())continue;const c=e.g+l.getCost(e),h=l.visited;(!h||c<l.g)&&(l.visited=!0,l.parent=e,"manhattan"===this.heuristicType?l.h=l.h||this.heuristicManhattan(l,n):"diagonal"===this.heuristicType&&(l.h=l.h||this.heuristicDiagonal(l,n)),l.g=c,l.f=l.g+l.h,t.markDirty(l),o&&(l.h<a.h||l.h===a.h&&l.g<a.g)&&(a=l),h?i.rescoreElement(l):i.push(l))}}return o?this.pathTo(a):[]}static heuristicManhattan(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static heuristicDiagonal(t,e){const n=Math.sqrt(2),s=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);return 1*(s+o)+(n-2)*Math.min(s,o)}static cleanNode(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}}class Xt{constructor(t,e,n){this.x=t,this.y=e,this.weight=n}toString(){return"["+this.x+" "+this.y+"]"}getCost(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight}isWall(){return 0===this.weight}}class Gt{constructor(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(let e=0;e<t.length;e++){this.grid[e]=[];for(let n=0,s=t[e];n<s.length;n++){const t=new Xt(e,n,s[n]);this.grid[e][n]=t,this.nodes.push(t)}}this.init()}init(){this.dirtyNodes=[];for(let t=0;t<this.nodes.length;t++)Vt.cleanNode(this.nodes[t])}cleanDirty(){for(let t=0;t<this.dirtyNodes.length;t++)Vt.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]}markDirty(t){this.dirtyNodes.push(t)}neighbors(t){const e=[],n=t.x,s=t.y,o=this.grid;return o[n-1]&&o[n-1][s]&&e.push(o[n-1][s]),o[n+1]&&o[n+1][s]&&e.push(o[n+1][s]),o[n]&&o[n][s-1]&&e.push(o[n][s-1]),o[n]&&o[n][s+1]&&e.push(o[n][s+1]),this.diagonal&&(o[n-1]&&o[n-1][s-1]&&e.push(o[n-1][s-1]),o[n+1]&&o[n+1][s-1]&&e.push(o[n+1][s-1]),o[n-1]&&o[n-1][s+1]&&e.push(o[n-1][s+1]),o[n+1]&&o[n+1][s+1]&&e.push(o[n+1][s+1])),e}toString(){const t=[],e=this.grid;for(let n=0;n<e.length;n++){const s=[],o=e[n];for(let t=0;t<o.length;t++)s.push(o[t].weight);t.push(s.join(" "))}return t.join("\n")}}class Zt extends Ft{constructor(t,e,n,s){super(t,e,n,s)}perform(){const t=this.entity.getComponent("positionalobject");if(!t)return new h(this.entity,"Entity doesn't have a position.");const e=t.x+this.dx,n=t.y+this.dy,s=es.gameMap;if(!s.isInBounds(e,n))return new h(this.entity,"Location is outside the map!");const o=s.tiles.get(wt.Wall)[e][n];if(o){const t=o.getComponent("openable");if(t)return t.open()?this:new h(this.entity,"That cannot be opened.")}return new h(this.entity,"There's nothing to open there!")}}class Qt extends Ft{constructor(t,e,n,s){super(t,e,n,s)}perform(){const t=this.entity.getComponent("positionalobject");if(!t)return new h(this.entity,"Entity doesn't have a position.");const e=t.x+this.dx,n=t.y+this.dy,s=t.z+this.dz;if(es.gameMap.getBlockingActorAtLocation(e,n,s))return new Yt(this.entity,this.dx,this.dy,this.dz).perform();{const t=es.gameMap.tiles.get(wt.Wall)[e];if(t){const e=t[n];if(e){const t=e.getComponent("openable");if(t&&!t.isOpen)return new Zt(this.entity,this.dx,this.dy,this.dz).perform()}return new qt(this.entity,this.dx,this.dy,this.dz).perform()}return new h(this.entity,"Nowhere to move.")}}}class Jt extends kt{constructor(t={}){super(t,"aiMeleeChase");const e=t.components&&void 0!==t.components.aiMeleeChase;if(this.fov=new d,this.chaseLocation=null,this.radius=5,this.movementActions=1,this.currentMovement=0,e){const e=t.components.aiMeleeChase;void 0!==e.radius&&(this.radius=e.radius),void 0!==e.movementActions&&(this.movementActions=e.movementActions),void 0!==e.currentMovement&&(this.currentMovement=e.currentMovement)}}save(){if(this.cachedSave)return this.cachedSave;const t={aiMeleeChase:{}};return 5!==this.radius&&(t.aiMeleeChase.radius=this.radius),1!==this.movementActions&&(t.aiMeleeChase.movementActions=this.movementActions),0!==this.currentMovement&&(t.aiMeleeChase.currentMovement=this.currentMovement),this.cachedSave=t,t}perform(){const t=this.parentEntity,e=t.getComponent("positionalobject");if(e){this.fov.compute(e.x,e.y,e.z,this.radius,e.z-10,e.z+10);let n=[],s=null;const o=t.getComponent("faction");if(o)for(const t of this.fov.visibleActors)if(t.isAlive()){const i=t.getComponent("faction");if(o.isEnemyOf(i)){const o=t.getComponent("positionalobject");if(o){const i=Math.abs(o.x-e.x),a=Math.abs(o.y-e.y),r=Math.max(i,a);null===s||r<s?(n=[],n.push(t),s=r):r===s&&n.push(t)}}}let i;if(1===n.length?i=n[0]:n.length>1&&(i=n[a.M8C.randInt(0,n.length-1)]),i){const n=i.getComponent("positionalobject");if(this.chaseLocation=new a.Pa4(n.x,n.y,n.z),s<=1)return new Yt(t,n.x-e.x,n.y-e.y,n.z-e.z).perform()}else if(null!==this.chaseLocation&&this.chaseLocation.x===e.x&&this.chaseLocation.y===e.y&&this.chaseLocation.z===e.z&&(this.chaseLocation=null),null===this.chaseLocation)return new Ut(t).perform();if(this.currentMovement+=this.movementActions,this.currentMovement>=1){const n=es.gameMap,s=this.fov.right-this.fov.left,o=this.fov.bottom-this.fov.top,i=Array(s).fill().map((()=>Array(o).fill(0)));for(let t=this.fov.left;t<this.fov.right;t++)for(let s=this.fov.top;s<this.fov.bottom;s++){const o=n.tiles.get(e.z)[t][s];if(o){const t=o.getComponent("blocksMovement");if(t&&t.blocksMovement)continue}if(!n.tiles.has(e.z-1))continue;const a=n.tiles.get(e.z-1)[t][s];if(a){const e=a.getComponent("walkable");e&&e.walkable&&(i[t-this.fov.left][s-this.fov.top]+=10)}}for(const t of this.fov.visibleActors)if(t.isAlive()){const e=t.getComponent("positionalobject");e&&(i[e.x-this.fov.left][e.y-this.fov.top]+=100)}const a=new Gt(i,{diagonal:!0}),r=a.grid[e.x-this.fov.left][e.y-this.fov.top],l=a.grid[this.chaseLocation.x-this.fov.left][this.chaseLocation.y-this.fov.top],c=Vt.search(a,r,l);let h;for(;this.currentMovement>=1;){if(c&&c.length>0){const n=c.shift();n&&(h=new Qt(t,n.x+this.fov.left-e.x,n.y+this.fov.top-e.y,e.z).perform())}else h=new Wt(t).perform();this.currentMovement-=1}return h}}}}class Kt extends lt{constructor(t={}){super(t,"faction");const e=t.components&&void 0!==t.components.faction;if(this.factions=[],this.enemies=[],e){const e=t.components.faction;e.factions&&this.setFactions(e.factions.split(",")),e.enemies&&this.setEnemies(e.enemies.split(","))}}save(){if(this.cachedSave)return this.cachedSave;const t={faction:{factions:this.factions.toString(),enemies:this.enemies.toString()}};return this.cachedSave=t,t}setFactions(t){for(const e of t)this.factions.push(e.trim());this.clearSaveCache()}setEnemies(t){for(const e of t)this.enemies.push(e.trim());this.clearSaveCache()}isEnemyOf(t){if(!t)return!1;for(const e of this.factions)if(t.enemies.indexOf(e)>-1)return!0;return!1}}class $t extends lt{constructor(t={}){super(t,"remnant");const e=t.components&&void 0!==t.components.remnant;if(this.isRemnant=!1,this.x=-1,this.y=-1,this.z=-1,e){const e=t.components.remnant;void 0!==e.isRemnant&&(this.isRemnant=e.isRemnant),void 0!==e.x&&(this.x=e.x),void 0!==e.y&&(this.y=e.y),void 0!==e.z&&(this.z=e.z)}}save(){if(this.cachedSave)return this.cachedSave;const t={remnant:{}};return this.isRemnant&&(t.remnant.isRemnant=this.isRemnant),-1!==this.x&&(t.remnant.x=this.x),-1!==this.y&&(t.remnant.y=this.y),-1!==this.z&&(t.remnant.z=this.z),this.cachedSave=t,t}}class te extends c{constructor(t,e,n){super(t),this.item=e,this.targetPosition=n}perform(){const t=this.item.getComponent("consumable");if(t)return t.activate(this,this.targetPosition)}getTargetActor(){const t=new a.Pa4(this.targetPosition.x,this.targetPosition.y,this.targetPosition.z+1);return es.gameMap.getAliveActorAtLocation(t)}}class ee extends lt{constructor(t={},e){super(t,"consumable",e)}save(){return null}consume(){const t=this.getItem(),e=t.parentEntity;e&&e.use(t,1)}getAction(){const t=this.getConsumer(),e=this.getItem();return new te(t,e)}activate(){console.error("Not Implemented")}getItem(){return this.parentEntity}getConsumer(){let t=this.parentEntity;for(;t&&"actor"!==t.type;)t=t.parentEntity;return t}isPlayer(){return this.getConsumer()===es.player}}class ne extends ee{constructor(t={}){super(t,"healingConsumable");const e=t.components&&void 0!==t.components.healingConsumable;if(this.amount=0,e){const e=t.components.healingConsumable;e&&void 0!==e.amount&&(this.amount=e.amount)}}save(){if(this.cachedSave)return this.cachedSave;const t={healingConsumable:{amount:this.amount}};return this.cachedSave=t,t}activate(t){const e=t.entity.getComponent("fighter");if(e){const n=e.heal(this.getModifiedAmount());return n>0?(this.consume(),this.isPlayer()&&b.text("You consume the "+this.parentEntity.name+", and recover "+n+" HP!").build(),this):new h(t.entity,"Your health is already full")}}getModifiedAmount(){let t=0,e=this.getConsumer();e||(e=es.player);const n=e.getComponent("fighter");return n&&(t=n.healingBonus),this.amount+t}getDescription(){return"<span class='item__details-line'>Recovers <span style='color: #c00;'>"+this.getModifiedAmount()+"</span> health</span>"}}var se=n(7675);const oe=new class extends v{constructor(){super(se),this.equipmentDom=this.dom.getElementsByClassName("inventory__equipment")[0],this.equipmentSlots=[];for(let t=0;t<12;t++){const e=document.createElement("div");e.classList.add("slot","inventory__equipment-slot"),e.setAttribute("data-index",t),this.equipmentSlots.push(e),this.equipmentDom.appendChild(e)}this.storageWrapDom=this.dom.getElementsByClassName("inventory__storage-wrap")[0],this.goldCountDom=this.dom.getElementsByClassName("inventory__gold-count")[0],this.itemTooltipDom=document.createElement("div"),this.itemTooltipDom.classList.add("item__tooltip"),this.itemDragDom=document.createElement("div"),this.itemDragDom.classList.add("item__drag"),document.body.appendChild(this.itemTooltipDom),document.body.appendChild(this.itemDragDom),this.openStorages=[],this.itemsOnGround=[]}populateInventory(t){const e=t.getComponent("equipment");if(e){this.storageWrapDom.innerHTML="";for(let t=0;t<this.equipmentSlots.length;t++){const n=this.equipmentSlots[t],s=e.items[t].item;this.populateSlot(n,s)}this.openStorages=[];const t=e.items[9].item;t&&this.openEquipmentStorage(t);const n=e.items[7].item;n&&this.openEquipmentStorage(n);for(let t=0;t<this.equipmentSlots.length;t++){if(7===t||9===t)continue;const n=e.items[t].item;n&&this.openEquipmentStorage(n)}}this.openGroundItems();const n=t.getComponent("inventory");n&&(this.goldCountDom.innerText=n.gold)}openEquipmentStorage(t){this.openStorages.push(t);const e=t.getComponent("equippable");if(e&&0!==e.maxStorage){let n;n=-1===e.maxStorage?e.storage.length+1:e.maxStorage;const s=document.createElement("div");s.classList.add("inventory__storage"),s.setAttribute("data-index",this.openStorages.length-1);const o=document.createElement("div");o.classList.add("inventory__storage-title"),o.innerText=t.name,s.appendChild(o),this.inventorySlots=[];for(let t=0;t<n;t++){const n=document.createElement("div");n.classList.add("slot","inventory__storage-slot"),n.setAttribute("data-index",t),this.populateSlot(n,e.storage[t]),this.inventorySlots.push(n),s.appendChild(n)}this.storageWrapDom.appendChild(s)}}populateItemsAtGround(){const t=es.player.getComponent("positionalobject");this.itemsOnGround=[];for(const e of es.gameMap.items){const n=e.getComponent("positionalobject");t.x===n.x&&t.y===n.y&&t.z===n.z&&this.itemsOnGround.push(e)}}openGroundItems(){if(this.isOpen()){this.populateItemsAtGround();const t=10*Math.ceil((this.itemsOnGround.length+1)/10),e=document.createElement("div");e.classList.add("inventory__storage");const n=document.createElement("div");n.classList.add("inventory__storage-title"),n.innerText="On Ground",e.appendChild(n),this.inventorySlots=[];for(let n=0;n<t;n++){const t=document.createElement("div");t.classList.add("slot","pickup-slot"),t.setAttribute("data-index",n),this.populateSlot(t,this.itemsOnGround[n]),this.inventorySlots.push(t),e.appendChild(t)}this.storageWrapDom.appendChild(e)}}populateSlot(t,e){if(e){const n=e.getComponent("positionalobject");if(n){let s="";0!==n.zRot&&(s="transform: rotate("+180*n.zRot+"deg);"),t.classList.add("has-item");let o="<div class='item' style='color:"+n.color+";"+s+"'><div class='item__icon'>"+n.letter+"</div>";e.amount>1&&(o+="<span class='item__amount'>"+e.amount+"</span>"),o+="<div class='item__details'><span class='item__details-line item__name'>"+e.name+"</span>",e.description&&(o+="<span class='item__details-line item__description'>"+e.description+"</span>"),o+="<span class='item__details-line'><hr/></span>",o+=e.getComponentDescriptions(),o+="</div></div>",t.innerHTML=o}}else t.classList.remove("has-item"),t.innerHTML=""}toggle(){this.isOpen()?this.close():(this.open(),this.populateInventory(es.player))}};class ie extends lt{constructor(t={}){super(t,"inventory");const e=t.components&&t.components.inventory;if(this.gold=0,e){const e=t.components.inventory;this.gold=this.parseRandInt(e.gold,0)}}save(){if(this.cachedSave)return this.cachedSave;const t={inventory:{gold:this.gold}};return this.cachedSave=t,t}add(t){return this.clearSaveCache(),"gold"===t.id&&(this.gold+=t.amount,!0)}dropAll(){const t=this.gold;if(t>0){const e=on.createFromTemplate("gold");e.amount=t,this.drop(e)}this.clearSaveCache()}drop(t){if(t){const e=this.parentEntity.getComponent("positionalobject");es.gameMap.addItem(t,e),this.isPlayer()&&b.text("You dropped the "+t.name).build(),this.clearSaveCache(),this.isPlayer()&&oe.populateInventory(es.player)}}onEntityDeath(){this.dropAll()}}class ae extends ee{constructor(t={}){super(t,"damageNearestConsumable");const e=t.components&&void 0!==t.components.damageNearestConsumable;if(this.damage=20,this.maxRange=5,e){const e=t.components.damageNearestConsumable;e&&(void 0!==e.damage&&(this.damage=e.damage),void 0!==e.maxRange&&(this.maxRange=e.maxRange))}}save(){if(this.cachedSave)return this.cachedSave;const t={damageNearestConsumable:{damage:this.damage,maxRange:this.maxRange}};return this.cachedSave=t,t}activate(t){const e=t.entity,n=this.getClosestActor(e);if(n){const t=n.getComponent("fighter"),e=Math.max(0,this.damage-t.getBlockedDamage());return this.isPlayer()&&b.text(n.name+" is struck for "+e+" damage!").build(),t.takeDamage(e),this.consume(),this}return new h(t.entity,"No enemy is close enough to strike.")}getClosestActor(t){let e=[],n=null;const s=es.airFov.visibleActors,o=es.fov.visibleActors,i=t.getComponent("positionalobject"),r=t.getComponent("faction");if(i&&r){for(const t of s)if(t.isAlive()&&r.isEnemyOf(t.getComponent("faction"))){const s=t.getComponent("positionalobject");if(s){const o=i.distance(s);null===n||o<n?(e=[],e.push(t),n=o):o===n&&e.push(t)}}for(const t of o)if(t.isAlive()&&r.isEnemyOf(t.getComponent("faction"))){const s=t.getComponent("positionalobject");if(s){const o=i.distance(s);null===n||o<n?(e=[],e.push(t),n=o):o===n&&e.push(t)}}}let l;return 1===e.length?l=e[0]:e.length>1&&(l=e[a.M8C.randInt(0,e.length-1)]),l}getDescription(){return"<span class='item__details-line'>Lightning Damage: <span style='color: #aa6;'>"+this.damage+"</span></span><span class='item__details-line'>Range: <span style='color: #666;'>"+this.maxRange+"</span></span>"}}class re extends I{constructor(){super(),this.resetPosition(),this.initted=!1}init(){this.initted||(this.selectIndex(),this.initted=!0)}resetPosition(){this.player=es.player;const t=this.player.getComponent("positionalobject");this.position=new a.Pa4(t.x,t.y,t.z-1)}exit(){as.updateCameraPosition(es.player),es.setEventHandler(new Vn)}handleInput(){if(this.init(),at.testPressed("cancel"))this.exit();else if(at.testPressed("confirm"))this.confirmIndex();else if(at.testPressed("reset")||at.testPressed("wait"))this.resetPosition();else{let t=1;at.isPressed("modifier-speed1")&&(t*=5),at.isPressed("modifier-speed2")&&(t*=10),at.isPressed("modifier-speed3")&&(t*=20);let e=0,n=0;if(at.testPressed("up")?n=1:at.testPressed("down")?n=-1:at.testPressed("left")?e=-1:at.testPressed("right")?e=1:at.testPressed("nw")?(e=-1,n=1):at.testPressed("ne")?(e=1,n=1):at.testPressed("sw")?(e=-1,n=-1):at.testPressed("se")&&(e=1,n=-1),0!==e||0!==n){const s=this.position.x+e*t,o=this.position.y+n*t;this.position.x=Math.max(0,Math.min(s,es.gameMap.width-1)),this.position.y=Math.max(0,Math.min(o,es.gameMap.height-1)),this.selectIndex()}}}selectIndex(t=!0){let e=null,n=null;const s=es.gameMap.tiles.get(this.position.z);if(s){const t=s[this.position.x];if(t){const s=t[this.position.y];if(s){const t=s.getComponent("positionalobject");t&&(1===t.transparency&&t.hasObject()?this.isHighlighted(s)||(n=s):e=s)}}}e?(this.clearHighlights(!1),t&&as.updateCameraPosition(es.player,e),x.updatePositionOnly(e)):n?(t&&as.updateCameraPosition(es.player,n),this.clearAndSetHighlight(n)):this.clearHighlights(!0)}confirmIndex(){console.error("Not Implemented")}onMouseMove(t){this.mouse.x=t.clientX/as.canvasDom.offsetWidth*2-1,this.mouse.y=-t.clientY/as.canvasDom.offsetHeight*2+1,this.raycaster.setFromCamera(this.mouse,as.camera);const e=this.raycaster.intersectObject(as.scene,!0);for(let t=0;t<e.length;t++){const n=e[t].object.parentEntity;if(n&&n instanceof je){const t=n.getComponent("positionalobject");if(t){if(0===t.transparency||!t.hasObject())continue;this.position.x===t.x&&this.position.y===t.y||(this.position.x=t.x,this.position.y=t.y,this.selectIndex(!1),es.needsMapUpdate=!0);break}}}}onLeftClick(){this.confirmIndex()}}class le extends re{constructor(t){super(),this.callback=t}confirmIndex(){es.processAction(this.callback(this.position)),this.exit()}}class ce extends kt{constructor(t={}){super(t,"aiConfusedEnemy");const e=t.components&&void 0!==t.components.aiConfusedEnemy;if(this.previousAI="",this.turnsRemaining=10,e){const e=t.components.aiConfusedEnemy;e&&(e.previousAI&&(this.previousAI=e.previousAI),void 0!==e.turnsRemaining&&(this.turnsRemaining=e.turnsRemaining))}}save(){if(this.cachedSave)return this.cachedSave;const t={aiConfusedEnemy:{previousAI:this.previousAI,turnsRemaining:this.turnsRemaining}};return this.cachedSave=t,t}setTurnsRemaining(t){t>this.turnsRemaining&&(this.turnsRemaining=t,this.clearSaveCache())}perform(){if(!(this.turnsRemaining<=0))return this.setTurnsRemaining(this.turnsRemaining-1),new Ut(this.parentEntity).perform();{this.parentEntity.removeComponent("ai");const t=Se.create(this.parentEntity,this.previousAI);this.parentEntity.setComponent(t)}}}class he extends ee{constructor(t={}){super(t,"confusionConsumable");const e=t.components&&void 0!==t.components.confusionConsumable;if(this.turns=0,e){const e=t.components.confusionConsumable;e&&void 0!==e.turns&&(this.turns=e.turns)}}save(){if(this.cachedSave)return this.cachedSave;const t={confusionConsumable:{turns:this.turns}};return this.cachedSave=t,t}getAction(){const t=this;return this.isPlayer()&&b.text("Select a target location.","#3fffff").build(),es.setEventHandler(new le((function(e){return new te(t.getConsumer(),t.getItem(),e)}))),new y(this.parentEntity)}activate(t){const e=t.entity,n=t.getTargetActor();if(!n)return new h(this.parentEntity,"You must select an enemy to target.");if(n===e)return new h(this.parentEntity,"You cannot confuse yourself.");if(-1===es.fov.visibleActors.indexOf(n)&&-1===es.airFov.visibleActors.indexOf(n))return new h(this.parentEntity,"You cannot target an area that you cannot see.");this.isPlayer()&&b.text("The eyes of the "+n.name+" look vacant, as it starts to stumble around!","#3fff3f").build();const s=n.getComponent("ai");if(s){if(s instanceof ce)s.setTurnsRemaining(this.turns);else{const t={components:{aiConfusedEnemy:{previousAI:s.type,turnsRemaining:this.turns}}};n.removeComponent("ai");const e=Se.create(n,"aiConfusedEnemy",t);n.setComponent(e)}this.consume()}return this}getDescription(){return"<span class='item__details-line'>Confuses for: <span style='color: #cf3fff;'>"+this.turns+"</span> turns</span>"}}class pe extends re{constructor(t,e){super(),this.callback=t,this.radius=e}selectIndex(t=!0){let e=!0,n=null;const s=[],o=es.gameMap.tiles.get(this.position.z);if(o){const t=Math.max(0,this.position.x-this.radius),i=Math.min(es.gameMap.width,this.position.x+this.radius+1),a=Math.max(0,this.position.y-this.radius),r=Math.min(es.gameMap.height,this.position.y+this.radius+1);for(let l=t;l<i;l++){const t=o[l];if(t)for(let o=a;o<r;o++){const i=t[o],a=i.getComponent("positionalobject");a&&(1===a.transparency&&a.hasObject()&&s.push(i),l===this.position.x&&o===this.position.y&&(n=i,1===a.transparency&&a.hasObject()&&(e=!1)))}}}n&&(t&&as.updateCameraPosition(es.player,n),e?x.updatePositionOnly(n):x.updatePositionDetails(n)),s.length>0?this.clearAndSetHighlights(s):this.clearHighlights(!0)}confirmIndex(){es.processAction(this.callback(this.position)),this.exit()}}class me extends ee{constructor(t={}){super(t,"aoeDamageConsumable");const e=t.components&&void 0!==t.components.aoeDamageConsumable;if(this.damage=12,this.radius=1,e){const e=t.components.aoeDamageConsumable;e&&(void 0!==e.damage&&(this.damage=e.damage),void 0!==e.radius&&(this.radius=e.radius))}}save(){if(this.cachedSave)return this.cachedSave;const t={aoeDamageConsumable:{damage:this.damage,radius:this.radius}};return this.cachedSave=t,t}getAction(){const t=this;return this.isPlayer()&&b.text("Select a target location.","#3fffff").build(),es.setEventHandler(new pe((function(e){return new te(t.getConsumer(),t.getItem(),e)}),t.radius)),new y(this.parentEntity)}activate(t){const e=t.targetPosition;if(!es.gameMap.isPositionVisible(e))return new h(this.parentEntity,"You cannot target an area that you cannot see.");const n=this.targetActors(e,es.fov.visibleActors),s=this.targetActors(e,es.airFov.visibleActors);return n||s?(this.consume(),this):new h(this.parentEntity,"There are no targets in range.")}targetActors(t,e){let n=!1;for(const s of e)if(s.isAlive()&&s.getComponent("positionalobject").horizontalDistance(t)<=this.radius){const t=s.getComponent("fighter");if(t){const e=Math.max(0,this.damage-t.getBlockedDamage());this.isPlayer()&&b.text("The "+s.name+" is engulfed in a fiery explosion, taking "+e+" damage!").build(),t.takeDamage(e),n=!0}}return n}getDescription(){const t=2*this.radius+1,e=t+"x"+t;return"<span class='item__details-line'>Fire Damage: <span style='color: #c00;'>"+this.damage+"</span></span><span class='item__details-line'>Area of effect: <span style='color: #ccc;'>"+e+"</span></span>"}}class de extends ee{constructor(t={}){super(t,"manaConsumable");const e=t.components&&void 0!==t.components.manaConsumable;if(this.amount=0,e){const e=t.components.manaConsumable;e&&void 0!==e.amount&&(this.amount=e.amount)}}save(){if(this.cachedSave)return this.cachedSave;const t={manaConsumable:{amount:this.amount}};return this.cachedSave=t,t}activate(t){const e=t.entity.getComponent("fighter");if(e){const n=e.recoverMana(this.amount);return n>0?(this.consume(),this.isPlayer()&&b.text("You consume the "+this.parentEntity.name+", and recover "+n+" mana!").build(),this):new h(t.entity,"Your mana is already full")}}getDescription(){return"<span class='item__details-line'>Recovers <span style='color: #c00;'>"+this.amount+"</span> mana</span>"}}class Ae extends kt{constructor(t={}){super(t,"aiGelatinousCube"),this.fov=new d,this.chaseLocation=null}save(){if(this.cachedSave)return this.cachedSave;const t={aiGelatinousCube:{}};return this.cachedSave=t,t}perform(){let t=null;const e=this.parentEntity,n=e.getComponent("positionalobject");if(n){this.fov.compute(n.x,n.y,n.z,5,n.z-10,n.z+10);let s=[],o=null;const i=e.getComponent("faction");if(i)for(const t of this.fov.visibleActors)if(t.isAlive()){const e=t.getComponent("faction");if(i.isEnemyOf(e)){const e=t.getComponent("positionalobject");if(e){const i=Math.abs(e.x-n.x),a=Math.abs(e.y-n.y),r=Math.max(i,a);null===o||r<o?(s=[],s.push(t),o=r):r===o&&s.push(t)}}}let r;if(1===s.length?r=s[0]:s.length>1&&(r=s[a.M8C.randInt(0,s.length-1)]),r){const s=r.getComponent("positionalobject");this.chaseLocation=new a.Pa4(s.x,s.y,s.z),o<=1&&(t=new Yt(e,s.x-n.x,s.y-n.y,s.z-n.z))}else null!==this.chaseLocation&&this.chaseLocation.x===n.x&&this.chaseLocation.y===n.y&&this.chaseLocation.z===n.z&&(this.chaseLocation=null),null===this.chaseLocation&&(t=new Ut(e));if(!t){const s=es.gameMap,o=this.fov.right-this.fov.left,i=this.fov.bottom-this.fov.top,a=Array(o).fill().map((()=>Array(i).fill(0)));for(let t=this.fov.left;t<this.fov.right;t++)for(let e=this.fov.top;e<this.fov.bottom;e++){const o=s.tiles.get(n.z)[t][e];if(o){const t=o.getComponent("blocksMovement");if(t&&t.blocksMovement)continue}if(!s.tiles.has(n.z-1))continue;const i=s.tiles.get(n.z-1)[t][e];if(i){const n=i.getComponent("walkable");n&&n.walkable&&(a[t-this.fov.left][e-this.fov.top]+=10)}}for(const t of this.fov.visibleActors)if(t.isAlive()){const e=t.getComponent("positionalobject");e&&(a[e.x-this.fov.left][e.y-this.fov.top]+=100)}const r=new Gt(a,{diagonal:!0}),l=r.grid[n.x-this.fov.left][n.y-this.fov.top],c=r.grid[this.chaseLocation.x-this.fov.left][this.chaseLocation.y-this.fov.top],h=Vt.search(r,l,c);if(h&&h.length>0){const s=h.shift();t=new Qt(e,s.x+this.fov.left-n.x,s.y+this.fov.top-n.y,n.z)}else t=new Wt(e)}t.perform();const l=e.getComponent("attachedItems");if(l){const t=[];for(const e of this.fov.visibleItems){const s=e.getComponent("remnant");if(s&&s.isRemnant)continue;const o=e.getComponent("positionalobject");if(n.isSamePosition(o)&&l.add(e)){t.push(e);const n={xOffset:o.xOffset,yOffset:o.yOffset,zOffset:o.zOffset,xRot:o.xRot,yRot:o.yRot,zRot:o.zRot},i={xOffset:n.xOffset+a.M8C.randFloat(0,.1),yOffset:n.yOffset+a.M8C.randFloat(0,.1),zOffset:n.zOffset+a.M8C.randFloat(.2,.7),xRot:a.M8C.randFloat(0,2),yRot:a.M8C.randFloat(0,2),zRot:a.M8C.randFloat(0,2)};if(s&&!s.isRemnant)o.updateRotation(i.xRot,i.yRot,i.zRot),o.updateOffsets(i.xOffset,i.yOffset,i.zOffset),o.updateObjectPosition(),es.needsMapUpdate=!0;else{const t=new ct.w.Tween(n).to(i,200);t.start(),t.onUpdate((function(){o.updateRotation(n.xRot,n.yRot,n.zRot),o.updateOffsets(n.xOffset,n.yOffset,n.zOffset),o.updateObjectPosition(),es.needsMapUpdate=!0}))}}}for(const e of t)es.gameMap.removeItem(e),es.fov.remove(e)}}}onEntityDeath(){const t=this.parentEntity.getComponent("attachedItems");if(t){for(const e of t.items)if(es.gameMap.addItem(e)){const t=e.getComponent("positionalobject");if(t){const n=on.createFromTemplate(e.id).getComponent("positionalobject"),s={xOffset:t.xOffset,yOffset:t.yOffset,zOffset:t.zOffset,xRot:t.xRot,yRot:t.yRot},o={xOffset:n.xOffset,yOffset:n.yOffset,zOffset:n.zOffset,xRot:n.xRot,yRot:n.yRot},i=new ct.w.Tween(s).to(o,200);i.start(),i.onUpdate((function(){t.updateRotation(s.xRot,s.yRot),t.updateOffsets(s.xOffset,s.yOffset,s.zOffset),t.updateObjectPosition(),es.needsMapUpdate=!0}))}}t.clearItems()}}}class ue extends kt{constructor(t={}){super(t,"aiPlayer")}save(){if(this.cachedSave)return this.cachedSave;const t={aiPlayer:{}};return this.cachedSave=t,t}perform(){}}class ge extends lt{constructor(t={}){super(t,"explodeOnDeath");const e=t.components&&void 0!==t.components.explodeOnDeath;if(this.damage=0,this.radius=0,e){const e=t.components.explodeOnDeath;void 0!==e.damage&&(this.damage=e.damage),void 0!==e.radius&&(this.radius=e.radius)}}save(){if(this.cachedSave)return this.cachedSave;const t={explodeOnDeath:{damage:this.damage,radius:this.radius}};return this.cachedSave=t,t}onEntityDeath(){const t=this.parentEntity,e=t.getComponent("positionalobject");if(e&&(e.teardown(),es.gameMap.removeActor(t),this.damage>0))for(const t of es.gameMap.actors){const n=t.getComponent("positionalobject");if(e.horizontalDistance(n)<=this.radius){const e=t.getComponent("fighter");e&&e.takeDamage(Math.max(0,this.damage-e.getBlockedDamage()))}}}}class fe extends lt{constructor(t={}){if(super(t,"attachedItems"),this.items=[],t.components&&void 0!==t.components.attachedItems){const e=t.components.attachedItems;if(void 0!==e.items)for(let t=0;t<e.items.length;t++){const n=e.items[t];null!==n&&(this.items[t]=on.create(n),this.items[t].parentEntity=this)}}}save(){if(this.cachedSave)return this.cachedSave;const t=[];for(const e of this.items)e?t.push(JSON.stringify(e.save())):t.push(null);const e={attachedItems:{items:t}};return this.cachedSave=e,e}add(t){return-1===this.items.indexOf(t)&&(this.items.push(t),this.clearSaveCache(),!0)}clearItems(){this.items=[],this.clearSaveCache()}remove(t){const e=this.items.indexOf(t);e>-1&&this.items.splice(e,1),this.clearSaveCache()}onMeleeAttack(t){for(const e of this.items)this.animateEntity(e,t)}animateEntity(t,e){const n=t.getComponent("positionalobject");if(n&&n.hasObject()){t.stopCombatAnimations();const s=e.getComponent("positionalobject");if(n&&n.hasObject()&&s&&s.hasObject()){const e=new a.Pa4(n.object.position.x,n.object.position.y,n.object.position.z),o=new a.Pa4((n.object.position.x+s.object.position.x)/2,(n.object.position.y+s.object.position.y)/2,(n.object.position.z+s.object.position.z)/2),i=e.clone(),r=new ct.w.Tween(i).to(o,100);r.onUpdate((function(){n.hasObject()?(n.object.position.x=i.x,n.object.position.y=i.y,n.object.position.z=i.z,es.needsMapUpdate=!0):this.stop()}));const l=new ct.w.Tween(i).to(e,100);l.onUpdate((function(){n.hasObject()?(n.object.position.x=i.x,n.object.position.y=i.y,n.object.position.z=i.z,es.needsMapUpdate=!0):this.stop()})),r.chain(l),r.start(),t.combatTweens.push(r),t.combatTweens.push(l)}}}onEntityMove(){for(const t of this.items)t.stopCombatAnimations();const t=this.parentEntity.getComponent("positionalobject");if(t)for(const e of this.items){const n=e.getComponent("positionalobject");n&&(n.moveTo(t.x,t.y,t.z,!1),es.needsMapUpdate=!0)}this.clearSaveCache()}onAddToScene(){for(const t of this.items){const e=t.getComponent("positionalobject");e&&(e.isVisible()?e.resetColor():e.setVisible())}}onMapTeardown(){for(const t of this.items)t.callEvent("onMapTeardown")}onCreateRemnant(){for(const t of this.items){const e=t.getComponent("positionalobject");if(e){const n=t.clone();n.setComponent(new $t({components:{remnant:{isRemnant:!0,x:e.x,y:e.y,z:e.z}}}));const s=n.getComponent("positionalobject");s.setVisible(),s.shiftColor(.5),es.gameMap.items.push(n),t.setComponent(new $t({components:{remnant:{isRemnant:!1,x:e.x,y:e.y,z:e.z}}})),e.setVisible(!1)}}}onDestroyRemnant(){for(const t of this.items)t.getComponent("remnant")&&t.removeComponent("remnant")}}class ve extends lt{constructor(t={},e){super(t,"interactable",e)}save(){return null}interact(){}}class be extends ve{constructor(t={}){super(t,"stairsInteractable");const e=t.components&&void 0!==t.components.stairsInteractable;if(this.map=null,this.x=null,this.y=null,this.z=null,this.generator=null,e){const e=t.components.stairsInteractable;e&&(void 0!==e.map&&(this.map=e.map),void 0!==e.x&&(this.x=e.x),void 0!==e.y&&(this.y=e.y),void 0!==e.z&&(this.z=e.z),void 0!==e.generator&&(this.generator=e.generator))}}save(){if(this.cachedSave)return this.cachedSave;const t={stairsInteractable:{}};return this.map&&(t.stairsInteractable.map=this.map),null!==this.x&&(t.stairsInteractable.x=this.x),null!==this.y&&(t.stairsInteractable.y=this.y),null!==this.z&&(t.stairsInteractable.z=this.z),this.generator&&(t.stairsInteractable.generator=this.generator),this.cachedSave=t,t}setPosition(t,e,n){this.x=t,this.y=e,this.z=n,this.clearSaveCache()}interact(){if(this.map){const t=es.player.getComponent("positionalobject");t.x=this.x,t.y=this.y,t.z=this.z,es.setMap(es.gameMaps.get(this.map),this)}else if(this.generator){const t={};es.gameMap.level&&(t.level=es.gameMap.level+1);const e=es.mapLoader.loadMap(this.generator,t);this.map=e.name,this.generator=null,es.setMap(e,this)}}}var ye=n(2469);const Ce=new class extends v{constructor(){super(ye),this.dom.getElementsByClassName("bottom-container__left")[0].appendChild(Ot.dom),this.dom.getElementsByClassName("bottom-container__right")[0].appendChild(Pt.dom),this.xpFilledDom=this.dom.getElementsByClassName("character__xp-filled")[0],this.openCharacter=this.dom.getElementsByClassName("hotbar__open-character")[0],this.openSkills=this.dom.getElementsByClassName("hotbar__open-skill")[0],this.beltSlotsDom=this.dom.getElementsByClassName("belt-slots")[0]}updateAll(){this.updateXp(),this.updateStatPointsIndicator(),this.updateSkillPointsIndicator(),this.updateBeltSlots()}updateXp(){const t=es.player.getComponent("level");this.xpFilledDom.style.width=t.getPercentXPTowardsLevel()+"%"}updateStatPointsIndicator(){es.player.getComponent("level").statPointsAvailable>0?this.openCharacter.classList.add("has-statpoint"):this.openCharacter.classList.remove("has-statpoint")}updateSkillPointsIndicator(){es.player.getComponent("level").skillPointsAvailable>0?this.openSkills.classList.add("has-skillpoint"):this.openSkills.classList.remove("has-skillpoint")}updateBeltSlots(){this.beltSlotsDom.innerHTML="";const t=es.player.getComponent("equipment");if(t){const e=t.items[7].item;if(e){const t=e.getComponent("equippable");if(t)for(let e=0;e<t.maxStorage;e++){const n=document.createElement("div");if(n.classList.add("slot","belt-slot"),n.setAttribute("data-index",e),t.storage.length>=e){const s=t.storage[e];this.populateSlot(n,s)}this.beltSlotsDom.appendChild(n)}}}}populateSlot(t,e){if(e){const n=e.getComponent("positionalobject");if(n){let s="";0!==n.zRot&&(s="transform: rotate("+180*n.zRot+"deg);"),t.classList.add("has-item");let o="<div class='item' style='color:"+n.color+";"+s+"'><div class='item__icon'>"+n.letter+"</div>";e.amount>1&&(o+="<span class='item__amount'>"+e.amount+"</span>"),o+="<div class='item__details'><span class='item__details-line item__name'>"+e.name+"</span>",e.description&&(o+="<span class='item__details-line item__description'>"+e.description+"</span>"),o+="<span class='item__details-line'><hr/></span>",o+=e.getComponentDescriptions(),o+="</div></div>",t.innerHTML=o}}else t.classList.remove("has-item"),t.innerHTML=""}};class xe extends lt{constructor(t={}){super(t,"level");const e=t.components&&void 0!==t.components.level;if(this.level=1,this.xp=0,this.xpGiven=0,this.statPointsAvailable=0,this.skillPointsAvailable=0,this.statPointsPerLevel=1,this.skillPointsPerLevel=1,e){const e=t.components.level;void 0!==e.level&&(this.level=e.level),void 0!==e.xp&&(this.xp=e.xp),void 0!==e.xpGiven&&(this.xpGiven=e.xpGiven),void 0!==e.statPointsAvailable&&(this.statPointsAvailable=e.statPointsAvailable),void 0!==e.skillPointsAvailable&&(this.skillPointsAvailable=e.skillPointsAvailable)}}save(){if(this.cachedSave)return this.cachedSave;const t={level:{}};return this.level>1&&(t.level=this.level),this.xp>0&&(t.xp=this.xp),this.xpGiven>0&&(t.xpGiven=this.xpGiven),this.statPointsAvailable>0&&(t.statPointsAvailable=this.statPointsAvailable),this.skillPointsAvailable>0&&(t.skillPointsAvailable=this.skillPointsAvailable),this.cachedSave=t,t}xpForLevel(t){return 75*(t*t+t)}requiresLevelUp(){return this.xp>=this.xpForLevel(this.level)}getPercentXPTowardsLevel(){const t=this.xpForLevel(this.level-1),e=this.xpForLevel(this.level)-t;return(this.xp-t)/e*100}levelUp(){this.level+=1,this.statPointsAvailable+=this.statPointsPerLevel,this.skillPointsAvailable+=this.skillPointsPerLevel,b.text("You are now level "+this.level+"!").build();const t=this.parentEntity.getComponent("fighter");t.heal(t.maxHp),t.recoverMana(t.maxMana),Ce.updateStatPointsIndicator(),Ce.updateSkillPointsIndicator(),this.clearSaveCache()}useStatPoint(){this.statPointsAvailable-=1,Rt.populate(es.player),Ce.updateStatPointsIndicator(),this.clearSaveCache()}useSkillPoint(){this.skillPointsAvailable-=1,Ce.updateSkillPointsIndicator(),this.clearSaveCache()}addXp(t){t<=0||(this.xp+=t,b.text("You gain "+t+" xp.").build(),this.requiresLevelUp()&&this.levelUp(),Rt.isOpen()&&Rt.populate(es.player),Ce.updateXp(),this.clearSaveCache())}onEntityDeath(){es.player&&!this.isPlayer()&&es.player.getComponent("level").addXp(this.xpGiven)}}class Ie extends re{constructor(t){super(),this.callback=t}confirmIndex(){es.processAction(this.callback(this.position)),this.exit()}}class _e extends ee{constructor(t={}){super(t,"summonPortalConsumable")}save(){if(this.cachedSave)return this.cachedSave;const t={summonPortalConsumable:{}};return this.cachedSave=t,t}getAction(){const t=this;return es.gameMap&&"town"===es.gameMap.name?new h(this.parentEntity,"You can't summon a portal in town!"):(this.isPlayer()&&b.text("Select a target location.","#3fffff").build(),es.setEventHandler(new Ie((function(e){return new te(t.getConsumer(),t.getItem(),e)}))),new y(this.parentEntity))}activate(t,e){const n=es.gameMap.tiles.get(e.z+1);if(n){const t=n[e.x];if(t){const n=t[e.y];if(n){const t=n.getComponent("walkable");if(t&&t.blocksMovement)return new h(this.parentEntity,n.name+" is in the way.")}}}let s=!1;const o=es.gameMap.tiles.get(e.z);if(o){const t=o[e.x];if(t){const n=t[e.y];if(n){const t=n.getComponent("walkable"),e=n.getComponent("positionalobject");if(e&&t&&t.walkable){if(1!==e.transparency||!e.hasObject())return new h(this.parentEntity,"You can't see there!");s=!0}}}}if(!s)return new h(this.parentEntity,"No floor there to support the portal.");const i=t.getTargetActor();if(i)return new h(this.parentEntity,i.name+" is in the way.");es.gameMap.tiles.get(e.z+1)[e.x][e.y]=on.createFromTemplate("portal",{components:{positionalobject:{x:e.x,y:e.y,z:e.z+1},portalInteractable:{map:"town",x:34,y:36,z:1}}}),es.gameMaps.get("town").tiles.get(1)[34][36]=on.createFromTemplate("portal",{components:{positionalobject:{x:34,y:36,z:1},portalInteractable:{map:es.gameMap.name,x:e.x,y:e.y,z:e.z+1}}}),this.consume()}}class we extends ve{constructor(t={}){super(t,"portalInteractable");const e=t.components&&void 0!==t.components.portalInteractable;if(this.map=null,this.x=null,this.y=null,this.z=null,e){const e=t.components.portalInteractable;e&&(void 0!==e.map&&(this.map=e.map),void 0!==e.x&&(this.x=e.x),void 0!==e.y&&(this.y=e.y),void 0!==e.z&&(this.z=e.z))}}save(){if(this.cachedSave)return this.cachedSave;const t={portalInteractable:{}};return this.map&&(t.portalInteractable.map=this.map),null!==this.x&&(t.portalInteractable.x=this.x),null!==this.y&&(t.portalInteractable.y=this.y),null!==this.z&&(t.portalInteractable.z=this.z),this.cachedSave=t,t}setPosition(t,e,n){this.x=t,this.y=e,this.z=n,this.clearSaveCache()}interact(){if(this.map){const t=es.player.getComponent("positionalobject");"town"!==this.map.name&&(es.gameMaps.get("town").tiles.get(1)[34][36]=on.createFromTemplate("portal",{components:{positionalobject:{x:34,y:36,z:1},portalInteractable:{map:es.gameMap.name,x:t.x,y:t.y,z:t.z}}})),this.parentEntity.getComponent("positionalobject").teardown(),es.gameMap.tiles.get(t.z)[t.x][t.y]=null,t.x=this.x,t.y=this.y,t.z=this.z,es.setMap(es.gameMaps.get(this.map),this)}}}const Be=Object.freeze({MAIN_HAND:"mainhand",OFF_HAND:"offhand",BODY:"body",HELMET:"helmet",GLOVES:"gloves",SHOULDER:"shoulder",BELT:"belt",BOOTS:"boots",STORAGE:"storage",AMULET:"amulet",RING:"ring"});class Ee{constructor(t,e){this.slot=t,this.item=e}}class ke extends lt{constructor(t={}){super(t,"equipment");const e=t.components&&void 0!==t.components.equipment;if(this.items=[],this.items.push(new Ee(Be.SHOULDER)),this.items.push(new Ee(Be.HELMET)),this.items.push(new Ee(Be.AMULET)),this.items.push(new Ee(Be.MAIN_HAND)),this.items.push(new Ee(Be.BODY)),this.items.push(new Ee(Be.OFF_HAND)),this.items.push(new Ee(Be.RING)),this.items.push(new Ee(Be.BELT)),this.items.push(new Ee(Be.RING)),this.items.push(new Ee(Be.STORAGE)),this.items.push(new Ee(Be.BOOTS)),this.items.push(new Ee(Be.GLOVES)),e){const e=t.components.equipment;if(void 0!==e.items)for(let t=0;t<e.items.length;t++){const n=e.items[t];null!==n&&(void 0!==n.load?this.items[t].item=on.createFromTemplate(n.load,n):this.items[t].item=on.create(n),this.items[t].item.parentEntity=this)}}}save(){if(this.cachedSave)return this.cachedSave;const t=[];for(const e of this.items){const n=e.item;n?t.push(JSON.stringify(n.save())):t.push(null)}const e={equipment:{items:t}};return this.cachedSave=e,e}getEquippables(){const t=[];for(const e of this.items){const n=e.item;if(n){const e=n.getComponent("equippable");e&&t.push(e)}}return t}move(t,e){if(t!==e){const n=this.items[t].item;this.items[t].item=this.items[e].item,this.items[e].item=n,this.clearSaveCache()}}dropAll(){for(const t of this.items)t.item&&this.drop(t.item);const t=this.gold;if(t>0){const e=on.createFromTemplate("gold");e.amount=t,this.drop(e)}this.clearSaveCache()}drop(t){if(t){const e=this.parentEntity.getComponent("positionalobject");es.gameMap.addItem(t,e),this.isPlayer()&&b.text("You dropped the "+t.name).build(),this.remove(t),this.clearSaveCache(),this.isPlayer()&&oe.populateInventory(es.player)}}remove(t){for(let e=0;e<this.items.length;e++){const n=this.items[e];if(n&&n.item===t){n.item=null,this.clearSaveCache(),es.needsMapUpdate=!0;break}}}addItem(t){const e=this.items[7].item,n=this.items[9].item;let s=!1;if(e&&(s=e.getComponent("equippable").addPartialStacks(t)),!s&&n&&(s=n.getComponent("equippable").addPartialStacks(t)),!s)for(let t=0;t<this.items.length;t++){if(7===t||9===t)continue;const e=this.items[t].item;if(e&&(s=e.getComponent("equippable").addPartialStacks(e),s))break}return!s&&n&&(s=n.getComponent("equippable").addFullStacks(t)),s}setItem(t,e){this.items[t].item=e,this.clearSaveCache()}getItem(t){return this.items[t].item}onEntityDeath(){this.dropAll()}}class Me extends lt{constructor(t={}){super(t,"equippable");const e=t.components&&void 0!==t.components.equippable;if(this.slot=Be.MAIN_HAND,this.minDamage=0,this.maxDamage=0,this.defense=0,this.blockChance=0,this.health=0,this.mana=0,this.strength=0,this.agility=0,this.constitution=0,this.wisdom=0,this.lightRadius=0,this.maxStorage=0,this.storage=[],e){const e=t.components.equippable;void 0!==e.slot&&(this.slot=e.slot);const n=e.damage;if(void 0!==n)if("string"==typeof n){const t=n.split(",");this.minDamage=this.parseRandIntBetween(t[0]),t.length>1?this.maxDamage=this.parseRandIntBetween(t[1]):this.maxDamage=this.minDamage}else this.minDamage=n,this.maxDamage=this.minDamage;if(void 0!==e.defense&&(this.defense=this.parseRandIntBetween(e.defense)),void 0!==e.blockChance&&(this.blockChance=this.parseRandIntBetween(e.blockChance)),void 0!==e.health&&(this.health=this.parseRandIntBetween(e.health)),void 0!==e.mana&&(this.mana=this.parseRandIntBetween(e.mana)),void 0!==e.strength&&(this.strength=this.parseRandIntBetween(e.strength)),void 0!==e.agility&&(this.agility=this.parseRandIntBetween(e.agility)),void 0!==e.constitution&&(this.constitution=this.parseRandIntBetween(e.constitution)),void 0!==e.wisdom&&(this.wisdom=this.parseRandIntBetween(e.wisdom)),void 0!==e.lightRadius&&(this.lightRadius=this.parseRandIntBetween(e.lightRadius)),void 0!==e.maxStorage&&(this.maxStorage=e.maxStorage),void 0!==e.storage)for(let t=0;t<e.storage.length;t++){const n=e.storage[t];null!==n&&(void 0!==n.load?this.storage[t]=on.createFromTemplate(n.load,n):this.storage[t]=on.create(n),this.storage[t].parentEntity=this)}}}save(){if(this.cachedSave)return this.cachedSave;const t={equippable:{}};this.slot!==Be.MAIN_HAND&&(t.equippable.slot=this.slot),0===this.minDamage&&0===this.maxDamage||(this.minDamage===this.maxDamage?t.equippable.damage=this.minDamage:t.equippable.damage=this.minDamage+","+this.maxDamage),0!==this.defense&&(t.equippable.defense=this.defense),0!==this.blockChance&&(t.equippable.blockChance=this.blockChance),0!==this.health&&(t.equippable.health=this.health),0!==this.mana&&(t.equippable.mana=this.mana),0!==this.strength&&(t.equippable.strength=this.strength),0!==this.agility&&(t.equippable.agility=this.agility),0!==this.constitution&&(t.equippable.constitution=this.constitution),0!==this.wisdom&&(t.equippable.wisdom=this.wisdom),0!==this.lightRadius&&(t.equippable.lightRadius=this.lightRadius),0!==this.maxStorage&&(t.equippable.maxStorage=this.maxStorage);const e=[];for(const t of this.storage)t?e.push(JSON.stringify(t.save())):e.push(null);return e.length>0&&(t.equippable.storage=e),this.cachedSave=t,t}getDescription(){let t="<span class='item__details-line'>Type: <span style='color: #fff;'>"+this.slot+"</span></span>";return 0===this.minDamage&&0===this.maxDamage||(t+="<span class='item__details-line'>Damage: <span style='color: #f00;'>",this.minDamage===this.maxDamage?t+=this.minDamage:t+=this.minDamage+" - "+this.maxDamage,t+="</span></span>"),0!==this.defense&&(t+="<span class='item__details-line'>Defense: <span style='color: #fff;'>"+this.defense+"</span></span>"),0!==this.blockChance&&(t+="<span class='item__details-line'>Block Chance: <span style='color: #fff;'>"+this.blockChance+"</span></span>"),0!==this.health&&(t+="<span class='item__details-line'>Health: <span style='color: #fff;'>+"+this.health+"</span></span>"),0!==this.mana&&(t+="<span class='item__details-line'>Mana: <span style='color: #fff;'>+"+this.mana+"</span></span>"),0!==this.strength&&(t+="<span class='item__details-line'>Strength: <span style='color: #fff;'>+"+this.strength+"</span></span>"),0!==this.agility&&(t+="<span class='item__details-line'>Agility: <span style='color: #fff;'>+"+this.agility+"</span></span>"),0!==this.constitution&&(t+="<span class='item__details-line'>Constitution: <span style='color: #fff;'>+"+this.constitution+"</span></span>"),0!==this.wisdom&&(t+="<span class='item__details-line'>Wisdom: <span style='color: #fff;'>+"+this.wisdom+"</span></span>"),0!==this.lightRadius&&(t+="<span class='item__details-line'>Light Radius: <span style='color: #fff;'>+"+this.lightRadius+"</span></span>"),-1===this.maxStorage?t+="<span class='item__details-line'>Storage: <span style='color: #fff;'>Unlimited</span></span>":this.maxStorage>0&&(t+="<span class='item__details-line'>Storage: <span style='color: #fff;'>"+this.maxStorage+"</span></span>"),t}addFullStacks(t){if(this.clearSaveCache(),-1===this.maxStorage)this.storage.push(t),t.parentEntity=this;else for(let e=0;e<this.maxStorage;e++)if(!this.storage[e])return this.storage[e]=t,t.parentEntity=this,!0;return!1}addPartialStacks(t){if(t.amount<=0)return!1;this.clearSaveCache();const e=t.amount;let n,s=t.amount;n=-1===this.maxStorage?this.storage.length:this.maxStorage;for(let e=0;e<n;e++){const n=this.storage[e];if(n&&t.id===n.id){const e=n.maxStackSize-n.amount;if(e>=s)return n.setAmount(n.amount+s),!0;n.setAmount(n.amount+e),t.setAmount(t.amount-e),s-=e}}return e!==s}use(t,e){t.setAmount(t.amount-e),t.amount<=0&&this.remove(t),this.clearSaveCache()}remove(t){const e=this.storage.indexOf(t);e>-1&&this.storage.splice(e,1,null),this.clearSaveCache(),es.needsMapUpdate=!0}setItem(t,e){this.storage[t]=e,this.clearSaveCache()}move(t,e){if(t!==e){const n=this.storage[t];this.storage[t]=this.storage[e],this.storage[e]=n,this.clearSaveCache(),this.isPlayer()&&oe.populateInventory(es.player)}}drop(t){if(t){let e=this.parentEntity;for(;"actor"!==e.type;)e=e.parentEntity;const n=e.getComponent("positionalobject");es.gameMap.addItem(t,n),e===es.player&&b.text("You dropped the "+t.name).build(),this.remove(t),this.clearSaveCache(),e===es.player&&oe.populateInventory(es.player)}}}const Se=new class{constructor(){this.types=new Map,this.load(new ce),this.load(new Mt),this.load(new Ae),this.load(new Jt),this.load(new ue),this.load(new me),this.load(new he),this.load(new ae),this.load(new ne),this.load(new de),this.load(new _e),this.load(new ke),this.load(new Me),this.load(new be),this.load(new we),this.load(new yt),this.load(new dt),this.load(new fe),this.load(new _t),this.load(new Ct),this.load(new ge),this.load(new Kt),this.load(new Nt),this.load(new It),this.load(new ie),this.load(new xe),this.load(new Bt),this.load(new $t),this.load(new Et),this.load(new xt)}load(t){this.types.set(t.type,t)}create(t,e,n){return new(0,this.types.get(e).constructor)(n)}};class ze{constructor(t,e){e&&(t.type=e),this.type=t.type||"entity",this.id=t.id,this.name=t.name||"",this.description=t.description||"",this.componentArray=[],this.components={},this.parent=null,this.combatTweens=[],t.components&&(this.loadComponents(t,t.components),this.callEvent("onComponentsLoaded")),this.cachedSave=null}loadComponents(t,e){const n=this;Object.keys(e).forEach((function(e){const s=Se.types.get(e);if(s){const o=s.baseType;n.getComponent(o)||n.setComponent(Se.create(this,e,t))}}))}setComponent(t){t.parentEntity=this,this.components[t.baseType]=t,this.componentArray.push(t),this.clearSaveCache()}getComponent(t){return this.components[t]}removeComponent(t){if(this.components[t]){this.components[t]=void 0;for(const e of this.componentArray)if(e.baseType===t){const t=this.componentArray.indexOf(e);this.componentArray.splice(t,1);break}this.clearSaveCache()}}clearSaveCache(){this.cachedSave=null}save(){if(null!==this.cachedSave)return this.cachedSave;const t={id:this.id,type:this.type,name:this.name,description:this.description,components:{}};for(const e of this.componentArray){const n=e.save();null!==n&&n!=={}&&pt.deep(t.components,n)}return this.cachedSave=t,t}clone(){console.error("Not implemented")}callEvent(t,e){for(const n of this.componentArray)n[t]?.(e);this[t]?.(e)}getComponentDescriptions(){let t="";for(const e of this.componentArray)t+=e.getDescription();return t}stopCombatAnimations(){for(const t of this.combatTweens)t.stop();const t=this.getComponent("positionalobject");t&&t.updateObjectPosition()}setName(t){this.name=t,this.clearSaveCache()}onEntityDeath(){this.setName("Remains of "+this.name)}}class je extends ze{constructor(t={}){super(t,"tile")}clone(){return new je(this.save())}}class De extends ze{constructor(t={}){super(t,"actor")}isAlive(){const t=this.getComponent("fighter");return t&&t.hp>0}clone(){return new De(this.save())}}class Oe extends ze{constructor(t={}){super(t,"item"),this.amount=1,this.maxStackSize=1,void 0!==t.amount&&(this.amount=t.amount),void 0!==t.maxStackSize&&(this.maxStackSize=t.maxStackSize)}save(){const t=super.save();return 1!==this.amount&&(t.amount=this.amount),1!==this.maxStackSize&&(t.maxStackSize=this.maxStackSize),t}clone(){return new Oe(this.save())}setAmount(t){this.amount=t,this.clearSaveCache()}}var Te=n(4319),Pe=n(974),Le=n(4147),Re=n(5945),Ne=n(4451),Fe=n(1238),qe=n(7191),We=n(1365),Ue=n(6611),Ye=n(3755),He=n(8517),Ve=n(8217),Xe=n(9889),Ge=n(2853),Ze=n(9375),Qe=n(4276),Je=n(3116),Ke=n(7165),$e=n(4763),tn=n(81),en=n(2283),nn=n(8002),sn=n(5510);const on=new class{constructor(){this.types=new Map,this.templates=new Map,this.load(new je),this.load(new De),this.load(new Oe),this.loadTemplates()}load(t){this.types.set(t.type,t)}create(t,e={}){let n;if(n="object"==typeof t?t:JSON.parse(t),void 0!==n.extends){const t=JSON.parse(this.templates.get(n.extends));return delete n.extends,this.create(pt.deep(t,n),e)}return new(this.types.get(n.type).constructor)(pt.deep(n,e))}loadTemplates(){this.loadTemplate(Te),this.loadTemplate(Pe),this.loadTemplate(Le),this.loadTemplate(Re),this.loadTemplate(Ne),this.loadTemplate(Fe),this.loadTemplate(qe),this.loadTemplate(We),this.loadTemplate(Ue),this.loadTemplate(Ye),this.loadTemplate(He),this.loadTemplate(Ve),this.loadTemplate(Xe),this.loadTemplate(Ge),this.loadTemplate(Ze),this.loadTemplate(Qe),this.loadTemplate(Je),this.loadTemplate(Ke),this.loadTemplate($e),this.loadTemplate(tn),this.loadTemplate(en),this.loadTemplate(nn),this.loadTemplate(sn)}loadTemplate(t){for(const e of t){const t=e.id;this.templates.has(t)?console.error("Template for entity id '"+t+"' already exists."):this.templates.set(t,JSON.stringify(e))}}createFromTemplate(t,e={}){if(this.templates.has(t)){const n=this.templates.get(t);return this.create(n,e)}return console.error("Json template for id '"+t+"' is missing."),null}};class an{constructor(t,e,n){this.name=t,this.width=e,this.height=n,this.timeout=null,this.saveCache=null,this.init()}init(){this.tiles=new Map;for(let t=-1;t<=2;t++)this.tiles.set(t,rt.create2dArray(this.width));this.actors=[],this.items=[]}create(){}teardown(){this.timeout&&clearTimeout(this.timeout),es.fov.teardown(),es.airFov.teardown();const t=this.tiles.entries();for(const e of t){const t=e[1];for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const s=t[e][n];s&&s.callEvent("onMapTeardown")}}for(const t of this.actors)t.callEvent("onMapTeardown");for(const t of this.items)t.callEvent("onMapTeardown")}removeEntity(t){t instanceof De?this.removeActor(t):t instanceof Oe&&this.removeItem(t)}removeItem(t){const e=this.items.indexOf(t);e>-1&&this.items.splice(e,1)}addItem(t,e){const n=t.getComponent("positionalobject");e||(e=n);let s=t.amount;for(const o of this.items)if(o.id===t.id){const i=o.getComponent("positionalobject"),a=o.getComponent("remnant");if(i&&e.isSamePosition(i)&&(!a||!a.isRemnant)){if(-1===o.maxStackSize)return o.setAmount(o.amount+t.amount),n.teardown(),!1;const e=o.maxStackSize-o.amount;if(e>=s)return o.setAmount(o.amount+s),n.teardown(),!1;o.setAmount(o.amount+e),t.setAmount(t.amount-e),s-=e}}return s>0?(t.setAmount(s),n.moveTo(e.x,e.y,e.z,!1),t.parent=null,this.items.push(t),n.setVisible(),!0):(n.teardown(),!1)}removeActor(t){const e=this.actors.indexOf(t);e>-1&&this.actors.splice(e,1)}save(){if(es.gameMap!==this&&this.saveCache)return this.saveCache;const t={name:this.name,width:this.width,height:this.height,tiles:{}},e=this.tiles.entries();for(const n of e){const e=[],s=[];let o="",i=65;for(let t=0;t<this.width;t++)for(let a=0;a<this.height;a++){const r=n[1][t][a];if(r){const t=JSON.stringify(r.save()),n=e.indexOf(t);n>-1?o+=String.fromCharCode(s[n]):(e.push(t),s.push(i),o+=String.fromCharCode(i),i++," "===String.fromCharCode(i)&&i++)}else o+=" "}const a=n[0];t.tiles[a]={},t.tiles[a].key=o,t.tiles[a].map={};for(let n=0;n<e.length;n++)t.tiles[a].map[String.fromCharCode(s[n])]=e[n]}const n=[];for(const t of this.actors)n.push(JSON.stringify(t.save()));t.actors=n;const s=[];for(const t of this.items)s.push(JSON.stringify(t.save()));return t.items=s,this.saveCache=t,t}load(t){const e=t.tiles,n=this.tiles.entries();for(const t of n){const n=t[1],s=e[t[0]];if(s){const e=s.key,o=s.map;for(let s=0;s<this.width;s++)for(let i=0;i<this.height;i++){const a=o[e[s*this.height+i]];a&&(n[s][i]=on.create(a,{components:{positionalobject:{x:s,y:i,z:t[0]}}}))}}}const s=t.actors;for(const t of s){const e=on.create(t);this.actors.push(e)}const o=t.items;for(const t of o){const e=on.create(t);this.items.push(e)}}isInBounds(t,e){return 0<=t&&t<this.width&&0<=e&&e<this.height}revealPreviouslyExplored(){const t=this.tiles.entries();for(const e of t)for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++){const s=e[1][t][n];if(s){const t=s.getComponent("positionalobject");if(t&&!t.isVisible()){const e=s.getComponent("fov");e&&e.explored&&(t.setVisible(),this.setTransparency(t,-5,-5,t.z),t.shiftColor(.5))}}}for(const t of this.items){const e=t.getComponent("remnant");if(e&&e.isRemnant){const e=t.getComponent("positionalobject");e.setVisible(),e.shiftColor(.5)}}for(const t of this.actors){const e=t.getComponent("remnant");if(e&&e.isRemnant){const e=t.getComponent("positionalobject");e.setVisible(),e.shiftColor(.5)}}}revealFromPosition(t,e,n,s=25){const o=this,i=Math.max(0,t-n),a=Math.min(es.gameMap.width,t+n),r=Math.max(0,e-n),l=Math.min(es.gameMap.height,e+n);0===s?o._revealGradually(i,a,r,l,t,e,1,n,s):o.timeout=setTimeout((function(){o._revealGradually(i,a,r,l,t,e,1,n,s)}),s)}_revealGradually(t,e,n,s,o,i,a,r,l){const c=this;c.timeout=null,a<=r&&(c.timeout=setTimeout((function(){c._revealGradually(t,e,n,s,o,i,a+1,r,l)}),l));const h=o-a,p=o+a,m=i-a,d=i+a;for(let t=h;t<=p;t++){const e=t===h||t===p;for(let n=m;n<=d;n++)(e||n===m||n===d)&&(this._revealAtPosition(t,n),es.needsMapUpdate=!0)}return!0}_revealAtPosition(t,e){const n=this.tiles.entries();for(const s of n)if(s[1][t]){const n=s[1][t][e];if(n){const t=n.getComponent("positionalobject");t&&!t.isVisible()&&(t.setVisible(),this.setTransparency(t,-5,-5,t.z),t.shiftColor(.5),n.getComponent("fov")||n.setComponent(new It({components:{fov:{explored:!0,visible:!1}}})))}}for(const n of this.items){const s=n.getComponent("remnant");if(s&&s.isRemnant){const s=n.getComponent("positionalobject");s&&s.x===t&&s.y===e&&n.getComponent("positionalobject").teardown()}}for(const n of this.actors){const s=n.getComponent("remnant");if(s&&s.isRemnant){const s=n.getComponent("positionalobject");s&&s.x===t&&s.y===e&&n.getComponent("positionalobject").teardown()}}for(const n of this.items){const s=n.getComponent("remnant");if(!s||!s.isRemnant){const s=n.getComponent("positionalobject");if(s&&s.x===t&&s.y===e&&!s.isVisible()){const t=n.clone();t.setName("Sighting of "+t.name),t.removeComponent("ai"),t.removeComponent("blocksMovement"),t.removeComponent("blocksFov"),t.setComponent(new $t({components:{remnant:{isRemnant:!0,x:s.x,y:s.y,z:s.z}}}));const e=t.getComponent("positionalobject");e.setVisible(),e.shiftColor(.5),n instanceof De?this.actors.push(t):this.items.push(t),n.setComponent(new $t({components:{remnant:{isRemnant:!1,x:s.x,y:s.y,z:s.z}}})),s.setVisible(!1),n.callEvent("onCreateRemnant")}}}for(const n of this.actors){const s=n.getComponent("remnant");if(!s||!s.isRemnant){const s=n.getComponent("positionalobject");if(s&&s.x===t&&s.y===e&&!s.isVisible()){const t=n.clone();t.setName("Sighting of "+t.name),t.removeComponent("ai"),t.removeComponent("blocksMovement"),t.removeComponent("blocksFov"),t.setComponent(new $t({components:{remnant:{isRemnant:!0,x:s.x,y:s.y,z:s.z}}}));const e=t.getComponent("positionalobject");e.setVisible(),e.shiftColor(.5),n instanceof De?this.actors.push(t):this.items.push(t),n.setComponent(new $t({components:{remnant:{isRemnant:!1,x:s.x,y:s.y,z:s.z}}})),s.setVisible(!1),n.callEvent("onCreateRemnant")}}}}reveal(){const t=this.tiles.entries();for(const e of t)for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++){const s=e[1][t][n];if(s){const t=s.getComponent("positionalobject");t&&!t.isVisible()&&(t.setVisible(),this.setTransparency(t,-5,-5,t.z),t.shiftColor(.5),s.getComponent("fov")||s.setComponent(new It({components:{fov:{explored:!0,visible:!1}}})))}}for(const t of this.items){const e=t.getComponent("remnant");e&&e.isRemnant&&t.getComponent("positionalobject").teardown()}for(const t of this.actors){const e=t.getComponent("remnant");e&&e.isRemnant&&t.getComponent("positionalobject").teardown()}for(const t of this.items){const e=t.getComponent("remnant");if(!e||!e.isRemnant){const e=t.getComponent("positionalobject");if(e&&!e.isVisible()){const n=t.clone();n.setName("Sighting of "+n.name),n.removeComponent("ai"),n.removeComponent("blocksMovement"),n.removeComponent("blocksFov"),n.setComponent(new $t({components:{remnant:{isRemnant:!0,x:e.x,y:e.y,z:e.z}}}));const s=n.getComponent("positionalobject");s.setVisible(),s.shiftColor(.5),t instanceof De?this.actors.push(n):this.items.push(n),t.setComponent(new $t({components:{remnant:{isRemnant:!1,x:e.x,y:e.y,z:e.z}}})),e.setVisible(!1),t.callEvent("onCreateRemnant")}}}for(const t of this.actors){const e=t.getComponent("remnant");if(!e||!e.isRemnant){const e=t.getComponent("positionalobject");if(e&&!e.isVisible()){const n=t.clone();n.setName("Sighting of "+n.name),n.removeComponent("ai"),n.removeComponent("blocksMovement"),n.removeComponent("blocksFov"),n.setComponent(new $t({components:{remnant:{isRemnant:!0,x:e.x,y:e.y,z:e.z}}}));const s=n.getComponent("positionalobject");s.setVisible(),s.shiftColor(.5),t instanceof De?this.actors.push(n):this.items.push(n),t.setComponent(new $t({components:{remnant:{isRemnant:!1,x:e.x,y:e.y,z:e.z}}})),e.setVisible(!1),t.callEvent("onCreateRemnant")}}}}updateFOV(t,e,n,s){es.fov.compute(t,e,n,s,n-2,n+1),es.airFov.compute(t,e,n,2*s,n+2,n+8)}draw(t,e,n){this.drawItemsInFov(es.fov,t,e,n),this.drawItemsInFov(es.airFov,t,e,n)}drawItemsInFov(t,e,n,s){const o=t.newObjects,i=[];for(const e of o)if(e instanceof je){const t=e.getComponent("fov");t?(t.setExplored(!0),t.setVisible(!0)):e.setComponent(new It({components:{fov:{explored:!0,visible:!0}}}))}else if(e instanceof Oe){const n=e.getComponent("remnant");if(n&&n.isRemnant){const n=e.getComponent("positionalobject");n&&n.teardown(),this.removeItem(e),i.push(e),t.removeVisible(e)}}else if(e instanceof De){const n=e.getComponent("remnant");if(n)if(n.isRemnant){e.getComponent("positionalobject").teardown(),this.removeActor(e),i.push(e);const n=t.visibleObjects.indexOf(e);n>-1&&t.visibleObjects.splice(n,1)}else{const s=[];for(const o of this.actors){if(o===e)continue;const a=o.getComponent("remnant");if(a&&a.isRemnant&&n.x===a.x&&n.y===a.y&&n.z===a.z){o.getComponent("positionalobject").teardown(),s.push(o),i.push(o);const e=t.visibleObjects.indexOf(o);e>-1&&t.visibleObjects.splice(e,1),o.callEvent("onDestroyRemnant");const a=[];for(const e of this.items){const s=e.getComponent("remnant");if(s&&s.isRemnant&&n.x===s.x&&n.y===s.y&&n.z===s.z){a.push(e);const n=e.getComponent("positionalobject");n&&n.teardown(),i.push(e),t.removeVisible(e)}}for(const t of a)this.removeItem(t);break}}for(const t of s)this.removeActor(t);e.removeComponent("remnant")}}for(const t of i){const e=o.indexOf(t);e>-1&&o.splice(e,1)}for(const e of t.previousVisibleObjects)if(-1===t.visibleObjects.indexOf(e)){const n=e.getComponent("fov");n&&n.setVisible(!1),t.oldObjects.push(e)}for(const t of o){const e=t.getComponent("positionalobject");e&&(e.isVisible()?e.resetColor():e.setVisible()),t.callEvent("onAddToScene")}const a=t.visibleObjects;for(const t of a)if(t instanceof je){const o=t.getComponent("positionalobject");o&&this.setTransparency(o,e,n,s)}const r=t.oldObjects;for(const t of r){const o=t.getComponent("positionalobject");if(o){const i=t instanceof De;if(i||t instanceof Oe){const e=t.clone();e.setName("Sighting of "+e.name),e.removeComponent("ai"),e.removeComponent("blocksMovement"),e.removeComponent("blocksFov"),e.setComponent(new $t({components:{remnant:{isRemnant:!0,x:o.x,y:o.y,z:o.z}}}));const n=e.getComponent("positionalobject");n.setVisible(),n.shiftColor(.5),i?this.actors.push(e):this.items.push(e),t.setComponent(new $t({components:{remnant:{isRemnant:!1,x:o.x,y:o.y,z:o.z}}})),o.setVisible(!1),t.callEvent("onCreateRemnant")}else this.setTransparency(o,e,n,s),o.hasObject()&&o.shiftColor(.5)}}}setTransparency(t,e,n,s){if(t.z>=s){const o=Math.abs(e-t.x),i=Math.abs(n-t.y);t.z>s?t.x>=e&&t.y<=n&&Math.max(o,i)<t.z+3?t.z>s+1?t.setTransparency(0):t.setTransparency(.1):t.setTransparency(1):t.z<=s+1&&o<=1&&i<=1?t.setTransparency(.5):t.setTransparency(1)}else t.setTransparency(1)}getAliveActorAtLocation(t){let e=null;for(const n of this.actors)if(n.isAlive()){const s=n.getComponent("positionalobject");if(s&&t.x===s.x&&t.y===s.y&&t.z===s.z){e=n;break}}return e}getBlockingActorAtLocation(t,e,n){let s=null;for(const o of this.actors){const i=o.getComponent("positionalobject");if(i&&t===i.x&&e===i.y&&n===i.z){const t=o.getComponent("blocksMovement");if(t&&t.blocksMovement){s=o;break}}}return s}isPositionVisible(t){let e=!1;for(let n=t.z-1;n<=t.z+1;n++){const n=this.tiles.get(t.z);if(n){const s=n[t.x];if(s){const n=s[t.y];if(n){const t=n.getComponent("fov");if(t&&t.visible){e=!0;break}}}}}return e}addPlayer(t,e,n=1){es.player||(es.player=on.createFromTemplate("player")),this.actors.push(es.player);const s=es.player.getComponent("positionalobject");s.x=t,s.y=e,s.z=n,s.setVisible(),as.updateCameraPosition(es.player),this.updatePlayerUI()}updatePlayerUI(){const t=es.player.getComponent("fighter");Ce.updateAll(),Ot.update(t.hp,t.maxHp),Pt.update(t.mana,t.maxMana),x.updatePlayerDetails(),oe.populateInventory(es.player)}}class rn extends an{constructor(){super("tutorial-map",35,15),this.floor=["###################################","###################################","###################################","#####≈≈############################","#####≈≈############################","###################################","###################################","###################################","###################################","###################################","###################################","###################################","###################################","###################################","###################################"],this.wall=["###################################","###################################","####====###########################","####=  =###########################","####=  =###########################","####=  =###########################","####=  =###########################","##===  =########################===","##=    =#################======#= >","##=    =#########=======#=    =#= =","##=    ===========     ===    === =","##=                    + +        =","##=       ==== ===     ===    =====","##=========##= =#=======#=    =####","#############= =#########======####"],this.overlay=["###################################","########## RoguelikeDev ######v5_0#","###################################","############ does the ####2021#6-8#","###################################","### Complete Roguelike Tutorial ###","#####..############################","#####..############################","###....##########################.#","###....###################....###.#","###....###########.....###....###.#","###....................#.#........#","###.......####.###.....###....#####","##############.###########....#####","##############.####################"]}init(){super.init(),this.tiles.set(wt.Decorative,rt.create2dArray(this.width))}create(){super.create();const t=[16738009,16738047,14247679,11691775,9201407,6711039,6730495,6740479,6750169,6750130,6750054,11730790,14286694,16777062,16767334,16757350,16747622,16737932,16737970,16738009,16738047,14247679,11691775,9201407,6711039,65471,65408,65280,8453888,16776960,16760576,16744448,3355443,3355443,3355443,3355443,3355443,3355443,3355443,41945,55769,55715,55660,55552,7133440,10737920,14276864,14263040,14248960,14235136,14221312,3355443,3355443,3355443,3355443];let e=0;for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++){switch(this.floor[this.height-n-1].charAt(s)){case"#":this.tiles.get(-1)[s][n]=on.createFromTemplate("floor",{components:{positionalobject:{x:s,y:n,z:-1}}}),this.tiles.get(wt.Floor)[s][n]=on.createFromTemplate("floor",{components:{positionalobject:{x:s,y:n,z:0}}});break;case"≈":this.tiles.get(-1)[s][n]=on.createFromTemplate("floor",{components:{positionalobject:{x:s,y:n,z:-1}}}),this.tiles.get(wt.Floor)[s][n]=on.createFromTemplate("water",{components:{positionalobject:{x:s,y:n,z:0}}})}switch(this.wall[this.height-n-1].charAt(s)){case"#":case"=":this.tiles.get(wt.Wall)[s][n]=on.createFromTemplate("wall",{components:{positionalobject:{x:s,y:n,z:1}}});break;case"+":this.tiles.get(wt.Wall)[s][n]=on.createFromTemplate("door",{components:{positionalobject:{x:s,y:n,z:1}}});break;case">":this.tiles.get(wt.Wall)[s][n]=on.createFromTemplate("stairs_north",{components:{positionalobject:{x:s,y:n,z:1}}})}let o=this.overlay[this.height-n-1].charAt(s);"#"!==o&&("."!==o&&(this.tiles.get(wt.DecorativeBG)[s][n]=on.createFromTemplate("art_backing",{components:{positionalobject:{x:s,y:n,z:2}}}))," "!==o&&"."!==o&&("_"===o&&(o="."),this.tiles.get(wt.Decorative)[s][n]=on.createFromTemplate("art",{components:{characterobject:{x:s,y:n,z:2.05,letter:o,color:t[e]}}}),e++))}this.addPlayer(21,3),es.gameMap.actors.push(on.createFromTemplate("gelatinous_cube",{components:{positionalobject:{x:18,y:4,z:1}}}));for(let t=0;t<2;t++)es.gameMap.items.push(on.createFromTemplate("scroll_confusion",{components:{positionalobject:{x:21,y:3,z:1}}}));es.gameMap.items.push(on.createFromTemplate("potion_health",{components:{positionalobject:{x:19,y:4,z:1}}})),es.gameMap.items.push(on.createFromTemplate("tower_shield",{components:{positionalobject:{x:19,y:4,z:1}}}));for(let t=18;t<=22;t++)for(let e=2;e<=4;e++)es.gameMap.items.push(on.createFromTemplate("gold",{amount:5,components:{positionalobject:{x:t,y:e,z:1}}}))}}var ln=n(7461),cn=n(9138),hn=n(2805);const pn=new class{constructor(){this.entityGroups=new Map,this.itemGroups=new Map,this.generators=new Map,this.loadEntityGroups(ln),this.loadItemGroups(cn),this.loadGenerator("basic-dungeon",hn)}loadEntityGroups(t){for(const e of t)this.entityGroups.set(e.id,e.entities)}loadItemGroups(t){for(const e of t)this.itemGroups.set(e.id,e.items)}loadGenerator(t,e){this.generators.set(t,e)}getChancesForLevel(t,e){let n;const s=this.generators.get(t);for(const t of s){if(t.level>e)break;n=t}return n}getActorForLevel(t,e){const n=this.getChancesForLevel(t,e).actors;let s=this.getRandomFromGroup(n);for(;void 0!==s.group;){const t=this.entityGroups.get(s.group);s=this.getRandomFromGroup(t)}return s.id}getItemForLevel(t,e){const n=this.getChancesForLevel(t,e).items;let s=this.getRandomFromGroup(n);for(;void 0!==s.group;){const t=this.itemGroups.get(s.group);s=this.getRandomFromGroup(t)}return s.id}getRandomFromGroup(t){let e,n=0;for(const e of t)n+=e.weight;let s=0;const o=a.M8C.randFloat(0,n);for(const n of t)if(s+=n.weight,o<s){e=n;break}return e}};class mn extends class{constructor(){}placeEntities(){}}{constructor(t,e,n,s){super(),this.x1=t,this.y1=e,this.x2=t+n,this.y2=e+s,this.width=n,this.height=s}getCenterX(){return Math.round((this.x1+this.x2)/2)}getCenterY(){return Math.round((this.y1+this.y2)/2)}intersects(t){return this.x1<=t.x2&&this.x2>=t.x1&&this.y1<=t.y2&&this.y2>=t.y1}createRoom(t){const e=Math.max(0,this.x1),n=Math.min(t.width,this.x2+1),s=Math.max(0,this.y1),o=Math.min(t.height,this.y2+1);for(let i=e;i<n;i++)for(let e=s;e<o;e++){const n=t.tiles.get(wt.Floor)[i][e];n||(t.tiles.get(wt.Floor)[i][e]=on.createFromTemplate("floor",{components:{positionalobject:{x:i,y:e,z:0}}}));const s=(i===this.x1||i===this.x2)&&e>=this.y1&&e<=this.y2,o=(e===this.y1||e===this.y2)&&i>=this.x1&&i<=this.x2,a=t.tiles.get(wt.Wall)[i][e];o||s?n||a||(t.tiles.get(wt.Wall)[i][e]=on.createFromTemplate("wall",{components:{positionalobject:{x:i,y:e,z:1}}})):a&&(t.tiles.get(wt.Wall)[i][e]=null)}}placeEntities(t,e,n){const s=a.M8C.randInt(0,n);for(let n=0;n<s;n++){const n=a.M8C.randInt(this.x1+1,this.x2-1),s=a.M8C.randInt(this.y1+1,this.y2-1);if(!es.gameMap.getBlockingActorAtLocation(n,s,1)){const o={components:{positionalobject:{x:n,y:s,z:1}}},i=pn.getActorForLevel(t,e),a=on.createFromTemplate(i,o);es.gameMap.actors.push(a)}}}placeItems(t,e,n){const s=a.M8C.randInt(0,n);for(let n=0;n<s;n++){const n={components:{positionalobject:{x:a.M8C.randInt(this.x1+1,this.x2-1),y:a.M8C.randInt(this.y1+1,this.y2-1),z:1}}},s=pn.getItemForLevel(t,e),o=on.createFromTemplate(s,n);es.gameMap.items.push(o)}const o=a.M8C.randInt(0,n);for(let t=0;t<o;t++){const t=a.M8C.randInt(this.x1+1,this.x2-1),e=a.M8C.randInt(this.y1+1,this.y2-1),n={amount:a.M8C.randInt(1,25),components:{positionalobject:{x:t,y:e,z:1}}},s=on.createFromTemplate("gold",n);es.gameMap.items.push(s)}}}class dn{static floorEntity=on.createFromTemplate("floor",{components:{positionalobject:{x:0,y:0,z:0}}});static wallEntity=on.createFromTemplate("wall",{components:{positionalobject:{x:0,y:0,z:0}}});constructor(){}static tunnelBetween(t,e,n,s,o){let i,a;Math.random()<.5?(i=s,a=n):(i=e,a=o),this.bresenham(t,e,n,i,a),this.bresenham(t,i,a,s,o)}static bresenham(t,e,n,s,o){if(e===s){if(n===o)return;let s=n,i=o;n>o&&(s=o,i=n);for(let n=e-1;n<=e+1;n++)for(let o=s;o<=i;o++)this.bresenhamCreateTiles(t,n===e,n,o)}else{let o=e,i=s;e>s&&(o=s,i=e);for(let e=n-1;e<=n+1;e++)for(let s=o;s<=i;s++)this.bresenhamCreateTiles(t,e===n,s,e)}}static bresenhamCreateTiles(t,e,n,s){if(e){const e=t.tiles.get(1)[n][s];if(e){const o=e.getComponent("blocksMovement");o&&o.blocksMovement&&(t.tiles.get(1)[n][s]=null)}}else if(!t.tiles.get(0)[n][s]){const e=this.wallEntity.clone();e.getComponent("positionalobject").moveTo(n,s,1,!1),t.tiles.get(1)[n][s]=e}const o=this.floorEntity.clone();o.getComponent("positionalobject").moveTo(n,s,0,!1),t.tiles.get(0)[n][s]=o}}class An extends an{constructor(t,e,n={}){const s=n.level||1;super("basic-dungeon-"+s,t,e),this.maxRooms=n.maxRooms||30,this.roomMinSize=n.roomMinSize||6,this.roomMaxSize=n.roomMaxSize||10,this.level=s,this.maxMonstersByFloor=[{level:1,amount:2},{level:4,amount:3},{level:7,amount:4}],this.maxItemsByFloor=[{level:1,amount:2},{level:4,amount:3},{level:6,amount:5}]}getFloorAmount(t){let e=0;for(const n of t){if(n.level>this.level)break;e=n.amount}return e}save(){if(es.gameMap!==this&&this.saveCache)return this.saveCache;const t=super.save();return 1!==this.level&&(t.level=this.level),this.saveCache=t,t}create(t,e){super.create();const n=on.createFromTemplate("floor",{components:{positionalobject:{x:0,y:0,z:0}}}),s=on.createFromTemplate("wall",{components:{positionalobject:{x:0,y:0,z:0}}});for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){const o=n.clone();o.getComponent("positionalobject").moveTo(e,t,-1,!1);const i=n.clone();i.getComponent("positionalobject").moveTo(e,t,0,!1);const a=s.clone();a.getComponent("positionalobject").moveTo(e,t,1,!1),this.tiles.get(-1)[e][t]=o,this.tiles.get(0)[e][t]=i,this.tiles.get(1)[e][t]=a}const o=[];for(let n=0;n<this.maxRooms;n++){const n=a.M8C.randInt(this.roomMinSize,this.roomMaxSize),s=a.M8C.randInt(this.roomMinSize,this.roomMaxSize),i=a.M8C.randInt(0,this.width-n-1),r=a.M8C.randInt(0,this.height-s-1),l=new mn(i,r,n,s);let c=!1;for(const t of o)if(l.intersects(t)){c=!0;break}if(!c){if(l.createRoom(this),0===o.length){const n=l.getCenterX(),s=l.getCenterY();if(e&&e.setPosition(n,s,1),es.player){const e=es.player.getComponent("positionalobject");e&&(this.tiles.get(1)[n][s]=on.createFromTemplate("stairs_north",{components:{positionalobject:{x:n,y:s,z:1},stairsInteractable:{map:t,x:e.x,y:e.y,z:e.z}}}))}else this.tiles.get(1)[n][s]=on.createFromTemplate("stairs_north",{components:{positionalobject:{x:n,y:s,z:1},stairsInteractable:{map:"town",x:31,y:31,z:0}}});this.addPlayer(n,s)}else{const t=o[o.length-1];dn.tunnelBetween(this,t.getCenterX(),t.getCenterY(),l.getCenterX(),l.getCenterY())}l.placeEntities("basic-dungeon",this.level,this.getFloorAmount(this.maxMonstersByFloor)),l.placeItems("basic-dungeon",this.level,this.getFloorAmount(this.maxItemsByFloor)),o.push(l)}}const i=o[o.length-1],r=i.getCenterX(),l=i.getCenterY();this.tiles.get(0)[r][l]=on.createFromTemplate("stairs_north",{components:{positionalobject:{x:r,y:l,z:0},stairsInteractable:{generator:"basic-dungeon"}}})}}var un=n(6620);const gn=new class extends v{constructor(){super(un),this.addAction("select","👆",!0),this.addAction("paint","🖌"),this.addAction("delete","⌫"),this.activeAction="select",this.dom.addEventListener("click",this)}handleEvent(t){switch(t.type){case"click":this.setControl(t)}}addAction(t,e,n){const s=document.createElement("button");s.id="editor-controls-"+t,s.setAttribute("data-action",t),s.classList.add("editor-controls__action"),n&&s.classList.add("active"),s.innerHTML=e,this.dom.appendChild(s)}setControl(t){const e=t.target;if("submit"===e.type&&!e.classList.contains("active")){const t=e.parentNode.children;for(const e of t)e.classList.remove("active");this.activeAction=e.getAttribute("data-action"),e.classList.add("active")}}};var fn=n(7666);const vn=new class extends v{constructor(){super(fn),this.dataMap=new Map;const t=document.createElement("div");t.classList.add("editor-info__component","active"),this.addData("entity",t),this.addData("name",t),this.dom.appendChild(t),this.positionalObject=document.createElement("div"),this.positionalObject.classList.add("editor-info__component"),this.addData("baseType",this.positionalObject),this.addData("x",this.positionalObject),this.addData("y",this.positionalObject),this.addData("z",this.positionalObject),this.addData("color",this.positionalObject),this.addDataInput("scale",this.positionalObject),this.addData("xRot",this.positionalObject),this.addData("yRot",this.positionalObject),this.addData("zRot",this.positionalObject),this.addData("xOffset",this.positionalObject),this.addData("yOffset",this.positionalObject),this.addData("zOffset",this.positionalObject),this.dom.appendChild(this.positionalObject),this.walkable=document.createElement("div"),this.walkable.classList.add("editor-info__component"),this.addData("walkable",this.walkable),this.dom.appendChild(this.walkable),this.blocksMovement=document.createElement("div"),this.blocksMovement.classList.add("editor-info__component"),this.addData("blocksMovement",this.blocksMovement),this.dom.appendChild(this.blocksMovement)}addDataInput(t,e){this.addData(t,e,"input")}addData(t,e,n="text"){const s=this,o=document.createElement("div");o.classList.add("editor-info__data");const i=document.createElement("span");let a;i.classList.add("editor-info__label"),i.innerHTML=t+": ",o.appendChild(i),"text"===n?a=document.createElement("span"):"input"===n&&(a=document.createElement("input"),a.setAttribute("tabindex","-1"),a.onchange=function(t){s.updateScale(s,t)},a.onblur=function(t){s.updateScale(s,t)}),a.classList.add("editor-info__"+n),a.id="editor-info-"+t,o.appendChild(a),e.appendChild(o),this.dataMap.set(t,a)}updateScale(t,e){let n=e.target.value;if(n<.1?(n=.1,e.target.value=n):n>1&&(n=1,e.target.value=n),t.entity){const e=t.entity.getComponent("positionalobject");e&&(e.scale=n,e.teardown(),e.setVisible(),es.needsMapUpdate=!0)}}setData(t,e){const n=this.dataMap.get(t);"INPUT"===n.tagName?n.value=e:n.innerHTML=e}setDataForEntity(t){this.entity=t,this.setData("entity",t.type),this.setData("name",t.name);const e=t.getComponent("positionalobject");e?(this.positionalObject.classList.add("active"),this.setData("x",e.x),this.setData("y",e.y),this.setData("z",e.z),this.setData("baseType",e.type),this.setData("color",e.color),this.setData("scale",e.scale),this.setData("xRot",e.xRot),this.setData("yRot",e.yRot),this.setData("zRot",e.zRot),this.setData("xOffset",e.xOffset),this.setData("yOffset",e.yOffset),this.setData("zOffset",e.zOffset)):this.positionalObject.classList.remove("active");const n=t.getComponent("walkable");n?(this.walkable.classList.add("active"),this.setData("walkable",n.walkable)):this.walkable.classList.remove("active");const s=t.getComponent("blocksMovement");s?(this.blocksMovement.classList.add("active"),this.setData("blocksMovement",s.blocksMovement)):this.blocksMovement.classList.remove("active")}};class bn extends I{constructor(){super(),this.selectedEntity=null,gn.open(),vn.open()}teardown(){super.teardown(),this.clearSelected(),gn.close(),vn.close()}clearSelected(){if(null!==this.selectedEntity){const t=this.selectedEntity.getComponent("positionalobject");t&&t.removeHighlight()}}handleInput(){let t=null;return at.testPressed("editor-up")?t=new Qt(es.player,0,1):at.testPressed("editor-down")?t=new Qt(es.player,0,-1):at.testPressed("editor-left")?t=new Qt(es.player,-1):at.testPressed("editor-right")?t=new Qt(es.player,1):at.testPressed("debug")?(es.gameMap.reveal(),es.needsMapUpdate=!0,es.setEventHandler(new Vn),gn.close(),vn.close()):at.testPressed("debug2")&&(es.clearMaps(),es.setMap(new rn)),t}onLeftClick(t){if("CANVAS"===t.target.tagName)if("select"===gn.activeAction){const e=this.getMouseIntersectingObjects(t);let n=!1;for(let t=0;t<e.length;t++){const s=e[t].object.parentEntity;if(s){const t=s.getComponent("positionalobject");if(t){if(0===t.transparency)continue;this.clearSelected(),this.selectedEntity=s,vn.setDataForEntity(this.selectedEntity),t.highlight()}n=!0;break}}n||this.clearSelected()}else"delete"===gn.activeAction&&this.removeEntityFromMouseEvent(t);es.needsMapUpdate=!0}onMouseMove(t){const e=this.getMouseIntersectingObjects(t);let n=!1;for(let t=0;t<e.length;t++){const s=e[t].object.parentEntity;if(s){const t=s.getComponent("positionalobject");if(t&&!t.highlighted){if(0===t.transparency)continue;this.isHighlighted(s)||this.clearAndSetHighlight(s)}n=!0;break}}n||this.clearHighlights(!0),this.mouseDown&&"delete"===gn.activeAction&&this.removeEntityFromMouseEvent(t),es.needsMapUpdate=!0}removeEntityFromMouseEvent(t){const e=this.getMouseIntersectingObjects(t);for(let t=0;t<e.length;t++){const n=e[t].object.parentEntity;if(n){const t=n.getComponent("positionalobject");n instanceof je?es.gameMap.tiles.get(t.z)[t.x][t.y]=null:n instanceof De?es.gameMap.removeActor(n):n instanceof Oe&&es.gameMap.removeItem(n),t.teardown();break}}}}class yn extends c{constructor(t){super(t)}perform(){const t=this.entity.getComponent("positionalobject"),e=this.entity.getComponent("inventory"),n=[];let s=!1;for(const o of es.gameMap.items){const i=o.getComponent("positionalobject");t.x===i.x&&t.y===i.y&&t.z===i.z&&(e.add(o)?(s=!0,o.parentEntity=e,es.gameMap.removeItem(o),i.teardown(),es.fov.remove(o),es.needsMapUpdate=!0,this.isPlayer()&&(oe.populateInventory(es.player),o.amount>1?b.text("You picked up "+o.amount+" "+o.name):b.text("You picked up the "+o.name),b.build())):n.push(o))}const o=this.entity.getComponent("equipment");for(const t of n){if(o.addItem(t)){const e=t.getComponent("positionalobject");return es.gameMap.removeItem(t),e.teardown(),es.fov.remove(t),es.needsMapUpdate=!0,this.isPlayer()&&(oe.populateInventory(es.player),t.amount>1?b.text("You picked up "+t.amount+" "+t.name):b.text("You picked up the "+t.name),b.build()),this}if(!s)return new h(this.entity,"Nothing to pick up here.")}return new y(this.entity)}}class Cn extends re{constructor(){super()}handleInput(){at.testPressed("look")&&this.exit(),super.handleInput()}confirmIndex(){this.exit()}}var xn=n(1122);const In=new class extends v{constructor(){super(xn)}};var _n=n(7244);const wn=new class{constructor(){this.saveName="default",this.autosaveTurnCounter=0,this.loadSaves()}getCurrentSaveName(){return"save-"+this.saveName}save(){this.saveSaves(),es.save(this.getCurrentSaveName())}delete(t){delete this.saves[t],this.save(),this.saveName===t&&(this.saveName="default")}autosave(){const t=es.settings;if(t.autosavesEnabled){if(this.autosaveTurnCounter<t.autosaveTurns)return void this.autosaveTurnCounter++;let e;this.autosaveTurnCounter=0;const n=this.getLastAutosave();e=-1===n?1:n<t.autosaveAmount?n+1:1,es.save(this.getCurrentSaveName()+"-autosave"+e),this.setLastAutosave(e),b.text("Game autosaved.").build()}}loadSaves(){const t=localStorage.getItem("saves");this.saves=t?JSON.parse(t):{}}saveSaves(){void 0===this.saves[this.saveName]&&(this.saves[this.saveName]={name:this.getCurrentSaveName(),lastAutosave:-1,date:new Date}),localStorage.setItem("saves",JSON.stringify(this.saves))}getLastAutosave(){const t=this.saves[this.saveName];return void 0===t?-1:t.lastAutosave}setLastAutosave(t){const e=this.saves[this.saveName];void 0===e?this.saves[this.saveName]={name:this.getCurrentSaveName(),lastAutosave:t}:e.lastAutosave=t,this.saveSaves()}};var Bn=n(3258);const En=new class extends v{constructor(){super(_n),this.oldSavesDom=this.dom.getElementsByClassName("loadgame__oldsaves")[0],this.loadSaves()}loadSaves(){const t=this;this.oldSavesDom.innerHTML="";for(const[e,n]of Object.entries(wn.saves)){const s=this.htmlToElement(Bn);s.getElementsByClassName("save__text")[0].innerText=e,s.getElementsByClassName("save__date")[0].innerText=this.formatDate(n.date),s.getElementsByClassName("save__time")[0].innerText=this.formatTime(n.date),t.oldSavesDom.appendChild(s)}}formatDate(t){const e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}formatTime(t){const e=new Date(t);return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}};class kn extends I{constructor(t){super(),this.previousEventHandler=t}returnToPreviousMenu(){es.setEventHandler(new this.previousEventHandler.constructor)}}class Mn extends kn{constructor(t){super(t),En.loadSaves(),En.open()}teardown(){super.teardown(),En.close()}onLeftClick(t){const e=t.target,n=e.classList;if(n.contains("menu__back"))this.returnToPreviousMenu();else if(n.contains("save__title")){const t=e.getElementsByClassName("save__text")[0];wn.saveName=t.innerText,es.load(wn.getCurrentSaveName()),es.setEventHandler(new Vn)}else if(n.contains("save__delete")){const t=e.parentNode.getElementsByClassName("save__text")[0].innerText;wn.delete(t),En.loadSaves()}}}var Sn=n(656);const zn=new class extends v{constructor(){super(Sn)}};class jn extends kn{constructor(t){super(t),this.isEditingKey=!1,this.editingDom=null,this.tempValue=null,this.tempControls=at.clone(),this.populateControls(),zn.open()}teardown(){super.teardown(),zn.close()}onLeftClick(t){const e=t.target,n=e.classList;this.editingDom&&(this.editingDom.value=this.tempValue,this.editingDom=null,this.isEditingKey=!1),n.contains("menu__save")?this.saveAndExit():n.contains("menu__cancel")?this.cancel():n.contains("menu__reset")?this.resetControls():"INPUT"===e.tagName&&(this.tempValue=e.value,e.value="",this.editingDom=e,this.isEditingKey=!0)}onKeydown(t){const e=t.target;if(this.isEditingKey&&"INPUT"===e.tagName){const n=e.getAttribute("data-key"),s=e.getAttribute("data-index"),o=at.getKey(t.key,t.code);e.value=o,t.preventDefault(),e.blur(),this.setKey(n,s,o),this.isEditingKey=!1,this.editingDom=null}}setKey(t,e,n){this.tempControls.get(t)[e]=n}saveAndExit(){at.setControls(this.tempControls),this.returnToPreviousMenu()}cancel(){this.returnToPreviousMenu()}resetControls(){at.resetToDefault(),this.tempControls=at.clone(),this.populateControls()}populateControls(){this.populateControl("up","control-moveup"),this.populateControl("down","control-movedown"),this.populateControl("left","control-moveleft"),this.populateControl("right","control-moveright"),this.populateControl("nw","control-movenw"),this.populateControl("ne","control-movene"),this.populateControl("sw","control-movesw"),this.populateControl("se","control-movese"),this.populateControl("wait","control-movewait"),this.populateControl("inventory","control-inventory"),this.populateControl("character","control-character"),this.populateControl("closeall","control-closeall"),this.populateControl("get","control-get"),this.populateControl("look","control-look"),this.populateControl("pause","control-pause"),this.populateControl("interact","control-interact"),this.populateControl("quicksave","control-quicksave"),this.populateControl("quickload","control-quickload"),this.populateControl("confirm","control-confirm"),this.populateControl("cancel","control-cancel"),this.populateControl("modifier-speed1","control-targetingmodifier1"),this.populateControl("modifier-speed2","control-targetingmodifier2"),this.populateControl("modifier-speed3","control-targetingmodifier3"),this.populateControl("debug","control-revealmap"),this.populateControl("debug2","control-debugroom"),this.populateControl("reset","control-generatemap")}populateControl(t,e){const n=at.controls.get(t),s=document.getElementById(e);s.setAttribute("data-key",t),s.setAttribute("data-index","0"),n.length>0?s.value=n[0]:s.value="";const o=document.getElementById(e+"-alt");o.setAttribute("data-key",t),o.setAttribute("data-index","1"),n.length>1?o.value=n[1]:o.value=""}}var Dn=n(4603);const On=new class extends v{constructor(){super(Dn),this.showStats=!0}};class Tn{constructor(){this.messageConsolePosition="",this.autosavesEnabled=!0,this.autosaveAmount=3,this.autosaveTurns=100,this.displayFPS=!1,this.debugControlsEnabled=!1,this.load()}load(){const t=localStorage.getItem("settings");if(t){const e=JSON.parse(t);void 0!==e.messageConsolePosition&&(this.messageConsolePosition=e.messageConsolePosition),void 0!==e.autosavesEnabled&&(this.autosavesEnabled=e.autosavesEnabled),void 0!==e.autosaveAmount&&(this.autosaveAmount=e.autosaveAmount),void 0!==e.autosaveTurns&&(this.autosaveTurns=e.autosaveTurns),void 0!==e.displayFPS&&(this.displayFPS=e.displayFPS),void 0!==e.debugControlsEnabled&&(this.debugControlsEnabled=e.debugControlsEnabled)}}save(){const t={messageConsolePosition:this.messageConsolePosition,autosavesEnabled:this.autosavesEnabled,autosaveAmount:this.autosaveAmount,autosaveTurns:this.autosaveTurns,displayFPS:this.displayFPS,debugControlsEnabled:this.debugControlsEnabled};localStorage.setItem("settings",JSON.stringify(t))}}class Pn extends kn{constructor(t){super(t),this.tempSettings=new Tn,this.populateSettings(),On.open()}teardown(){super.teardown(),On.close()}onLeftClick(t){const e=t.target,n=e.id,s=e.classList;s.contains("menu__save")?this.saveAndExit():s.contains("menu__cancel")?this.cancel():"setting-displayfps"===n?(this.tempSettings.displayFPS=e.checked,this.applyDisplayFPS(this.tempSettings)):"setting-autosavesenabled"===n?(this.tempSettings.autosavesEnabled=e.checked,this.applyAutosavesEnabled(this.tempSettings)):"setting-debugcontrolsenabled"===n&&(this.tempSettings.debugControlsEnabled=e.checked)}onChange(t){const e=t.target,n=e.id;if("setting-autosaveamount"===n){let t=parseInt(e.value);t?t<1?(e.value=1,t=1):t>9&&(e.value=9,t=9):(e.value=3,t=3),this.tempSettings.autosaveAmount=t}else if("setting-autosaveturns"===n){let t=parseInt(e.value);t?t<10?(e.value=10,t=10):t>1e3&&(e.value=1e3,t=1e3):(e.value=100,t=100),this.tempSettings.autosaveTurns=t}}saveAndExit(){es.settings=this.tempSettings,es.settings.save(),this.returnToPreviousMenu()}cancel(){this.applyAllSettings(es.settings),this.returnToPreviousMenu()}populateSettings(){document.getElementById("setting-displayfps").checked=this.tempSettings.displayFPS,document.getElementById("setting-debugcontrolsenabled").checked=this.tempSettings.debugControlsEnabled,document.getElementById("setting-autosavesenabled").checked=this.tempSettings.autosavesEnabled,document.getElementById("setting-autosaveamount").value=this.tempSettings.autosaveAmount,document.getElementById("setting-autosaveturns").value=this.tempSettings.autosaveTurns}applyAllSettings(t){this.applyDisplayFPS(t),this.applyAutosavesEnabled(t)}applyDisplayFPS(t){as.updateStatsVisibility(t)}applyAutosavesEnabled(t){const e=document.getElementById("setting-autosaveamount"),n=document.getElementById("setting-autosaveturns");t.autosavesEnabled?(e.removeAttribute("disabled"),n.removeAttribute("disabled")):(e.setAttribute("disabled","disabled"),n.setAttribute("disabled","disabled"))}}var Ln=n(7469);const Rn=new class extends v{constructor(){super(Ln)}};class Nn extends kn{constructor(t){super(t);const e=this;Rn.open(),this.timeout=setTimeout((function(){e.onLeftClick()}),31e3)}teardown(){super.teardown(),clearTimeout(this.timeout),Rn.close()}onLeftClick(){this.returnToPreviousMenu()}}var Fn=n(5257);const qn=new class extends v{constructor(){super(Fn),this.overwriteDom=this.dom.getElementsByClassName("savegame__overwrite")[0],this.oldSavesDom=this.dom.getElementsByClassName("savegame__oldsaves")[0]}loadSaves(){const t=this;this.oldSavesDom.innerHTML="";for(const[e,n]of Object.entries(wn.saves)){const s=this.htmlToElement(Bn);s.getElementsByClassName("save__text")[0].innerText=e,s.getElementsByClassName("save__date")[0].innerText=this.formatDate(n.date),s.getElementsByClassName("save__time")[0].innerText=this.formatTime(n.date),t.oldSavesDom.appendChild(s)}}formatDate(t){const e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}formatTime(t){const e=new Date(t);return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}};class Wn extends kn{constructor(t){super(t),this.overwriteName="",qn.loadSaves(),qn.open()}teardown(){super.teardown(),qn.close()}onLeftClick(t){const e=t.target,n=e.classList;if(qn.overwriteDom.classList.contains("active"))n.contains("save__overwrite")?(wn.saveName=this.overwriteName,wn.save(),qn.loadSaves(),qn.overwriteDom.classList.remove("active")):n.contains("save__overwrite-cancel")&&qn.overwriteDom.classList.remove("active");else if(n.contains("menu__back"))this.returnToPreviousMenu();else if(n.contains("save__confirm")){const t=qn.dom.getElementsByClassName("savegame__newsave-input")[0].value;void 0!==wn.saves[t]?(qn.overwriteDom.getElementsByClassName("savegame__overwrite-title")[0].innerText=t+" already exists. Overwrite?",this.overwriteName=t,qn.overwriteDom.classList.add("active")):(wn.saveName=t,wn.save(),qn.loadSaves())}else if(n.contains("save__title")){const t=e.getElementsByClassName("save__text")[0].innerText;qn.overwriteDom.getElementsByClassName("savegame__overwrite-title")[0].innerText="Overwrite "+t+"?",this.overwriteName=t,qn.overwriteDom.classList.add("active")}else if(n.contains("save__delete")){const t=e.parentNode.getElementsByClassName("save__text")[0].innerText;wn.delete(t),qn.loadSaves()}}}class Un extends I{constructor(t){super(t),In.open()}teardown(){super.teardown(),In.close()}handleInput(){at.testPressed("pause")&&es.setEventHandler(new Vn)}onLeftClick(t){const e=t.target;switch(e.id){case"pausemenu__savegame":this.openSaveGameMenu();break;case"pausemenu__loadgame":this.openLoadGameMenu();break;case"pausemenu__controls":this.openControlsMenu();break;case"pausemenu__settings":this.openSettingsMenu();break;case"pausemenu__credits":this.openCreditsMenu();break;case"pausemenu__quit":this.quit()}e.classList.contains("menu__returntogame")&&es.setEventHandler(new Vn)}openSaveGameMenu(){es.setEventHandler(new Wn(this))}openLoadGameMenu(){es.setEventHandler(new Mn(this))}openControlsMenu(){es.setEventHandler(new jn(this))}openSettingsMenu(){es.setEventHandler(new Pn(this))}openCreditsMenu(){es.setEventHandler(new Nn(this))}quit(){es.player=null,es.setEventHandler(new Kn)}}class Yn extends c{constructor(t){super(t)}perform(){const t=this.entity.getComponent("positionalobject");if(!t)return new h(this.entity,"Entity doesn't have a position.");const e=es.gameMap,n=e.tiles.get(t.z)[t.x][t.y];if(n){const t=n.getComponent("interactable");if(t)return t.interact(),new y(this.entity)}const s=e.tiles.get(t.z-1)[t.x][t.y];if(s){const t=s.getComponent("interactable");if(t)return t.interact(),new y(this.entity)}return new h(this.entity,"There is nothing to interact with here.")}}class Hn extends te{constructor(t,e,n){super(t,e,n)}perform(){this.entity.getComponent("equipment").drop(this.item)}}class Vn extends I{constructor(){super(),Ce.open(),Ot.open(),Pt.open(),b.open(),x.open()}teardown(){super.teardown(),Ce.close(),Ot.close(),Pt.close(),b.close(),x.close()}handleInput(){let t=null;return this.isPlayerTurn&&(at.testPressed("up")?t=new Qt(es.player,0,1):at.testPressed("down")?t=new Qt(es.player,0,-1):at.testPressed("left")?t=new Qt(es.player,-1):at.testPressed("right")?t=new Qt(es.player,1):at.testPressed("nw")?t=new Qt(es.player,-1,1):at.testPressed("ne")?t=new Qt(es.player,1,1):at.testPressed("sw")?t=new Qt(es.player,-1,-1):at.testPressed("se")?t=new Qt(es.player,1,-1):at.testPressed("wait")?t=new Wt(es.player):at.testPressed("get")?t=new yn(es.player):at.testPressed("interact")?t=new Yn(es.player):at.testPressed("look")?es.setEventHandler(new Cn):at.testPressed("inventory")?(oe.toggle(),this.hideItemTooltip()):at.testPressed("character")?Rt.toggle():at.testPressed("closeall")?(oe.isOpen()&&oe.close(),Rt.isOpen()&&Rt.close()):at.testPressed("pause")?es.setEventHandler(new Un):at.testPressed("quicksave",1e3)?es.save("quicksave"):at.testPressed("quickload",1e3)?es.load("quicksave"):es.settings.debugControlsEnabled&&(at.testPressed("debug")?(es.gameMap.reveal(),es.needsMapUpdate=!0,es.setEventHandler(new bn)):at.testPressed("debug2")?(es.clearMaps(),es.setMap(new rn)):at.testPressed("reset")&&"town"!==es.gameMap.name&&(es.clearAllButTownMaps(),es.setMap(new An(100,100))))),t}onMouseMove(t){const e=t.target;this.mouse.x=t.clientX/as.canvasDom.offsetWidth*2-1,this.mouse.y=-t.clientY/as.canvasDom.offsetHeight*2+1,this.raycaster.setFromCamera(this.mouse,as.camera);const n=this.raycaster.intersectObject(as.scene,!0);let s=!1;for(let t=0;t<n.length;t++){const e=n[t].object.parentEntity;if(e&&e instanceof je){const t=e.getComponent("positionalobject");if(t){if(0===t.transparency||!t.hasObject())continue;this.isHighlighted(e)||this.clearAndSetHighlight(e),s=!0;break}}}if(s||this.clearHighlights(!0),this.attemptToDrag&&(this.dragDistance=Math.max(Math.abs(this.dragStart.x-t.clientX),Math.abs(this.dragStart.y-t.clientY)),this.dragDistance>10&&(this.attemptToDrag=!1,this.startDragging())),this.isDragging&&(oe.itemDragDom.style.left=t.clientX+this.dragOffset.x+"px",oe.itemDragDom.style.top=t.clientY+this.dragOffset.y+"px"),this.attemptToDrag||this.isDragging)this.hoveringOver=null;else if(e.classList.contains("slot")&&e.classList.contains("has-item"))if(e!==this.hoveringOver){this.hoveringOver=t.target;const n=e.getElementsByClassName("item__details")[0].cloneNode(!0);oe.itemTooltipDom.innerHTML="",oe.itemTooltipDom.appendChild(n),this.updateToolTipSize(t),oe.itemTooltipDom.classList.add("active")}else this.updateToolTipSize(t);else this.hideItemTooltip();es.needsMapUpdate=!0}startDragging(){this.isDragging=!0,this.slotDragging.classList.add("dragging"),oe.itemDragDom.classList.add("active"),this.hideItemTooltip()}updateToolTipSize(t){const e=oe.itemTooltipDom.getBoundingClientRect();oe.itemTooltipDom.style.left=t.clientX-e.width-25+"px",oe.itemTooltipDom.style.top=t.clientY-e.height/2+"px"}hideItemTooltip(){this.hoveringOver=null,oe.itemTooltipDom.classList.remove("active")}onLeftClick(t){if(this.isDragging)this.isDragging=!1;else{const e=t.target,n=e.classList;if(n.contains("has-item")){const t=e.getAttribute("data-index");let s;if(n.contains("inventory__storage-slot")){const n=e.parentNode.getAttribute("data-index");s=oe.openStorages[n].getComponent("equippable").storage[t]}else if(n.contains("belt-slot")){const t=e.getAttribute("data-index"),n=es.player.getComponent("equipment");if(n){const e=n.getItem(7);e&&(s=e.getComponent("equippable").storage[t])}}if(s){const t=s.getComponent("consumable");t&&(this.hideItemTooltip(),es.processAction(t.getAction())&&oe.populateInventory(es.player))}}else if(n.contains("stat__level")){const t=es.player.getComponent("level");if(t.statPointsAvailable>0){const n=es.player.getComponent("fighter"),s=e.parentNode.classList;s.contains("stat--strength")?(n.baseStrength+=1,n.recalculateStats(),t.useStatPoint()):s.contains("stat--agility")?(n.baseAgility+=1,n.recalculateStats(),t.useStatPoint()):s.contains("stat--constitution")?(n.baseConstitution+=1,n.recalculateStats(),t.useStatPoint(),Ot.update(n.hp,n.maxHp)):s.contains("stat--wisdom")&&(n.baseWisdom+=1,n.recalculateStats(),t.useStatPoint(),Pt.update(n.mana,n.maxMana))}}else n.contains("hotbar__open-inventory")?oe.toggle():n.contains("hotbar__open-character")?Rt.toggle():n.contains("hotbar__open-skill")}}onMouseDown(t){const e=t.target;if(e.classList.contains("slot")&&!e.classList.contains("belt-slot")&&e.classList.contains("has-item")){if(e.classList.contains("pickup-slot")){const t=e.getAttribute("data-index"),n=oe.itemsOnGround[t];if(n&&es.player.getComponent("inventory").add(n))return es.gameMap.removeItem(n),n.getComponent("positionalobject").teardown(),es.fov.remove(n),oe.populateInventory(es.player),void(es.needsMapUpdate=!0)}this.slotDragging=e,document.body.classList.add("disable-select");const n=e.getBoundingClientRect();this.dragStart=new a.FM8(t.clientX,t.clientY),this.attemptToDrag=!0,this.dragOffset=new a.FM8(n.left-t.clientX,n.top-t.clientY);const s=e.getElementsByClassName("item")[0].cloneNode(!0);oe.itemDragDom.innerHTML="",oe.itemDragDom.appendChild(s),oe.itemDragDom.style.width=n.width+"px",oe.itemDragDom.style.height=n.height+"px",oe.itemDragDom.style.left=t.clientX+this.dragOffset.x+"px",oe.itemDragDom.style.top=t.clientY+this.dragOffset.y+"px"}}onMouseUp(t){if(this.attemptToDrag=!1,document.body.classList.remove("disable-select"),this.isDragging){this.slotDragging.classList.remove("dragging"),oe.itemDragDom.classList.remove("active");const e=es.player.getComponent("equipment"),n=t.target,s=this.slotDragging.classList.contains("pickup-slot"),o=this.slotDragging.classList.contains("inventory__storage-slot"),i=this.slotDragging.classList.contains("inventory__equipment-slot"),a=n.classList.contains("pickup-slot"),r=n.classList.contains("inventory__storage-slot"),l=n.classList.contains("inventory__equipment-slot"),c=this.slotDragging.getAttribute("data-index"),h=n.getAttribute("data-index");if((a||r||l)&&!n.classList.contains("disabled")){if(s){const t=oe.itemsOnGround[c];if(l){const n=t.getComponent("equippable");if(n&&n.slot===e.items[h].slot){const n=e.getItem(h);n&&es.processAction(new Hn(es.player,n)),e.setItem(h,t),t.parentEntity=e,es.gameMap.removeItem(t),t.getComponent("positionalobject").teardown(),es.fov.remove(t),es.needsMapUpdate=!0,oe.populateInventory(es.player),Ce.updateBeltSlots(),es.player.callEvent("onEquipmentChange")}}else if(r){const e=n.parentNode.getAttribute("data-index"),s=oe.openStorages[e].getComponent("equippable"),o=s.storage[h];o&&s.drop(o),s.setItem(h,t),t.parentEntity=s,es.gameMap.removeItem(t),t.getComponent("positionalobject").teardown(),es.fov.remove(t),es.needsMapUpdate=!0,oe.populateInventory(es.player),Ce.updateBeltSlots()}}else if(i){const t=e.getItem(c);if(l)h!==c&&e.items[h].slot===e.items[c].slot&&(e.move(c,h),oe.populateInventory(es.player),Ce.updateBeltSlots(),es.player.callEvent("onEquipmentChange"));else if(r){const s=n.parentNode.getAttribute("data-index"),o=oe.openStorages[s];if(t===o)return void b.text("You can't put "+t.name+" inside itself!").build();const i=o.getComponent("equippable"),a=i.storage[h];if(a){const n=t.getComponent("equippable");if(n&&n.slot!==e.items[h].slot)return}e.setItem(c,a),i.setItem(h,t),t.parentEntity=e,oe.populateInventory(es.player),Ce.updateBeltSlots(),es.player.callEvent("onEquipmentChange")}else a&&(es.processAction(new Hn(es.player,t)),Ce.updateBeltSlots(),es.player.callEvent("onEquipmentChange"))}else if(o){const t=this.slotDragging.parentNode.getAttribute("data-index"),s=oe.openStorages[t],o=s.getComponent("equippable"),i=o.storage[c];if(l){const t=i.getComponent("equippable");if(t&&t.slot===e.items[h].slot){const t=e.getItem(h);let n=i.parentEntity;for(;n;){if(n===t)return void b.text("You can't equip a container from within its parent. Consider moving it elsewhere first.").build();n=n.parentEntity}e.setItem(h,i),o.setItem(c,t),i.parentEntity=e,oe.populateInventory(es.player),Ce.updateBeltSlots(),es.player.callEvent("onEquipmentChange")}}else if(r){const t=n.parentNode.getAttribute("data-index"),e=oe.openStorages[t];if(s===e)o.move(c,h),oe.populateInventory(es.player),Ce.updateBeltSlots();else{const t=e.getComponent("equippable"),n=t.storage[h];o.setItem(c,n),n&&(n.parentEntity=o),t.setItem(h,i),i.parentEntity=t,oe.populateInventory(es.player),Ce.updateBeltSlots()}}else a&&(o.drop(i),Ce.updateBeltSlots())}}else if("CANVAS"===n.tagName)if(o){const t=this.slotDragging.parentNode.getAttribute("data-index"),e=oe.openStorages[t].getComponent("equippable"),n=e.storage[c];e.drop(n)}else i&&es.processAction(new Hn(es.player,e.getItem(c)))}}}var Xn=n(7157);const Gn=new class extends v{constructor(){super(Xn)}};class Zn extends mn{constructor(t,e,n,s){super(t,e,n,s)}createRoom(t){this.walls=[];const e=Math.max(0,this.x1),n=Math.min(t.width,this.x2+1),s=Math.max(0,this.y1),o=Math.min(t.height,this.y2+1);for(let i=e;i<n;i++)for(let e=s;e<o;e++){const n=t.tiles.get(0)[i][e];n||(t.tiles.get(-1)[i][e]=on.createFromTemplate("floor",{components:{positionalobject:{x:i,y:e,z:-1}}}),t.tiles.get(0)[i][e]=on.createFromTemplate("floor",{components:{positionalobject:{x:i,y:e,z:0}}}));const s=(i===this.x1||i===this.x2)&&e>=this.y1&&e<=this.y2,o=(e===this.y1||e===this.y2)&&i>=this.x1&&i<=this.x2,a=t.tiles.get(1)[i][e];o||s?n||a||(t.tiles.get(1)[i][e]=on.createFromTemplate("wall",{components:{positionalobject:{x:i,y:e,z:1}}}),t.tiles.get(2)[i][e]=on.createFromTemplate("wall",{components:{positionalobject:{x:i,y:e,z:2}}}),o&&s||this.walls.push(t.tiles.get(1)[i][e])):a&&(t.tiles.get(1)[i][e]=null)}const i=a.M8C.randInt(0,this.walls.length-1),r=this.walls[i].getComponent("positionalobject");t.tiles.get(1)[r.x][r.y]=on.createFromTemplate("door",{components:{positionalobject:{x:r.x,y:r.y,z:1}}});const l=a.M8C.randInt(this.x1+1,this.x2-1),c=a.M8C.randInt(this.y1+1,this.y2-1),h=on.createFromTemplate("shop_owner",{components:{positionalobject:{x:l,y:c,z:1}}});es.gameMap.actors.push(h)}}class Qn extends mn{constructor(t,e,n,s){super(t,e,n,s)}createRoom(t){this.walls=[];const e=Math.max(0,this.x1),n=Math.min(t.width,this.x2+1),s=Math.max(0,this.y1),o=Math.min(t.height,this.y2+1);for(let i=e;i<n;i++)for(let e=s;e<o;e++){const n=i>this.x1+this.width/2,s=e<this.y1+this.height/2,o=t.tiles.get(0)[i][e];o||(t.tiles.get(-1)[i][e]=on.createFromTemplate("floor",{components:{positionalobject:{x:i,y:e,z:-1}}}),t.tiles.get(0)[i][e]=n||s?on.createFromTemplate("floor",{components:{positionalobject:{x:i,y:e,z:0}}}):on.createFromTemplate("floor_gravel",{components:{positionalobject:{x:i,y:e,z:0}}}));const a=(i===this.x1||i===this.x2)&&e>=this.y1&&e<=this.y2,r=(e===this.y1||e===this.y2)&&i>=this.x1&&i<=this.x2,l=t.tiles.get(1)[i][e];r||a?o||l||!n&&!s||(t.tiles.get(1)[i][e]=on.createFromTemplate("wall",{components:{positionalobject:{x:i,y:e,z:1}}}),t.tiles.get(2)[i][e]=on.createFromTemplate("wall",{components:{positionalobject:{x:i,y:e,z:2}}}),r&&a||this.walls.push(t.tiles.get(1)[i][e])):l&&(t.tiles.get(1)[i][e]=null)}const i=a.M8C.randInt(this.x1+1,this.x2-1),r=a.M8C.randInt(this.y1+1,this.y2-1),l=on.createFromTemplate("shop_owner",{components:{positionalobject:{x:i,y:r,z:1}}});es.gameMap.actors.push(l)}}class Jn extends an{constructor(){super("town",65,70)}init(){this.tiles=new Map;for(let t=-1;t<10;t++)this.tiles.set(t,rt.create2dArray(this.width));this.actors=[],this.items=[]}create(){super.create(),new Zn(18,28,6,8).createRoom(this),new Zn(16,40,7,7).createRoom(this),new Zn(35,48,10,6).createRoom(this),new Zn(40,41,5,7).createRoom(this),new Qn(37,26,10,10).createRoom(this);let t=10,e=15;for(let n=5;n<this.width-5;n++){const s=Math.random();s>.95?t-=1:s>.9&&(t+=1);const o=Math.random();o>.95?e-=1:o>.9&&(e+=1),e<t+2&&(e=t+2),e>t+6&&(e=t+6);for(let s=t;s<=e;s++)this.tiles.get(-1)[n][s]=on.createFromTemplate("floor",{components:{positionalobject:{x:n,y:s,z:-1}}}),this.tiles.get(0)[n][s]=on.createFromTemplate("water",{components:{positionalobject:{x:n,y:s,z:0}}})}for(let t=5;t<this.height-5;t++)for(let e=5;e<this.width-5;e++)if(44===e&&t>=33&&t<=35&&(this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("table",{components:{positionalobject:{x:e,y:t,z:1}}})),(37===e&&36===t||42===e&&31===t)&&(this.tiles.get(1)[e][t]=on.createFromTemplate("post",{components:{positionalobject:{x:e,y:t,z:1}}}),this.tiles.get(2)[e][t]=on.createFromTemplate("post",{components:{positionalobject:{x:e,y:t,z:2}}})),!this.tiles.get(wt.Floor)[e][t])if(this.tiles.get(-1)[e][t]=on.createFromTemplate("floor",{components:{positionalobject:{x:e,y:t,z:-1}}}),this.tiles.get(wt.Floor)[e][t]=31===e&&31===t?on.createFromTemplate("stairs_north",{components:{positionalobject:{x:e,y:t,z:0},stairsInteractable:{generator:"basic-dungeon"}}}):on.createFromTemplate("floor_grass",{components:{positionalobject:{x:e,y:t,z:0}}}),29===e&&t>=35&&t<=39)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("fence_vertical",{components:{positionalobject:{x:e,y:t,z:1}}});else if(32===e&&41===t)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("well",{components:{positionalobject:{x:e,y:t,z:1}}});else if(36!==e&&37!==e||47!==t)if(19===e&&17===t)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("bench_south",{components:{positionalobject:{x:e,y:t,z:1}}});else if(20===e&&17===t)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("bench_south_left",{components:{positionalobject:{x:e,y:t,z:1}}});else if(18===e&&17===t)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("bench_south_right",{components:{positionalobject:{x:e,y:t,z:1}}});else if(e>17&&e<21&&20===t)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("bench_stone",{components:{positionalobject:{x:e,y:t,z:1}}});else{const n=this.tiles.get(wt.Floor)[e][t];if(n.components.walkable&&n.components.walkable.walkable)if(Math.random()<.01)this.createTree(e,t);else if(Math.random()<.05)this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("stone",{components:{positionalobject:{x:e,y:t,z:1}}});else if(Math.random()<.3){const n=a.M8C.randInt(1,4);this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("grass"+n,{components:{positionalobject:{x:e,y:t,z:1}}})}}else this.tiles.get(wt.Wall)[e][t]=on.createFromTemplate("barrel",{components:{positionalobject:{x:e,y:t,z:1}}});this.addPlayer(33,36)}createTree(t,e){for(let n=1;n<=8;n++)this.tiles.get(n)[t][e]=on.createFromTemplate("tree_trunk",{components:{positionalobject:{x:t,y:e,z:n}}});for(let n=5;n<10;n++)for(let s=-2;s<=2;s++)for(let o=-2;o<=2;o++)if(0!==s||0!==o){const i=Math.abs(s),a=Math.abs(o);if(2===i||2===a){if(2===i&&2===a)continue;if(5===n||9===n)continue;if(Math.random()<.1)continue}this.tiles.get(n)[t+s]&&(this.tiles.get(n)[t+s][e+o]=on.createFromTemplate("tree_leaves",{components:{positionalobject:{x:t+s,y:e+o,z:n}}}))}this.tiles.get(9)[t][e]=on.createFromTemplate("tree_leaves",{components:{positionalobject:{x:t,y:e,z:9}}})}}class Kn extends I{constructor(){super(),Gn.open()}teardown(){super.teardown(),Gn.close()}onLeftClick(t){switch(t.target.id){case"mainmenu__newgame":this.startNewGame();break;case"mainmenu__loadgame":this.openLoadGameMenu();break;case"mainmenu__controls":this.openControlsMenu();break;case"mainmenu__settings":this.openSettingsMenu();break;case"mainmenu__credits":this.openCreditsMenu()}}startNewGame(){es.clearMaps(),es.setMap(new Jn),es.gameMap.reveal(),es.setEventHandler(new Vn),b.clear(),b.text("Welcome adventurer!").build()}openLoadGameMenu(){es.setEventHandler(new Mn(this))}openControlsMenu(){es.setEventHandler(new jn(this))}openSettingsMenu(){es.setEventHandler(new Pn(this))}openCreditsMenu(){es.setEventHandler(new Nn(this))}}class $n{constructor(){}loadMap(t,e={}){switch(t){case"basic-dungeon":return new An(100,100,e);default:return null}}}const ts=new class{constructor(){this.eventHandler=new Kn,this.settings=new Tn,this.player=null,this.gameMap=null,this.gameMaps=new Map,this.mapLoader=new $n,this.needsMapUpdate=!1,this.fov=new d,this.airFov=new A}setEventHandler(t){this.eventHandler&&this.eventHandler.teardown(),this.eventHandler=t}handleEvents(){this.processAction(this.eventHandler.handleInput())}processAction(t){if(t&&this.eventHandler.isPlayerTurn){const e=t.perform();return!(e instanceof y||(e instanceof h?(e.reason&&b.text(e.reason).build(),1):(as.updateCameraPosition(ts.player),ts.gameMap.updatePlayerUI(),ts.needsMapUpdate=!0,this.handleEnemyTurns(),wn.autosave(),0)))}}handleEnemyTurns(){this.eventHandler.isPlayerTurn=!1;for(const t of this.gameMap.actors)if(t!==this.player){const e=t.getComponent("ai");e&&e.perform()}this.eventHandler.isPlayerTurn=!0}setMap(t,e){if(this.gameMap===t)return;let n=null;if(this.gameMap){n=this.gameMap.name,this.gameMap.teardown();const t=this.gameMap.actors.indexOf(this.player);this.gameMap.actors.splice(t,1),this.gameMap.save()}this.gameMap=t,this.addMap(t,n,e),t.save(),-1===this.gameMap.actors.indexOf(this.player)&&this.gameMap.actors.push(this.player),this.player.getComponent("positionalobject").setVisible(),as.updateCameraPosition(this.player),this.gameMap.revealPreviouslyExplored(),this.gameMap.updatePlayerUI(),this.needsMapUpdate=!0}addMap(t,e,n){this.gameMaps.has(t.name)||(this.gameMaps.set(t.name,t),t.create(e,n))}clearMaps(){this.player=null,this.gameMaps=new Map}clearAllButTownMaps(){this.player=null;const t=this.gameMaps.get("town");this.gameMaps=new Map,this.gameMaps.set("town",t)}save(t){const e=[];for(const t of this.gameMaps.values())e.push(t.save());const n={name:t,date:new Date,currentMap:this.gameMap.name,maps:e};localStorage.setItem(t,JSON.stringify(n))}load(t){this.clearMaps();const e=localStorage.getItem(t);if(e){const t=JSON.parse(e),n=t.currentMap;for(const e of t.maps){const t=new an(e.name,e.width,e.height);if(t.load(e),this.addMap(t),t.name===n){for(const e of t.actors)if("Player"===e.name){this.player=e;break}this.setMap(t)}}}}},es=ts;var ns=n(2523);const ss=new class extends v{constructor(){super(ns)}};var os=n(9226);const is=new class extends v{constructor(){super(os)}},as=new class{constructor(){this.scene=new a.xsS,this.setupGameHtml(),this.setupLights(),this.updateCamera(),window.addEventListener("resize",this)}setupGameHtml(){const t=document.createElement("div");t.classList.add("game"),this.canvasDom=document.createElement("div"),this.canvasDom.classList.add("view"),t.appendChild(this.canvasDom),t.appendChild(x.dom),t.appendChild(Ce.dom),t.appendChild(b.dom),t.appendChild(oe.dom),t.appendChild(Rt.dom),t.appendChild(gn.dom),t.appendChild(vn.dom),t.appendChild(ss.dom),t.appendChild(is.dom),t.appendChild(zn.dom),t.appendChild(Rn.dom),t.appendChild(zt.dom),t.appendChild(En.dom),t.appendChild(Gn.dom),t.appendChild(In.dom),t.appendChild(qn.dom),t.appendChild(On.dom),this.renderer=new a.CP7({antialias:!0,alpha:!0}),this.renderer.setClearColor(11184810,1),this.canvasDom.appendChild(this.renderer.domElement),document.body.appendChild(t),this.stats=new(l()),this.stats.showPanel(0),this.stats.dom.classList.add("ui"),document.body.appendChild(this.stats.dom),this.updateStatsVisibility(es.settings)}handleEvent(t){switch(t.type){case"resize":this.updateCamera(),this.player&&this.updateCameraPosition(this.player)}}setupLights(){const t=new a.Mig(16777215,.5);this.scene.add(t);const e=new a.Ox3(16777215,.5);e.position.set(100,-300,400),this.scene.add(e)}updateCamera(){const t=this.canvasDom.offsetWidth/this.canvasDom.offsetHeight,e=80*-t/2,n=80*t/2;this.camera=new a.iKG(e,n,40,-40,-1e4,1e4),this.renderer.setSize(this.canvasDom.offsetWidth,this.canvasDom.offsetHeight)}updateCameraPosition(t,e=t){this.player=t,this.camera.up.set(0,0,1);const n=e.getComponent("positionalobject");if(n){const t=n.getObjectPosition();this.camera.position.set(200+t.x,-200+t.y,300),this.camera.lookAt(t.x,t.y,0),es.needsMapUpdate=!0}}updateStatsVisibility(t){t.displayFPS?this.stats.dom.classList.add("active"):this.stats.dom.classList.remove("active")}};class rs extends an{constructor(){super("main-menu",35,15),this.floor=["###################################","###################################","###################################","#####≈≈############################","#####≈≈############################","###################################","###################################","###################################","###################################","###################################","###################################","###################################","###################################","###################################","###################################"],this.wall=["###################################","###################################","####====###########################","####=  =###########################","####=  =###########################","####=  =###########################","####=  =###########################","##===  =########################===","##=    =#################======#= >","##=    =#########=======#=    =#= =","##=    ===========     ===    === =","##=                    + +        =","##=       ==== ===     ===    =====","##=========##= =#=======#=    =####","#############= =#########======####"],this.overlay=["###################################","########## RoguelikeDev ######v5_0#","###################################","############ does the ####2021#6-8#","###################################","### Complete Roguelike Tutorial ###","#####..############################","#####..############################","###....##########################.#","###....###################....###.#","###....###########.....###....###.#","###....................#.#........#","###.......####.###.....###....#####","##############.###########....#####","##############.####################"]}init(){super.init(),this.tiles.set(wt.Decorative,rt.create2dArray(this.width))}create(){super.create();const t=[16738009,16738047,14247679,11691775,9201407,6711039,6730495,6740479,6750169,6750130,6750054,11730790,14286694,16777062,16767334,16757350,16747622,16737932,16737970,16738009,16738047,14247679,11691775,9201407,6711039,65471,65408,65280,8453888,16776960,16760576,16744448,3355443,3355443,3355443,3355443,3355443,3355443,3355443,41945,55769,55715,55660,55552,7133440,10737920,14276864,14263040,14248960,14235136,14221312,3355443,3355443,3355443,3355443];let e=0;for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++){switch(this.floor[this.height-n-1].charAt(s)){case"#":this.tiles.get(-1)[s][n]=on.createFromTemplate("floor",{components:{positionalobject:{x:s,y:n,z:-1}}}),this.tiles.get(wt.Floor)[s][n]=on.createFromTemplate("floor",{components:{positionalobject:{x:s,y:n,z:0}}});break;case"≈":this.tiles.get(-1)[s][n]=on.createFromTemplate("floor",{components:{positionalobject:{x:s,y:n,z:-1}}}),this.tiles.get(wt.Floor)[s][n]=on.createFromTemplate("water",{components:{positionalobject:{x:s,y:n,z:0}}})}switch(this.wall[this.height-n-1].charAt(s)){case"#":case"=":this.tiles.get(wt.Wall)[s][n]=on.createFromTemplate("wall",{components:{positionalobject:{x:s,y:n,z:1}}});break;case"+":this.tiles.get(wt.Wall)[s][n]=on.createFromTemplate("door",{components:{positionalobject:{x:s,y:n,z:1}}});break;case">":this.tiles.get(wt.Wall)[s][n]=on.createFromTemplate("stairs_north",{components:{positionalobject:{x:s,y:n,z:1}}})}let o=this.overlay[this.height-n-1].charAt(s);"#"!==o&&("."!==o&&(this.tiles.get(wt.DecorativeBG)[s][n]=on.createFromTemplate("art_backing",{components:{positionalobject:{x:s,y:n,z:2}}}))," "!==o&&"."!==o&&("_"===o&&(o="."),this.tiles.get(wt.Decorative)[s][n]=on.createFromTemplate("art",{components:{characterobject:{x:s,y:n,z:2.05,letter:o,color:t[e]}}}),e++))}this.addPlayer(21,3),es.gameMap.actors.push(on.createFromTemplate("ant",{components:{positionalobject:{x:27,y:4,z:1}}})),es.gameMap.actors.push(on.createFromTemplate("dragon_red",{components:{positionalobject:{x:18,y:4,z:1}}})),es.gameMap.actors.push(on.createFromTemplate("goblin",{components:{positionalobject:{x:5,y:2,z:1}}})),es.gameMap.items.push(on.createFromTemplate("potion_health",{components:{positionalobject:{x:3,y:5,z:1}}})),es.gameMap.items.push(on.createFromTemplate("^",{components:{positionalobject:{x:6,y:5,z:1}}})),es.gameMap.items.push(on.createFromTemplate("tower_shield",{components:{positionalobject:{x:28,y:1,z:1}}}))}}!function(){const t=function(){as.stats.begin(),es.handleEvents(),es.needsMapUpdate&&(e(),es.needsMapUpdate=!1),ct.w.update(),as.stats.end()},e=function(){if(es.player){const t=es.player.getComponent("positionalobject");if(t){let e=5;const n=es.gameMap.tiles.get(t.z)[t.x][t.y];if(n){const t=n.getComponent("visibilityModifier");t&&(e=t.getVisibility(e))}const s=0===es.fov.visibleObjects.length;es.gameMap.updateFOV(t.x,t.y,t.z,e),es.gameMap.draw(t.x,t.y,t.z),s&&x.updatePlayerDetails()}as.renderer.render(as.scene,as.camera)}};!function(){es.clearMaps(),es.setMap(new rs);const e=es.player.getComponent("positionalobject");es.gameMap.revealFromPosition(e.x,e.y,100,0),es.needsMapUpdate=!0,as.renderer.setAnimationLoop(t)}()}()}},t=>{t.O(0,[164,787,216,979],(()=>(30,t(t.s=30)))),t.O()}]);
//# sourceMappingURL=app.c5663833ac8561a7f5af.js.map