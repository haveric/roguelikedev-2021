{"version":3,"sources":["webpack://roguelikedev-2021/./src/styles/style.css","webpack://roguelikedev-2021/./src/styles/style.css?ff94","webpack://roguelikedev-2021/./src/js/actions/_Action.js","webpack://roguelikedev-2021/./src/js/actions/UnableToPerformAction.js","webpack://roguelikedev-2021/./src/js/map/fov/_BaseFov.js","webpack://roguelikedev-2021/./src/js/map/fov/FovSlope.js","webpack://roguelikedev-2021/./src/js/map/fov/AdamMilazzoFov.js","webpack://roguelikedev-2021/./src/js/map/fov/SimpleFov.js","webpack://roguelikedev-2021/./src/js/ui/message/SubMessage.js","webpack://roguelikedev-2021/./src/js/ui/message/Message.js","webpack://roguelikedev-2021/./src/js/ui/UIElement.js","webpack://roguelikedev-2021/./src/js/ui/MessageConsole.js","webpack://roguelikedev-2021/./src/js/actions/NoAction.js","webpack://roguelikedev-2021/./src/js/ui/Details.js","webpack://roguelikedev-2021/./src/js/event/_EventHandler.js","webpack://roguelikedev-2021/./src/js/controls/Key.js","webpack://roguelikedev-2021/./src/js/controls/Controls.js","webpack://roguelikedev-2021/./src/js/util/ArrayUtil.js","webpack://roguelikedev-2021/./src/js/components/_Component.js","webpack://roguelikedev-2021/./src/js/util/Extend.js","webpack://roguelikedev-2021/./src/js/components/positionalObject/_PositionalObject.js","webpack://roguelikedev-2021/./src/js/components/positionalObject/SolidObject.js","webpack://roguelikedev-2021/./src/js/components/positionalObject/CharacterObject.js","webpack://roguelikedev-2021/./src/js/components/BlocksMovement.js","webpack://roguelikedev-2021/./src/js/components/Walkable.js","webpack://roguelikedev-2021/./src/js/components/Fov.js","webpack://roguelikedev-2021/./src/js/components/BlocksFov.js","webpack://roguelikedev-2021/./src/js/map/MapLayer.js","webpack://roguelikedev-2021/./src/js/components/Openable.js","webpack://roguelikedev-2021/./src/js/components/VisibilityModifier.js","webpack://roguelikedev-2021/./src/js/components/ai/_AI.js","webpack://roguelikedev-2021/./src/js/components/ai/AIDead.js","webpack://roguelikedev-2021/./src/js/ui/menu/GameOverMenu.js","webpack://roguelikedev-2021/./src/js/event/GameOverEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/CharacterHealth.js","webpack://roguelikedev-2021/./src/js/ui/CharacterMana.js","webpack://roguelikedev-2021/./src/js/ui/Character.js","webpack://roguelikedev-2021/./src/js/components/Fighter.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/_ActionWithDirection.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/MovementAction.js","webpack://roguelikedev-2021/./src/js/actions/WaitAction.js","webpack://roguelikedev-2021/./src/js/actions/WanderAction.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/MeleeAction.js","webpack://roguelikedev-2021/./src/js/pathfinding/BinaryHeap.js","webpack://roguelikedev-2021/./src/js/pathfinding/AStar.js","webpack://roguelikedev-2021/./src/js/pathfinding/GridNode.js","webpack://roguelikedev-2021/./src/js/pathfinding/Graph.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/OpenAction.js","webpack://roguelikedev-2021/./src/js/actions/actionWithDirection/BumpAction.js","webpack://roguelikedev-2021/./src/js/components/ai/AIMeleeChase.js","webpack://roguelikedev-2021/./src/js/components/Faction.js","webpack://roguelikedev-2021/./src/js/components/Remnant.js","webpack://roguelikedev-2021/./src/js/actions/itemAction/ItemAction.js","webpack://roguelikedev-2021/./src/js/components/consumable/_Consumable.js","webpack://roguelikedev-2021/./src/js/components/consumable/HealingConsumable.js","webpack://roguelikedev-2021/./src/js/ui/Inventory.js","webpack://roguelikedev-2021/./src/js/components/Inventory.js","webpack://roguelikedev-2021/./src/js/components/consumable/DamageNearestConsumable.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/_SelectIndexHandler.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/SingleRangedAttackHandler.js","webpack://roguelikedev-2021/./src/js/components/ai/AIConfusedEnemy.js","webpack://roguelikedev-2021/./src/js/components/consumable/ConfusionConsumable.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/AreaRangedAttackHandler.js","webpack://roguelikedev-2021/./src/js/components/consumable/AOEDamageConsumable.js","webpack://roguelikedev-2021/./src/js/components/consumable/ManaConsumable.js","webpack://roguelikedev-2021/./src/js/components/ai/AIGelatinousCube.js","webpack://roguelikedev-2021/./src/js/components/ai/AIPlayer.js","webpack://roguelikedev-2021/./src/js/components/ExplodeOnDeath.js","webpack://roguelikedev-2021/./src/js/components/AttachedItems.js","webpack://roguelikedev-2021/./src/js/components/interactable/_Interactable.js","webpack://roguelikedev-2021/./src/js/components/interactable/StairsInteractable.js","webpack://roguelikedev-2021/./src/js/ui/BottomContainer.js","webpack://roguelikedev-2021/./src/js/components/Level.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/EmptyTileTargetHandler.js","webpack://roguelikedev-2021/./src/js/components/consumable/SummonPortalConsumable.js","webpack://roguelikedev-2021/./src/js/components/interactable/PortalInteractable.js","webpack://roguelikedev-2021/./src/js/components/equipment/EquipmentType.js","webpack://roguelikedev-2021/./src/js/components/equipment/EquipmentSlot.js","webpack://roguelikedev-2021/./src/js/components/equipment/Equipment.js","webpack://roguelikedev-2021/./src/js/components/equipment/Equippable.js","webpack://roguelikedev-2021/./src/js/components/ComponentLoader.js","webpack://roguelikedev-2021/./src/js/entity/_Entity.js","webpack://roguelikedev-2021/./src/js/entity/Tile.js","webpack://roguelikedev-2021/./src/js/entity/Actor.js","webpack://roguelikedev-2021/./src/js/entity/Item.js","webpack://roguelikedev-2021/./src/js/entity/EntityLoader.js","webpack://roguelikedev-2021/./src/js/map/GameMap.js","webpack://roguelikedev-2021/./src/js/map/TutorialMap.js","webpack://roguelikedev-2021/./src/js/map/mapGeneration/ChanceLoader.js","webpack://roguelikedev-2021/./src/js/map/room/RectangularRoom.js","webpack://roguelikedev-2021/./src/js/map/mapGeneration/MapGeneration.js","webpack://roguelikedev-2021/./src/js/map/BasicDungeon.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorControls.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorInfo.js","webpack://roguelikedev-2021/./src/js/event/EditorEventHandler.js","webpack://roguelikedev-2021/./src/js/actions/PickupAction.js","webpack://roguelikedev-2021/./src/js/event/selectIndexHandler/LookHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/PauseMenu.js","webpack://roguelikedev-2021/./src/js/SaveManager.js","webpack://roguelikedev-2021/./src/js/ui/menu/LoadGameMenu.js","webpack://roguelikedev-2021/./src/js/event/_MenuEventHandler.js","webpack://roguelikedev-2021/./src/js/event/LoadGameMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/ControlsMenu.js","webpack://roguelikedev-2021/./src/js/event/ControlsMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/SettingsMenu.js","webpack://roguelikedev-2021/./src/js/settings/Settings.js","webpack://roguelikedev-2021/./src/js/event/SettingsMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/CreditsMenu.js","webpack://roguelikedev-2021/./src/js/event/CreditsMenuEventsHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/SaveGameMenu.js","webpack://roguelikedev-2021/./src/js/event/SaveGameMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/event/PauseMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/actions/InteractAction.js","webpack://roguelikedev-2021/./src/js/actions/itemAction/DropFromEquipmentAction.js","webpack://roguelikedev-2021/./src/js/event/DefaultPlayerEventHandler.js","webpack://roguelikedev-2021/./src/js/ui/menu/MainMenu.js","webpack://roguelikedev-2021/./src/js/map/room/Shop.js","webpack://roguelikedev-2021/./src/js/map/room/Forge.js","webpack://roguelikedev-2021/./src/js/map/Town.js","webpack://roguelikedev-2021/./src/js/event/MainMenuEventHandler.js","webpack://roguelikedev-2021/./src/js/map/MapLoader.js","webpack://roguelikedev-2021/./src/js/Engine.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorLayer.js","webpack://roguelikedev-2021/./src/js/ui/editor/EditorPaint.js","webpack://roguelikedev-2021/./src/js/SceneState.js","webpack://roguelikedev-2021/./src/js/map/MainMenuMap.js","webpack://roguelikedev-2021/./src/index.js"],"names":["___CSS_LOADER_EXPORT___","push","module","id","Action","constructor","entity","this","perform","console","error","isPlayer","UnableToPerformAction","reason","super","BaseFov","previousVisibleObjects","visibleObjects","visibleActors","visibleItems","oldObjects","newObjects","left","right","top","bottom","teardown","compute","x","y","z","radius","Math","max","min","addVisibleObject","object","indexOf","addVisibleActor","addVisibleItem","remove","newIndex","splice","oldIndex","removeVisible","visibleIndex","visibleItemsIndex","previousVisibleItemsIndex","exploreTile","minZ","maxZ","tilesOnly","tilesIter","entry","tileArrayX","tile","actor","positionalObject","getComponent","item","FovSlope","greater","greaterOrEqual","lessOrEqual","AdamMilazzoFov","octant","computeOctant","originX","originY","originZ","rangeLimit","topY","bottomY","round","blocksLight","ax","wasOpaque","isOpaque","setVisible","nx","ny","wallTiles","wallTile","blocksFov","SimpleFov","minX","maxX","minY","maxY","i","j","SubMessage","text","color","options","bold","italics","isEqual","subMessage","Message","subMessages","count","length","sub1","sub2","getHtml","messageDom","document","createElement","classList","add","subMessageDom","innerText","style","appendChild","getCountHtml","amountDom","UIElement","html","dom","htmlToElement","template","trim","innerHTML","content","firstChild","isOpen","contains","open","close","messages","builder","getElementsByClassName","addEventListener","e","parent","target","parentElement","messagesInnerDom","build","stack","addMessage","slice","clear","lastMessage","updateLastMessageCount","addNewMessage","lastMessageDom","querySelectorAll","NoAction","updatePlayerDetails","updatePositionDetails","getPosition","position","updatePositionOnly","skipPlayer","zStart","tiles","get","name","isVisible","abs","letter","fighter","getHealthDescription","itemLines","line","nearby","isAlive","EventHandler","raycaster","mouse","mouseDown","window","isPlayerTurn","highlightedTiles","removeEventListener","clearHighlights","handleEvent","type","onMouseMove","onMouseDown","onMouseUp","onLeftClick","onRightClick","onChange","onKeydown","handleInput","getMouseIntersectingObjects","clientX","clientY","setFromCamera","intersectObject","scene","isHighlighted","highlightedTile","clearAndSetHighlights","highlight","clearAndSetHighlight","updatePlayer","removeHighlight","self","defaultDelay","lastShiftUp","treatShiftNumpadEqual","keysDown","keysDelayed","defaults","Map","controls","set","load","key","preventDefault","getModifierState","shiftKey","code","startsWith","keyCode","getKey","endsWith","localStorage","getItem","JSON","parse","resetToDefault","save","setItem","stringify","Array","from","entries","setControls","controlsMap","value","keys","val","clone","isPressed","pressed","defaultKeys","forEach","keyToTest","isDelayed","delayed","deleteKey","delay","setTimeout","testPressed","succeeded","ArrayUtil","numRows","array","_Component","args","baseType","parentEntity","cachedSave","clearSaveCache","getDescription","parseRandFloat","defaultValue","returnValue","valueSplit","split","parseFloat","toFixed","parseRandInt","parseInt","parseRandIntBetween","Extend","out","arguments","hasOwnProperty","obj","deep","undefined","_PositionalObject","extend","hasComponent","components","positionalobject","meshes","highlighted","width","height","depth","scale","opacity","xRot","yRot","zRot","xOffset","yOffset","zOffset","size","actorZOffset","deathAnimation","transparency","saveJson","Tile","createObject","stop","hasObject","onMapTeardown","resetColor","mesh","material","originalColor","shiftColor","scalar","transparent","multiplyScalar","setTransparency","actualOpacity","getObjectPosition","updateObjectPosition","rotation","PI","visible","fov","explored","move","callEvent","moveTo","updateRotation","updateOffsets","updateZOffset","distance","other","horizontalDistance","isSamePosition","onEntityDeath","finalRotation","random","to","onUpdate","start","cachedSolidGeometries","SolidObject","solidobject","newDepth","anyFound","geometry","parameters","cachedTextGeometries","fontCache","CharacterObject","characterobject","fontName","centered","characters","has","font","character","createMesh","newHeight","newSize","sameFont","cachedFamilyName","data","familyName","sameSize","cachedSize","cachedHeight","cachedLetter","cachedCentered","curveSegments","bevelEnabled","bevelThickness","bevelSize","bevelOffset","bevelSegments","center","lastAnimation","animateInTween","translateX","translateY","translateZ","rotateX","rotateY","rotateZ","animateIn","animation","startScale","setupAnimation","animations","firstAnimation","newAnimation","chain","time","end","tween","percent","_startTime","_duration","zRotation","BlocksMovement","blocksMovement","Walkable","walkable","Fov","setExplored","BlocksFov","Object","freeze","Floor","Wall","DecorativeBG","Decorative","Openable","openable","openEntity","closedEntity","VisibilityModifier","visibilityModifier","modifier","amount","arg","getVisibility","visibility","AI","onMeleeAttack","blockingActor","stopCombatAnimations","blockingPosition","originalPosition","attackPosition","currentPosition","tweenAttack","tweenReturn","combatTweens","onEntityMove","AIDead","aiDead","previousAI","GameOverEventHandler","returnToMainMenu","MainMenuEventHandler","fgDom","textDom","update","current","strengthDom","damageDom","agilityDom","defenseDom","blockChanceDom","constitutionDom","healthDom","healingBonusDom","wisomDom","manaDom","availableStatPointsDom","levelDom","currentXpDom","neededXpDom","xpFilledDom","populate","player","strength","getDamageDisplay","agility","defense","blockChance","constitution","hp","maxHp","healingBonus","wisdom","mana","maxMana","level","statPointsAvailable","xp","xpForLevel","getPercentXPTowardsLevel","toggle","Fighter","baseStrength","baseDamage","baseAgility","baseDefense","baseConstitution","baseHp","baseWisdom","baseMana","minDamage","maxDamage","recalculateStats","calculateStats","floor","newMax","getMaxHp","newMaxMana","getMaxMana","calculateDamage","calculateDefense","calculateBlockChance","updateUI","equipmentStrength","equipmentAgility","equipmentConstitution","equipmentWisdom","equipment","equippables","getEquippables","equippable","statDamage","equipmentMinDamage","equipmentMaxDamage","statDefense","equipmentDefense","statBlockChance","equipmentBlockChance","getDamage","getBlockedDamage","statHp","equipmentHp","health","statMana","equipmentMana","createDamageIndicator","damage","xRand","yRand","zRand","indicator","easing","onComplete","takeDamage","die","heal","newHp","healedHp","consumeMana","recoverMana","newMana","recoveredMana","ai","aiArgs","removeComponent","newAI","setComponent","description","onComponentsLoaded","onEquipmentChange","ActionWithDirection","dx","dy","dz","MovementAction","destX","destY","destZ","gameMap","isInBounds","ground","tryMoveTo","below","above","getBlockingActorAtLocation","blocksMovementComponent","floorTile","walkableComponent","WaitAction","WanderAction","MeleeAction","entityFighter","blockingFighter","plural","blockingName","attackColor","blockRandom","blockedColor","BinaryHeap","scoreFunction","element","sinkDown","pop","result","bubbleUp","node","rescoreElement","n","parentN","elemScore","child2N","child1N","child1Score","swap","child1","child2","AStar","curr","path","unshift","f","graph","cleanDirty","heuristicType","heuristic","closest","openHeap","getHeap","closestNode","h","heuristicManhattan","heuristicDiagonal","markDirty","currentNode","pathTo","closed","neighbors","il","neighbor","isWall","gScore","g","getCost","beenVisited","visited","pos0","pos1","D2","sqrt","d1","d2","GridNode","weight","toString","fromNeighbor","Graph","gridIn","nodes","diagonal","grid","row","init","dirtyNodes","cleanNode","ret","graphString","rowDebug","join","OpenAction","BumpAction","tileX","AIMeleeChase","aiMeleeChase","chaseLocation","movementActions","currentMovement","entityPosition","closestEnemies","closestDistance","entityFaction","actorFaction","isEnemyOf","actorPosition","closestEnemy","closestEnemyPosition","fovWidth","fovHeight","cost","fill","map","costGraph","search","lastAction","next","shift","Faction","faction","factions","enemies","setFactions","setEnemies","factionList","enemyList","enemy","otherFaction","Remnant","remnant","isRemnant","ItemAction","targetPosition","consumable","activate","getTargetActor","Consumable","consume","parentStorage","use","getAction","consumer","getConsumer","action","HealingConsumable","healingConsumable","amountHealed","getModifiedAmount","equipmentDom","equipmentSlots","slot","setAttribute","storageWrapDom","goldCountDom","itemTooltipDom","itemDragDom","body","openStorages","itemsOnGround","populateInventory","items","populateSlot","storageItem","openEquipmentStorage","beltItem","openGroundItems","inventory","gold","maxStorage","maxItems","storage","inventoryStorageDom","inventoryStorageTitleDom","inventorySlots","populateItemsAtGround","itemPosition","ceil","getComponentDescriptions","dropAll","goldItem","drop","parentPosition","DamageNearestConsumable","damageNearestConsumable","maxRange","getClosestActor","actualDamage","airActors","actors","consumerPosition","consumerFaction","SelectIndexHandler","resetPosition","initted","selectIndex","exit","DefaultPlayerEventHandler","confirmIndex","moveCamera","obscuredTile","visibleTile","tilesX","intersects","SingleRangedAttackHandler","callback","AIConfusedEnemy","aiConfusedEnemy","turnsRemaining","setTurnsRemaining","turns","ConfusionConsumable","confusionConsumable","AreaRangedAttackHandler","centerIsObscured","centerTile","visibleTiles","AOEDamageConsumable","aoeDamageConsumable","fovHit","targetActors","airFovHit","targetsHit","areaOfEffect","areaOfEffectText","ManaConsumable","manaConsumable","amountRecovered","AIGelatinousCube","performAction","attachedItems","itemsPickedUp","finalPosition","templatePosition","clearItems","AIPlayer","ExplodeOnDeath","explodeOnDeath","AttachedItems","itemJson","index","animateEntity","onAddToScene","onCreateRemnant","remnantPosition","onDestroyRemnant","Interactable","interact","StairsInteractable","stairsInteractable","generator","setPosition","playerPosition","newMap","openCharacter","openSkills","beltSlotsDom","updateAll","updateXp","updateStatPointsIndicator","updateSkillPointsIndicator","updateBeltSlots","skillPointsAvailable","playerEquipment","beltEquippable","beltSlotDom","Level","xpGiven","statPointsPerLevel","skillPointsPerLevel","requiresLevelUp","previousLevelXp","levelXpAdjusted","levelUp","useStatPoint","useSkillPoint","addXp","EmptyTileTargetHandler","SummonPortalConsumable","hasFloorTile","floorTiles","portalInteractable","PortalInteractable","MAIN_HAND","OFF_HAND","BODY","HELMET","GLOVES","SHOULDER","BELT","BOOTS","STORAGE","AMULET","RING","EquipmentSlot","Equipment","equipmentSlot","equipmentItem","fromIndex","toIndex","fromItem","addItem","belt","success","addPartialStacks","addFullStacks","Equippable","lightRadius","damageSplit","storageJson","originalAmount","partialMax","amountToAdd","inventoryItem","amountCanAdd","maxStackSize","setAmount","types","component","create","_Entity","componentArray","loadComponents","json","event","setName","newName","getDefaultTemplate","Actor","Item","templates","loadTemplates","parsedJson","extends","loadTemplate","placeholder","npcs","foliage","furniture","amulets","armor","belts","boots","gloves","helmets","misc","potions","rings","scrolls","shields","shoulder","weapons","entities","createFromTemplate","GameMap","timeout","saveCache","create2dArray","clearTimeout","tilesArray","removeEntity","removeActor","removeItem","groundPosition","mapItem","saveData","tileMap","charCode","tileJson","String","fromCharCode","mapKey","tileMapIter","tileMapEntry","actorJson","tileLayer","tilesToLoad","createdActor","createdItem","revealPreviouslyExplored","tileIter","revealFromPosition","_revealGradually","maxRadius","xRadiusMin","xRadiusMax","yRadiusMin","yRadiusMax","xIsEdge","_revealAtPosition","reveal","updateFOV","range","draw","drawItemsInFov","newObjectsRemoved","newObject","fovComponent","actorsRemoved","actorRemnant","itemsRemoved","itemRemnant","visibleObject","oldObject","isActor","xDiff","yDiff","getAliveActorAtLocation","location","aliveActor","isPositionVisible","addPlayer","updatePlayerUI","playerFighter","TutorialMap","wall","overlay","overlayColors","overlayColorIndex","charAt","overlayChar","entityGroups","itemGroups","generators","loadEntityGroups","loadItemGroups","loadGenerator","group","getChancesForLevel","chances","getActorForLevel","actorOrGroup","getRandomFromGroup","actorGroup","getItemForLevel","itemOrGroup","itemGroup","returnChance","totalWeight","chance","currentWeight","rand","RectangularRoom","x1","y1","x2","y2","getCenterX","getCenterY","otherRoom","createRoom","previousFloorTile","isVerticalEdge","isHorizontalEdge","placeEntities","maxMonsters","numMonsters","actorId","placeItems","numItems","itemId","numGoldItems","MapGeneration","cornerX","cornerY","bresenham","startY","endY","bresenhamCreateTiles","startX","endX","createWall","wallEntity","floorEntity","BasicDungeon","maxRooms","roomMinSize","roomMaxSize","maxMonstersByFloor","maxItemsByFloor","getFloorAmount","weights","previousMapName","rooms","roomWidth","roomHeight","newRoom","intersectsOtherRoom","room","centerX","centerY","lastRoom","tunnelBetween","lastRoomCenterX","lastRoomCenterY","addAction","activeAction","setControl","subId","char","active","allActions","parentNode","children","getAttribute","dataMap","entityDom","addData","addDataInput","domElement","label","dataDom","onchange","updateScale","onblur","setData","tagName","setDataForEntity","EditorEventHandler","selectedEntity","clearSelected","parentObject","removeEntityFromMouseEvent","PickupAction","entityInventory","itemsToPickup","anyGoldPickedUp","entityEquipment","LookHandler","saveName","autosaveTurnCounter","loadSaves","getCurrentSaveName","saveSaves","delete","saveToDelete","saves","autosave","settings","autosavesEnabled","autosaveTurns","lastAutosave","getLastAutosave","autosaveAmount","setLastAutosave","Date","oldSavesDom","saveElement","formatDate","date","formatTime","formatted","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","MenuEventHandler","eventHandler","previousEventHandler","returnToPreviousMenu","LoadGameMenuEventHandler","ControlsMenuEventHandler","isEditingKey","editingDom","tempValue","tempControls","populateControls","saveAndExit","cancel","resetControls","newKey","blur","setKey","populateControl","keyName","primaryKey","getElementById","secondaryKey","showStats","messageConsolePosition","displayFPS","debugControlsEnabled","toSave","SettingsMenuEventHandler","tempSettings","populateSettings","checked","applyDisplayFPS","applyAutosavesEnabled","newSaveAmount","newTurnsAmount","applyAllSettings","autosaveAmountInput","autosaveTurnsInput","removeAttribute","CreditsMenuEventsHandler","overwriteDom","SaveGameMenuEventHandler","overwriteName","newSaveName","PauseMenuEventHandler","openSaveGameMenu","openLoadGameMenu","openControlsMenu","openSettingsMenu","openCreditsMenu","quit","InteractAction","wallInteractable","floorInteractable","DropFromEquipmentAction","hideItemTooltip","attemptToDrag","dragDistance","dragStart","startDragging","isDragging","dragOffset","hoveringOver","cloneNode","updateToolTipSize","slotDragging","tooltipRect","sourceSlot","sourceItem","sourceStorage","parentClasses","targetRect","getBoundingClientRect","sourceIsGround","sourceIsInventorySlot","sourceIsEquipmentSlot","targetIsGround","targetIsInventorySlot","targetIsEquipmentSlot","targetSlot","fromEquippable","targetItem","targetStorage","storageEquippable","sourceStorageItem","sourceStorageEquippable","targetStorageItem","targetStorageEquippable","Shop","walls","randWall","npc","Forge","isRightHalf","isBottomHalf","Town","jStart","jEnd","jStartRandom","jEndRandom","createTree","randomGrass","absI","absJ","startNewGame","MapLoader","loadMap","mapType","engine","gameMaps","mapLoader","needsMapUpdate","airFov","setEventHandler","handleEvents","processAction","performedAction","handleEnemyTurns","setMap","playerIndex","addMap","clearMaps","maps","values","loadData","currentMap","setupGameHtml","setupLights","updateCamera","gameDom","canvasDom","renderer","antialias","alpha","setClearColor","stats","showPanel","updateStatsVisibility","updateCameraPosition","ambientLight","dirLight","aspectRatio","offsetWidth","offsetHeight","camera","viewSize","setSize","lookAt","up","MainMenuMap","updateRender","playerVisibility","tileAtPlayer","isFovNew"],"mappings":"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","file":"app.d40156ad79021f09e1b9.js","sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"* {\\n    box-sizing: border-box;\\n}\\n\\nbody {\\n    margin: 0 auto;\\n    overflow: hidden;\\n    width: 100vw;\\n    height: 100vh;\\n    font-size: 1.2vh;\\n}\\n\\nbody.disable-select * {\\n    user-select: none;\\n}\\n\\n.ui {\\n    display: block;\\n    z-index: -1000 !important;\\n    opacity: 0;\\n    pointer-events: none;\\n}\\n\\n.ui.active {\\n    z-index: 0 !important;\\n    opacity: 1;\\n    pointer-events: all;\\n}\\n\\n.menu {\\n    position: fixed;\\n    left: 5%;\\n    top: 5%;\\n    background-color: #000;\\n    min-width: 20%;\\n    max-width: 30%;\\n    text-align: center;\\n    padding: 0.5vh 2.5vh 4vh;\\n    border-radius: 15px 0;\\n    color: #eee;\\n}\\n\\n.menu--full {\\n    left: 10%;\\n    right: 10%;\\n    max-width: none;\\n}\\n\\n.menu hr {\\n    margin: 1.5vh 0;\\n}\\n\\n.menu.active {\\n    background-color: rgba(0, 0, 0, .7);\\n}\\n\\n.menu__title {\\n    font-size: 5vh;\\n    color: #fff;\\n    margin: 0 0 1.5vh;\\n    font-family: Georgia, serif;\\n}\\n\\n.menu__action {\\n    margin: 0 auto;\\n    display: block;\\n    width: 75%;\\n    font-family: Lucida Console, serif;\\n    font-size: 1.8vh;\\n    padding: .5vh;\\n}\\n\\n.menu__action--cancel {\\n    background-color: #f33;\\n}\\n\\n.menu__action--cancel:hover {\\n    background-color: #f11;\\n}\\n\\n.menu__action--confirm {\\n    background-color: #3f3;\\n}\\n\\n.menu__action--confirm:hover {\\n    background-color: #3c3;\\n}\\n\\n.menu__action + .menu__action {\\n    margin-top: 15px;\\n}\\n\\n.menu--full .menu__action {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.menu--full .menu__action + .menu__action {\\n    margin-top: 0;\\n    margin-left: 15px;\\n}\\n\\n#editor-controls {\\n    position: fixed;\\n    top: 50px;\\n    right: 50px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-controls__action {\\n    display: block;\\n    padding: 5px 0;\\n    background-color: #ccc;\\n    font-size: 20px;\\n    text-align: center;\\n    width: 45px;\\n}\\n\\n.editor-controls__action.active {\\n    border-style: inset;\\n}\\n\\n#editor-info {\\n    position: fixed;\\n    top: 50px;\\n    right: 200px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-info__component {\\n    border: 1px solid #999;\\n    padding: 5px;\\n    background-color: #ccc;\\n    display: none;\\n}\\n\\n.editor-info__component.active {\\n    display: block;\\n}\\n\\n.editor-info__component + .editor-info__component {\\n    border-top: 0;\\n}\\n\\n.editor-info__label {\\n    font-weight: bold;\\n    text-transform: capitalize;\\n}\\n\\n.game {\\n    width: 100vw;\\n    height: 100vh;\\n}\\n\\n.view {\\n    display: block;\\n    float: left;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.details {\\n    padding: 10px 15px;\\n    font-size: 2vh;\\n    display: block;\\n    width: 20%;\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    background-color: #ddd;\\n}\\n\\n\\n.details__header {\\n    margin-top: 20px;\\n}\\n.details__line {\\n    display: block;\\n}\\n\\n.console {\\n    background-color: #eee;\\n    transform: translate(0, 0);\\n    position: fixed;\\n    left: 0;\\n    right: 0;\\n    width: 45%;\\n    margin: 0 auto;\\n    height: 12.25%;\\n    bottom: 8%;\\n}\\n\\n.console.active {\\n    opacity: .95;\\n}\\n\\n.console.animate {\\n    transition: all 1s ease;\\n}\\n\\n.console.full {\\n    transform: translate(0, -10%);\\n    height: 80%;\\n}\\n\\n.console.active.full {\\n    opacity: 1;\\n}\\n\\n.console.collapsed {\\n    height: 4.5%;\\n}\\n\\n.console__button {\\n    position: absolute;\\n    top: 0;\\n    z-index: 100;\\n    opacity: 1;\\n}\\n\\n.console__increase {\\n    right: 40px;\\n}\\n\\n.console.full .console__increase {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.console__decrease {\\n    right: 64px;\\n}\\n\\n.console.collapsed .console__decrease {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.messages__wrap {\\n    position: absolute;\\n    opacity: 1;\\n    padding: 5px;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.messages {\\n    display:flex;\\n    flex-direction:column-reverse;\\n    height: 100%;\\n    overflow-y: scroll;\\n}\\n\\n.messages__inn {\\n\\n}\\n\\n.message {\\n    font-size: 1.66vh;\\n    text-shadow: 1px 1px 0 #888;\\n}\\n\\n.message__text {\\n\\n}\\n\\n.message__bold {\\n    font-weight: bold;\\n}\\n\\n.message__italics {\\n    font-style: italic;\\n}\\n\\n.message__amount {\\n    margin-left: 1em;\\n}\\n\\n.character-info {\\n    font-family: Arial, serif;\\n    font-weight: bold;\\n    font-size: 15vh;\\n    text-align: center;\\n}\\n#character-health {\\n    color: #c00;\\n}\\n\\n#character-mana {\\n    color: #00c;\\n}\\n\\n.character-info__wrap {\\n    position: absolute;\\n    top: 5%;\\n    bottom: 5%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n#character-mana .character-info__wrap {\\n    transform: rotate(180deg);\\n}\\n\\n.character-info__bg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 10;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-health .character-info__bg {\\n    color: #ffe0e0;\\n}\\n\\n.character-info__fg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 20;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-mana .character-info__bg,\\n#character-mana .character-info__fg {\\n    bottom: -15%;\\n    font-size: 18.75vh;\\n}\\n\\n#character-mana .character-info__fg {\\n    color: #e0e0ff;\\n}\\n\\n.character-info__text {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    font-size: 3vh;\\n    color: #000;\\n    z-index: 30;\\n    text-shadow: 1px 1px 3px #eee;\\n}\\n\\n#character-health .character-info__text {\\n    top: 38%;\\n    bottom: 0;\\n}\\n\\n#character-mana .character-info__text {\\n    transform: rotate(180deg);\\n    top: 0;\\n    bottom: 38%;\\n}\\n\\n.inventory {\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.inventory.active {\\n    transform: translateX(0);\\n}\\n\\n.inventory__equipment {\\n    width: 100%;\\n    height: 55%;\\n    display: grid;\\n    grid-template-columns: repeat(3, minmax(0, 1fr));\\n    grid-template-rows: repeat(4, minmax(0, 1fr));\\n    background-color: #333;\\n    grid-gap: 0.2vw;\\n    padding: 1vh 7.5vh\\n}\\n\\n.inventory__storage-wrap {\\n    width: 100%;\\n    height: 40%;\\n    background-color: #333;\\n    position: relative;\\n    overflow-y: auto;\\n}\\n\\n.inventory__storage {\\n    width: 100%;\\n    display: grid;\\n    grid-template-columns: repeat(10, minmax(0, 1fr));\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.inventory__storage-title {\\n    grid-column: span 10;\\n    padding: 5px;\\n    background-color: #ccc;\\n    font-size: 1.8vh;\\n}\\n\\n.slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n    position: relative;\\n    font-family: helvetica, serif;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot .item {\\n    font-size: 7.5vh;\\n}\\n\\n.inventory__equipment-slot:before {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    right: 0;\\n    bottom: 0;\\n    width: 100%;\\n    height: 100%;\\n    font-size: 7.5vh;\\n    opacity: 0.15;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot.has-item:before {\\n    display: none;\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"0\\\"]:before {\\n    content: \\\"⌈\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"1\\\"]:before {\\n    content: \\\"∩\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"2\\\"]:before {\\n    content: \\\"ᴕ\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"3\\\"]:before {\\n    content: \\\"†\\\";\\n    transform: rotate(180deg);\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"4\\\"]:before {\\n    content: \\\"☗\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"5\\\"]:before {\\n    content: \\\"●\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"6\\\"]:before,\\n.inventory__equipment-slot[data-index=\\\"8\\\"]:before {\\n    content: \\\"○\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"7\\\"]:before {\\n    content: \\\"-\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"9\\\"]:before {\\n    content: \\\"ひ\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"10\\\"]:before {\\n    content: \\\"◫\\\";\\n}\\n.inventory__equipment-slot[data-index=\\\"11\\\"]:before {\\n    content: \\\"″\\\";\\n}\\n\\n.inventory__storage-slot {\\n    height: 5.3vh;\\n}\\n\\n.slot.has-item:hover {\\n    cursor: pointer;\\n    background-color: #999;\\n}\\n\\n.slot.disabled {\\n    background-color: #845b5b;\\n}\\n\\n.slot.dragging .item {\\n    display: none;\\n}\\n\\n.character {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(-100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.character.active {\\n    transform: translateX(0);\\n}\\n\\n.character__title {\\n    text-align: center;\\n    font-weight: bold;\\n    margin-top: 0;\\n    margin-bottom: 40px;\\n    text-transform: uppercase;\\n    font-family: Arial, serif;\\n    font-size: 3vh;\\n}\\n\\n.character__xp {\\n    width: 80%;\\n    margin: 0 auto 40px;\\n}\\n\\n.item {\\n    font-family: helvetica, serif;\\n    pointer-events: none;\\n    position: relative;\\n    font-size: 4.5vh;\\n    user-select: none;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n    width: 100%;\\n}\\n\\n.item__icon {\\n\\n}\\n\\n.item__amount {\\n    position: absolute;\\n    right: 5%;\\n    bottom: 5%;\\n    font-size: 1.1vw;\\n    color: #fff;\\n    line-height: 0.7vw;\\n}\\n\\n.item__details {\\n    display: none;\\n}\\n\\n.item__tooltip .item__details {\\n    display: block;\\n}\\n\\n.item__details-line  {\\n    display: block;\\n}\\n\\n.item__details-line span {\\n    font-weight: bold;\\n}\\n\\n.inventory__golddisplay {\\n    width: 100%;\\n    height: 5%;\\n    font-size: 1.5vw;\\n    padding: 1%;\\n}\\n\\n.item__tooltip {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    background: #ccc;\\n    padding: 5px 10px;\\n    border-radius: 5px;\\n    max-width: 30%;\\n    font-size: 1.5vh;\\n    pointer-events: none;\\n}\\n\\n.item__tooltip.active {\\n    display: block;\\n}\\n\\n.item__drag {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    text-align: center;\\n    pointer-events: none;\\n}\\n\\n.item__drag.active {\\n    display: block;\\n}\\n\\n.item__name {\\n    font-weight: bold;\\n    font-size: 2.5vh;\\n}\\n\\n.item__description {\\n    font-style: italic;\\n}\\n\\n\\n.savegame__overwrite {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 100%;\\n    height: 100%;\\n    background-color: #000;\\n    display: none;\\n    pointer-events: none;\\n    padding: 15px;\\n    border-radius: 15px 0;\\n}\\n\\n.savegame__overwrite.active {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.savegame__overwrite-title {\\n    color: #fff;\\n    font-size: 3vh;\\n}\\n\\n.savegame__oldsaves,\\n.loadgame__oldsaves {\\n    margin-bottom: 15px;\\n}\\n\\n.savegame__newsave-input {\\n    font-size: 2.2vh;\\n    display: inline-block;\\n    float: left;\\n    margin-right: 1vh;\\n}\\n\\n.save {\\n    text-align: left;\\n    position: relative;\\n    font-size: 2vh;\\n    font-weight: bold;\\n}\\n\\n.save label {\\n    font-family: Lucida Console, serif;\\n    display: block;\\n}\\n\\n.save + .save {\\n    margin-top: 1vh;\\n}\\n\\n.save__title,\\n.save__delete {\\n    font-size: 2vh;\\n}\\n.save__title {\\n    width: 80%;\\n    display: inline-grid;\\n    grid-template-columns: 2fr 1fr;\\n}\\n\\n.save__text {\\n    grid-column: 1;\\n    grid-row: 1 / span 2;\\n    pointer-events: none;\\n}\\n\\n.save__date,\\n.save__time {\\n    font-size: 1.2vh;\\n    grid-column: 2;\\n    text-align: right;\\n    pointer-events: none;\\n}\\n\\n.save__date {\\n    grid-row: 1;\\n}\\n\\n.save__time {\\n    grid-row: 2;\\n}\\n\\n.save__delete {\\n    width: 10%;\\n    background-color: #f66;\\n    font-size: 3.6vh;\\n    line-height: 2.9vh;\\n    font-weight: bold;\\n    float: right;\\n}\\n\\n.save__confirm {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.credits {\\n    font-size: 5vh;\\n    width: 100%;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n    max-width: 100%;\\n    border-radius: 0;\\n}\\n\\n.credits .menu__content {\\n    transform: translateY(30%);\\n}\\n\\n.credits.active .menu__content {\\n    transform: translateY(-100%);\\n    transition: all 30s linear;\\n}\\n\\n.credits__title {\\n    font-size: 15vh;\\n    margin: 0;\\n}\\n\\n.credits__section {\\n    padding: 15vh;\\n}\\n\\n.settings input[type=checkbox] {\\n    width: 2vh;\\n    height: 2vh;\\n}\\n\\n.settings input[type=number] {\\n    min-width: 55px;\\n    width: 4.5vh;\\n}\\n\\n.settings .menu__actions,\\n.controls .menu__actions {\\n    margin-top: 3vh;\\n}\\n\\n.controls label {\\n    text-align: right;\\n    padding-right: 25px;\\n}\\n\\n.settings__section,\\n.controls__section {\\n    text-align: left;\\n    font-size: 2vh;\\n}\\n\\n.settings__section-title,\\n.controls__section-title {\\n    font-size: 3vh;\\n    margin-top: 0;\\n    margin-bottom: .5vh;\\n    text-decoration: underline;\\n}\\n\\n.settings__section + .settings__section,\\n.controls__section + .controls__section {\\n    padding-top: 15px;\\n    margin-top: 15px;\\n}\\n\\n.settings__section-inn,\\n.controls__section-inn{\\n    padding: 0 15px;\\n}\\n\\n.control {\\n    display: grid;\\n    grid-template-columns: 1.3fr 1fr 1fr;\\n}\\n\\n.controls__section {\\n    display: inline-block;\\n    width: 47%;\\n    margin-right: 2%;\\n}\\n\\n.controls__section-inn {\\n    display: grid;\\n}\\n\\n.stat__group {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    margin-top: 10px;\\n}\\n\\n.stat {\\n    display: grid;\\n    grid-template-columns: 4fr 2fr 1fr;\\n    text-align: center;\\n    width: 97%;\\n}\\n\\n.attribute {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    text-align: center;\\n}\\n\\n.stat__title,\\n.stat__text,\\n.attribute__title,\\n.attribute__value {\\n    border: 2px solid #000;\\n    padding: 5px;\\n}\\n\\n.attribute + .attribute .attribute__title,\\n.attribute + .attribute .attribute__value{\\n    border-top: 0;\\n}\\n\\n.stat__text,\\n.attribute__value {\\n    border-left: 0;\\n}\\n\\n.stat__title {\\n    text-transform: uppercase;\\n    font-weight: bold;\\n}\\n.stat__text {\\n    margin-right: 7px;\\n}\\n\\n.stat__level {\\n    display: none;\\n    pointer-events: none;\\n    background-color: #3a3;\\n    color: #fff;\\n    font-weight: bold;\\n}\\n\\n.character.has-statpoint .stat__level {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.available-stats {\\n    display: none;\\n    text-align: center;\\n    margin: 20px 0;\\n}\\n\\n.character.has-statpoint .available-stats {\\n    display: block;\\n}\\n\\n.available-stats__inn {\\n    border: 1px solid #000;\\n    display: inline-block;\\n    padding: 10px;\\n}\\n\\n.available-stats__value {\\n    margin-right: 10px;\\n}\\n\\n.character__xp-text {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n}\\n\\n.character__xp-value {\\n    text-align: right;\\n}\\n\\n.character__xp-bar {\\n    width: 100%;\\n    height: 20px;\\n    background: repeating-linear-gradient(to right, #ddd, #ddd 10%, #eee 10%, #eee 20%);\\n    position: relative;\\n    border: 2px solid #333;\\n}\\n\\n.bottom-container .character__xp-bar{\\n    position: absolute;\\n    bottom: 32%;\\n    height: 8%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n.character__xp-filled {\\n    background-color: rgba(210, 210, 0, .6);\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n}\\n\\n.bottom-container {\\n    position: fixed;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 75%;\\n    height: 20%;\\n    display: grid;\\n    grid-template-columns: 1fr 3fr 1fr;\\n    margin: 0 auto;\\n}\\n\\n.bottom-container__left,\\n.bottom-container__center,\\n.bottom-container__right {\\n    position: relative;\\n}\\n\\n.hotbar {\\n    position: absolute;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 100%;\\n    height: 32%;\\n    display: grid;\\n    grid-template-columns: 4.5fr 1fr 4.5fr;\\n    background-color: #333;\\n}\\n\\n.spell-slots,\\n.belt-slots {\\n    display: grid;\\n    width: 100%;\\n    height: 100%;\\n    grid-template-columns: repeat(6, 1fr);\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.spell-slot,\\n.belt-slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n}\\n\\n.spell-slot + .spell-slot,\\n.belt-slot + .belt-slot {\\n    border-left: 0;\\n}\\n\\n.hotbar__controls {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    grid-template-rows: 35% 65%;\\n    padding: 0.4vh 0 0.6vh;\\n    grid-gap: 0.2vh;\\n}\\n\\n.hotbar__controls button {\\n    width: 100%;\\n    height: 100%;\\n    border-radius: 0;\\n    font-weight: bold;\\n    text-transform: uppercase;\\n    line-height: 0;\\n}\\n\\n.hotbar-inventory,\\n.hotbar-character,\\n.hotbar-skills {\\n    width: 100%;\\n    height: 100%;\\n}\\n.hotbar-inventory {\\n    grid-row: 1;\\n    grid-column: span 2;\\n}\\n.hotbar-character {\\n    grid-row: 2;\\n    grid-column: 1;\\n}\\n.hotbar__open-character.has-statpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n.hotbar-skills {\\n    grid-row: 2;\\n    grid-column: 2;\\n}\\n.hotbar__open-skill.has-skillpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n\\n.pickup-slot {\\n    height: 5.3vh;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/styles/style.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"* {\\n    box-sizing: border-box;\\n}\\n\\nbody {\\n    margin: 0 auto;\\n    overflow: hidden;\\n    width: 100vw;\\n    height: 100vh;\\n    font-size: 1.2vh;\\n}\\n\\nbody.disable-select * {\\n    user-select: none;\\n}\\n\\n.ui {\\n    display: block;\\n    z-index: -1000 !important;\\n    opacity: 0;\\n    pointer-events: none;\\n}\\n\\n.ui.active {\\n    z-index: 0 !important;\\n    opacity: 1;\\n    pointer-events: all;\\n}\\n\\n.menu {\\n    position: fixed;\\n    left: 5%;\\n    top: 5%;\\n    background-color: #000;\\n    min-width: 20%;\\n    max-width: 30%;\\n    text-align: center;\\n    padding: 0.5vh 2.5vh 4vh;\\n    border-radius: 15px 0;\\n    color: #eee;\\n}\\n\\n.menu--full {\\n    left: 10%;\\n    right: 10%;\\n    max-width: none;\\n}\\n\\n.menu hr {\\n    margin: 1.5vh 0;\\n}\\n\\n.menu.active {\\n    background-color: rgba(0, 0, 0, .7);\\n}\\n\\n.menu__title {\\n    font-size: 5vh;\\n    color: #fff;\\n    margin: 0 0 1.5vh;\\n    font-family: Georgia, serif;\\n}\\n\\n.menu__action {\\n    margin: 0 auto;\\n    display: block;\\n    width: 75%;\\n    font-family: Lucida Console, serif;\\n    font-size: 1.8vh;\\n    padding: .5vh;\\n}\\n\\n.menu__action--cancel {\\n    background-color: #f33;\\n}\\n\\n.menu__action--cancel:hover {\\n    background-color: #f11;\\n}\\n\\n.menu__action--confirm {\\n    background-color: #3f3;\\n}\\n\\n.menu__action--confirm:hover {\\n    background-color: #3c3;\\n}\\n\\n.menu__action + .menu__action {\\n    margin-top: 15px;\\n}\\n\\n.menu--full .menu__action {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.menu--full .menu__action + .menu__action {\\n    margin-top: 0;\\n    margin-left: 15px;\\n}\\n\\n#editor-controls {\\n    position: fixed;\\n    top: 50px;\\n    right: 50px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-controls__action {\\n    display: block;\\n    padding: 5px 0;\\n    background-color: #ccc;\\n    font-size: 20px;\\n    text-align: center;\\n    width: 45px;\\n}\\n\\n.editor-controls__action.active {\\n    border-style: inset;\\n}\\n\\n#editor-info {\\n    position: fixed;\\n    top: 50px;\\n    right: 200px;\\n    background-color: chocolate;\\n    padding: 1px;\\n}\\n\\n.editor-info__component {\\n    border: 1px solid #999;\\n    padding: 5px;\\n    background-color: #ccc;\\n    display: none;\\n}\\n\\n.editor-info__component.active {\\n    display: block;\\n}\\n\\n.editor-info__component + .editor-info__component {\\n    border-top: 0;\\n}\\n\\n.editor-info__label {\\n    font-weight: bold;\\n    text-transform: capitalize;\\n}\\n\\n.game {\\n    width: 100vw;\\n    height: 100vh;\\n}\\n\\n.view {\\n    display: block;\\n    float: left;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.details {\\n    padding: 10px 15px;\\n    font-size: 2vh;\\n    display: block;\\n    width: 20%;\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    background-color: #ddd;\\n}\\n\\n\\n.details__header {\\n    margin-top: 20px;\\n}\\n.details__line {\\n    display: block;\\n}\\n\\n.console {\\n    background-color: #eee;\\n    transform: translate(0, 0);\\n    position: fixed;\\n    left: 0;\\n    right: 0;\\n    width: 45%;\\n    margin: 0 auto;\\n    height: 12.25%;\\n    bottom: 8%;\\n}\\n\\n.console.active {\\n    opacity: .95;\\n}\\n\\n.console.animate {\\n    transition: all 1s ease;\\n}\\n\\n.console.full {\\n    transform: translate(0, -10%);\\n    height: 80%;\\n}\\n\\n.console.active.full {\\n    opacity: 1;\\n}\\n\\n.console.collapsed {\\n    height: 4.5%;\\n}\\n\\n.console__button {\\n    position: absolute;\\n    top: 0;\\n    z-index: 100;\\n    opacity: 1;\\n}\\n\\n.console__increase {\\n    right: 40px;\\n}\\n\\n.console.full .console__increase {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.console__decrease {\\n    right: 64px;\\n}\\n\\n.console.collapsed .console__decrease {\\n    opacity: 0;\\n    z-index: -1;\\n}\\n\\n.messages__wrap {\\n    position: absolute;\\n    opacity: 1;\\n    padding: 5px;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.messages {\\n    display:flex;\\n    flex-direction:column-reverse;\\n    height: 100%;\\n    overflow-y: scroll;\\n}\\n\\n.messages__inn {\\n\\n}\\n\\n.message {\\n    font-size: 1.66vh;\\n    text-shadow: 1px 1px 0 #888;\\n}\\n\\n.message__text {\\n\\n}\\n\\n.message__bold {\\n    font-weight: bold;\\n}\\n\\n.message__italics {\\n    font-style: italic;\\n}\\n\\n.message__amount {\\n    margin-left: 1em;\\n}\\n\\n.character-info {\\n    font-family: Arial, serif;\\n    font-weight: bold;\\n    font-size: 15vh;\\n    text-align: center;\\n}\\n#character-health {\\n    color: #c00;\\n}\\n\\n#character-mana {\\n    color: #00c;\\n}\\n\\n.character-info__wrap {\\n    position: absolute;\\n    top: 5%;\\n    bottom: 5%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n#character-mana .character-info__wrap {\\n    transform: rotate(180deg);\\n}\\n\\n.character-info__bg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 10;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-health .character-info__bg {\\n    color: #ffe0e0;\\n}\\n\\n.character-info__fg {\\n    position: absolute;\\n    bottom: 10%;\\n    left: 0;\\n    right: 0;\\n    z-index: 20;\\n    display: flex;\\n    flex-direction: column-reverse;\\n    overflow: hidden;\\n}\\n\\n#character-mana .character-info__bg,\\n#character-mana .character-info__fg {\\n    bottom: -15%;\\n    font-size: 18.75vh;\\n}\\n\\n#character-mana .character-info__fg {\\n    color: #e0e0ff;\\n}\\n\\n.character-info__text {\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    font-size: 3vh;\\n    color: #000;\\n    z-index: 30;\\n    text-shadow: 1px 1px 3px #eee;\\n}\\n\\n#character-health .character-info__text {\\n    top: 38%;\\n    bottom: 0;\\n}\\n\\n#character-mana .character-info__text {\\n    transform: rotate(180deg);\\n    top: 0;\\n    bottom: 38%;\\n}\\n\\n.inventory {\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.inventory.active {\\n    transform: translateX(0);\\n}\\n\\n.inventory__equipment {\\n    width: 100%;\\n    height: 55%;\\n    display: grid;\\n    grid-template-columns: repeat(3, minmax(0, 1fr));\\n    grid-template-rows: repeat(4, minmax(0, 1fr));\\n    background-color: #333;\\n    grid-gap: 0.2vw;\\n    padding: 1vh 7.5vh\\n}\\n\\n.inventory__storage-wrap {\\n    width: 100%;\\n    height: 40%;\\n    background-color: #333;\\n    position: relative;\\n    overflow-y: auto;\\n}\\n\\n.inventory__storage {\\n    width: 100%;\\n    display: grid;\\n    grid-template-columns: repeat(10, minmax(0, 1fr));\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.inventory__storage-title {\\n    grid-column: span 10;\\n    padding: 5px;\\n    background-color: #ccc;\\n    font-size: 1.8vh;\\n}\\n\\n.slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n    position: relative;\\n    font-family: helvetica, serif;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot .item {\\n    font-size: 7.5vh;\\n}\\n\\n.inventory__equipment-slot:before {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    right: 0;\\n    bottom: 0;\\n    width: 100%;\\n    height: 100%;\\n    font-size: 7.5vh;\\n    opacity: 0.15;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n}\\n\\n.inventory__equipment-slot.has-item:before {\\n    display: none;\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"0\\\"]:before {\\n    content: \\\"⌈\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"1\\\"]:before {\\n    content: \\\"∩\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"2\\\"]:before {\\n    content: \\\"ᴕ\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"3\\\"]:before {\\n    content: \\\"†\\\";\\n    transform: rotate(180deg);\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"4\\\"]:before {\\n    content: \\\"☗\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"5\\\"]:before {\\n    content: \\\"●\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"6\\\"]:before,\\n.inventory__equipment-slot[data-index=\\\"8\\\"]:before {\\n    content: \\\"○\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"7\\\"]:before {\\n    content: \\\"-\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"9\\\"]:before {\\n    content: \\\"ひ\\\";\\n}\\n\\n.inventory__equipment-slot[data-index=\\\"10\\\"]:before {\\n    content: \\\"◫\\\";\\n}\\n.inventory__equipment-slot[data-index=\\\"11\\\"]:before {\\n    content: \\\"″\\\";\\n}\\n\\n.inventory__storage-slot {\\n    height: 5.3vh;\\n}\\n\\n.slot.has-item:hover {\\n    cursor: pointer;\\n    background-color: #999;\\n}\\n\\n.slot.disabled {\\n    background-color: #845b5b;\\n}\\n\\n.slot.dragging .item {\\n    display: none;\\n}\\n\\n.character {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 30%;\\n    height: 80%;\\n    transform: translateX(-100%);\\n    transition: transform 1s ease;\\n    background: #fff;\\n    padding: 15px;\\n}\\n\\n.character.active {\\n    transform: translateX(0);\\n}\\n\\n.character__title {\\n    text-align: center;\\n    font-weight: bold;\\n    margin-top: 0;\\n    margin-bottom: 40px;\\n    text-transform: uppercase;\\n    font-family: Arial, serif;\\n    font-size: 3vh;\\n}\\n\\n.character__xp {\\n    width: 80%;\\n    margin: 0 auto 40px;\\n}\\n\\n.item {\\n    font-family: helvetica, serif;\\n    pointer-events: none;\\n    position: relative;\\n    font-size: 4.5vh;\\n    user-select: none;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n    width: 100%;\\n}\\n\\n.item__icon {\\n\\n}\\n\\n.item__amount {\\n    position: absolute;\\n    right: 5%;\\n    bottom: 5%;\\n    font-size: 1.1vw;\\n    color: #fff;\\n    line-height: 0.7vw;\\n}\\n\\n.item__details {\\n    display: none;\\n}\\n\\n.item__tooltip .item__details {\\n    display: block;\\n}\\n\\n.item__details-line  {\\n    display: block;\\n}\\n\\n.item__details-line span {\\n    font-weight: bold;\\n}\\n\\n.inventory__golddisplay {\\n    width: 100%;\\n    height: 5%;\\n    font-size: 1.5vw;\\n    padding: 1%;\\n}\\n\\n.item__tooltip {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    background: #ccc;\\n    padding: 5px 10px;\\n    border-radius: 5px;\\n    max-width: 30%;\\n    font-size: 1.5vh;\\n    pointer-events: none;\\n}\\n\\n.item__tooltip.active {\\n    display: block;\\n}\\n\\n.item__drag {\\n    display: none;\\n    position: fixed;\\n    z-index: 1000;\\n    text-align: center;\\n    pointer-events: none;\\n}\\n\\n.item__drag.active {\\n    display: block;\\n}\\n\\n.item__name {\\n    font-weight: bold;\\n    font-size: 2.5vh;\\n}\\n\\n.item__description {\\n    font-style: italic;\\n}\\n\\n\\n.savegame__overwrite {\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    width: 100%;\\n    height: 100%;\\n    background-color: #000;\\n    display: none;\\n    pointer-events: none;\\n    padding: 15px;\\n    border-radius: 15px 0;\\n}\\n\\n.savegame__overwrite.active {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.savegame__overwrite-title {\\n    color: #fff;\\n    font-size: 3vh;\\n}\\n\\n.savegame__oldsaves,\\n.loadgame__oldsaves {\\n    margin-bottom: 15px;\\n}\\n\\n.savegame__newsave-input {\\n    font-size: 2.2vh;\\n    display: inline-block;\\n    float: left;\\n    margin-right: 1vh;\\n}\\n\\n.save {\\n    text-align: left;\\n    position: relative;\\n    font-size: 2vh;\\n    font-weight: bold;\\n}\\n\\n.save label {\\n    font-family: Lucida Console, serif;\\n    display: block;\\n}\\n\\n.save + .save {\\n    margin-top: 1vh;\\n}\\n\\n.save__title,\\n.save__delete {\\n    font-size: 2vh;\\n}\\n.save__title {\\n    width: 80%;\\n    display: inline-grid;\\n    grid-template-columns: 2fr 1fr;\\n}\\n\\n.save__text {\\n    grid-column: 1;\\n    grid-row: 1 / span 2;\\n    pointer-events: none;\\n}\\n\\n.save__date,\\n.save__time {\\n    font-size: 1.2vh;\\n    grid-column: 2;\\n    text-align: right;\\n    pointer-events: none;\\n}\\n\\n.save__date {\\n    grid-row: 1;\\n}\\n\\n.save__time {\\n    grid-row: 2;\\n}\\n\\n.save__delete {\\n    width: 10%;\\n    background-color: #f66;\\n    font-size: 3.6vh;\\n    line-height: 2.9vh;\\n    font-weight: bold;\\n    float: right;\\n}\\n\\n.save__confirm {\\n    width: auto;\\n    display: inline-block;\\n}\\n\\n.credits {\\n    font-size: 5vh;\\n    width: 100%;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n    max-width: 100%;\\n    border-radius: 0;\\n}\\n\\n.credits .menu__content {\\n    transform: translateY(30%);\\n}\\n\\n.credits.active .menu__content {\\n    transform: translateY(-100%);\\n    transition: all 30s linear;\\n}\\n\\n.credits__title {\\n    font-size: 15vh;\\n    margin: 0;\\n}\\n\\n.credits__section {\\n    padding: 15vh;\\n}\\n\\n.settings input[type=checkbox] {\\n    width: 2vh;\\n    height: 2vh;\\n}\\n\\n.settings input[type=number] {\\n    min-width: 55px;\\n    width: 4.5vh;\\n}\\n\\n.settings .menu__actions,\\n.controls .menu__actions {\\n    margin-top: 3vh;\\n}\\n\\n.controls label {\\n    text-align: right;\\n    padding-right: 25px;\\n}\\n\\n.settings__section,\\n.controls__section {\\n    text-align: left;\\n    font-size: 2vh;\\n}\\n\\n.settings__section-title,\\n.controls__section-title {\\n    font-size: 3vh;\\n    margin-top: 0;\\n    margin-bottom: .5vh;\\n    text-decoration: underline;\\n}\\n\\n.settings__section + .settings__section,\\n.controls__section + .controls__section {\\n    padding-top: 15px;\\n    margin-top: 15px;\\n}\\n\\n.settings__section-inn,\\n.controls__section-inn{\\n    padding: 0 15px;\\n}\\n\\n.control {\\n    display: grid;\\n    grid-template-columns: 1.3fr 1fr 1fr;\\n}\\n\\n.controls__section {\\n    display: inline-block;\\n    width: 47%;\\n    margin-right: 2%;\\n}\\n\\n.controls__section-inn {\\n    display: grid;\\n}\\n\\n.stat__group {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    margin-top: 10px;\\n}\\n\\n.stat {\\n    display: grid;\\n    grid-template-columns: 4fr 2fr 1fr;\\n    text-align: center;\\n    width: 97%;\\n}\\n\\n.attribute {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    text-align: center;\\n}\\n\\n.stat__title,\\n.stat__text,\\n.attribute__title,\\n.attribute__value {\\n    border: 2px solid #000;\\n    padding: 5px;\\n}\\n\\n.attribute + .attribute .attribute__title,\\n.attribute + .attribute .attribute__value{\\n    border-top: 0;\\n}\\n\\n.stat__text,\\n.attribute__value {\\n    border-left: 0;\\n}\\n\\n.stat__title {\\n    text-transform: uppercase;\\n    font-weight: bold;\\n}\\n.stat__text {\\n    margin-right: 7px;\\n}\\n\\n.stat__level {\\n    display: none;\\n    pointer-events: none;\\n    background-color: #3a3;\\n    color: #fff;\\n    font-weight: bold;\\n}\\n\\n.character.has-statpoint .stat__level {\\n    display: block;\\n    pointer-events: all;\\n}\\n\\n.available-stats {\\n    display: none;\\n    text-align: center;\\n    margin: 20px 0;\\n}\\n\\n.character.has-statpoint .available-stats {\\n    display: block;\\n}\\n\\n.available-stats__inn {\\n    border: 1px solid #000;\\n    display: inline-block;\\n    padding: 10px;\\n}\\n\\n.available-stats__value {\\n    margin-right: 10px;\\n}\\n\\n.character__xp-text {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n}\\n\\n.character__xp-value {\\n    text-align: right;\\n}\\n\\n.character__xp-bar {\\n    width: 100%;\\n    height: 20px;\\n    background: repeating-linear-gradient(to right, #ddd, #ddd 10%, #eee 10%, #eee 20%);\\n    position: relative;\\n    border: 2px solid #333;\\n}\\n\\n.bottom-container .character__xp-bar{\\n    position: absolute;\\n    bottom: 32%;\\n    height: 8%;\\n    left: 0;\\n    right: 0;\\n}\\n\\n.character__xp-filled {\\n    background-color: rgba(210, 210, 0, .6);\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    height: 100%;\\n}\\n\\n.bottom-container {\\n    position: fixed;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 75%;\\n    height: 20%;\\n    display: grid;\\n    grid-template-columns: 1fr 3fr 1fr;\\n    margin: 0 auto;\\n}\\n\\n.bottom-container__left,\\n.bottom-container__center,\\n.bottom-container__right {\\n    position: relative;\\n}\\n\\n.hotbar {\\n    position: absolute;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    width: 100%;\\n    height: 32%;\\n    display: grid;\\n    grid-template-columns: 4.5fr 1fr 4.5fr;\\n    background-color: #333;\\n}\\n\\n.spell-slots,\\n.belt-slots {\\n    display: grid;\\n    width: 100%;\\n    height: 100%;\\n    grid-template-columns: repeat(6, 1fr);\\n    grid-gap: 0.2vw;\\n    padding: 0.2vw;\\n}\\n\\n.spell-slot,\\n.belt-slot {\\n    background-color: gray;\\n    text-align: center;\\n    border-radius: 5px;\\n}\\n\\n.spell-slot + .spell-slot,\\n.belt-slot + .belt-slot {\\n    border-left: 0;\\n}\\n\\n.hotbar__controls {\\n    display: grid;\\n    grid-template-columns: 1fr 1fr;\\n    grid-template-rows: 35% 65%;\\n    padding: 0.4vh 0 0.6vh;\\n    grid-gap: 0.2vh;\\n}\\n\\n.hotbar__controls button {\\n    width: 100%;\\n    height: 100%;\\n    border-radius: 0;\\n    font-weight: bold;\\n    text-transform: uppercase;\\n    line-height: 0;\\n}\\n\\n.hotbar-inventory,\\n.hotbar-character,\\n.hotbar-skills {\\n    width: 100%;\\n    height: 100%;\\n}\\n.hotbar-inventory {\\n    grid-row: 1;\\n    grid-column: span 2;\\n}\\n.hotbar-character {\\n    grid-row: 2;\\n    grid-column: 1;\\n}\\n.hotbar__open-character.has-statpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n.hotbar-skills {\\n    grid-row: 2;\\n    grid-column: 2;\\n}\\n.hotbar__open-skill.has-skillpoint {\\n    background-color: #3a3;\\n    color: #fff;\\n}\\n\\n.pickup-slot {\\n    height: 5.3vh;\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!./style.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import engine from \"../Engine\";\n\nexport default class Action {\n    constructor(entity) {\n        this.entity = entity;\n    }\n\n    /**\n     *\n     * @returns {Action}\n     */\n    perform() {\n        console.error(\"Not Implemented\");\n    }\n\n    isPlayer() {\n        return this.entity === engine.player;\n    }\n}","import Action from \"./_Action\";\n\nexport default class UnableToPerformAction extends Action {\n    constructor(entity, reason) {\n        super(entity);\n\n        this.reason = reason;\n    }\n\n    perform() {\n        return this;\n    }\n}","import engine from \"../../Engine\";\n\nexport default class BaseFov {\n    constructor() {\n        this.previousVisibleObjects = [];\n        this.visibleObjects = [];\n        this.visibleActors = [];\n        this.visibleItems = [];\n        this.oldObjects = [];\n        this.newObjects = [];\n        this.left = 0;\n        this.right = 0;\n        this.top = 0;\n        this.bottom = 0;\n    }\n\n    teardown() {\n        this.previousVisibleObjects = [];\n        this.visibleObjects = [];\n        this.visibleActors = [];\n        this.visibleItems = [];\n        this.oldObjects = [];\n        this.newObjects = [];\n    }\n\n    compute(x, y, z, radius) {\n        this.previousVisibleObjects = this.visibleObjects;\n        this.visibleObjects = [];\n        this.visibleActors = [];\n        this.visibleItems = [];\n        this.oldObjects = [];\n        this.newObjects = [];\n\n        this.left = Math.max(0, x - radius);\n        this.right = Math.min(engine.gameMap.width, x + radius + 1);\n        this.top = Math.max(0, y - radius);\n        this.bottom = Math.min(engine.gameMap.height, y + radius + 1);\n    }\n\n    addVisibleObject(object) {\n        if (this.visibleObjects.indexOf(object) === -1) {\n            this.visibleObjects.push(object);\n        }\n\n        if (this.previousVisibleObjects.indexOf(object) === -1 && this.newObjects.indexOf(object) === -1) {\n            this.newObjects.push(object);\n        }\n    }\n\n    addVisibleActor(object) {\n        if (this.visibleActors.indexOf(object) === -1) {\n            this.visibleActors.push(object);\n        }\n    }\n\n    addVisibleItem(object) {\n        if (this.visibleItems.indexOf(object) === -1) {\n            this.visibleItems.push(object);\n        }\n    }\n\n    remove(object) {\n        const newIndex = this.newObjects.indexOf(object);\n        if (newIndex > -1) {\n            this.newObjects.splice(newIndex, 1);\n        }\n\n        const oldIndex = this.oldObjects.indexOf(object);\n        if (oldIndex > -1) {\n            this.oldObjects.splice(oldIndex, 1);\n        }\n\n        this.removeVisible(object);\n    }\n\n    removeVisible(object) {\n        const visibleIndex = this.visibleObjects.indexOf(object);\n        if (visibleIndex > -1 ) {\n            this.visibleObjects.splice(visibleIndex, 1);\n        }\n\n        const visibleItemsIndex = this.visibleItems.indexOf(object);\n        if (visibleItemsIndex > -1) {\n            this.visibleItems.splice(visibleItemsIndex, 1);\n        }\n\n        const previousVisibleItemsIndex = this.previousVisibleObjects.indexOf(object);\n        if (previousVisibleItemsIndex > -1) {\n            this.previousVisibleObjects.splice(previousVisibleItemsIndex, 1);\n        }\n    }\n\n    exploreTile(x, y, minZ, maxZ, tilesOnly = false) {\n        const tilesIter = engine.gameMap.tiles.entries();\n        for (const entry of tilesIter) {\n            if (entry[0] >= minZ && entry[0] <= maxZ) {\n                const tilesArray = entry[1];\n                const tileArrayX = tilesArray[x];\n                if (tileArrayX) {\n                    const tile = tileArrayX[y];\n\n                    if (tile) {\n                        this.addVisibleObject(tile);\n                    }\n                }\n            }\n        }\n\n        if (!tilesOnly) {\n            for (let actor of engine.gameMap.actors) {\n                const positionalObject = actor.getComponent(\"positionalobject\");\n                if (positionalObject) {\n                    if (positionalObject.x === x && positionalObject.y === y) {\n                        this.addVisibleObject(actor);\n                        this.addVisibleActor(actor);\n                    }\n                }\n            }\n\n            for (let item of engine.gameMap.items) {\n                const positionalObject = item.getComponent(\"positionalobject\");\n                if (positionalObject) {\n                    if (positionalObject.x === x && positionalObject.y === y) {\n                        this.addVisibleObject(item);\n                        this.addVisibleItem(item);\n                    }\n                }\n            }\n        }\n    }\n}","export default class FovSlope {\n    constructor(y, x) {\n        this.y = y;\n        this.x = x;\n    }\n\n    greater(y, x) {\n        return this.y * x > this.x * y;\n    }\n\n    greaterOrEqual(y, x) {\n        return this.y * x >= this.x * y;\n    }\n/*\n    less(y, x) {\n        return this.y * x < this.x * y;\n    }\n*/\n    lessOrEqual(y, x) {\n        return this.y * x <= this.x * y;\n    }\n}","import BaseFov from \"./_BaseFov\";\nimport FovSlope from \"./FovSlope\";\nimport engine from \"../../Engine\";\n\n/**\n * Credit to Adam Milazzo for this fov algorithm: http://www.adammil.net/blog/v125_roguelike_vision_algorithms.html\n */\nexport default class AdamMilazzoFov extends BaseFov {\n    constructor() {\n        super();\n    }\n\n    compute(x, y, z, radius, minZ, maxZ) {\n        super.compute(x, y, z, radius);\n\n        this.exploreTile(x, y, minZ, maxZ);\n        for (let octant = 0; octant < 8; octant ++) {\n            this.computeOctant(octant, x, y, z, radius, 1, new FovSlope(1, 1), new FovSlope(0, 1), minZ, maxZ);\n        }\n    }\n\n    computeOctant(octant, originX, originY, originZ, rangeLimit, x, top, bottom, minZ, maxZ) {\n        for (; x <= rangeLimit; x++) {\n            let topY;\n            if (top.x === 1) {\n                topY = x;\n            } else {\n                topY = Math.round(((x * 2 - 1) * top.y + top.x) / (top.x * 2));\n\n                if (this.blocksLight(octant, originX, originY, originZ, x, topY)) {\n                    if (top.greaterOrEqual(topY * 2 + 1, x * 2) && !this.blocksLight(octant, originX, originY, originZ, x, topY + 1)) {\n                        topY ++;\n                    }\n                } else {\n                    let ax = x * 2;\n                    if (this.blocksLight(octant, originX, originY, originZ, x + 1, topY + 1)) {\n                        ax ++;\n                    }\n\n                    if (top.greater(topY * 2 + 1, ax)) {\n                        topY ++;\n                    }\n                }\n            }\n\n            let bottomY;\n            if (bottom.y === 0) {\n                bottomY = 0;\n            } else {\n                bottomY = ((x * 2 - 1) * bottom.y + bottom.x) / (bottom.x * 2);\n\n                if (bottom.greaterOrEqual(bottomY * 2 + 1, x * 2) && this.blocksLight(octant, originX, originY, originZ, x, bottomY) && !this.blocksLight(octant, originX, originY, originZ, x, bottomY + 1)) {\n                    bottomY ++;\n                }\n            }\n\n            let wasOpaque = -1; // 0:false, 1:true, -1:not applicable\n            for (let y = topY; y >= bottomY; y--) {\n                const isOpaque = this.blocksLight(octant, originX, originY, originZ, x, y);\n                const isVisible = isOpaque || ((y !== topY || top.greaterOrEqual(y, x)) && (y !== bottomY || bottom.lessOrEqual(y, x)));\n\n                if (isVisible) {\n                    this.setVisible(octant, originX, originY, x, y, minZ, maxZ);\n                }\n\n                if (x !== rangeLimit) {\n                    if (isOpaque) {\n                        if (wasOpaque === 0) {\n                            const nx = x * 2;\n                            const ny = y * 2 + 1;\n\n                            if (top.greater(ny, nx)) {\n                                if (y === bottomY) {\n                                    bottom = new FovSlope(ny, nx);\n                                    break;\n                                } else {\n                                    this.computeOctant(octant, originX, originY, originZ, rangeLimit, x + 1, top, new FovSlope(ny, nx), minZ, maxZ);\n                                }\n                            } else {\n                                if (y === bottomY) {\n                                    return;\n                                }\n                            }\n                        }\n\n                        wasOpaque = 1;\n                    } else {\n                        if (wasOpaque > 0) {\n                            const nx = x * 2;\n                            const ny = y * 2 + 1;\n\n                            if (bottom.greaterOrEqual(ny, nx)) {\n                                return;\n                            }\n\n                            top = new FovSlope(ny, nx);\n                        }\n\n                        wasOpaque = 0;\n                    }\n                }\n            }\n\n            if (wasOpaque !== 0) {\n                break;\n            }\n        }\n    }\n\n    blocksLight(octant, originX, originY, originZ, x, y) {\n        switch(octant) {\n            case 0:\n                originX += x;\n                originY -= y;\n                break;\n            case 1:\n                originX += y;\n                originY -= x;\n                break;\n            case 2:\n                originX -= y;\n                originY -= x;\n                break;\n            case 3:\n                originX -= x;\n                originY -= y;\n                break;\n            case 4:\n                originX -= x;\n                originY += y;\n                break;\n            case 5:\n                originX -= y;\n                originY += x;\n                break;\n            case 6:\n                originX += y;\n                originY += x;\n                break;\n            case 7:\n                originX += x;\n                originY += y;\n                break;\n        }\n\n        let blocksLight = false;\n        if (engine.gameMap.tiles.has(originZ)) {\n            const wallTiles = engine.gameMap.tiles.get(originZ);\n            if (wallTiles[originX]) {\n                const wallTile = wallTiles[originX][originY];\n                if (wallTile) {\n                    const blocksFov = wallTile.getComponent(\"blocksFov\");\n                    if (blocksFov) {\n                        blocksLight = blocksFov.blocksFov;\n                    }\n                }\n            }\n        }\n\n        return blocksLight;\n    }\n\n    setVisible(octant, originX, originY, x, y, minZ, maxZ) {\n        switch(octant) {\n            case 0:\n                originX += x;\n                originY -= y;\n                break;\n            case 1:\n                originX += y;\n                originY -= x;\n                break;\n            case 2:\n                originX -= y;\n                originY -= x;\n                break;\n            case 3:\n                originX -= x;\n                originY -= y;\n                break;\n            case 4:\n                originX -= x;\n                originY += y;\n                break;\n            case 5:\n                originX -= y;\n                originY += x;\n                break;\n            case 6:\n                originX += y;\n                originY += x;\n                break;\n            case 7:\n                originX += x;\n                originY += y;\n                break;\n        }\n\n        this.exploreTile(originX, originY, minZ, maxZ);\n    }\n}","import BaseFov from \"./_BaseFov\";\nimport engine from \"../../Engine\";\n\nexport default class SimpleFov extends BaseFov {\n    constructor() {\n        super();\n    }\n\n    compute(x, y, z, radius, minZ, maxZ) {\n        super.compute(x, y, z, radius, minZ, maxZ);\n\n        const minX = Math.max(0, x - radius);\n        const maxX = Math.min(engine.gameMap.width, x + radius);\n        const minY = Math.max(0, y - radius);\n        const maxY = Math.min(engine.gameMap.height, y + radius);\n\n        for (let i = minX; i < maxX; i++) {\n            for (let j = minY; j < maxY; j++) {\n                this.exploreTile(i, j, minZ, maxZ, true);\n            }\n        }\n    }\n}","export default class SubMessage {\n    constructor(text, color, options) {\n        this.text = text;\n        this.color = color || \"#333\";\n\n        this.bold = false;\n        this.italics = false;\n        if (options) {\n            this.bold = options.bold || false;\n            this.italics = options.italics || false;\n        }\n    }\n\n    isEqual(subMessage) {\n        return this.text === subMessage.text && this.color === subMessage.color && this.bold === subMessage.bold && this.italics === subMessage.italics;\n    }\n}","export default class Message {\n    constructor(subMessages = []) {\n        this.subMessages = subMessages;\n        this.count = 1;\n    }\n\n    isEqual(subMessages) {\n        if (this.subMessages.length !== subMessages.length) {\n            return false;\n        }\n\n        for (let i = 0; i < this.subMessages.length; i++) {\n            const sub1 = this.subMessages[i];\n            const sub2 = subMessages[i];\n\n            if (!sub1.isEqual(sub2)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    getHtml() {\n        const messageDom = document.createElement(\"div\");\n        messageDom.classList.add(\"message\");\n\n        for (const subMessage of this.subMessages) {\n            const subMessageDom = document.createElement(\"span\");\n            subMessageDom.classList.add(\"message__text\");\n\n            if (subMessage.bold) {\n                subMessageDom.classList.add(\"message__bold\");\n            }\n\n            if (subMessage.italics) {\n                subMessageDom.classList.add(\"message__italics\");\n            }\n            subMessageDom.innerText = subMessage.text;\n            subMessageDom.style.color = subMessage.color;\n            messageDom.appendChild(subMessageDom);\n        }\n\n        if (this.count > 1) {\n            messageDom.appendChild(this.getCountHtml());\n        }\n\n        return messageDom;\n    }\n\n    getCountHtml() {\n        const amountDom = document.createElement(\"span\");\n        amountDom.classList.add(\"message__amount\");\n        amountDom.innerText = \"x\" + this.count;\n\n        return amountDom;\n    }\n}","export default class UIElement {\n    constructor(html) {\n        this.dom = this.htmlToElement(html);\n    }\n\n    /**\n     * Reference: https://stackoverflow.com/a/35385518\n     * @param {String} html HTML representing a single element\n     * @return {Element}\n     */\n    htmlToElement(html) {\n        const template = document.createElement('template');\n        html = html.trim(); // Never return a text node of whitespace as the result\n        template.innerHTML = html;\n        return template.content.firstChild;\n    }\n\n    // /**\n    //  * Reference: https://stackoverflow.com/a/35385518\n    //  * @param {String} html HTML representing any number of sibling elements\n    //  * @return {NodeList}\n    //  */\n    // htmlToElements(html) {\n    //     const template = document.createElement('template');\n    //     template.innerHTML = html;\n    //     return template.content.childNodes;\n    // }\n\n    isOpen() {\n        return this.dom.classList.contains(\"active\");\n    }\n\n    open() {\n        if (!this.dom.classList.contains(\"active\")) {\n            this.dom.classList.add(\"active\");\n        }\n    }\n\n    close() {\n        this.dom.classList.remove(\"active\");\n    }\n}","import html from '../../html/ui/MessageConsole.html';\nimport SubMessage from \"./message/SubMessage\";\nimport Message from \"./message/Message\";\nimport UIElement from \"./UIElement\";\n\nclass MessageConsole extends UIElement {\n    constructor() {\n        super(html);\n        this.messages = [];\n        this.builder = [];\n\n        const consoleIncreaseDom = this.dom.getElementsByClassName(\"console__increase\")[0];\n        consoleIncreaseDom.addEventListener(\"click\", function(e) {\n            const parent = e.target.parentElement;\n            if (!parent.classList.contains(\"animate\")) {\n                parent.classList.add(\"animate\");\n            }\n            if (parent.classList.contains(\"collapsed\")) {\n                parent.classList.remove(\"collapsed\");\n            } else {\n                parent.classList.add(\"full\");\n            }\n        });\n\n        const consoleDecreaseDom = this.dom.getElementsByClassName(\"console__decrease\")[0];\n        consoleDecreaseDom.addEventListener(\"click\", function(e) {\n            const parent = e.target.parentElement;\n            if (!parent.classList.contains(\"animate\")) {\n                parent.classList.add(\"animate\");\n            }\n            if (parent.classList.contains(\"full\")) {\n                parent.classList.remove(\"full\");\n            } else {\n                parent.classList.add(\"collapsed\");\n            }\n        });\n\n        this.messagesInnerDom = this.dom.getElementsByClassName(\"messages__inn\")[0];\n    }\n\n    text(text, color, options) {\n        this.builder.push(new SubMessage(text, color, options));\n        return this; // Allow chaining\n    }\n\n    build(stack = true) {\n        this.addMessage(this.builder.slice(0), stack);\n        this.builder = [];\n    }\n\n    clear() {\n        this.messagesInnerDom.innerHTML = \"\";\n        this.messages = [];\n    }\n\n    addMessage(subMessages, stack = true) {\n        if (stack && this.messages.length > 0) {\n            const lastMessage = this.messages[this.messages.length - 1];\n            if (lastMessage.isEqual(subMessages)) {\n                lastMessage.count += 1;\n                this.updateLastMessageCount(lastMessage);\n            } else {\n                this.messages.push(new Message(subMessages));\n                this.addNewMessage();\n            }\n        } else {\n            this.messages.push(new Message(subMessages));\n            this.addNewMessage();\n        }\n    }\n\n    updateLastMessageCount(lastMessage) {\n        const lastMessageDom = document.querySelectorAll(\".message:last-child\")[0];\n        const amountDom = lastMessageDom.querySelectorAll(\".message__amount\")[0];\n\n        if (amountDom) {\n            amountDom.innerText = \"x\" + lastMessage.count;\n        } else {\n            lastMessageDom.appendChild(lastMessage.getCountHtml());\n        }\n    }\n\n    addNewMessage() {\n        const lastMessage = this.messages[this.messages.length - 1];\n        this.messagesInnerDom.appendChild(lastMessage.getHtml());\n    }\n\n    close() {\n        super.close();\n\n        this.dom.classList.remove(\"animate\");\n    }\n}\n\nconst messageConsole = new MessageConsole();\nexport default messageConsole;","import Action from \"./_Action\";\n\nexport default class NoAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        return this;\n    }\n}","import html from '../../html/ui/Details.html';\nimport engine from \"../Engine\";\nimport UIElement from \"./UIElement\";\n\nclass Details extends UIElement {\n    constructor() {\n        super(html);\n    }\n\n    updatePlayerDetails() {\n        this.updatePositionDetails(engine.player, true);\n    }\n\n    getPosition(entity) {\n        const position = entity.getComponent(\"positionalobject\");\n        const x = position.x;\n        const y = position.y;\n        return \"<span class='details__line'>Looking at: X:\" + x + \" - Y:\" + y + \"</span>\";\n    }\n\n    updatePositionOnly(entity) {\n        this.dom.innerHTML = this.getPosition(entity);\n    }\n\n    updatePositionDetails(entity, skipPlayer = false, ) {\n        const position = entity.getComponent(\"positionalobject\");\n        const x = position.x;\n        const y = position.y;\n        const z = position.z;\n        let zStart = z - 1;\n        if (entity !== engine.player) {\n            zStart = z;\n        }\n        let text = this.getPosition(entity);\n        const tiles = engine.gameMap.tiles;\n        for (let i = zStart; i <= z; i++) {\n            if (tiles.get(i) && tiles.get(i)[x]) {\n                const tile = tiles.get(i)[x][y];\n                if (tile) {\n                    text += \"<span class='details__line'>\" + tile.name + \"</span>\";\n                }\n            }\n        }\n\n        for (const actor of engine.gameMap.actors) {\n            if (skipPlayer && actor === engine.player) {\n                continue;\n            }\n\n            const position = actor.getComponent(\"positionalobject\");\n            if (position && position.isVisible() && x === position.x && y === position.y && Math.abs(z - position.z) < 2) {\n                text += \"<span class='details__line'><span style='color:\" + position.color + \"'>\" + position.letter + \"</span>: \" + actor.name;\n\n                const fighter = actor.getComponent(\"fighter\");\n                if (fighter) {\n                    text += \" \" + fighter.getHealthDescription();\n                }\n                text += \"</span>\";\n            }\n        }\n\n\n        const itemLines = [];\n        for (const item of engine.gameMap.items) {\n            const position = item.getComponent(\"positionalobject\");\n            if (position && position.isVisible() && x === position.x && y === position.y && Math.abs(z - position.z) < 2) {\n                itemLines.push(\"<span class='details__line'><span style='color:\" + position.color + \"'>\" + position.letter + \"</span>: \" + item.name + \"</span>\");\n            }\n        }\n\n        if (itemLines.length > 0) {\n            text += \"<span class='details__line details__header'>Items:</span>\";\n        }\n\n        for (const line of itemLines) {\n            text += line;\n        }\n\n\n        let nearby = [];\n        for (const actor of engine.fov.visibleActors) {\n            if (actor === engine.player || !actor.isAlive()) {\n                continue;\n            }\n\n            const position = actor.getComponent(\"positionalobject\");\n            if (position) {\n                nearby.push(actor);\n            }\n        }\n\n        if (nearby.length > 0) {\n            text += \"<span class='details__line details__header'>Nearby:</span>\";\n\n            for (const actor of nearby) {\n                const position = actor.getComponent(\"positionalobject\");\n                if (position) {\n                    text += \"<span class='details__line'>\"\n                    text += \"<span style='color:\" + position.color + \"'>\" + position.letter + \"</span>: \" + actor.name;\n\n                    const fighter = actor.getComponent(\"fighter\");\n                    if (fighter) {\n                        text += \" \" + fighter.getHealthDescription();\n                    }\n\n                    text += \"</span>\";\n                }\n            }\n        }\n\n        this.dom.innerHTML = text;\n    }\n}\n\nconst details = new Details();\nexport default details;","import * as THREE from \"three\";\nimport sceneState from \"../SceneState\";\nimport details from \"../ui/Details\";\nimport engine from \"../Engine\";\n\nexport default class EventHandler {\n    constructor() {\n        this.raycaster = new THREE.Raycaster();\n        this.mouse = new THREE.Vector2();\n        this.mouseDown = false;\n\n        window.addEventListener(\"mousemove\", this);\n        window.addEventListener(\"mousedown\", this);\n        window.addEventListener(\"mouseup\", this);\n        window.addEventListener(\"click\", this);\n        window.addEventListener(\"contextmenu\", this);\n        window.addEventListener(\"change\", this);\n        window.addEventListener(\"keydown\", this);\n\n        this.isPlayerTurn = true;\n        this.highlightedTiles = [];\n    }\n\n    teardown() {\n        window.removeEventListener(\"mousemove\", this);\n        window.removeEventListener(\"mousedown\", this);\n        window.removeEventListener(\"mouseup\", this);\n        window.removeEventListener(\"click\", this);\n        window.removeEventListener(\"contextmenu\", this);\n        window.removeEventListener(\"change\", this);\n        window.removeEventListener(\"keydown\", this);\n\n        this.clearHighlights();\n    }\n\n    handleEvent(e) {\n        switch(e.type) {\n            case \"mousemove\":\n                this.onMouseMove(e);\n                break;\n            case \"mousedown\":\n                this.onMouseDown(e);\n                break;\n            case \"mouseup\":\n                this.onMouseUp(e);\n                break;\n            case \"click\":\n                this.onLeftClick(e);\n                break;\n            case \"contextmenu\":\n                this.onRightClick(e);\n                break;\n            case \"change\":\n                this.onChange(e);\n                break;\n            case \"keydown\":\n                this.onKeydown(e);\n                break;\n        }\n    }\n\n    handleInput() {}\n\n    onMouseMove(e) {}\n\n    onMouseDown(e) {\n        this.mouseDown = true;\n    }\n\n    onMouseUp(e) {\n        this.mouseDown = false;\n    }\n\n    onLeftClick(e) {}\n\n    onRightClick(e) {}\n\n    onChange(e) {}\n\n    onKeydown(e) {}\n\n    getMouseIntersectingObjects(e) {\n        this.mouse.x = (e.clientX / sceneState.canvasDom.offsetWidth) * 2 - 1;\n        this.mouse.y = -(e.clientY / sceneState.canvasDom.offsetHeight) * 2 + 1;\n\n        this.raycaster.setFromCamera(this.mouse, sceneState.camera);\n\n        return this.raycaster.intersectObject(sceneState.scene, true);\n    }\n\n    isHighlighted(tile) {\n        for (const highlightedTile of this.highlightedTiles) {\n            if (tile === highlightedTile) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    clearAndSetHighlights(tiles) {\n        this.clearHighlights();\n        for (const tile of tiles) {\n            const position = tile.getComponent(\"positionalobject\");\n            if (position) {\n                position.highlight();\n                this.highlightedTiles.push(tile);\n            }\n        }\n        engine.needsMapUpdate = true;\n    }\n\n    clearAndSetHighlight(tile) {\n        this.clearHighlights();\n        const position = tile.getComponent(\"positionalobject\");\n        if (position) {\n            position.highlight();\n            this.highlightedTiles.push(tile);\n        }\n\n        details.updatePositionDetails(tile);\n        engine.needsMapUpdate = true;\n    }\n\n    clearHighlights(updatePlayer = false) {\n        for (const highlightedTile of this.highlightedTiles) {\n            const position = highlightedTile.getComponent(\"positionalobject\");\n            if (position) {\n                position.removeHighlight();\n            }\n        }\n\n        this.highlightedTiles = [];\n\n        if (updatePlayer) {\n            details.updatePlayerDetails();\n        }\n\n        engine.needsMapUpdate = true;\n    }\n}","const Key = {\n    LEFT: \"ArrowLeft\",\n    RIGHT: \"ArrowRight\",\n    UP: \"ArrowUp\",\n    DOWN: \"ArrowDown\",\n    BACKSPACE: \"Backspace\",\n    TAB: \"Tab\",\n    ENTER: \"Enter\",\n    SHIFT_LEFT: \"Left Shift\",\n    SHIFT_RIGHT: \"Right Shift\",\n    CONTROL_LEFT: \"Left Control\",\n    CONTROL_RIGHT: \"Right Control\",\n    ALT_LEFT: \"Left Alt\",\n    ALT_RIGHT: \"Right Alt\",\n    PAUSE_BREAK: \"Pause\",\n    CAPS_LOCK: \"CapsLock\",\n    ESCAPE: \"Escape\",\n    SPACE: \" \",\n    PAGE_UP: \"PageUp\",\n    PAGE_DOWN: \"PageDown\",\n    END: \"End\",\n    HOME: \"Home\",\n    INSERT: \"Insert\",\n    DELETE: \"Delete\",\n    OS_LEFT: \"Left OS\",\n    OS_RIGHT: \"Right OS\",\n    CONTEXT_MENU: \"ContextMenu\",\n    SCROLL_LOCK: \"ScrollLock\",\n    NUM_LOCK: \"NumLock\",\n    NUMPAD_DIVIDE: \"Numpad /\",\n    NUMPAD_MULTIPLY: \"Numpad *\",\n    NUMPAD_SUBTRACT: \"Numpad -\",\n    NUMPAD_ADD: \"Numpad +\",\n    NUMPAD_ENTER: \"Numpad Enter\",\n\n    NUMPAD_PERIOD: \"Numpad .\",\n    NUMPAD_0: \"Numpad 0\",\n    NUMPAD_1: \"Numpad 1\",\n    NUMPAD_2: \"Numpad 2\",\n    NUMPAD_3: \"Numpad 3\",\n    NUMPAD_4: \"Numpad 4\",\n    NUMPAD_5: \"Numpad 5\",\n    NUMPAD_6: \"Numpad 6\",\n    NUMPAD_7: \"Numpad 7\",\n    NUMPAD_8: \"Numpad 8\",\n    NUMPAD_9: \"Numpad 9\",\n\n    NUMPAD_DELETE: \"Numpad Delete\",\n    NUMPAD_INSERT: \"Numpad Insert\",\n    NUMPAD_END: \"Numpad End\",\n    NUMPAD_ARROW_DOWN: \"Numpad ArrowDown\",\n    NUMPAD_PAGE_DOWN: \"Numpad PageDown\",\n    NUMPAD_ARROW_LEFT: \"Numpad ArrowLeft\",\n    NUMPAD_CLEAR: \"Numpad Clear\",\n    NUMPAD_ARROW_RIGHT: \"Numpad ArrowRight\",\n    NUMPAD_HOME: \"Numpad Home\",\n    NUMPAD_ARROW_UP: \"Numpad ArrowUp\",\n    NUMPAD_PAGE_UP: \"Numpad PageUp\",\n}\n\nexport default Key;","import Key from \"./Key\";\r\n\r\nclass Controls {\r\n    constructor() {\r\n        const self = this;\r\n\r\n        self.defaultDelay = 25;\r\n        self.lastShiftUp = null;\r\n        self.treatShiftNumpadEqual = true;\r\n        self.keysDown = [];\r\n        self.keysDelayed = [];\r\n        self.defaults = new Map();\r\n\r\n        self.controls = new Map();\r\n        self.defaults.set(\"left\", [Key.NUMPAD_4, Key.LEFT]);\r\n        self.defaults.set(\"right\", [Key.NUMPAD_6, Key.RIGHT]);\r\n        self.defaults.set(\"up\", [Key.NUMPAD_8, Key.UP]);\r\n        self.defaults.set(\"down\", [Key.NUMPAD_2, Key.DOWN]);\r\n\r\n        self.defaults.set(\"editor-left\", [Key.LEFT]);\r\n        self.defaults.set(\"editor-right\", [Key.RIGHT]);\r\n        self.defaults.set(\"editor-up\", [Key.UP]);\r\n        self.defaults.set(\"editor-down\", [Key.DOWN]);\r\n\r\n        self.defaults.set(\"nw\", [Key.NUMPAD_7]);\r\n        self.defaults.set(\"ne\", [Key.NUMPAD_9]);\r\n        self.defaults.set(\"sw\", [Key.NUMPAD_1]);\r\n        self.defaults.set(\"se\", [Key.NUMPAD_3]);\r\n        self.defaults.set(\"wait\", [Key.NUMPAD_5]);\r\n\r\n        //self.defaults.set(\"drop\", [\"d\"]);\r\n        self.defaults.set(\"get\", [\"g\"]);\r\n        self.defaults.set(\"inventory\", [\"i\"]);\r\n        self.defaults.set(\"character\", [\"c\"]);\r\n        self.defaults.set(\"closeall\", [\"`\"]);\r\n        self.defaults.set(\"look\", [\"/\"]);\r\n        self.defaults.set(\"pause\", [\"p\", Key.ESCAPE]);\r\n        self.defaults.set(\"interact\", [Key.ENTER, Key.NUMPAD_ENTER]);\r\n\r\n        self.defaults.set(\"confirm\", [Key.ENTER, Key.NUMPAD_ENTER]);\r\n        self.defaults.set(\"cancel\", [Key.ESCAPE, Key.BACKSPACE]);\r\n        self.defaults.set(\"modifier-speed1\", [Key.SHIFT_LEFT, Key.SHIFT_RIGHT]);\r\n        self.defaults.set(\"modifier-speed2\", [Key.CONTROL_LEFT, Key.CONTROL_RIGHT]);\r\n        self.defaults.set(\"modifier-speed3\", [Key.ALT_LEFT, Key.ALT_RIGHT]);\r\n\r\n        self.defaults.set(\"quicksave\", [\"F8\"]);\r\n        self.defaults.set(\"quickload\", [\"F9\"]);\r\n\r\n        self.defaults.set(\"debug\", [\"F2\"]);\r\n        self.defaults.set(\"debug2\", [\"F4\"]);\r\n        self.defaults.set(\"reset\", [\"r\"]);\r\n\r\n        self.load();\r\n\r\n        addEventListener(\"keydown\", function (e) {\r\n            // TODO: Evaluate if this should be generalized. I don't want to prevent all keys necessarily.\r\n            if (e.key === \"/\") {\r\n                e.preventDefault();\r\n            }\r\n\r\n            if (self.treatShiftNumpadEqual) {\r\n                const numLockOn = e.getModifierState(\"NumLock\");\r\n                // Re-add Shift key from Numpad press\r\n                if (numLockOn && !e.shiftKey && e.code.startsWith(\"Numpad\") && e.keyCode < 90) {\r\n                    if (self.lastShiftUp) {\r\n                        self.keysDown[self.lastShiftUp] = true;\r\n                        //console.log(\"Bonus Key Down: \", self.lastShiftUp);\r\n                    }\r\n                }\r\n            }\r\n\r\n            let key = self.getKey(e.key, e.code);\r\n            //console.log(\"Key Down: \", key);\r\n            self.keysDown[key] = true;\r\n        }, false);\r\n\r\n\r\n        addEventListener(\"keyup\", function (e) {\r\n            let key = self.getKey(e.key, e.code);\r\n            if (key === Key.SHIFT_LEFT || key === Key.SHIFT_RIGHT) {\r\n                self.lastShiftUp = key;\r\n            }\r\n\r\n            //console.log(\"Key Up: \", key);\r\n            delete self.keysDown[key];\r\n            delete self.keysDelayed[key];\r\n        }, false);\r\n    }\r\n\r\n    getKey(key, code) {\r\n        if (!code.startsWith(\"Arrow\")) {\r\n            if (code.endsWith(\"Left\")) {\r\n                key = \"Left \" + key;\r\n            } else if (code.endsWith(\"Right\")) {\r\n                key = \"Right \" + key;\r\n            } else if (code.startsWith(\"Numpad\")) {\r\n                key = \"Numpad \" + key;\r\n            }\r\n        }\r\n\r\n        if (this.treatShiftNumpadEqual) {\r\n            switch(key) {\r\n                case Key.NUMPAD_DELETE: key = Key.NUMPAD_PERIOD; break;\r\n                case Key.NUMPAD_INSERT: key = Key.NUMPAD_0; break;\r\n                case Key.NUMPAD_END: key = Key.NUMPAD_1; break;\r\n                case Key.NUMPAD_ARROW_DOWN: key = Key.NUMPAD_2; break;\r\n                case Key.NUMPAD_PAGE_DOWN: key = Key.NUMPAD_3; break;\r\n                case Key.NUMPAD_ARROW_LEFT: key = Key.NUMPAD_4; break;\r\n                case Key.NUMPAD_CLEAR: key = Key.NUMPAD_5; break;\r\n                case Key.NUMPAD_ARROW_RIGHT: key = Key.NUMPAD_6; break;\r\n                case Key.NUMPAD_HOME: key = Key.NUMPAD_7; break;\r\n                case Key.NUMPAD_ARROW_UP: key = Key.NUMPAD_8; break;\r\n                case Key.NUMPAD_PAGE_UP: key = Key.NUMPAD_9; break;\r\n            }\r\n        }\r\n\r\n        return key;\r\n    }\r\n\r\n    load() {\r\n        const controls = localStorage.getItem(\"controls\");\r\n        if (controls) {\r\n            this.controls = new Map(JSON.parse(controls));\r\n        } else {\r\n            this.resetToDefault();\r\n        }\r\n    }\r\n\r\n    save() {\r\n        localStorage.setItem(\"controls\", JSON.stringify(Array.from(this.controls.entries())));\r\n    }\r\n\r\n    setControls(controlsMap) {\r\n        this.controls = new Map();\r\n        for (const [key, value] of controlsMap.entries()) {\r\n            const keys = [];\r\n            for (const val of value) {\r\n                keys.push(val);\r\n            }\r\n            this.controls.set(key, keys);\r\n        }\r\n        this.save();\r\n    }\r\n\r\n    resetToDefault() {\r\n        this.setControls(this.defaults);\r\n    }\r\n\r\n    clone() {\r\n        const clone = new Map();\r\n        for (const [key, value] of this.controls.entries()) {\r\n            const keys = [];\r\n            for (const val of value) {\r\n                keys.push(val);\r\n            }\r\n            clone.set(key, keys);\r\n        }\r\n        return clone;\r\n    }\r\n\r\n    isPressed(key) {\r\n        const self = this;\r\n        let pressed = false;\r\n\r\n        let keys = self.controls.get(key);\r\n        if (!keys) {\r\n            const defaultKeys = self.defaults.get(key);\r\n            if (defaultKeys) {\r\n                self.controls.set(key, defaultKeys);\r\n                self.save();\r\n                keys = defaultKeys;\r\n            } else {\r\n                console.error(\"Missing keybindings for: \", key, keys);\r\n            }\r\n        }\r\n        keys.forEach(function(keyToTest) {\r\n            if (keyToTest in self.keysDown) {\r\n                pressed = true;\r\n            }\r\n        });\r\n\r\n        return pressed;\r\n    }\r\n\r\n    isDelayed(key) {\r\n        const self = this;\r\n        let delayed = false;\r\n\r\n        this.controls.get(key).forEach(function(keyToTest) {\r\n            if (keyToTest in self.keysDelayed) {\r\n                delayed = true;\r\n            }\r\n        });\r\n\r\n        return delayed;\r\n    }\r\n\r\n    deleteKey(key, delay) {\r\n        const self = this;\r\n        self.controls.get(key).forEach(function(keyToTest) {\r\n            delete self.keysDown[keyToTest];\r\n            if (delay) {\r\n                self.keysDelayed[keyToTest] = true;\r\n            }\r\n        });\r\n\r\n        if (delay) {\r\n            setTimeout(function() {\r\n                self.controls.get(key).forEach(function(keyToTest) {\r\n                    delete self.keysDelayed[keyToTest];\r\n                });\r\n            }, delay);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  Returns true if press succeeds\r\n     *          false if press does not succeed\r\n     */\r\n    testPressed(key, delay) {\r\n        delay = delay || this.defaultDelay;\r\n\r\n        const self = this;\r\n        let succeeded = false;\r\n\r\n        if (self.isPressed(key) && !self.isDelayed(key)) {\r\n            self.deleteKey(key, delay);\r\n            succeeded = true;\r\n        }\r\n\r\n        return succeeded;\r\n    }\r\n/*\r\n    hasControllerSupport() {\r\n        return \"getGamepads\" in navigator;\r\n    }\r\n\r\n    checkForGamepads() {\r\n        const self = this;\r\n        if (this.hasControllerSupport()) {\r\n            const numGamepads = navigator.getGamepads().length;\r\n            for (let i = 0; i < numGamepads; i++) {\r\n                const gamepad = navigator.getGamepads()[i];\r\n                if (gamepad) {\r\n                    gamepad.axes.forEach(function(axis, axisIndex) {\r\n                        if (axis <= -0.5) {\r\n                            //console.log(\"axis\" + axisIndex + \"-left\");\r\n                            self.keysDown[\"axis\" + axisIndex + \"-left\"] = true;\r\n                        } else if (axis >= 0.5) {\r\n                            //console.log(\"axis\" + axisIndex + \"-right\");\r\n                            self.keysDown[\"axis\" + axisIndex + \"-right\"] = true;\r\n                        } else {\r\n                            delete self.keysDown[\"axis\" + axisIndex + \"-left\"];\r\n                            delete self.keysDown[\"axis\" + axisIndex + \"-right\"];\r\n                            delete self.keysDelayed[\"axis\" + axisIndex + \"-left\"];\r\n                            delete self.keysDelayed[\"axis\" + axisIndex + \"-right\"];\r\n                        }\r\n                    });\r\n\r\n                    gamepad.buttons.forEach(function(button, buttonIndex) {\r\n                        if (button.pressed) {\r\n                            //console.log(\"gamepad\" + buttonIndex);\r\n                            self.keysDown[\"gamepad\"+ buttonIndex] = true;\r\n                        } else {\r\n                            delete self.keysDown[\"gamepad\" + buttonIndex];\r\n                            delete self.keysDelayed[\"gamepad\" + buttonIndex];\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n*/\r\n}\r\n\r\nconst controls = new Controls();\r\nexport default controls;\r\n\r\n\r\n// window.addEventListener(\"gamepadconnected\", function(e) {\r\n//     const gamepad = navigator.getGamepads()[e.gamepad.index];\r\n//     console.log(\"Gamepad connected at index %d: %s. %d buttons, %d axes.\", gamepad.index, gamepad.id, gamepad.buttons.length, gamepad.axes.length);\r\n//     console.log(gamepad.buttons);\r\n// });\r\n//\r\n// window.addEventListener(\"gamepaddisconnected\", function(e) {\r\n//     /*\r\n//     var gamepad = navigator.getGamepads()[e.gamepad.index];\r\n//     console.log(\"Gamepad disconnected at index %d: %s. %d buttons, %d axes.\", gamepad.index, gamepad.id, gamepad.buttons.length, gamepad.axes.length);\r\n//     */\r\n// });","export default class ArrayUtil {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    static create2dArray(numRows) {\r\n        const array = [];\r\n\r\n        for (let i = 0; i < numRows; i++) {\r\n            array[i] = [];\r\n        }\r\n        return array;\r\n    }\r\n}","import engine from \"../Engine\";\r\nimport {MathUtils} from \"three\";\r\n\r\nexport default class _Component {\r\n    constructor(args = {}) {\r\n        this.baseType = args.baseType || \"component\";\r\n        this.type = args.type || this.baseType;\r\n        this.parentEntity = args.parentEntity;\r\n\r\n        this.cachedSave = null;\r\n    }\r\n\r\n    save() {\r\n        return null;\r\n    }\r\n\r\n    clearSaveCache() {\r\n        this.cachedSave = null;\r\n\r\n        if (this.parentEntity) {\r\n            this.parentEntity.clearSaveCache();\r\n        }\r\n    }\r\n\r\n    getDescription() {\r\n        return \"\";\r\n    }\r\n\r\n    isPlayer() {\r\n        return this.parentEntity === engine.player;\r\n    }\r\n\r\n    parseRandFloat(value, defaultValue) {\r\n        let returnValue;\r\n        if (typeof value === \"string\") {\r\n            if (value.indexOf(\",\") !== -1) {\r\n                const valueSplit = value.split(\",\");\r\n                returnValue = parseFloat(MathUtils.randFloat(parseFloat(valueSplit[0].trim()), parseFloat(valueSplit[1].trim())).toFixed(2));\r\n            } else {\r\n                returnValue = parseFloat(value) || defaultValue;\r\n            }\r\n        } else {\r\n            returnValue = value || defaultValue;\r\n        }\r\n\r\n        return returnValue;\r\n    }\r\n\r\n\r\n    parseRandInt(value, defaultValue) {\r\n        let returnValue;\r\n        if (typeof value === \"string\") {\r\n            if (value.indexOf(\",\") !== -1) {\r\n                const valueSplit = value.split(\",\");\r\n                returnValue = MathUtils.randInt(parseInt(valueSplit[0].trim()), parseInt(valueSplit[1].trim()));\r\n            } else {\r\n                returnValue = parseInt(value) || defaultValue;\r\n            }\r\n        } else {\r\n            returnValue = value || defaultValue;\r\n        }\r\n\r\n        return returnValue;\r\n    }\r\n\r\n    parseRandIntBetween(value) {\r\n        if (typeof value === \"string\") {\r\n            const split = value.trim().split(\"-\");\r\n            if (split.length > 1) {\r\n                return MathUtils.randInt(parseInt(split[0].trim()), parseInt(split[1].trim()));\r\n            } else {\r\n                return parseInt(split[0].trim());\r\n            }\r\n        } else {\r\n            return value;\r\n        }\r\n    }\r\n}","/**\n * Adapted from http://youmightnotneedjquery.com/\n */\nexport default class Extend {\n    constructor() {}\n\n    static extend(out) {\n        out = out || {};\n\n        for (let i = 1; i < arguments.length; i++) {\n            if (!arguments[i]) {\n                continue;\n            }\n\n            for (const key in arguments[i]) {\n                if (arguments[i].hasOwnProperty(key)) {\n                    out[key] = arguments[i][key];\n                }\n            }\n        }\n\n        return out;\n    }\n\n    static deep(out) {\n        out = out || {};\n\n        for (let i = 1; i < arguments.length; i++) {\n            const obj = arguments[i];\n\n            if (!obj) {\n                continue;\n            }\n\n            for (const key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    if (typeof obj[key] === 'object'){\n                        if (obj[key] instanceof Array) {\n                            out[key] = obj[key].slice(0);\n                        } else {\n                            out[key] = Extend.deep(out[key], obj[key]);\n                        }\n                    } else {\n                        if (typeof out === 'boolean' && out[key] === undefined) {\n                            out = obj[key];\n                        } else {\n                            out[key] = obj[key];\n                        }\n                    }\n                }\n            }\n        }\n\n        return out;\n    }\n}","import _Component from \"../_Component\";\r\nimport sceneState from \"../../SceneState\";\r\nimport Tile from \"../../entity/Tile\";\r\nimport Extend from \"../../util/Extend\";\r\nimport {Vector3} from \"three\";\r\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\r\nimport engine from \"../../Engine\";\r\n\r\nexport default class _PositionalObject extends _Component {\r\n    constructor(args = {}) {\r\n        super(Extend.extend(args, {baseType: \"positionalobject\"}));\r\n        const hasComponent = args.components && args.components.positionalobject;\r\n\r\n        this.object = null;\r\n        this.meshes = [];\r\n        this.highlighted = false;\r\n        this.width = 5;\r\n        this.height = 5;\r\n        this.depth = 5;\r\n\r\n        this.scale = 1;\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.z = 0;\r\n        this.color = \"#ffffff\";\r\n        this.opacity = 1;\r\n        this.xRot = 0;\r\n        this.yRot = 0;\r\n        this.zRot = 0;\r\n        this.xOffset = 0;\r\n        this.yOffset = 0;\r\n        this.zOffset = 0;\r\n        this.size = 1;\r\n        this.actorZOffset = 0;\r\n\r\n        this.deathAnimation = null;\r\n\r\n        if (hasComponent) {\r\n            const positionalobject = args.components.positionalobject;\r\n            this.x = positionalobject.x || 0;\r\n            this.y = positionalobject.y || 0;\r\n            this.z = positionalobject.z || 0;\r\n            this.color = positionalobject.color || \"#ffffff\";\r\n            if (positionalobject.opacity !== undefined) {\r\n                this.opacity = positionalobject.opacity;\r\n            }\r\n\r\n            this.scale = this.parseRandFloat(positionalobject.scale, 1);\r\n            this.xRot = this.parseRandFloat(positionalobject.xRot, 0);\r\n            this.yRot = this.parseRandFloat(positionalobject.yRot, 0);\r\n            this.zRot = this.parseRandFloat(positionalobject.zRot, 0);\r\n\r\n            this.xOffset = this.parseRandFloat(positionalobject.xOffset, 0);\r\n            this.yOffset = this.parseRandFloat(positionalobject.yOffset, 0);\r\n            this.zOffset = this.parseRandFloat(positionalobject.zOffset, 0);\r\n            this.size = this.parseRandFloat(positionalobject.size, 1);\r\n            this.actorZOffset = this.parseRandFloat(positionalobject.actorZOffset, 0);\r\n        }\r\n\r\n        this.transparency = 1; // for quick reference on mousemove\r\n    }\r\n\r\n    save() {\r\n        if (this.cachedSave) {\r\n            return this.cachedSave;\r\n        }\r\n\r\n        let saveJson = {\r\n            positionalobject: {}\r\n        };\r\n\r\n        if (this.parentEntity && this.parentEntity instanceof Tile) {\r\n            if (this.actorZOffset !== 0) {\r\n                saveJson.positionalobject.actorZOffset = this.actorZOffset;\r\n            }\r\n        } else {\r\n            saveJson.positionalobject.x = this.x;\r\n            saveJson.positionalobject.y = this.y;\r\n            saveJson.positionalobject.z = this.z;\r\n        }\r\n\r\n        if (this.xRot !== 0) {\r\n            saveJson.positionalobject.xRot = this.xRot;\r\n        }\r\n\r\n        if (this.yRot !== 0) {\r\n            saveJson.positionalobject.yRot = this.yRot;\r\n        }\r\n\r\n        if (this.zRot !== 0) {\r\n            saveJson.positionalobject.zRot = this.zRot;\r\n        }\r\n\r\n        if (this.xOffset !== 0) {\r\n            saveJson.positionalobject.xOffset = this.xOffset;\r\n        }\r\n\r\n        if (this.yOffset !== 0) {\r\n            saveJson.positionalobject.yOffset = this.yOffset;\r\n        }\r\n\r\n        if (this.zOffset !== 0) {\r\n            saveJson.positionalobject.zOffset = this.zOffset;\r\n        }\r\n\r\n        if (this.color !== \"#ffffff\") {\r\n            saveJson.positionalobject.color = this.color;\r\n        }\r\n\r\n        if (this.opacity !== 1) {\r\n            saveJson.positionalobject.opacity = this.opacity;\r\n        }\r\n\r\n        if (this.scale !== 1) {\r\n            saveJson.positionalobject.scale = this.scale;\r\n        }\r\n\r\n        if (this.size !== 1) {\r\n            saveJson.positionalobject.size = this.size;\r\n        }\r\n\r\n        this.cachedSave = saveJson;\r\n        return saveJson;\r\n    }\r\n\r\n    createObject() {}\r\n\r\n    teardown() {\r\n        if (this.deathAnimation) {\r\n            this.deathAnimation.stop();\r\n        }\r\n\r\n        if (this.hasObject()) {\r\n            sceneState.scene.remove(this.object);\r\n        }\r\n\r\n        this.object = undefined;\r\n        this.meshes = [];\r\n    }\r\n\r\n    onMapTeardown() {\r\n        this.teardown();\r\n    }\r\n\r\n    resetColor() {\r\n        for (const mesh of this.meshes) {\r\n            mesh.material.color.set(mesh.originalColor);\r\n        }\r\n    }\r\n\r\n    shiftColor(scalar) {\r\n        for (const mesh of this.meshes) {\r\n            mesh.material.transparent = true;\r\n            mesh.material.color.multiplyScalar(scalar);\r\n        }\r\n    }\r\n\r\n    setTransparency(opacity = 1) {\r\n        this.transparency = opacity;\r\n\r\n        const actualOpacity = opacity * this.opacity;\r\n        for (const mesh of this.meshes) {\r\n            mesh.material.transparent = actualOpacity < 1;\r\n            mesh.material.opacity = actualOpacity;\r\n        }\r\n    }\r\n\r\n    getObjectPosition() {\r\n        return new Vector3((this.x + this.xOffset) * this.width, (this.y + this.yOffset) * this.height, (this.z + this.zOffset) * this.depth - ((this.depth - (this.scale * this.depth)) / 2));\r\n    }\r\n\r\n    updateObjectPosition() {\r\n        if (this.hasObject()) {\r\n            let zOffset = this.zOffset;\r\n            if (this.parentEntity.type === \"actor\" || this.parentEntity.type === \"item\") {\r\n                const tile = engine.gameMap.tiles.get(this.z)[this.x][this.y];\r\n                if (tile) {\r\n                    const position = tile.getComponent(\"positionalobject\");\r\n                    zOffset += position.actorZOffset;\r\n                }\r\n            }\r\n\r\n            this.object.position.set((this.x + this.xOffset) * this.width, (this.y + this.yOffset) * this.height, (this.z + zOffset) * this.depth - ((this.depth - (this.scale * this.depth)) / 2));\r\n            this.object.rotation.set(Math.PI * this.xRot, Math.PI * this.yRot, Math.PI * this.zRot);\r\n        }\r\n    }\r\n\r\n    hasObject() {\r\n        return this.object != null;\r\n    }\r\n\r\n    setVisible(visible = true) {\r\n        if (visible && !this.hasObject()) {\r\n            this.createObject();\r\n            sceneState.scene.add(this.object);\r\n        }\r\n\r\n        if (this.hasObject()) {\r\n            if (visible && !this.object.visible) {\r\n                this.object.visible = true;\r\n            } else if (!visible && this.object.visible) {\r\n                this.object.visible = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    isVisible() {\r\n        return this.hasObject() && this.object.visible;\r\n    }\r\n\r\n    highlight() {\r\n        if (!this.highlighted) {\r\n            if (this.hasObject()) {\r\n                this.shiftColor(2.5);\r\n            }\r\n            this.highlighted = true;\r\n        }\r\n    }\r\n\r\n    removeHighlight() {\r\n        if (this.highlighted) {\r\n            if (this.hasObject()) {\r\n                for (const mesh of this.meshes) {\r\n                    mesh.material.color.set(this.color);\r\n                }\r\n\r\n                const parent = this.parentEntity;\r\n                if (parent) {\r\n                    const fov = parent.getComponent(\"fov\");\r\n                    if (fov && fov.explored && !fov.visible) {\r\n                        this.shiftColor(.5);\r\n                    }\r\n                }\r\n            }\r\n            this.highlighted = false;\r\n        }\r\n    }\r\n\r\n    move(x, y = 0, z = 0) {\r\n        this.x += x;\r\n        this.y += y;\r\n        this.z += z;\r\n\r\n        this.clearSaveCache();\r\n        this.updateObjectPosition();\r\n\r\n        this.parentEntity.callEvent(\"onEntityMove\");\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param z\r\n     * @param callEvent Set to false when this is being called from the parent entity to prevent infinite calls\r\n     */\r\n    moveTo(x, y = this.y, z = this.z, callEvent = true) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n\r\n        this.clearSaveCache();\r\n        this.updateObjectPosition();\r\n\r\n        if (callEvent) {\r\n            this.parentEntity.callEvent(\"onEntityMove\");\r\n        }\r\n    }\r\n\r\n    updateRotation(xRot, yRot = this.yRot, zRot = this.zRot) {\r\n        this.xRot = xRot;\r\n        this.yRot = yRot;\r\n        this.zRot = zRot;\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    updateOffsets(xOffset, yOffset = this.yOffset, zOffset = this.zOffset) {\r\n        this.xOffset = xOffset;\r\n        this.yOffset = yOffset;\r\n        this.zOffset = zOffset;\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    updateZOffset(zOffset) {\r\n        this.zOffset = zOffset;\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {_PositionalObject} other\r\n     */\r\n    distance(other) {\r\n        return Math.abs(this.x - other.x) + Math.abs(this.y - other.y) + Math.abs(this.z - other.z);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {_PositionalObject} other\r\n     */\r\n    horizontalDistance(other) {\r\n        return Math.max(Math.abs(this.x - other.x), Math.abs(this.y - other.y));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {_PositionalObject} other\r\n     */\r\n    isSamePosition(other) {\r\n        if (!other) {\r\n            return false;\r\n        }\r\n\r\n        return this.x === other.x && this.y === other.y && this.z === other.z;\r\n    }\r\n\r\n    onEntityDeath() {\r\n        const self = this;\r\n        const rotation = {\r\n            xRot: this.xRot,\r\n            yRot: this.yRot,\r\n            zRot: this.zRot,\r\n            zOffset: this.zOffset\r\n        }\r\n        const finalRotation = {\r\n            xRot: 0,\r\n            yRot: 0,\r\n            zRot: Math.random() * 2,\r\n            zOffset: 0\r\n        };\r\n\r\n        this.deathAnimation = new TWEEN.Tween(rotation).to(finalRotation, 200);\r\n        this.deathAnimation.onUpdate(function () {\r\n            self.updateRotation(rotation.xRot, rotation.yRot, rotation.zRot);\r\n            self.updateZOffset(rotation.zOffset);\r\n            self.updateObjectPosition();\r\n            engine.needsMapUpdate = true;\r\n        });\r\n        this.deathAnimation.start();\r\n    }\r\n}","import _PositionalObject from \"./_PositionalObject\";\r\nimport * as THREE from \"three\";\r\nimport Extend from \"../../util/Extend\";\r\n\r\nconst cachedSolidGeometries = [];\r\nexport default class SolidObject extends _PositionalObject {\r\n    constructor(args = {}) {\r\n        const hasComponent = args.components && args.components.solidobject;\r\n        if (hasComponent) {\r\n            args.components.positionalobject = args.components.positionalobject || {};\r\n            args.components.positionalobject = Extend.extend(args.components.positionalobject, args.components.solidobject);\r\n        }\r\n        super(Extend.extend(args, {type: \"solidobject\"}));\r\n    }\r\n\r\n    save() {\r\n        if (this.cachedSave) {\r\n            return this.cachedSave;\r\n        }\r\n\r\n        const saveJson = {\r\n            solidobject: {}\r\n        };\r\n\r\n        this.cachedSave = Extend.deep(super.save(), saveJson);\r\n        return this.cachedSave;\r\n    }\r\n\r\n    createObject() {\r\n        this.meshes = [];\r\n        const newDepth = this.scale * this.depth;\r\n\r\n        let anyFound = false;\r\n        for (const geometry of cachedSolidGeometries) {\r\n            if (geometry.parameters.depth === newDepth) {\r\n                this.geometry = geometry;\r\n                anyFound = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!anyFound) {\r\n            this.geometry = new THREE.BoxBufferGeometry(this.width, this.height, newDepth);\r\n            cachedSolidGeometries.push(this.geometry);\r\n        }\r\n        this.object = new THREE.Mesh(\r\n            this.geometry,\r\n            new THREE.MeshLambertMaterial({color: this.color})\r\n        );\r\n        this.object.originalColor = this.color;\r\n        this.meshes.push(this.object);\r\n\r\n        this.updateObjectPosition();\r\n        this.object.parentEntity = this.parentEntity;\r\n    }\r\n}","import _PositionalObject from \"./_PositionalObject\";\r\nimport * as THREE from \"three\";\r\nimport Extend from \"../../util/Extend\";\r\nimport helvetikerFont from \"../../../fonts/helvetiker_regular.typeface.json\";\r\nimport jetbrainsFont from \"../../../fonts/JetBrains Mono_Regular.json\";\r\nimport mplusCustomFont from \"../../../fonts/mplus_custom.json\";\r\n//import mplus from \"../../../fonts/Rounded Mplus 1c_Regular.json\";\r\nimport pressStartFont from \"../../../fonts/Press Start 2P_Regular.json\";\r\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\r\nimport engine from \"../../Engine\";\r\n\r\nconst cachedTextGeometries = [];\r\nconst fontCache = new Map();\r\nexport default class CharacterObject extends _PositionalObject {\r\n    constructor(args = {}) {\r\n        const hasComponent = args.components && args.components.characterobject;\r\n        if (hasComponent) {\r\n             args.components.positionalobject = args.components.positionalobject || {};\r\n             args.components.positionalobject = Extend.extend(args.components.characterobject, args.components.positionalobject);\r\n        }\r\n\r\n        super(Extend.extend(args, {type: \"characterobject\"}));\r\n\r\n        this.fontName = \"helvetiker\";\r\n        this.letter = '@';\r\n        this.centered = true;\r\n        this.characters = [];\r\n\r\n        if (hasComponent) {\r\n            const characterobject = args.components.characterobject;\r\n            this.fontName = characterobject.fontName || \"helvetiker\";\r\n            this.letter = characterobject.letter || '@';\r\n            if (characterobject.centered !== undefined) {\r\n                this.centered = characterobject.centered;\r\n            }\r\n\r\n            if (characterobject.characters !== undefined) {\r\n                this.characters = characterobject.characters;\r\n            }\r\n        }\r\n\r\n        switch(this.fontName) {\r\n            case \"mplus\":\r\n                if (!fontCache.has(this.fontName)) {\r\n                    fontCache.set(this.fontName, new THREE.Font(mplusCustomFont));\r\n                }\r\n\r\n                this.font = fontCache.get(this.fontName);\r\n                break;\r\n            case \"helvetiker\":\r\n                if (!fontCache.has(this.fontName)) {\r\n                    fontCache.set(this.fontName, new THREE.Font(helvetikerFont));\r\n                }\r\n\r\n                this.font = fontCache.get(this.fontName);\r\n                break;\r\n            case \"jetbrains\":\r\n                if (!fontCache.has(this.fontName)) {\r\n                    fontCache.set(this.fontName, new THREE.Font(jetbrainsFont));\r\n                }\r\n\r\n                this.font = fontCache.get(this.fontName);\r\n                break;\r\n            case \"pressStart\":\r\n            default:\r\n                if (!fontCache.has(this.fontName)) {\r\n                    fontCache.set(this.fontName, new THREE.Font(pressStartFont));\r\n                }\r\n\r\n                this.font = fontCache.get(this.fontName);\r\n                break;\r\n        }\r\n    }\r\n\r\n    save() {\r\n        if (this.cachedSave) {\r\n            return this.cachedSave;\r\n        }\r\n\r\n        let saveJson = {\r\n            characterobject: {}\r\n        };\r\n\r\n        if (this.fontName !== \"helvetiker\") {\r\n            saveJson.characterobject.fontName = this.fontName;\r\n        }\r\n\r\n        if (this.letter !== \"@\") {\r\n            saveJson.characterobject.letter = this.letter;\r\n        }\r\n\r\n        if (this.centered !== true) {\r\n            saveJson.characterobject.centered = this.centered;\r\n        }\r\n\r\n        if (this.characters.length > 0) {\r\n            saveJson.characterobject.characters = JSON.stringify(this.characters);\r\n        }\r\n\r\n        this.cachedSave = Extend.deep(super.save(), saveJson);\r\n        return this.cachedSave;\r\n    }\r\n\r\n    createObject() {\r\n        super.createObject();\r\n        this.meshes = [];\r\n\r\n        if (this.characters.length > 0) {\r\n            this.object = new THREE.Group();\r\n            this.object.originalColor = this.color;\r\n\r\n            for (const character of this.characters) {\r\n                const letter = character.letter || this.letter;\r\n                const color = character.color || this.color;\r\n                let scale;\r\n                if (character.scale !== undefined) {\r\n                    scale = character.scale;\r\n                } else {\r\n                    scale = this.scale;\r\n                }\r\n\r\n                let depth;\r\n                if (character.depth !== undefined) {\r\n                    depth = character.depth;\r\n                } else {\r\n                    depth = this.depth;\r\n                }\r\n\r\n                let size;\r\n                if (character.size !== undefined) {\r\n                    size = character.size;\r\n                } else {\r\n                    size = this.size;\r\n                }\r\n\r\n                let font;\r\n                if (character.fontName) {\r\n                    font = fontCache.get(character.fontName);\r\n                } else {\r\n                    font = this.font;\r\n                }\r\n\r\n                this.object.add(this.createMesh(scale, depth, size, font, letter, color, character));\r\n            }\r\n        } else {\r\n            this.object = this.createMesh(this.scale, this.depth, this.size, this.font, this.letter, this.color);\r\n        }\r\n\r\n        this.setTransparency();\r\n\r\n        this.updateObjectPosition();\r\n    }\r\n\r\n    createMesh(scale, depth, size, font, letter, color, options) {\r\n        const newHeight = scale * depth;\r\n        const newSize = 4.1 / 5 * depth * size;\r\n\r\n        let anyFound = false;\r\n        for (const geometry of cachedTextGeometries) {\r\n            const sameFont = geometry.cachedFamilyName === font.data.familyName;\r\n            const sameSize = geometry.cachedSize === newSize;\r\n\r\n            if (sameFont && sameSize && geometry.cachedHeight === newHeight && geometry.cachedLetter === letter && geometry.cachedCentered === this.centered) {\r\n                this.geometry = geometry;\r\n                anyFound = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!anyFound) {\r\n            this.geometry = new THREE.TextGeometry(letter, {\r\n                font: font,\r\n                size: newSize,\r\n                height: newHeight,\r\n                curveSegments: 12,\r\n                bevelEnabled: true,\r\n                bevelThickness: .05,\r\n                bevelSize: .05,\r\n                bevelOffset: 0,\r\n                bevelSegments: 1\r\n            });\r\n            this.geometry.cachedFamilyName = font.data.familyName;\r\n            this.geometry.cachedSize = newSize;\r\n            this.geometry.cachedHeight = newHeight;\r\n            this.geometry.cachedLetter = letter;\r\n            this.geometry.cachedCentered = this.centered;\r\n            if (this.centered) {\r\n                this.geometry.center();\r\n            }\r\n\r\n            cachedTextGeometries.push(this.geometry);\r\n        }\r\n\r\n        const mesh = new THREE.Mesh(\r\n            this.geometry,\r\n            new THREE.MeshLambertMaterial({color: color})\r\n        );\r\n\r\n        if (options) {\r\n            if (options.xOffset !== undefined) {\r\n                mesh.translateX(options.xOffset * this.width);\r\n            }\r\n\r\n            if (options.yOffset !== undefined) {\r\n                mesh.translateY(options.yOffset * this.height);\r\n            }\r\n\r\n            if (options.zOffset !== undefined) {\r\n                mesh.translateZ(options.zOffset * this.depth);\r\n            }\r\n\r\n            if (options.xRot !== undefined) {\r\n                mesh.rotateX(options.xRot * Math.PI);\r\n            }\r\n\r\n            if (options.yRot !== undefined) {\r\n                mesh.rotateY(options.yRot * Math.PI);\r\n            }\r\n\r\n            if (options.zRot !== undefined) {\r\n                mesh.rotateZ(options.zRot * Math.PI);\r\n            }\r\n\r\n\r\n            let lastAnimation;\r\n            let animateInTween;\r\n            if (options.animateIn !== undefined) {\r\n                const animation = options.animateIn;\r\n                const startScale = animation.start.scale;\r\n                if (startScale !== undefined) {\r\n                    mesh.scale.x = startScale;\r\n                    mesh.scale.y = startScale;\r\n                    mesh.scale.z = startScale;\r\n                }\r\n                animateInTween = this.setupAnimation(mesh, animation);\r\n                lastAnimation = animateInTween;\r\n            }\r\n\r\n            if (options.animations !== undefined) {\r\n                let firstAnimation;\r\n                for (const animation of options.animations) {\r\n                    const newAnimation = this.setupAnimation(mesh, animation);\r\n                    if (lastAnimation) {\r\n                        lastAnimation.chain(newAnimation);\r\n                    }\r\n\r\n                    lastAnimation = newAnimation;\r\n\r\n                    if (!firstAnimation) {\r\n                        firstAnimation = newAnimation;\r\n                    }\r\n                }\r\n\r\n                lastAnimation.chain(firstAnimation);\r\n\r\n                if (!animateInTween) {\r\n                    firstAnimation.start();\r\n                }\r\n            }\r\n\r\n            if (animateInTween) {\r\n                animateInTween.start();\r\n            }\r\n        }\r\n        mesh.originalColor = color;\r\n        mesh.parentEntity = this.parentEntity;\r\n        this.meshes.push(mesh);\r\n\r\n        return mesh;\r\n    }\r\n\r\n    setupAnimation(mesh, options) {\r\n        let time;\r\n        if (options.time !== undefined) {\r\n            time = options.time;\r\n        } else {\r\n            time = 500;\r\n        }\r\n\r\n        const end = {\r\n            x: options.end.scale,\r\n            y: options.end.scale,\r\n            z: options.end.scale\r\n        }\r\n\r\n        const tween = new TWEEN.Tween(mesh.scale).to(end, time);\r\n        tween.onUpdate(function() {\r\n            const percent = ((TWEEN.now() - this._startTime) / this._duration);\r\n\r\n            if (options.zRotation !== undefined) {\r\n                mesh.rotation.z = options.zRotation * percent * 2 * Math.PI;\r\n            }\r\n\r\n            engine.needsMapUpdate = true;\r\n        });\r\n\r\n        return tween;\r\n    }\r\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class BlocksMovement extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"blocksMovement\"}));\n        const hasComponent = args.components && args.components.blocksMovement !== undefined;\n\n        // Whether the tile can moved into\n        this.blocksMovement = false;\n\n        if (hasComponent) {\n            const type = typeof args.components.blocksMovement;\n            if (type === \"boolean\") {\n                this.blocksMovement = args.components.blocksMovement;\n            } else if (type === \"object\") {\n                if (args.components.blocksMovement) {\n                    this.blocksMovement = args.components.blocksMovement.blocksMovement;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson;\n        if (this.blocksMovement) {\n            saveJson = {\n                blocksMovement: this.blocksMovement\n            };\n        } else {\n            saveJson = {};\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    onEntityDeath() {\n        this.blocksMovement = false;\n\n        this.clearSaveCache();\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class Walkable extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"walkable\"}));\n        const hasComponent = args.components && args.components.walkable !== undefined;\n\n        // Can walk on top of\n        this.walkable = false;\n\n        if (hasComponent) {\n            const type = typeof args.components.walkable;\n            if (type === \"boolean\") {\n                this.walkable = args.components.walkable;\n            } else if (type === \"object\") {\n                if (args.components.walkable) {\n                    this.walkable = args.components.walkable.walkable;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            walkable: this.walkable\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class Fov extends _Component{\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"fov\"}));\n        const hasComponent = args.components && args.components.fov;\n\n        this.explored = false;\n        this.visible = false;\n\n        if (hasComponent) {\n            this.explored = args.components.fov.explored || false;\n            this.visible = args.components.fov.visible || false;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson;\n        if (this.explored) {\n            saveJson = {\n                fov: {\n                    explored: this.explored\n                }\n            };\n        } else {\n            saveJson = {};\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    setExplored(explored) {\n        this.explored = explored;\n        this.clearSaveCache();\n    }\n\n    setVisible(visible) {\n        this.visible = visible;\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class BlocksFov extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"blocksFov\"}));\n        const hasComponent = args.components && args.components.blocksFov !== undefined;\n\n        // Whether the tile can be seen through\n        this.blocksFov = false;\n\n        if (hasComponent) {\n            const type = typeof args.components.blocksFov;\n            if (type === \"boolean\") {\n                this.blocksFov = args.components.blocksFov;\n            } else if (type === \"object\") {\n                if (args.components.blocksFov) {\n                    this.blocksFov = args.components.blocksFov.blocksFov;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson;\n        if (this.blocksFov) {\n            saveJson = {\n                blocksFov: this.blocksFov\n            };\n        } else {\n            saveJson = {};\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n}","const MapLayer = Object.freeze({\n    Floor: 0,\n    Wall: 1,\n    DecorativeBG: 2,\n    Decorative: 2.05\n});\n\nexport default MapLayer;\n\n","import _Component from \"./_Component\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport engine from \"../Engine\";\nimport MapLayer from \"../map/MapLayer\";\nimport Extend from \"../util/Extend\";\n\nexport default class Openable extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"openable\"}));\n        const hasComponent = args.components && args.components.openable;\n\n        this.isOpen = false;\n        this.openEntity = null;\n        this.closedEntity = null;\n\n        if (hasComponent) {\n            this.isOpen = args.components.openable.isOpen || false;\n            this.openEntity = args.components.openable.openEntity;\n            this.closedEntity = args.components.openable.closedEntity;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            openable: {\n                isOpen: this.isOpen,\n                openEntity: this.openEntity,\n                closedEntity: this.closedEntity\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    open() {\n        if (!this.isOpen) {\n            this.isOpen = true;\n\n            const position = this.parentEntity.getComponent(\"positionalobject\");\n            if (position) {\n                position.teardown();\n                this.parentEntity = entityLoader.createFromTemplate(this.openEntity, {components: {positionalobject: {x: position.x, y: position.y, z: position.z}}});\n                engine.gameMap.tiles.get(MapLayer.Wall)[position.x][position.y] = this.parentEntity;\n            }\n\n            this.clearSaveCache();\n            return true;\n        }\n\n        return false;\n    }\n\n    close() {\n        if (this.isOpen) {\n            this.isOpen = false;\n\n            const position = this.parent.getComponent(\"positionalobject\");\n            if (position) {\n                position.teardown();\n                this.parentEntity = entityLoader.create(this.closedEntity, {components: {positionalobject: {x: position.x, y: position.y, z: position.z}}});\n                engine.gameMap.tiles.get(MapLayer.Wall)[position.x][position.y] = this.parent;\n            }\n\n            this.clearSaveCache();\n            return true;\n        }\n\n        return false;\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class VisibilityModifier extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"visibilityModifier\"}));\n        const hasComponent = args.components && args.components.visibilityModifier !== undefined;\n\n        this.modifier = \"+\";\n        this.amount = 0;\n\n        if (hasComponent) {\n            const arg = args.components.visibilityModifier;\n            if (arg.modifier) {\n                this.modifier = arg.modifier;\n            }\n\n            this.amount = arg.amount;\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"visibilityModifier\": {\n                \"modifier\": this.modifier,\n                \"amount\": this.amount\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getVisibility(visibility) {\n        switch (this.modifier) {\n            case \"+\":\n            default:\n                return visibility + this.amount;\n            case \"-\": return visibility - this.amount;\n            case \"*\": return visibility * this.amount;\n            case \"/\": return visibility / this.amount;\n        }\n    }\n}","import _Component from \"../_Component\";\nimport Extend from \"../../util/Extend\";\nimport {Vector3} from \"three\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport engine from \"../../Engine\";\n\nexport default class AI extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"ai\"}));\n    }\n\n    save() {\n        return null;\n    }\n\n    perform() {\n        console.error(\"Not Implemented\");\n    }\n\n    onMeleeAttack(blockingActor) {\n        const entity = this.parentEntity;\n        const position = entity.getComponent(\"positionalobject\");\n        if (position) {\n            entity.stopCombatAnimations();\n\n            const blockingPosition = blockingActor.getComponent(\"positionalobject\");\n            if (position && position.hasObject() && blockingPosition && blockingPosition.hasObject()) {\n                const originalPosition = new Vector3(position.object.position.x, position.object.position.y, position.object.position.z);\n                const attackPosition = new Vector3((position.object.position.x + blockingPosition.object.position.x) / 2, (position.object.position.y + blockingPosition.object.position.y) / 2, (position.object.position.z + blockingPosition.object.position.z) / 2);\n                const currentPosition = originalPosition.clone();\n\n                const tweenAttack = new TWEEN.Tween(currentPosition).to(attackPosition, 100);\n                tweenAttack.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                const tweenReturn = new TWEEN.Tween(currentPosition).to(originalPosition, 100);\n                tweenReturn.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                tweenAttack.chain(tweenReturn);\n                tweenAttack.start();\n\n                entity.combatTweens.push(tweenAttack);\n                entity.combatTweens.push(tweenReturn);\n            }\n        }\n    }\n\n    onEntityMove() {\n        const entity = this.parentEntity;\n        entity.stopCombatAnimations();\n    }\n}","import AI from \"./_AI\";\nimport Extend from \"../../util/Extend\";\n\nexport default class AIDead extends AI {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"aiDead\"}));\n        const hasComponent = args.components && args.components.aiDead !== undefined;\n\n        this.previousAI = \"\";\n\n        if (hasComponent) {\n            const aiDead = args.components.aiDead;\n            if (aiDead && aiDead.previousAI) {\n                this.previousAI = aiDead.previousAI;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiDead\": {\n                \"previousAI\": this.previousAI\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson\n    }\n\n    perform() {}\n}","import html from '../../../html/menu/GameOver.html';\nimport UIElement from \"../UIElement\";\n\nclass GameOverMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst gameOverMenu = new GameOverMenu();\nexport default gameOverMenu;","import EventHandler from \"./_EventHandler\";\nimport gameOverMenu from \"../ui/menu/GameOverMenu\";\nimport engine from \"../Engine\";\nimport MainMenuEventHandler from \"./MainMenuEventHandler\";\n\nexport default class GameOverEventHandler extends EventHandler {\n    constructor() {\n        super();\n\n        engine.player = null;\n        gameOverMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        gameOverMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (classList.contains(\"menu__return\")) {\n            this.returnToMainMenu();\n        }\n    }\n\n    returnToMainMenu() {\n        engine.setEventHandler(new MainMenuEventHandler());\n    }\n}","import html from '../../html/ui/CharacterHealth.html';\nimport UIElement from \"./UIElement\";\n\nclass CharacterHealth extends UIElement {\n    constructor() {\n        super(html);\n\n        this.fgDom = this.dom.getElementsByClassName(\"character-info__fg\")[0];\n        this.textDom = this.dom.getElementsByClassName(\"character-info__text\")[0];\n    }\n\n    update(current, max) {\n        const percent = current / max;\n        const height = percent * 80.5;\n        this.fgDom.style.height = height + \"%\";\n\n        this.textDom.innerText = current + \" / \" + max;\n    }\n}\n\nconst characterHealth = new CharacterHealth();\nexport default characterHealth;","import html from '../../html/ui/CharacterMana.html';\nimport UIElement from \"./UIElement\";\n\nclass CharacterMana extends UIElement {\n    constructor() {\n        super(html);\n\n        this.fgDom = this.dom.getElementsByClassName(\"character-info__fg\")[0];\n        this.textDom = this.dom.getElementsByClassName(\"character-info__text\")[0];\n    }\n\n    update(current, max) {\n        const percent = current / max;\n        const height = percent * 76.5;\n        this.fgDom.style.height = (100 - height) + \"%\";\n\n        this.textDom.innerText = current + \" / \" + max;\n    }\n}\n\nconst characterMana = new CharacterMana();\nexport default characterMana;","import html from '../../html/ui/Character.html';\nimport UIElement from \"./UIElement\";\nimport engine from \"../Engine\";\n\nclass Character extends UIElement {\n    constructor() {\n        super(html);\n\n        this.strengthDom = this.dom.getElementsByClassName(\"stat--strength\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.damageDom = this.dom.getElementsByClassName(\"attribute--damage\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.agilityDom = this.dom.getElementsByClassName(\"stat--agility\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.defenseDom = this.dom.getElementsByClassName(\"attribute--defense\")[0].getElementsByClassName(\"attribute__value\")[0];\n        this.blockChanceDom = this.dom.getElementsByClassName(\"attribute--blockchance\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.constitutionDom = this.dom.getElementsByClassName(\"stat--constitution\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.healthDom = this.dom.getElementsByClassName(\"attribute--health\")[0].getElementsByClassName(\"attribute__value\")[0];\n        this.healingBonusDom = this.dom.getElementsByClassName(\"attribute--healing-bonus\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.wisomDom = this.dom.getElementsByClassName(\"stat--wisdom\")[0].getElementsByClassName(\"stat__text\")[0];\n        this.manaDom = this.dom.getElementsByClassName(\"attribute--mana\")[0].getElementsByClassName(\"attribute__value\")[0];\n\n        this.availableStatPointsDom = this.dom.getElementsByClassName(\"available-stats__value\")[0];\n\n        this.levelDom = this.dom.getElementsByClassName(\"character__level-value\")[0];\n        this.currentXpDom = this.dom.getElementsByClassName(\"character__current-xp\")[0];\n        this.neededXpDom = this.dom.getElementsByClassName(\"character__needed-xp\")[0];\n\n        this.xpFilledDom = this.dom.getElementsByClassName(\"character__xp-filled\")[0];\n    }\n\n    populate(player) {\n        const fighter = player.getComponent(\"fighter\");\n        this.strengthDom.innerText = fighter.strength;\n        this.damageDom.innerText = fighter.getDamageDisplay();\n\n        this.agilityDom.innerText = fighter.agility;\n        this.defenseDom.innerText = fighter.defense;\n        this.blockChanceDom.innerText = fighter.blockChance + \"%\";\n\n        this.constitutionDom.innerText = fighter.constitution;\n        this.healthDom.innerText = fighter.hp + \" / \" + fighter.maxHp;\n        this.healingBonusDom.innerText = fighter.healingBonus;\n\n        this.wisomDom.innerText = fighter.wisdom;\n        this.manaDom.innerText = fighter.mana + \" / \" + fighter.maxMana;\n\n        const level = player.getComponent(\"level\");\n        if (level.statPointsAvailable) {\n            this.dom.classList.add(\"has-statpoint\");\n        } else {\n            this.dom.classList.remove(\"has-statpoint\");\n        }\n\n        this.availableStatPointsDom.innerText = level.statPointsAvailable;\n\n        this.levelDom.innerText = level.level;\n        this.currentXpDom.innerText = level.xp;\n        this.neededXpDom.innerText = level.xpForLevel(level.level);\n        this.xpFilledDom.style.width = level.getPercentXPTowardsLevel() + \"%\";\n    }\n\n    toggle() {\n        if (this.isOpen()) {\n            this.close();\n        } else {\n            this.populate(engine.player);\n            this.open();\n        }\n    }\n}\n\nconst character = new Character();\nexport default character;","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\nimport engine from \"../Engine\";\nimport AIDead from \"./ai/AIDead\";\nimport GameOverEventHandler from \"../event/GameOverEventHandler\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport characterHealth from \"../ui/CharacterHealth\";\nimport characterMana from \"../ui/CharacterMana\";\nimport {MathUtils, Vector3} from \"three\";\nimport CharacterObject from \"./positionalObject/CharacterObject\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport sceneState from \"../SceneState\";\nimport character from \"../ui/Character\";\n\nexport default class Fighter extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"fighter\"}));\n        const hasComponent = args.components && args.components.fighter !== undefined;\n\n        this.baseStrength = 0;\n        this.baseDamage = 0;\n\n        this.baseAgility = 0;\n        this.baseDefense = 0;\n\n        this.baseConstitution = 0;\n        this.baseHp = 0;\n        this.hp = null;\n\n        this.baseWisdom = 0;\n        this.baseMana = 0;\n        this.mana = null;\n\n        if (hasComponent) {\n            const fighter = args.components.fighter;\n            if (fighter.strength !== undefined) {\n                this.baseStrength = fighter.strength;\n            }\n\n            if (fighter.agility !== undefined) {\n                this.baseAgility = fighter.agility;\n            }\n\n            if (fighter.constitution !== undefined) {\n                this.baseConstitution = fighter.constitution;\n            }\n\n            if (fighter.wisdom !== undefined) {\n                this.baseWisdom = fighter.wisdom;\n            }\n\n            if (fighter.baseDamage !== undefined) {\n                this.baseDamage = fighter.baseDamage;\n            }\n\n            if (fighter.baseDefense !== undefined) {\n                this.baseDefense = fighter.baseDefense;\n            }\n\n            if (fighter.baseHp !== undefined) {\n                this.baseHp = fighter.baseHp;\n            }\n\n            if (fighter.hp !== undefined) {\n                this.hp = fighter.hp;\n            }\n\n            if (fighter.baseMana !== undefined) {\n                this.baseMana = fighter.baseMana;\n            }\n\n            if (fighter.mana !== undefined) {\n                this.mana = fighter.mana;\n            }\n        }\n\n        this.minDamage = 0;\n        this.maxDamage = 0;\n        this.defense = 0;\n        this.blockChance = 0;\n        this.healingBonus = 0;\n        this.strength = 0;\n        this.agility = 0;\n        this.constitution = 0;\n        this.wisdom = 0;\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson = {\n            fighter: {\n                hp: this.hp,\n                mana: this.mana\n            }\n        };\n\n        if (this.baseStrength > 0) {\n            saveJson.fighter.strength = this.baseStrength;\n        }\n        if (this.baseAgility > 0) {\n            saveJson.fighter.agility = this.baseAgility;\n        }\n        if (this.baseConstitution > 0) {\n            saveJson.fighter.constitution = this.baseConstitution;\n        }\n        if (this.baseWisdom > 0) {\n            saveJson.fighter.wisdom = this.baseWisdom;\n        }\n        if (this.baseDamage > 0) {\n            saveJson.fighter.baseDamage = this.baseDamage;\n        }\n        if (this.baseDefense > 0) {\n            saveJson.fighter.baseDefense = this.baseDefense;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    recalculateStats() {\n        this.calculateStats();\n        this.healingBonus = Math.floor(this.constitution / 2);\n\n        const newMax = this.getMaxHp();\n        if (this.hp === null || this.hp >= this.maxHp) {\n            this.hp = newMax;\n        }\n        this.maxHp = newMax;\n\n        const newMaxMana = this.getMaxMana();\n        if (this.mana === null || this.mana >= this.maxMana) {\n            this.mana = newMaxMana;\n        }\n        this.maxMana = newMaxMana;\n\n        this.calculateDamage();\n        this.calculateDefense();\n        this.calculateBlockChance();\n\n        this.updateUI();\n        this.clearSaveCache();\n    }\n\n    calculateStats() {\n        let equipmentStrength = 0;\n        let equipmentAgility = 0;\n        let equipmentConstitution = 0;\n        let equipmentWisdom = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentStrength += equippable.strength;\n                equipmentAgility += equippable.agility;\n                equipmentConstitution += equippable.constitution;\n                equipmentWisdom += equippable.wisdom;\n            }\n        }\n\n        this.strength = this.baseStrength + equipmentStrength;\n        this.agility = this.baseAgility + equipmentAgility;\n        this.constitution = this.baseConstitution + equipmentConstitution;\n        this.wisdom = this.baseWisdom + equipmentWisdom;\n    }\n\n    calculateDamage() {\n        const statDamage = this.baseDamage + this.strength;\n\n        let equipmentMinDamage = 0;\n        let equipmentMaxDamage = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentMinDamage += equippable.minDamage;\n                equipmentMaxDamage += equippable.maxDamage;\n            }\n        }\n\n        this.minDamage = statDamage + equipmentMinDamage;\n        this.maxDamage = Math.floor(statDamage * 1.5) + equipmentMaxDamage;\n    }\n\n    calculateDefense() {\n        const statDefense = this.baseDefense + (this.agility * 10);\n\n        let equipmentDefense = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentDefense += equippable.defense;\n            }\n        }\n\n        this.defense = statDefense + equipmentDefense;\n    }\n\n    calculateBlockChance() {\n        const statBlockChance = this.agility * 2;\n\n        let equipmentBlockChance = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentBlockChance += equippable.blockChance;\n            }\n        }\n\n        this.blockChance = Math.min(statBlockChance + equipmentBlockChance, 90);\n    }\n\n    getDamage() {\n        if (this.minDamage === this.maxDamage) {\n            return this.minDamage;\n        } else {\n            return MathUtils.randInt(this.minDamage, this.maxDamage);\n        }\n    }\n\n    getDamageDisplay() {\n        if (this.minDamage === this.maxDamage) {\n            return this.minDamage;\n        } else {\n            return this.minDamage + \" - \" + this.maxDamage;\n        }\n    }\n\n    getBlockedDamage() {\n        return Math.floor(MathUtils.randFloat(this.defense / 10, this.defense) / 10);\n    }\n\n    getMaxHp() {\n        const statHp = this.baseHp + this.constitution * 15;\n\n        let equipmentHp = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentHp += equippable.health;\n            }\n        }\n\n        return statHp + equipmentHp;\n    }\n\n    getMaxMana() {\n        const statMana = this.baseMana + this.wisdom * 10;\n\n        let equipmentMana = 0;\n        const equipment = this.parentEntity.getComponent(\"equipment\");\n        if (equipment) {\n            const equippables = equipment.getEquippables();\n            for (const equippable of equippables) {\n                equipmentMana += equippable.mana;\n            }\n        }\n\n        return statMana + equipmentMana;\n    }\n\n    createDamageIndicator(damage, color) {\n        const position = this.parentEntity.getComponent(\"positionalobject\");\n        if (position) {\n            const xRand = position.x + MathUtils.randFloat(-.25, .25);\n            const yRand = position.y + MathUtils.randFloat(-.25, .25);\n            const zRand = position.z + 1.1 + MathUtils.randFloat(0, 1);\n            const args = {\n                components: {\n                    characterobject: {\n                        letter: \"\" + damage,\n                        x: xRand,\n                        y: yRand,\n                        z: zRand,\n                        xRot: .5,\n                        yRot: .25,\n                        zRot: 0,\n                        color: color,\n                        scale: .05,\n                        size: .5\n                    }\n                }\n            }\n\n            const indicator = new CharacterObject(args);\n            indicator.parentEntity = this;\n            indicator.setVisible();\n            const current = new Vector3(position.x, position.y, zRand);\n            const target = new Vector3(position.x, position.y, zRand + 3)\n\n            const tween = new TWEEN.Tween(current).to(target, 500);\n            tween.easing(TWEEN.Easing.Cubic.In);\n            tween.onUpdate(function () {\n                indicator.z = current.z;\n                indicator.updateObjectPosition();\n                engine.needsMapUpdate = true;\n            });\n            tween.onComplete(function () {\n                sceneState.scene.remove(indicator.object);\n            });\n            tween.start();\n        }\n    }\n\n    takeDamage(damage) {\n        this.hp -= damage;\n\n        this.updateUI();\n        if (this.isPlayer()) {\n            this.createDamageIndicator(damage, \"#C00\");\n        } else {\n            this.createDamageIndicator(damage, \"#999\");\n        }\n\n        if (this.hp <= 0) {\n            this.die();\n        }\n\n        this.clearSaveCache();\n    }\n\n    heal(amount) {\n        if (this.hp === this.maxHp) {\n            return 0;\n        }\n\n        const newHp = Math.min(this.maxHp, this.hp + amount);\n        const healedHp = newHp - this.hp;\n        this.hp = newHp;\n\n        this.updateUI();\n\n        this.createDamageIndicator(healedHp, \"#090\");\n        this.clearSaveCache();\n\n        return healedHp;\n    }\n\n    consumeMana(amount) {\n        if (this.mana < amount) {\n            return false;\n        }\n\n        this.mana -= amount;\n\n        this.updateUI();\n\n        this.clearSaveCache();\n    }\n\n    recoverMana(amount) {\n        if (this.mana === this.maxMana) {\n            return 0;\n        }\n\n        const newMana = Math.min(this.maxMana, this.mana + amount);\n        const recoveredMana = newMana - this.mana;\n        this.mana = newMana;\n\n        this.updateUI();\n\n        this.clearSaveCache();\n\n        return recoveredMana;\n    }\n\n    die() {\n        const entity = this.parentEntity;\n        if (this.isPlayer()) {\n            messageConsole.text(\"You died!\", \"#f00\");\n            engine.setEventHandler(new GameOverEventHandler());\n        } else {\n            messageConsole.text(entity.name + \" dies!\", \"#ffa030\");\n        }\n        messageConsole.build();\n\n        entity.callEvent(\"onEntityDeath\");\n\n        const ai = entity.getComponent(\"ai\");\n        if (ai) {\n            const aiType = ai.type;\n            const aiArgs = {\n                components: {\n                    aiDead: {\n                        previousAI: aiType\n                    }\n                }\n            }\n            entity.removeComponent(\"ai\");\n            const newAI = new AIDead(aiArgs);\n            entity.setComponent(newAI);\n        }\n\n        this.clearSaveCache();\n    }\n\n    getHealthDescription() {\n        const percent = (this.hp / this.maxHp) * 100;\n        let description = \"\";\n\n        if (percent >= 90 && percent < 100) {\n            description = \"(Barely Scratched)\";\n        } else if (percent >= 75 && percent < 90) {\n            description = \"(Lightly Damaged)\";\n        } else if (percent >= 50 && percent < 75) {\n            description = \"(Damaged)\";\n        } else if (percent >= 25 && percent < 50) {\n            description = \"(Very Damaged)\";\n        } else if (percent >= 10 && percent < 25) {\n            description = \"(Extremely Damaged)\";\n        } else if (percent > 0 && percent < 10) {\n            description = \"(Nearly Dead)\";\n        }\n\n        return description;\n    }\n\n    updateUI() {\n        if (this.isPlayer()) {\n            characterHealth.update(this.hp, this.maxHp);\n            characterMana.update(this.mana, this.maxMana);\n            character.populate(engine.player);\n        }\n    }\n\n    onComponentsLoaded() {\n        this.recalculateStats();\n    }\n\n    onEquipmentChange() {\n        this.recalculateStats();\n    }\n}","import Action from \"../_Action\";\n\nexport default class ActionWithDirection extends Action {\n    constructor(entity, dx = 0, dy = 0, dz = 0) {\n        super(entity);\n\n        this.dx = dx;\n        this.dy = dy;\n        this.dz = dz;\n    }\n\n    perform() {\n        console.error(\"Not Implemented\");\n    }\n}","import UnableToPerformAction from \"../UnableToPerformAction\";\nimport engine from \"../../Engine\";\nimport ActionWithDirection from \"./_ActionWithDirection\";\n\nexport default class MovementAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n        const destZ = position.z + this.dz;\n\n        const gameMap = engine.gameMap;\n        if (!gameMap.isInBounds(destX, destY)) {\n            return new UnableToPerformAction(this.entity, \"Location is outside the map!\");\n        }\n\n        const ground = this.tryMoveTo(gameMap, destX, destY, destZ);\n        if (!(ground instanceof UnableToPerformAction)) {\n            position.move(this.dx, this.dy, this.dz);\n            return ground;\n        }\n\n        const below = this.tryMoveTo(gameMap, destX, destY, destZ - 1);\n        if (!(below instanceof UnableToPerformAction)) {\n            position.move(this.dx, this.dy, this.dz - 1);\n            return below;\n        }\n\n        const above = this.tryMoveTo(gameMap, destX, destY, destZ + 1);\n        if (!(above instanceof UnableToPerformAction)) {\n            position.move(this.dx, this.dy, this.dz + 1);\n            return above;\n        }\n\n        return ground;\n    }\n\n    tryMoveTo(gameMap, destX, destY, destZ) {\n        const blockingActor = gameMap.getBlockingActorAtLocation(destX, destY, destZ);\n        if (blockingActor) {\n            return new UnableToPerformAction(this.entity, \"There's something in the way!\");\n        }\n\n        if (gameMap.tiles.has(destZ)) {\n            const wallTile = gameMap.tiles.get(destZ)[destX][destY];\n            if (wallTile) {\n                const blocksMovementComponent = wallTile.getComponent(\"blocksMovement\");\n                if (blocksMovementComponent && blocksMovementComponent.blocksMovement) {\n                    return new UnableToPerformAction(this.entity, \"There's a \" + wallTile.name + \" in the way!\");\n                }\n            }\n        }\n\n        if (!gameMap.tiles.has(destZ - 1)) {\n            return new UnableToPerformAction(this.entity, \"No level to walk on!\");\n        }\n\n        const floorTile = gameMap.tiles.get(destZ - 1)[destX][destY];\n        if (!floorTile) {\n            return new UnableToPerformAction(this.entity, \"No floor to walk on.\");\n        }\n\n        const walkableComponent = floorTile.getComponent(\"walkable\");\n        if (walkableComponent && walkableComponent.walkable) {\n            return this;\n        } else {\n            return new UnableToPerformAction(this.entity, \"There's nothing to walk on.\");\n        }\n    }\n}","import Action from \"./_Action\";\n\nexport default class WaitAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        return this;\n    }\n}","import MovementAction from \"./actionWithDirection/MovementAction\";\nimport {MathUtils} from \"three\";\nimport Action from \"./_Action\";\nimport WaitAction from \"./WaitAction\";\n\nexport default class WanderAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        const x = MathUtils.randInt(-1, 1);\n        const y = MathUtils.randInt(-1, 1);\n\n        if (x === 0 && y === 0) {\n            return new WaitAction(this.entity).perform();\n        } else {\n            return new MovementAction(this.entity, x, y, 0).perform();\n        }\n    }\n}","import ActionWithDirection from \"./_ActionWithDirection\";\nimport UnableToPerformAction from \"../UnableToPerformAction\";\nimport engine from \"../../Engine\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport {MathUtils} from \"three\";\n\nexport default class MeleeAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n        const destZ = position.z + this.dz;\n\n        const blockingActor = engine.gameMap.getBlockingActorAtLocation(destX, destY, destZ);\n        if (blockingActor) {\n            const entityFighter = this.entity.getComponent(\"fighter\");\n            const blockingFighter = blockingActor.getComponent(\"fighter\");\n            if (entityFighter && blockingFighter) {\n                let name;\n                let plural;\n                if (this.isPlayer()) {\n                    name = \"You\";\n                    plural = \"\";\n                } else {\n                    name = this.entity.name;\n                    plural = \"s\"\n                }\n\n                let blockingName;\n                let attackColor;\n                if (blockingActor === engine.player) {\n                    blockingName = \"You\";\n                    attackColor = \"#C00\";\n                } else {\n                    blockingName = blockingActor.name;\n                    attackColor = \"#999\";\n                }\n\n                let description = name + \" attack\" + plural + \" \" + blockingName;\n                const blockRandom = MathUtils.randInt(0, 100);\n                if (blockingFighter.blockChance > blockRandom) {\n                    const blockedColor = \"#000\";\n                    messageConsole.text(description + \", but is blocked.\", blockedColor).build();\n                    blockingFighter.takeDamage(0);\n                } else {\n                    const damage = entityFighter.getDamage() - blockingFighter.getBlockedDamage();\n                    if (damage > 0) {\n                        messageConsole.text(description + \" for \" + damage + \" hit points.\", attackColor).build();\n                        blockingFighter.takeDamage(damage);\n                    } else {\n                        messageConsole.text(description + \", but does no damage.\", attackColor).build();\n                    }\n                }\n\n                this.entity.callEvent(\"onMeleeAttack\", blockingActor);\n            }\n        } else {\n            return new UnableToPerformAction(this.entity, \"There's nothing to attack there!\");\n        }\n    }\n}","export default class BinaryHeap {\n    constructor(scoreFunction) {\n        this.content = [];\n        this.scoreFunction = scoreFunction;\n    }\n\n    push(element) {\n        // Add the new element to the end of the array.\n        this.content.push(element);\n\n        // Allow it to sink down.\n        this.sinkDown(this.content.length - 1);\n    }\n\n    pop() {\n        // Store the first element so we can return it later.\n        const result = this.content[0];\n        // Get the element at the end of the array.\n        const end = this.content.pop();\n        // If there are any elements left, put the end element at the\n        // start, and let it bubble up.\n        if (this.content.length > 0) {\n            this.content[0] = end;\n            this.bubbleUp(0);\n        }\n        return result;\n    }\n\n    remove(node) {\n        const i = this.content.indexOf(node);\n\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        const end = this.content.pop();\n\n        if (i !== this.content.length - 1) {\n            this.content[i] = end;\n\n            if (this.scoreFunction(end) < this.scoreFunction(node)) {\n                this.sinkDown(i);\n            } else {\n                this.bubbleUp(i);\n            }\n        }\n    }\n    size() {\n        return this.content.length;\n    }\n\n    rescoreElement(node) {\n        this.sinkDown(this.content.indexOf(node));\n    }\n\n    sinkDown(n) {\n        // Fetch the element that has to be sunk.\n        const element = this.content[n];\n\n        // When at 0, an element can not sink any further.\n        while (n > 0) {\n            // Compute the parent element's index, and fetch it.\n            const parentN = ((n + 1) >> 1) - 1;\n            const parent = this.content[parentN];\n            // Swap the elements if the parent is greater.\n            if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n                this.content[parentN] = element;\n                this.content[n] = parent;\n                // Update 'n' to continue at the new position.\n                n = parentN;\n            }\n            // Found a parent that is less, no need to sink any further.\n            else {\n                break;\n            }\n        }\n    }\n\n    bubbleUp(n) {\n        // Look up the target element and its score.\n        const length = this.content.length;\n        const element = this.content[n];\n        const elemScore = this.scoreFunction(element);\n\n        while (true) {\n            // Compute the indices of the child elements.\n            const child2N = (n + 1) << 1;\n            const child1N = child2N - 1;\n            // This is used to store the new position of the element, if any.\n            let swap = null;\n            let child1Score;\n            // If the first child exists (is inside the array)...\n            if (child1N < length) {\n                // Look it up and compute its score.\n                const child1 = this.content[child1N];\n                child1Score = this.scoreFunction(child1);\n\n                // If the score is less than our element's, we need to swap.\n                if (child1Score < elemScore) {\n                    swap = child1N;\n                }\n            }\n\n            // Do the same checks for the other child.\n            if (child2N < length) {\n                const child2 = this.content[child2N];\n                const child2Score = this.scoreFunction(child2);\n                if (child2Score < (swap === null ? elemScore : child1Score)) {\n                    swap = child2N;\n                }\n            }\n\n            // If the element needs to be moved, swap it, and continue.\n            if (swap !== null) {\n                this.content[n] = this.content[swap];\n                this.content[swap] = element;\n                n = swap;\n            }\n            // Otherwise, we are done.\n            else {\n                break;\n            }\n        }\n    }\n};","// Modified from http://github.com/bgrins/javascript-astar\nimport BinaryHeap from \"./BinaryHeap\";\n\nexport default class AStar {\n    constructor() {}\n\n    static pathTo(node) {\n        let curr = node;\n        const path = [];\n        while (curr.parent) {\n            path.unshift(curr);\n            curr = curr.parent;\n        }\n        return path;\n    }\n\n    static getHeap() {\n        return new BinaryHeap(function(node) {\n            return node.f;\n        });\n    }\n\n    /**\n     * Perform an A* Search on a graph given a start and end node.\n     * @param {Graph} graph\n     * @param {GridNode} start\n     * @param {GridNode} end\n     * @param {Object} [options]\n     * @param {bool} [options.closest] Specifies whether to return the\n     path to the closest node if the target is unreachable.\n     * @param {string} [options.heuristic] Heuristic function (see\n     *          astar.heuristics).\n     */\n    static search(graph, start, end, options) {\n        graph.cleanDirty();\n        options = options || {};\n        this.heuristicType = options.heuristic || \"manhattan\";\n        const closest = options.closest || false;\n\n        const openHeap = this.getHeap();\n        let closestNode = start; // set the start node to be the closest if required\n\n        if (this.heuristicType === \"manhattan\") {\n            start.h = this.heuristicManhattan(start, end);\n        } else if (this.heuristicType === \"diagonal\") {\n            this.heuristicDiagonal(start, end);\n        }\n        graph.markDirty(start);\n\n        openHeap.push(start);\n\n        while (openHeap.size() > 0) {\n            // Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n            const currentNode = openHeap.pop();\n\n            // End case -- result has been found, return the traced path.\n            if (currentNode === end) {\n                return this.pathTo(currentNode);\n            }\n\n            // Normal case -- move currentNode from open to closed, process each of its neighbors.\n            currentNode.closed = true;\n\n            // Find all neighbors for the current node.\n            const neighbors = graph.neighbors(currentNode);\n\n            for (let i = 0, il = neighbors.length; i < il; ++i) {\n                let neighbor = neighbors[i];\n\n                if (neighbor.closed || neighbor.isWall()) {\n                    // Not a valid node to process, skip to next neighbor.\n                    continue;\n                }\n\n                // The g score is the shortest distance from start to current node.\n                // We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n                const gScore = currentNode.g + neighbor.getCost(currentNode);\n                const beenVisited = neighbor.visited;\n\n                if (!beenVisited || gScore < neighbor.g) {\n                    // Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n                    neighbor.visited = true;\n                    neighbor.parent = currentNode;\n\n                    if (this.heuristicType === \"manhattan\") {\n                        neighbor.h = neighbor.h || this.heuristicManhattan(neighbor, end);\n                    } else if (this.heuristicType === \"diagonal\") {\n                        neighbor.h = neighbor.h || this.heuristicDiagonal(neighbor, end);\n                    }\n                    neighbor.g = gScore;\n                    neighbor.f = neighbor.g + neighbor.h;\n                    graph.markDirty(neighbor);\n                    if (closest) {\n                        // If the neighbour is closer than the current closestNode or if it's equally close but has\n                        // a cheaper path than the current closest node then it becomes the closest node\n                        if (neighbor.h < closestNode.h || (neighbor.h === closestNode.h && neighbor.g < closestNode.g)) {\n                            closestNode = neighbor;\n                        }\n                    }\n\n                    if (!beenVisited) {\n                        // Pushing to heap will put it in proper place based on the 'f' value.\n                        openHeap.push(neighbor);\n                    } else {\n                        // Already seen the node, but since it has been rescored we need to reorder it in the heap\n                        openHeap.rescoreElement(neighbor);\n                    }\n                }\n            }\n        }\n\n        if (closest) {\n            return this.pathTo(closestNode);\n        }\n\n        // No result was found - empty array signifies failure to find path.\n        return [];\n    }\n    // See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html\n    static heuristicManhattan(pos0, pos1) {\n        const d1 = Math.abs(pos1.x - pos0.x);\n        const d2 = Math.abs(pos1.y - pos0.y);\n        return d1 + d2;\n    }\n\n    static heuristicDiagonal(pos0, pos1) {\n        const D = 1;\n        const D2 = Math.sqrt(2);\n        const d1 = Math.abs(pos1.x - pos0.x);\n        const d2 = Math.abs(pos1.y - pos0.y);\n        return (D * (d1 + d2)) + ((D2 - (2 * D)) * Math.min(d1, d2));\n    }\n\n    static cleanNode(node) {\n        node.f = 0;\n        node.g = 0;\n        node.h = 0;\n        node.visited = false;\n        node.closed = false;\n        node.parent = null;\n    }\n}","export default class GridNode {\n    constructor(x, y, weight) {\n        this.x = x;\n        this.y = y;\n        this.weight = weight;\n    }\n\n    toString() {\n        return \"[\" + this.x + \" \" + this.y + \"]\";\n    };\n\n    getCost(fromNeighbor) {\n        // Take diagonal weight into consideration.\n        if (fromNeighbor && fromNeighbor.x !== this.x && fromNeighbor.y !== this.y) {\n            return this.weight * 1.41421;\n        }\n        return this.weight;\n    }\n\n    isWall() {\n        return this.weight === 0;\n    }\n}","import AStar from \"./AStar\";\nimport GridNode from \"./GridNode\";\n\nexport default class Graph {\n    /**\n     * A graph memory structure\n     * @param {Array} gridIn 2D array of input weights\n     * @param {Object} [options]\n     * @param {bool} [options.diagonal] Specifies whether diagonal moves are allowed\n     */\n    constructor(gridIn, options) {\n        options = options || {};\n        this.nodes = [];\n        this.diagonal = !!options.diagonal;\n        this.grid = [];\n        for (let x = 0; x < gridIn.length; x++) {\n            this.grid[x] = [];\n\n            for (let y = 0, row = gridIn[x]; y < row.length; y++) {\n                const node = new GridNode(x, y, row[y]);\n                this.grid[x][y] = node;\n                this.nodes.push(node);\n            }\n        }\n        this.init();\n    }\n\n    init() {\n        this.dirtyNodes = [];\n        for (let i = 0; i < this.nodes.length; i++) {\n            AStar.cleanNode(this.nodes[i]);\n        }\n    }\n\n    cleanDirty() {\n        for (let i = 0; i < this.dirtyNodes.length; i++) {\n            AStar.cleanNode(this.dirtyNodes[i]);\n        }\n        this.dirtyNodes = [];\n    }\n\n    markDirty(node) {\n        this.dirtyNodes.push(node);\n    };\n\n    neighbors(node) {\n        const ret = [];\n        const x = node.x;\n        const y = node.y;\n        const grid = this.grid;\n\n        // West\n        if (grid[x - 1] && grid[x - 1][y]) {\n            ret.push(grid[x - 1][y]);\n        }\n\n        // East\n        if (grid[x + 1] && grid[x + 1][y]) {\n            ret.push(grid[x + 1][y]);\n        }\n\n        // South\n        if (grid[x] && grid[x][y - 1]) {\n            ret.push(grid[x][y - 1]);\n        }\n\n        // North\n        if (grid[x] && grid[x][y + 1]) {\n            ret.push(grid[x][y + 1]);\n        }\n\n        if (this.diagonal) {\n            // Southwest\n            if (grid[x - 1] && grid[x - 1][y - 1]) {\n                ret.push(grid[x - 1][y - 1]);\n            }\n\n            // Southeast\n            if (grid[x + 1] && grid[x + 1][y - 1]) {\n                ret.push(grid[x + 1][y - 1]);\n            }\n\n            // Northwest\n            if (grid[x - 1] && grid[x - 1][y + 1]) {\n                ret.push(grid[x - 1][y + 1]);\n            }\n\n            // Northeast\n            if (grid[x + 1] && grid[x + 1][y + 1]) {\n                ret.push(grid[x + 1][y + 1]);\n            }\n        }\n\n        return ret;\n    }\n\n    toString() {\n        const graphString = [];\n        const nodes = this.grid;\n        for (let x = 0; x < nodes.length; x++) {\n            const rowDebug = [];\n            const row = nodes[x];\n            for (let y = 0; y < row.length; y++) {\n                rowDebug.push(row[y].weight);\n            }\n            graphString.push(rowDebug.join(\" \"));\n        }\n        return graphString.join(\"\\n\");\n    }\n}\n","import UnableToPerformAction from \"../UnableToPerformAction\";\nimport ActionWithDirection from \"./_ActionWithDirection\";\nimport engine from \"../../Engine\";\nimport MapLayer from \"../../map/MapLayer\";\n\nexport default class OpenAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n\n        const gameMap = engine.gameMap;\n        if (!gameMap.isInBounds(destX, destY)) {\n            return new UnableToPerformAction(this.entity, \"Location is outside the map!\");\n        }\n\n        const wallTile = gameMap.tiles.get(MapLayer.Wall)[destX][destY];\n        if (wallTile) {\n            const openable = wallTile.getComponent(\"openable\");\n            if (openable) {\n                if (openable.open()) {\n                    return this;\n                } else {\n                    return new UnableToPerformAction(this.entity, \"That cannot be opened.\");\n                }\n            }\n        }\n\n        return new UnableToPerformAction(this.entity, \"There's nothing to open there!\");\n    }\n}","import ActionWithDirection from \"./_ActionWithDirection\";\nimport UnableToPerformAction from \"../UnableToPerformAction\";\nimport engine from \"../../Engine\";\nimport MeleeAction from \"./MeleeAction\";\nimport MovementAction from \"./MovementAction\";\nimport MapLayer from \"../../map/MapLayer\";\nimport OpenAction from \"./OpenAction\";\n\nexport default class BumpAction extends ActionWithDirection {\n    constructor(entity, dx, dy, dz) {\n        super(entity, dx, dy, dz);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const destX = position.x + this.dx;\n        const destY = position.y + this.dy;\n        const destZ = position.z + this.dz;\n\n        const blockingActor = engine.gameMap.getBlockingActorAtLocation(destX, destY, destZ);\n        if (blockingActor) {\n            return new MeleeAction(this.entity, this.dx, this.dy, this.dz).perform();\n        } else {\n            const tileX = engine.gameMap.tiles.get(MapLayer.Wall)[destX];\n            if (tileX) {\n                const wallTile = tileX[destY];\n                if (wallTile) {\n                    const openable = wallTile.getComponent(\"openable\");\n                    if (openable && !openable.isOpen) {\n                        return new OpenAction(this.entity, this.dx, this.dy, this.dz).perform();\n                    }\n                }\n                return new MovementAction(this.entity, this.dx, this.dy, this.dz).perform();\n            } else {\n                return new UnableToPerformAction(this.entity, \"Nowhere to move.\");\n            }\n        }\n    }\n}","import AI from \"./_AI\";\nimport Extend from \"../../util/Extend\";\nimport AdamMilazzoFov from \"../../map/fov/AdamMilazzoFov\";\nimport {MathUtils, Vector3} from \"three\";\nimport WanderAction from \"../../actions/WanderAction\";\nimport MeleeAction from \"../../actions/actionWithDirection/MeleeAction\";\nimport AStar from \"../../pathfinding/AStar\";\nimport Graph from \"../../pathfinding/Graph\";\nimport engine from \"../../Engine\";\nimport WaitAction from \"../../actions/WaitAction\";\nimport BumpAction from \"../../actions/actionWithDirection/BumpAction\";\n\nexport default class AIMeleeChase extends AI {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"aiMeleeChase\"}));\n        const hasComponent = args.components && args.components.aiMeleeChase !== undefined;\n\n        this.fov = new AdamMilazzoFov();\n        this.chaseLocation = null;\n        this.radius = 5;\n        this.movementActions = 1;\n        this.currentMovement = 0;\n\n        if (hasComponent) {\n            const aiMeleeChase = args.components.aiMeleeChase;\n\n            if (aiMeleeChase.radius !== undefined) {\n                this.radius = aiMeleeChase.radius;\n            }\n\n            if (aiMeleeChase.movementActions !== undefined) {\n                this.movementActions = aiMeleeChase.movementActions;\n            }\n\n            if (aiMeleeChase.currentMovement !== undefined) {\n                this.currentMovement = aiMeleeChase.currentMovement;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiMeleeChase\": {}\n        };\n\n        if (this.radius !== 5) {\n            saveJson.aiMeleeChase.radius = this.radius;\n        }\n\n        if (this.movementActions !== 1) {\n            saveJson.aiMeleeChase.movementActions = this.movementActions;\n        }\n\n        if (this.currentMovement !== 0) {\n            saveJson.aiMeleeChase.currentMovement = this.currentMovement;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {\n        const entity = this.parentEntity;\n        const entityPosition = entity.getComponent(\"positionalobject\");\n        if (entityPosition) {\n            this.fov.compute(entityPosition.x, entityPosition.y, entityPosition.z, this.radius, entityPosition.z - 10, entityPosition.z + 10);\n\n            let closestEnemies = [];\n            let closestDistance = null;\n            const entityFaction = entity.getComponent(\"faction\");\n            if (entityFaction) {\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorFaction = actor.getComponent(\"faction\");\n                        if (entityFaction.isEnemyOf(actorFaction)) {\n                            const actorPosition = actor.getComponent(\"positionalobject\");\n\n                            if (actorPosition) {\n                                const dx = Math.abs(actorPosition.x - entityPosition.x);\n                                const dy = Math.abs(actorPosition.y - entityPosition.y);\n                                const distance = Math.max(dx, dy);\n\n                                if (closestDistance === null || distance < closestDistance) {\n                                    closestEnemies = [];\n                                    closestEnemies.push(actor);\n                                    closestDistance = distance;\n                                } else if (distance === closestDistance) {\n                                    closestEnemies.push(actor);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            let closestEnemy;\n            if (closestEnemies.length === 1) {\n                closestEnemy = closestEnemies[0];\n            } else if (closestEnemies.length > 1) {\n                const index = MathUtils.randInt(0, closestEnemies.length - 1);\n                closestEnemy = closestEnemies[index];\n            }\n\n            if (closestEnemy) {\n                const closestEnemyPosition = closestEnemy.getComponent(\"positionalobject\");\n                this.chaseLocation = new Vector3(closestEnemyPosition.x, closestEnemyPosition.y, closestEnemyPosition.z);\n\n                if (closestDistance <= 1) {\n                    return new MeleeAction(entity, closestEnemyPosition.x - entityPosition.x, closestEnemyPosition.y - entityPosition.y, closestEnemyPosition.z - entityPosition.z).perform();\n                }\n            } else {\n                if (this.chaseLocation !== null && this.chaseLocation.x === entityPosition.x && this.chaseLocation.y === entityPosition.y && this.chaseLocation.z === entityPosition.z) {\n                    this.chaseLocation = null;\n                }\n\n                if (this.chaseLocation === null) {\n                    return new WanderAction(entity).perform();\n                }\n            }\n\n            this.currentMovement += this.movementActions;\n\n            if (this.currentMovement >= 1) {\n                // Move towards enemy\n                const gameMap = engine.gameMap;\n                const fovWidth = this.fov.right - this.fov.left;\n                const fovHeight = this.fov.bottom - this.fov.top;\n                const cost = Array(fovWidth).fill().map(() => Array(fovHeight).fill(0));\n\n                for (let i = this.fov.left; i < this.fov.right; i++) {\n                    for (let j = this.fov.top; j < this.fov.bottom; j++) {\n                        const wallTile = gameMap.tiles.get(entityPosition.z)[i][j];\n                        if (wallTile) {\n                            const blocksMovementComponent = wallTile.getComponent(\"blocksMovement\");\n                            if (blocksMovementComponent && blocksMovementComponent.blocksMovement) {\n                                continue;\n                            }\n                        }\n\n                        if (!gameMap.tiles.has(entityPosition.z - 1)) {\n                            continue;\n                        }\n\n                        const floorTile = gameMap.tiles.get(entityPosition.z - 1)[i][j];\n\n                        if (floorTile) {\n                            const walkableComponent = floorTile.getComponent(\"walkable\");\n                            if (walkableComponent && walkableComponent.walkable) {\n                                cost[i - this.fov.left][j - this.fov.top] += 10;\n                            }\n                        }\n                    }\n                }\n\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorPosition = actor.getComponent(\"positionalobject\");\n                        if (actorPosition) {\n                            cost[actorPosition.x - this.fov.left][actorPosition.y - this.fov.top] += 100;\n                        }\n                    }\n                }\n\n                const costGraph = new Graph(cost, {diagonal: true});\n\n                const start = costGraph.grid[entityPosition.x - this.fov.left][entityPosition.y - this.fov.top];\n                const end = costGraph.grid[this.chaseLocation.x - this.fov.left][this.chaseLocation.y - this.fov.top];\n                const path = AStar.search(costGraph, start, end);\n                path.length\n                let lastAction;\n                while (this.currentMovement >= 1) {\n                    if (path && path.length > 0) {\n                        const next = path.shift();\n                        if (next) {\n                            lastAction = new BumpAction(entity, next.x + this.fov.left - entityPosition.x, next.y + this.fov.top - entityPosition.y, entityPosition.z).perform();\n                        }\n                    } else {\n                        lastAction = new WaitAction(entity).perform();\n                    }\n\n                    this.currentMovement -= 1;\n                }\n            }\n        }\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class Faction extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"faction\"}));\n        const hasComponent = args.components && args.components.faction !== undefined;\n\n        this.factions = [];\n        this.enemies = [];\n\n        if (hasComponent) {\n            const faction = args.components.faction;\n            if (faction.factions) {\n                this.setFactions(faction.factions.split(\",\"));\n            }\n\n            if (faction.enemies) {\n                this.setEnemies(faction.enemies.split(\",\"));\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"faction\": {\n                factions: this.factions.toString(),\n                enemies: this.enemies.toString()\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    setFactions(factionList) {\n        for (const faction of factionList) {\n            this.factions.push(faction.trim());\n        }\n\n        this.clearSaveCache();\n    }\n\n    setEnemies(enemyList) {\n        for (const enemy of enemyList) {\n            this.enemies.push(enemy.trim());\n        }\n\n        this.clearSaveCache();\n    }\n\n    /**\n     *\n     * @param {Faction} otherFaction\n     */\n    isEnemyOf(otherFaction) {\n        if (!otherFaction) {\n            return false;\n        }\n\n        for (const faction of this.factions) {\n            if (otherFaction.enemies.indexOf(faction) > -1) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\n\nexport default class Remnant extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"remnant\"}));\n\n        const hasComponent = args.components && args.components.remnant !== undefined;\n\n        this.isRemnant = false;\n        this.x = -1;\n        this.y = -1;\n        this.z = -1;\n\n        if (hasComponent) {\n            const remnant = args.components.remnant;\n            if (remnant.isRemnant !== undefined) {\n                this.isRemnant = remnant.isRemnant;\n            }\n\n            if (remnant.x !== undefined) {\n                this.x = remnant.x;\n            }\n\n            if (remnant.y !== undefined) {\n                this.y = remnant.y;\n            }\n\n            if (remnant.z !== undefined) {\n                this.z = remnant.z;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson = {\n            remnant: {}\n        };\n\n        if (this.isRemnant) {\n            saveJson.remnant.isRemnant = this.isRemnant;\n        }\n\n        if (this.x !== -1) {\n            saveJson.remnant.x = this.x;\n        }\n\n        if (this.y !== -1) {\n            saveJson.remnant.y = this.y;\n        }\n\n        if (this.z !== -1) {\n            saveJson.remnant.z = this.z;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n}","import Action from \"../_Action\";\nimport engine from \"../../Engine\";\nimport {Vector3} from \"three\";\n\nexport default class ItemAction extends Action {\n    /**\n     *\n     * @param entity\n     * @param item\n     * @param {Vector3} targetPosition\n     */\n    constructor(entity, item, targetPosition) {\n        super(entity);\n\n        this.item = item;\n        this.targetPosition = targetPosition;\n    }\n\n    perform() {\n        const consumable = this.item.getComponent(\"consumable\");\n        if (consumable) {\n            return consumable.activate(this, this.targetPosition);\n        }\n    }\n\n    getTargetActor() {\n        const actorPosition = new Vector3(this.targetPosition.x, this.targetPosition.y, this.targetPosition.z + 1);\n        return engine.gameMap.getAliveActorAtLocation(actorPosition);\n    }\n}","import _Component from \"../_Component\";\nimport Extend from \"../../util/Extend\";\nimport engine from \"../../Engine\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\n\nexport default class Consumable extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"consumable\"}));\n    }\n\n    save() {\n        return null;\n    }\n\n    consume() {\n        const item = this.getItem();\n        const parentStorage = item.parentEntity;\n        if (parentStorage) {\n            parentStorage.use(item, 1);\n        }\n    }\n\n    /**\n     *\n     * @returns {Action}\n     */\n    getAction() {\n        const consumer = this.getConsumer();\n        const item = this.getItem();\n\n        return new ItemAction(consumer, item);\n    }\n\n    activate(action) {\n        console.error(\"Not Implemented\");\n    }\n\n    getItem() {\n        return this.parentEntity;\n    }\n\n    getConsumer() {\n        let parent = this.parentEntity;\n        while (parent.type !== \"actor\") {\n            parent = parent.parentEntity;\n        }\n        return parent;\n    }\n\n    isPlayer() {\n        return this.getConsumer() === engine.player;\n    }\n}","import Consumable from \"./_Consumable\";\nimport Extend from \"../../util/Extend\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport messageConsole from \"../../ui/MessageConsole\";\n\nexport default class HealingConsumable extends Consumable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"healingConsumable\"}));\n        const hasComponent = args.components && args.components.healingConsumable !== undefined;\n\n        this.amount = 0;\n\n        if (hasComponent) {\n            const healingConsumable = args.components.healingConsumable;\n            if (healingConsumable && healingConsumable.amount !== undefined) {\n                this.amount = healingConsumable.amount\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"healingConsumable\": {\n                amount: this.amount\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n        const fighter = consumer.getComponent(\"fighter\");\n        if (fighter) {\n            const amountHealed = fighter.heal(this.getModifiedAmount());\n\n            if (amountHealed > 0) {\n                this.consume();\n                if (this.isPlayer()) {\n                    messageConsole.text(\"You consume the \" + this.parentEntity.name + \", and recover \" + amountHealed + \" HP!\").build();\n                }\n                return this;\n            } else {\n                return new UnableToPerformAction(action.entity, \"Your health is already full\");\n            }\n        }\n    }\n\n    getModifiedAmount() {\n        let amount = this.amount;\n        let healingBonus = 0;\n        const consumer = this.getConsumer();\n        const fighter = consumer.getComponent(\"fighter\");\n        if (fighter) {\n            healingBonus = fighter.healingBonus;\n        }\n\n        return amount + healingBonus;\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Recovers <span style='color: #c00;'>\" + this.getModifiedAmount() + \"</span> health</span>\";\n    }\n}","import html from '../../html/ui/Inventory.html';\nimport UIElement from \"./UIElement\";\nimport engine from \"../Engine\";\n\nclass Inventory extends UIElement {\n    constructor() {\n        super(html);\n\n        this.equipmentDom = this.dom.getElementsByClassName(\"inventory__equipment\")[0];\n        this.equipmentSlots = [];\n        for (let i = 0; i < 12; i++ ) {\n            const slot = document.createElement(\"div\");\n            slot.classList.add(\"slot\", \"inventory__equipment-slot\");\n            slot.setAttribute(\"data-index\", i);\n            this.equipmentSlots.push(slot);\n            this.equipmentDom.appendChild(slot);\n        }\n\n        this.storageWrapDom = this.dom.getElementsByClassName(\"inventory__storage-wrap\")[0];\n        this.goldCountDom = this.dom.getElementsByClassName(\"inventory__gold-count\")[0];\n\n        this.itemTooltipDom = document.createElement(\"div\");\n        this.itemTooltipDom.classList.add(\"item__tooltip\");\n\n        this.itemDragDom = document.createElement(\"div\");\n        this.itemDragDom.classList.add(\"item__drag\");\n\n        document.body.appendChild(this.itemTooltipDom);\n        document.body.appendChild(this.itemDragDom);\n\n        this.openStorages = [];\n        this.itemsOnGround = [];\n    }\n\n    populateInventory(entity) {\n        const equipment = entity.getComponent(\"equipment\");\n        if (equipment) {\n            this.storageWrapDom.innerHTML = \"\";\n            for (let i = 0; i < this.equipmentSlots.length; i++) {\n                const slot = this.equipmentSlots[i];\n\n                const equipmentSlot = equipment.items[i];\n                const item = equipmentSlot.item;\n                this.populateSlot(slot, item);\n            }\n\n            this.openStorages = [];\n\n            // Get storage\n            const equipmentStorageItem = equipment.items[9];\n            const storageItem = equipmentStorageItem.item;\n            if (storageItem) {\n                this.openEquipmentStorage(storageItem);\n            }\n\n            // Get belt\n            const equipmentBeltItem = equipment.items[7];\n            const beltItem = equipmentBeltItem.item;\n            if (beltItem) {\n                this.openEquipmentStorage(beltItem);\n            }\n\n            for (let i = 0; i < this.equipmentSlots.length; i++) {\n                if (i === 7 || i === 9) {\n                    continue;\n                }\n\n                const equipmentItem = equipment.items[i];\n                const item = equipmentItem.item;\n                if (item) {\n                    this.openEquipmentStorage(item);\n                }\n            }\n        }\n\n        this.openGroundItems();\n\n        const inventory = entity.getComponent(\"inventory\");\n        if (inventory) {\n            this.goldCountDom.innerText = inventory.gold;\n        }\n    }\n\n    openEquipmentStorage(item) {\n        this.openStorages.push(item);\n        const equippable = item.getComponent(\"equippable\");\n        if (equippable && equippable.maxStorage !== 0) {\n            let maxItems;\n            if (equippable.maxStorage === -1) {\n                maxItems = equippable.storage.length + 1;\n            } else {\n                maxItems = equippable.maxStorage;\n            }\n            const inventoryStorageDom = document.createElement(\"div\");\n            inventoryStorageDom.classList.add(\"inventory__storage\");\n            inventoryStorageDom.setAttribute(\"data-index\", this.openStorages.length - 1);\n            const inventoryStorageTitleDom = document.createElement(\"div\");\n            inventoryStorageTitleDom.classList.add(\"inventory__storage-title\");\n            inventoryStorageTitleDom.innerText = item.name;\n            inventoryStorageDom.appendChild(inventoryStorageTitleDom);\n            this.inventorySlots = [];\n            for (let i = 0; i < maxItems; i++) {\n                const slot = document.createElement(\"div\");\n                slot.classList.add(\"slot\", \"inventory__storage-slot\");\n                slot.setAttribute(\"data-index\", i);\n\n                this.populateSlot(slot, equippable.storage[i]);\n                this.inventorySlots.push(slot);\n                inventoryStorageDom.appendChild(slot);\n            }\n            this.storageWrapDom.appendChild(inventoryStorageDom);\n        }\n    }\n\n    populateItemsAtGround() {\n        const position = engine.player.getComponent(\"positionalobject\");\n        this.itemsOnGround = [];\n        for (const item of engine.gameMap.items) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (position.x === itemPosition.x && position.y === itemPosition.y && position.z === itemPosition.z) {\n                this.itemsOnGround.push(item);\n            }\n        }\n    }\n\n    openGroundItems() {\n        if (this.isOpen()) {\n            this.populateItemsAtGround();\n\n            let maxItems = Math.ceil((this.itemsOnGround.length + 1) / 10) * 10;\n\n            const inventoryStorageDom = document.createElement(\"div\");\n            inventoryStorageDom.classList.add(\"inventory__storage\");\n            const inventoryStorageTitleDom = document.createElement(\"div\");\n            inventoryStorageTitleDom.classList.add(\"inventory__storage-title\");\n            inventoryStorageTitleDom.innerText = \"On Ground\";\n            inventoryStorageDom.appendChild(inventoryStorageTitleDom);\n            this.inventorySlots = [];\n            for (let i = 0; i < maxItems; i++) {\n                const slot = document.createElement(\"div\");\n                slot.classList.add(\"slot\", \"pickup-slot\");\n                slot.setAttribute(\"data-index\", i);\n\n                this.populateSlot(slot, this.itemsOnGround[i]);\n                this.inventorySlots.push(slot);\n                inventoryStorageDom.appendChild(slot);\n            }\n            this.storageWrapDom.appendChild(inventoryStorageDom);\n        }\n    }\n\n    populateSlot(slot, item) {\n        if (item) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (itemPosition) {\n                let rotation = \"\";\n                if (itemPosition.zRot !== 0) {\n                    rotation = \"transform: rotate(\" + (itemPosition.zRot * 180) + \"deg);\";\n                }\n                slot.classList.add(\"has-item\");\n                let html = \"<div class='item' style='color:\" + itemPosition.color + \";\" + rotation + \"'><div class='item__icon'>\" + itemPosition.letter + \"</div>\";\n\n                if (item.amount > 1) {\n                    html += \"<span class='item__amount'>\" + item.amount + \"</span>\";\n                }\n\n                html += \"<div class='item__details'>\"\n                    + \"<span class='item__details-line item__name'>\" + item.name + \"</span>\";\n                if (item.description) {\n                    html += \"<span class='item__details-line item__description'>\" + item.description + \"</span>\"\n                }\n\n                html += \"<span class='item__details-line'><hr/></span>\";\n\n                html += item.getComponentDescriptions();\n\n                html += \"</div></div>\";\n\n                slot.innerHTML = html;\n            }\n        } else {\n            slot.classList.remove(\"has-item\");\n            slot.innerHTML = \"\";\n        }\n    }\n\n    toggle() {\n        if (this.isOpen()) {\n            this.close();\n        } else {\n            this.open();\n            this.populateInventory(engine.player);\n        }\n    }\n}\n\nconst inventory = new Inventory();\nexport default inventory;","import _Component from \"./_Component\";\r\nimport Extend from \"../util/Extend\";\r\nimport entityLoader from \"../entity/EntityLoader\";\r\nimport engine from \"../Engine\";\r\nimport messageConsole from \"../ui/MessageConsole\";\r\nimport inventory from \"../ui/Inventory\";\r\n\r\nexport default class Inventory extends _Component {\r\n    constructor(args = {}) {\r\n        super(Extend.extend(args, {baseType: \"inventory\"}));\r\n        const hasComponent = args.components && args.components.inventory;\r\n\r\n        this.gold = 0;\r\n\r\n        if (hasComponent) {\r\n            const inventory = args.components.inventory;\r\n\r\n            this.gold = this.parseRandInt(inventory.gold, 0);\r\n        }\r\n    }\r\n\r\n    save() {\r\n        if (this.cachedSave) {\r\n            return this.cachedSave;\r\n        }\r\n\r\n        const saveJson = {\r\n            inventory: {\r\n                gold: this.gold\r\n            }\r\n        };\r\n\r\n        this.cachedSave = saveJson;\r\n        return saveJson;\r\n    }\r\n\r\n    add(item) {\r\n        this.clearSaveCache();\r\n\r\n        if (item.id === \"gold\") {\r\n            this.gold += item.amount;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    dropAll() {\r\n        const gold = this.gold;\r\n        if (gold > 0) {\r\n            let goldItem = entityLoader.createFromTemplate('gold');\r\n            goldItem.amount = gold;\r\n            this.drop(goldItem);\r\n        }\r\n\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    drop(item) {\r\n        if (item) {\r\n            const parentPosition = this.parentEntity.getComponent(\"positionalobject\");\r\n            engine.gameMap.addItem(item, parentPosition)\r\n\r\n            if (this.isPlayer()) {\r\n                messageConsole.text(\"You dropped the \" + item.name).build();\r\n            }\r\n\r\n            this.clearSaveCache();\r\n            if (this.isPlayer()) {\r\n                inventory.populateInventory(engine.player);\r\n            }\r\n        }\r\n    }\r\n\r\n    onEntityDeath() {\r\n        this.dropAll();\r\n    }\r\n}","import Consumable from \"./_Consumable\";\nimport Extend from \"../../util/Extend\";\nimport engine from \"../../Engine\";\nimport {MathUtils} from \"three\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\n\nexport default class DamageNearestConsumable extends Consumable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"damageNearestConsumable\"}));\n        const hasComponent = args.components && args.components.damageNearestConsumable !== undefined;\n\n        this.damage = 20;\n        this.maxRange = 5;\n\n        if (hasComponent) {\n            const damageNearestConsumable = args.components.damageNearestConsumable;\n            if (damageNearestConsumable) {\n                if (damageNearestConsumable.damage !== undefined) {\n                    this.damage = damageNearestConsumable.damage;\n                }\n\n                if (damageNearestConsumable.maxRange !== undefined) {\n                    this.maxRange = damageNearestConsumable.maxRange;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"damageNearestConsumable\": {\n                damage: this.damage,\n                maxRange: this.maxRange\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n        let target = this.getClosestActor(consumer);\n\n        if (target) {\n            const fighter = target.getComponent(\"fighter\");\n            const actualDamage = Math.max(0, this.damage - fighter.getBlockedDamage());\n            if (this.isPlayer()) {\n                messageConsole.text(target.name + \" is struck for \" + actualDamage + \" damage!\").build();\n            }\n            fighter.takeDamage(actualDamage);\n\n            this.consume();\n            return this;\n        } else {\n            return new UnableToPerformAction(action.entity, \"No enemy is close enough to strike.\");\n        }\n    }\n\n    getClosestActor(consumer) {\n        let closestEnemies = [];\n        let closestDistance = null;\n        const airActors = engine.airFov.visibleActors;\n        const actors = engine.fov.visibleActors;\n\n        const consumerPosition = consumer.getComponent(\"positionalobject\");\n        const consumerFaction = consumer.getComponent(\"faction\");\n\n        if (consumerPosition && consumerFaction) {\n            for (const actor of airActors) {\n                if (actor.isAlive()) {\n                    if (consumerFaction.isEnemyOf(actor.getComponent(\"faction\"))) {\n                        const position = actor.getComponent(\"positionalobject\");\n                        if (position) {\n                            let distance = consumerPosition.distance(position);\n                            if (closestDistance === null || distance < closestDistance) {\n                                closestEnemies = [];\n                                closestEnemies.push(actor);\n                                closestDistance = distance;\n                            } else if (distance === closestDistance) {\n                                closestEnemies.push(actor);\n                            }\n                        }\n                    }\n                }\n            }\n\n            for (const actor of actors) {\n                if (actor.isAlive()) {\n                    if (consumerFaction.isEnemyOf(actor.getComponent(\"faction\"))) {\n                        const position = actor.getComponent(\"positionalobject\");\n                        if (position) {\n                            let distance = consumerPosition.distance(position);\n                            if (closestDistance === null || distance < closestDistance) {\n                                closestEnemies = [];\n                                closestEnemies.push(actor);\n                                closestDistance = distance;\n                            } else if (distance === closestDistance) {\n                                closestEnemies.push(actor);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        let closestEnemy;\n        if (closestEnemies.length === 1) {\n            closestEnemy = closestEnemies[0];\n        } else if (closestEnemies.length > 1) {\n            const index = MathUtils.randInt(0, closestEnemies.length - 1);\n            closestEnemy = closestEnemies[index];\n        }\n\n        return closestEnemy;\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Lightning Damage: <span style='color: #aa6;'>\" + this.damage + \"</span></span>\" +\n                \"<span class='item__details-line'>Range: <span style='color: #666;'>\" + this.maxRange + \"</span></span>\";\n    }\n}","import EventHandler from \"../_EventHandler\";\nimport engine from \"../../Engine\";\nimport {Vector3} from \"three\";\nimport controls from \"../../controls/Controls\";\nimport DefaultPlayerEventHandler from \"../DefaultPlayerEventHandler\";\nimport details from \"../../ui/Details\";\nimport sceneState from \"../../SceneState\";\nimport Tile from \"../../entity/Tile\";\n\nexport default class SelectIndexHandler extends EventHandler {\n    constructor() {\n        super();\n\n        this.resetPosition();\n        this.initted = false;\n    }\n\n    init() {\n        if (!this.initted) {\n            this.selectIndex();\n            this.initted = true;\n        }\n    }\n\n    resetPosition() {\n        this.player = engine.player;\n        const position = this.player.getComponent(\"positionalobject\");\n        this.position = new Vector3(position.x, position.y, position.z - 1);\n    }\n\n    exit() {\n        sceneState.updateCameraPosition(engine.player);\n        engine.setEventHandler(new DefaultPlayerEventHandler());\n    }\n\n    handleInput() {\n        this.init();\n\n        if (controls.testPressed(\"cancel\")) {\n            this.exit();\n        } else if (controls.testPressed(\"confirm\")) {\n            this.confirmIndex();\n        } else if (controls.testPressed(\"reset\") || controls.testPressed(\"wait\")) {\n            this.resetPosition();\n        } else {\n            let modifier = 1;\n            if (controls.isPressed(\"modifier-speed1\")) {\n                modifier *= 5;\n            }\n\n            if (controls.isPressed(\"modifier-speed2\")) {\n                modifier *= 10;\n            }\n\n            if (controls.isPressed(\"modifier-speed3\")) {\n                modifier *= 20;\n            }\n\n            let dx = 0;\n            let dy = 0;\n            if (controls.testPressed(\"up\")) {\n                dy = 1;\n            } else if (controls.testPressed(\"down\")) {\n                dy = -1;\n            } else if (controls.testPressed(\"left\")) {\n                dx = -1;\n            } else if (controls.testPressed(\"right\")) {\n                dx = 1;\n            } else if (controls.testPressed(\"nw\")) {\n                dx = -1;\n                dy = 1;\n            } else if (controls.testPressed(\"ne\")) {\n                dx = 1;\n                dy = 1;\n            } else if (controls.testPressed(\"sw\")) {\n                dx = -1;\n                dy = -1;\n            } else if (controls.testPressed(\"se\")) {\n                dx = 1;\n                dy = -1;\n            }\n\n            if (dx !== 0 || dy !== 0) {\n                let x = this.position.x + (dx * modifier);\n                let y = this.position.y + (dy * modifier);\n\n                this.position.x = Math.max(0, Math.min(x, engine.gameMap.width - 1));\n                this.position.y = Math.max(0, Math.min(y, engine.gameMap.height - 1));\n                this.selectIndex();\n            }\n        }\n    }\n\n    selectIndex(moveCamera = true) {\n        let obscuredTile = null;\n        let visibleTile = null;\n        const tiles = engine.gameMap.tiles.get(this.position.z);\n        if (tiles) {\n            const tilesX = tiles[this.position.x];\n            if (tilesX) {\n                const tile = tilesX[this.position.y];\n                if (tile) {\n                    const position = tile.getComponent(\"positionalobject\");\n                    if (position) {\n                        // Skip invisible/unseen items\n                        if (position.transparency === 1 && position.hasObject()) {\n                            if (!this.isHighlighted(tile)) {\n                                visibleTile = tile;\n                            }\n                        } else {\n                            obscuredTile = tile;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (obscuredTile) {\n            this.clearHighlights(false);\n            if (moveCamera) {\n                sceneState.updateCameraPosition(engine.player, obscuredTile);\n            }\n            details.updatePositionOnly(obscuredTile);\n        } else if (visibleTile) {\n            if (moveCamera) {\n                sceneState.updateCameraPosition(engine.player, visibleTile);\n            }\n            this.clearAndSetHighlight(visibleTile);\n        } else {\n            this.clearHighlights(true);\n        }\n    }\n\n    confirmIndex() {\n        console.error(\"Not Implemented\");\n    }\n\n    onMouseMove(e) {\n        this.mouse.x = (e.clientX / sceneState.canvasDom.offsetWidth) * 2 - 1;\n        this.mouse.y = -(e.clientY / sceneState.canvasDom.offsetHeight) * 2 + 1;\n\n        this.raycaster.setFromCamera(this.mouse, sceneState.camera);\n\n        const intersects = this.raycaster.intersectObject(sceneState.scene, true);\n\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity && parentEntity instanceof Tile) {\n                const parentPosition = parentEntity.getComponent(\"positionalobject\");\n                if (parentPosition) {\n                    // Skip invisible/unseen items\n                    if (parentPosition.transparency === 0 || !parentPosition.hasObject()) {\n                        continue;\n                    }\n\n                    if (this.position.x !== parentPosition.x || this.position.y !== parentPosition.y) {\n                        this.position.x = parentPosition.x;\n                        this.position.y = parentPosition.y;\n\n                        this.selectIndex(false);\n                        engine.needsMapUpdate = true;\n                    }\n\n                    break;\n                }\n            }\n        }\n    }\n\n    onLeftClick(e) {\n        this.confirmIndex();\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport engine from \"../../Engine\";\n\nexport default class SingleRangedAttackHandler extends SelectIndexHandler {\n    constructor(callback) {\n        super();\n\n        this.callback = callback;\n    }\n\n    confirmIndex() {\n        engine.processAction(this.callback(this.position));\n        this.exit();\n    }\n}","import AI from \"./_AI\";\nimport Extend from \"../../util/Extend\";\nimport WanderAction from \"../../actions/WanderAction\";\nimport componentLoader from \"../ComponentLoader\";\n\nexport default class AIConfusedEnemy extends AI {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"aiConfusedEnemy\"}));\n        const hasComponent = args.components && args.components.aiConfusedEnemy !== undefined;\n\n        this.previousAI = \"\";\n        this.turnsRemaining = 10;\n\n        if (hasComponent) {\n            const aiConfusedEnemy = args.components.aiConfusedEnemy;\n            if (aiConfusedEnemy) {\n                if (aiConfusedEnemy.previousAI) {\n                    this.previousAI = aiConfusedEnemy.previousAI;\n                }\n\n                if (aiConfusedEnemy.turnsRemaining !== undefined) {\n                    this.turnsRemaining = aiConfusedEnemy.turnsRemaining;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiConfusedEnemy\": {\n                \"previousAI\": this.previousAI,\n                \"turnsRemaining\": this.turnsRemaining\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    setTurnsRemaining(turns) {\n        if (turns > this.turnsRemaining) {\n            this.turnsRemaining = turns;\n            this.clearSaveCache();\n        }\n    }\n\n    perform() {\n        if (this.turnsRemaining <= 0) {\n            this.parentEntity.removeComponent(\"ai\");\n            const newAI = componentLoader.create(this.parentEntity, this.previousAI);\n            this.parentEntity.setComponent(newAI);\n        } else {\n            this.setTurnsRemaining(this.turnsRemaining - 1);\n\n            return new WanderAction(this.parentEntity).perform();\n        }\n    }\n}","import Consumable from \"./_Consumable\";\nimport Extend from \"../../util/Extend\";\nimport engine from \"../../Engine\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport componentLoader from \"../ComponentLoader\";\nimport SingleRangedAttackHandler from \"../../event/selectIndexHandler/SingleRangedAttackHandler\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\nimport NoAction from \"../../actions/NoAction\";\nimport AIConfusedEnemy from \"../ai/AIConfusedEnemy\";\n\nexport default class ConfusionConsumable extends Consumable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"confusionConsumable\"}));\n        const hasComponent = args.components && args.components.confusionConsumable !== undefined;\n\n        this.turns = 0;\n\n        if (hasComponent) {\n            const confusionConsumable = args.components.confusionConsumable;\n            if (confusionConsumable && confusionConsumable.turns !== undefined) {\n                this.turns = confusionConsumable.turns\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"confusionConsumable\": {\n                turns: this.turns\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getAction() {\n        const self = this;\n        if (this.isPlayer()) {\n            messageConsole.text(\"Select a target location.\", \"#3fffff\").build();\n        }\n\n        engine.setEventHandler(new SingleRangedAttackHandler(function(targetPosition) {\n            return new ItemAction(self.getConsumer(), self.getItem(), targetPosition);\n        }));\n\n        return new NoAction(this.parentEntity);\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n\n        const target = action.getTargetActor();\n        if (!target) {\n            return new UnableToPerformAction(this.parentEntity, \"You must select an enemy to target.\");\n        }\n\n        if (target === consumer) {\n            return new UnableToPerformAction(this.parentEntity, \"You cannot confuse yourself.\");\n        }\n\n        if (engine.fov.visibleActors.indexOf(target) === -1 && engine.airFov.visibleActors.indexOf(target) === -1) {\n            return new UnableToPerformAction(this.parentEntity, \"You cannot target an area that you cannot see.\");\n        }\n\n        if (this.isPlayer()) {\n            messageConsole.text(\"The eyes of the \" + target.name + \" look vacant, as it starts to stumble around!\", \"#3fff3f\").build();\n        }\n\n        const ai = target.getComponent(\"ai\");\n        if (ai) {\n            if (ai instanceof AIConfusedEnemy) {\n                ai.setTurnsRemaining(this.turns);\n            } else {\n                const aiType = ai.type;\n                const aiArgs = {\n                    components: {\n                        aiConfusedEnemy: {\n                            previousAI: aiType,\n                            turnsRemaining: this.turns\n                        }\n                    }\n                }\n                target.removeComponent(\"ai\");\n                const newAI = componentLoader.create(target, \"aiConfusedEnemy\", aiArgs);\n                target.setComponent(newAI);\n            }\n\n            this.consume();\n        }\n\n        return this;\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Confuses for: <span style='color: #cf3fff;'>\" + this.turns + \"</span> turns</span>\";\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport engine from \"../../Engine\";\nimport sceneState from \"../../SceneState\";\nimport details from \"../../ui/Details\";\n\nexport default class AreaRangedAttackHandler extends SelectIndexHandler {\n    constructor(callback, radius) {\n        super();\n\n        this.callback = callback;\n        this.radius = radius;\n    }\n\n    selectIndex(moveCamera = true) {\n        let centerIsObscured = true;\n        let centerTile = null;\n        let visibleTiles = [];\n        const tiles = engine.gameMap.tiles.get(this.position.z);\n        if (tiles) {\n            const left = Math.max(0, this.position.x - this.radius);\n            const right = Math.min(engine.gameMap.width, this.position.x + this.radius + 1);\n            const top = Math.max(0, this.position.y - this.radius);\n            const bottom = Math.min(engine.gameMap.height, this.position.y + this.radius + 1);\n\n            for (let i = left; i < right; i++) {\n                const tilesX = tiles[i];\n                if (tilesX) {\n                    for (let j = top; j < bottom; j++) {\n                        const tile = tilesX[j];\n\n                        const position = tile.getComponent(\"positionalobject\");\n                        if (position) {\n                            // Skip invisible/unseen items\n                            if (position.transparency === 1 && position.hasObject()) {\n                                visibleTiles.push(tile);\n                            }\n\n                            if (i === this.position.x && j === this.position.y) {\n                                centerTile = tile;\n\n                                if (position.transparency === 1 && position.hasObject()) {\n                                    centerIsObscured = false;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        if (centerTile) {\n            if (moveCamera) {\n                sceneState.updateCameraPosition(engine.player, centerTile);\n            }\n\n            if (centerIsObscured) {\n                details.updatePositionOnly(centerTile);\n            } else {\n                details.updatePositionDetails(centerTile);\n            }\n        }\n\n        if (visibleTiles.length > 0) {\n            this.clearAndSetHighlights(visibleTiles);\n        } else {\n            this.clearHighlights(true);\n        }\n    }\n\n    confirmIndex() {\n        engine.processAction(this.callback(this.position));\n        this.exit();\n    }\n}","import Consumable from \"./_Consumable\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport engine from \"../../Engine\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\nimport NoAction from \"../../actions/NoAction\";\nimport Extend from \"../../util/Extend\";\nimport AreaRangedAttackHandler from \"../../event/selectIndexHandler/AreaRangedAttackHandler\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\n\nexport default class AOEDamageConsumable extends Consumable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"aoeDamageConsumable\"}));\n        const hasComponent = args.components && args.components.aoeDamageConsumable !== undefined;\n\n        this.damage = 12;\n        this.radius = 1;\n\n        if (hasComponent) {\n            const aoeDamageConsumable = args.components.aoeDamageConsumable;\n            if (aoeDamageConsumable) {\n                if (aoeDamageConsumable.damage !== undefined) {\n                    this.damage = aoeDamageConsumable.damage\n                }\n\n                if (aoeDamageConsumable.radius !== undefined) {\n                    this.radius = aoeDamageConsumable.radius\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aoeDamageConsumable\": {\n                damage: this.damage,\n                radius: this.radius\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getAction() {\n        const self = this;\n        if (this.isPlayer()) {\n            messageConsole.text(\"Select a target location.\", \"#3fffff\").build();\n        }\n\n        engine.setEventHandler(new AreaRangedAttackHandler(function(targetPosition) {\n            return new ItemAction(self.getConsumer(), self.getItem(), targetPosition);\n        }, self.radius));\n\n        return new NoAction(this.parentEntity);\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const targetPosition = action.targetPosition;\n\n        if (!engine.gameMap.isPositionVisible(targetPosition)) {\n            return new UnableToPerformAction(this.parentEntity, \"You cannot target an area that you cannot see.\");\n        }\n\n        const fovHit = this.targetActors(targetPosition, engine.fov.visibleActors);\n        const airFovHit = this.targetActors(targetPosition, engine.airFov.visibleActors);\n\n        if (fovHit || airFovHit) {\n            this.consume();\n            return this;\n        } else {\n            return new UnableToPerformAction(this.parentEntity, \"There are no targets in range.\");\n        }\n    }\n\n    targetActors(targetPosition, actors) {\n        let targetsHit = false;\n        for (const actor of actors) {\n            if (actor.isAlive()) {\n                const position = actor.getComponent(\"positionalobject\");\n                if (position.horizontalDistance(targetPosition) <= this.radius) {\n                    const fighter = actor.getComponent(\"fighter\");\n                    if (fighter) {\n                        const actualDamage = Math.max(0, this.damage - fighter.getBlockedDamage());\n                        if (this.isPlayer()) {\n                            messageConsole.text(\"The \" + actor.name + \" is engulfed in a fiery explosion, taking \" + actualDamage + \" damage!\").build();\n                        }\n\n                        fighter.takeDamage(actualDamage);\n                        targetsHit = true;\n                    }\n                }\n            }\n        }\n\n        return targetsHit;\n    }\n\n    getDescription() {\n        const areaOfEffect = (this.radius * 2) + 1;\n        const areaOfEffectText = areaOfEffect + \"x\" + areaOfEffect;\n        return \"<span class='item__details-line'>Fire Damage: <span style='color: #c00;'>\" + this.damage + \"</span></span>\" +\n            \"<span class='item__details-line'>Area of effect: <span style='color: #ccc;'>\" + areaOfEffectText + \"</span></span>\";\n    }\n}","import Consumable from \"./_Consumable\";\nimport Extend from \"../../util/Extend\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport messageConsole from \"../../ui/MessageConsole\";\n\nexport default class ManaConsumable extends Consumable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"manaConsumable\"}));\n        const hasComponent = args.components && args.components.manaConsumable !== undefined;\n\n        this.amount = 0;\n\n        if (hasComponent) {\n            const manaConsumable = args.components.manaConsumable;\n            if (manaConsumable && manaConsumable.amount !== undefined) {\n                this.amount = manaConsumable.amount\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"manaConsumable\": {\n                amount: this.amount\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     */\n    activate(action) {\n        const consumer = action.entity;\n        const fighter = consumer.getComponent(\"fighter\");\n        if (fighter) {\n            const amountRecovered = fighter.recoverMana(this.amount);\n\n            if (amountRecovered > 0) {\n                this.consume();\n                if (this.isPlayer()) {\n                    messageConsole.text(\"You consume the \" + this.parentEntity.name + \", and recover \" + amountRecovered + \" mana!\").build();\n                }\n                return this;\n            } else {\n                return new UnableToPerformAction(action.entity, \"Your mana is already full\");\n            }\n        }\n    }\n\n    getDescription() {\n        return \"<span class='item__details-line'>Recovers <span style='color: #c00;'>\" + this.amount + \"</span> mana</span>\";\n    }\n}","import Extend from \"../../util/Extend\";\n\nimport engine from \"../../Engine\";\nimport AdamMilazzoFov from \"../../map/fov/AdamMilazzoFov\";\nimport {MathUtils, Vector3} from \"three\";\nimport MeleeAction from \"../../actions/actionWithDirection/MeleeAction\";\nimport WanderAction from \"../../actions/WanderAction\";\nimport Graph from \"../../pathfinding/Graph\";\nimport AStar from \"../../pathfinding/AStar\";\nimport BumpAction from \"../../actions/actionWithDirection/BumpAction\";\nimport WaitAction from \"../../actions/WaitAction\";\nimport AI from \"./_AI\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport entityLoader from \"../../entity/EntityLoader\";\n\nexport default class AIGelatinousCube extends AI {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"aiGelatinousCube\"}));\n\n        this.fov = new AdamMilazzoFov();\n        this.chaseLocation = null;\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiGelatinousCube\": {}\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {\n        let performAction = null;\n        // Normal Melee Chase behaviour\n        const entity = this.parentEntity;\n        const entityPosition = entity.getComponent(\"positionalobject\");\n        if (entityPosition) {\n            this.fov.compute(entityPosition.x, entityPosition.y, entityPosition.z, 5, entityPosition.z - 10, entityPosition.z + 10);\n\n            let closestEnemies = [];\n            let closestDistance = null;\n            const entityFaction = entity.getComponent(\"faction\");\n            if (entityFaction) {\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorFaction = actor.getComponent(\"faction\");\n                        if (entityFaction.isEnemyOf(actorFaction)) {\n                            const actorPosition = actor.getComponent(\"positionalobject\");\n\n                            if (actorPosition) {\n                                const dx = Math.abs(actorPosition.x - entityPosition.x);\n                                const dy = Math.abs(actorPosition.y - entityPosition.y);\n                                const distance = Math.max(dx, dy);\n\n                                if (closestDistance === null || distance < closestDistance) {\n                                    closestEnemies = [];\n                                    closestEnemies.push(actor);\n                                    closestDistance = distance;\n                                } else if (distance === closestDistance) {\n                                    closestEnemies.push(actor);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            let closestEnemy;\n            if (closestEnemies.length === 1) {\n                closestEnemy = closestEnemies[0];\n            } else if (closestEnemies.length > 1) {\n                const index = MathUtils.randInt(0, closestEnemies.length - 1);\n                closestEnemy = closestEnemies[index];\n            }\n\n            if (closestEnemy) {\n                const closestEnemyPosition = closestEnemy.getComponent(\"positionalobject\");\n                this.chaseLocation = new Vector3(closestEnemyPosition.x, closestEnemyPosition.y, closestEnemyPosition.z);\n\n                if (closestDistance <= 1) {\n                    performAction = new MeleeAction(entity, closestEnemyPosition.x - entityPosition.x, closestEnemyPosition.y - entityPosition.y, closestEnemyPosition.z - entityPosition.z);\n                }\n            } else {\n                if (this.chaseLocation !== null && this.chaseLocation.x === entityPosition.x && this.chaseLocation.y === entityPosition.y && this.chaseLocation.z === entityPosition.z) {\n                    this.chaseLocation = null;\n                }\n\n                if (this.chaseLocation === null) {\n                    performAction = new WanderAction(entity);\n                }\n            }\n\n            if (!performAction) {\n                // Move towards enemy\n                const gameMap = engine.gameMap;\n                const fovWidth = this.fov.right - this.fov.left;\n                const fovHeight = this.fov.bottom - this.fov.top;\n                const cost = Array(fovWidth).fill().map(() => Array(fovHeight).fill(0));\n\n                for (let i = this.fov.left; i < this.fov.right; i++) {\n                    for (let j = this.fov.top; j < this.fov.bottom; j++) {\n                        const wallTile = gameMap.tiles.get(entityPosition.z)[i][j];\n                        if (wallTile) {\n                            const blocksMovementComponent = wallTile.getComponent(\"blocksMovement\");\n                            if (blocksMovementComponent && blocksMovementComponent.blocksMovement) {\n                                continue;\n                            }\n                        }\n\n                        if (!gameMap.tiles.has(entityPosition.z - 1)) {\n                            continue;\n                        }\n\n                        const floorTile = gameMap.tiles.get(entityPosition.z - 1)[i][j];\n\n                        if (floorTile) {\n                            const walkableComponent = floorTile.getComponent(\"walkable\");\n                            if (walkableComponent && walkableComponent.walkable) {\n                                cost[i - this.fov.left][j - this.fov.top] += 10;\n                            }\n                        }\n                    }\n                }\n\n                for (const actor of this.fov.visibleActors) {\n                    if (actor.isAlive()) {\n                        const actorPosition = actor.getComponent(\"positionalobject\");\n                        if (actorPosition) {\n                            cost[actorPosition.x - this.fov.left][actorPosition.y - this.fov.top] += 100;\n                        }\n                    }\n                }\n\n                const costGraph = new Graph(cost, {diagonal: true});\n\n                const start = costGraph.grid[entityPosition.x - this.fov.left][entityPosition.y - this.fov.top];\n                const end = costGraph.grid[this.chaseLocation.x - this.fov.left][this.chaseLocation.y - this.fov.top];\n\n                const path = AStar.search(costGraph, start, end);\n                if (path && path.length > 0) {\n                    const next = path.shift();\n                    performAction = new BumpAction(entity, next.x + this.fov.left - entityPosition.x, next.y + this.fov.top - entityPosition.y, entityPosition.z);\n                } else {\n                    performAction = new WaitAction(entity);\n                }\n            }\n\n            performAction.perform();\n\n            const attachedItems = entity.getComponent(\"attachedItems\");\n            if (attachedItems) {\n                const itemsPickedUp = [];\n\n                // Pickup all items in spot\n                for (const item of this.fov.visibleItems) {\n                    const remnant = item.getComponent(\"remnant\");\n                    if (remnant && remnant.isRemnant) {\n                        continue;\n                    }\n\n                    const itemPosition = item.getComponent(\"positionalobject\");\n                    if (entityPosition.isSamePosition(itemPosition)) {\n                        if (attachedItems.add(item)) {\n                            itemsPickedUp.push(item);\n\n                            const position = {\n                                xOffset: itemPosition.xOffset,\n                                yOffset: itemPosition.yOffset,\n                                zOffset: itemPosition.zOffset,\n                                xRot: itemPosition.xRot,\n                                yRot: itemPosition.yRot,\n                                zRot: itemPosition.zRot\n                            }\n\n                            const finalPosition = {\n                                xOffset: position.xOffset + MathUtils.randFloat(0, .1),\n                                yOffset: position.yOffset + MathUtils.randFloat(0, .1),\n                                zOffset: position.zOffset + MathUtils.randFloat(.2, .7),\n                                xRot: MathUtils.randFloat(0, 2),\n                                yRot: MathUtils.randFloat(0, 2),\n                                zRot: MathUtils.randFloat(0, 2)\n                            }\n\n                            if (remnant && !remnant.isRemnant) {\n                                itemPosition.updateRotation(finalPosition.xRot, finalPosition.yRot, finalPosition.zRot)\n                                itemPosition.updateOffsets(finalPosition.xOffset, finalPosition.yOffset, finalPosition.zOffset);\n                                itemPosition.updateObjectPosition();\n                                engine.needsMapUpdate = true;\n                            } else {\n                                const tween = new TWEEN.Tween(position).to(finalPosition, 200);\n                                tween.start();\n                                tween.onUpdate(function() {\n                                    itemPosition.updateRotation(position.xRot, position.yRot, position.zRot);\n                                    itemPosition.updateOffsets(position.xOffset, position.yOffset, position.zOffset);\n                                    itemPosition.updateObjectPosition();\n                                    engine.needsMapUpdate = true;\n                                });\n                            }\n                        }\n                    }\n                }\n\n                for (const item of itemsPickedUp) {\n                    engine.gameMap.removeItem(item);\n                    engine.fov.remove(item);\n                }\n            }\n        }\n    }\n\n    onEntityDeath() {\n        const entity = this.parentEntity;\n        const attachedItems = entity.getComponent(\"attachedItems\");\n        if (attachedItems) {\n            for (const item of attachedItems.items) {\n                if (engine.gameMap.addItem(item)) {\n\n                    const itemPosition = item.getComponent(\"positionalobject\");\n                    if (itemPosition) {\n                        const template = entityLoader.createFromTemplate(item.id);\n                        const templatePosition = template.getComponent(\"positionalobject\");\n                        const position = {\n                            xOffset: itemPosition.xOffset,\n                            yOffset: itemPosition.yOffset,\n                            zOffset: itemPosition.zOffset,\n                            xRot: itemPosition.xRot,\n                            yRot: itemPosition.yRot\n                        }\n\n                        const finalPosition = {\n                            xOffset: templatePosition.xOffset,\n                            yOffset: templatePosition.yOffset,\n                            zOffset: templatePosition.zOffset,\n                            xRot: templatePosition.xRot,\n                            yRot: templatePosition.yRot\n                        }\n\n                        const tween = new TWEEN.Tween(position).to(finalPosition, 200);\n                        tween.start();\n                        tween.onUpdate(function () {\n                            itemPosition.updateRotation(position.xRot, position.yRot);\n                            itemPosition.updateOffsets(position.xOffset, position.yOffset, position.zOffset);\n                            itemPosition.updateObjectPosition();\n                            engine.needsMapUpdate = true;\n                        });\n                    }\n                }\n            }\n\n            attachedItems.clearItems();\n        }\n    }\n}","import AI from \"./_AI\";\nimport Extend from \"../../util/Extend\";\n\nexport default class AIPlayer extends AI {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"aiPlayer\"}));\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"aiPlayer\": {}\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    perform() {}\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\nimport engine from \"../Engine\";\n\nexport default class ExplodeOnDeath extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"explodeOnDeath\"}));\n        const hasComponent = args.components && args.components.explodeOnDeath !== undefined;\n\n        this.damage = 0;\n        this.radius = 0;\n\n        if (hasComponent) {\n            const explodeOnDeath = args.components.explodeOnDeath;\n            if (explodeOnDeath.damage !== undefined) {\n                this.damage = explodeOnDeath.damage;\n            }\n\n            if (explodeOnDeath.radius !== undefined) {\n                this.radius = explodeOnDeath.radius;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"explodeOnDeath\": {\n                damage: this.damage,\n                radius: this.radius\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    onEntityDeath() {\n        const entity = this.parentEntity;\n\n        const position = entity.getComponent(\"positionalobject\");\n        if (position) {\n            position.teardown();\n\n            engine.gameMap.removeActor(entity);\n\n            if (this.damage > 0) {\n                for (const actor of engine.gameMap.actors) {\n                    const actorPosition = actor.getComponent(\"positionalobject\");\n                    if (position.horizontalDistance(actorPosition) <= this.radius) {\n                        const fighter = actor.getComponent(\"fighter\");\n                        if (fighter) {\n                            fighter.takeDamage(Math.max(0, this.damage - fighter.getBlockedDamage()));\n                        }\n                    }\n                }\n            }\n        }\n    }\n}","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\nimport {Vector3} from \"three\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport engine from \"../Engine\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport Remnant from \"./Remnant\";\n\nexport default class AttachedItems extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"attachedItems\"}));\n\n        this.items = [];\n        const hasComponent = args.components && args.components.attachedItems !== undefined;\n\n        if (hasComponent) {\n            const attachedItems = args.components.attachedItems;\n            if (attachedItems.items !== undefined) {\n                for (let i = 0; i < attachedItems.items.length; i++) {\n                    const item = attachedItems.items[i];\n                    if (item !== null) {\n                        this.items[i] = entityLoader.create(item);\n                        this.items[i].parentEntity = this;\n                    }\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const itemJson = [];\n        for (const item of this.items) {\n            if (!item) {\n                itemJson.push(null);\n            } else {\n                itemJson.push(JSON.stringify(item.save()));\n            }\n        }\n\n        const saveJson = {\n            attachedItems: {\n                items: itemJson\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    add(item) {\n        if (this.items.indexOf(item) === -1) {\n            this.items.push(item);\n            this.clearSaveCache();\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    clearItems() {\n        this.items = [];\n        this.clearSaveCache();\n    }\n\n    remove(item) {\n        const index = this.items.indexOf(item);\n        if (index > -1) {\n            this.items.splice(index, 1);\n        }\n        this.clearSaveCache();\n    }\n\n    onMeleeAttack(blockingActor) {\n        for (const item of this.items) {\n            this.animateEntity(item, blockingActor);\n        }\n    }\n\n    animateEntity(entity, blockingActor) {\n        const position = entity.getComponent(\"positionalobject\");\n        if (position && position.hasObject()) {\n            entity.stopCombatAnimations();\n\n            const blockingPosition = blockingActor.getComponent(\"positionalobject\");\n            if (position && position.hasObject() && blockingPosition && blockingPosition.hasObject()) {\n                const originalPosition = new Vector3(position.object.position.x, position.object.position.y, position.object.position.z);\n                const attackPosition = new Vector3((position.object.position.x + blockingPosition.object.position.x) / 2, (position.object.position.y + blockingPosition.object.position.y) / 2, (position.object.position.z + blockingPosition.object.position.z) / 2);\n                const currentPosition = originalPosition.clone();\n\n                const tweenAttack = new TWEEN.Tween(currentPosition).to(attackPosition, 100);\n                tweenAttack.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                const tweenReturn = new TWEEN.Tween(currentPosition).to(originalPosition, 100);\n                tweenReturn.onUpdate(function () {\n                    if (position.hasObject()) {\n                        position.object.position.x = currentPosition.x;\n                        position.object.position.y = currentPosition.y;\n                        position.object.position.z = currentPosition.z;\n                        engine.needsMapUpdate = true;\n                    } else {\n                        this.stop();\n                    }\n                });\n\n                tweenAttack.chain(tweenReturn);\n                tweenAttack.start();\n\n                entity.combatTweens.push(tweenAttack);\n                entity.combatTweens.push(tweenReturn);\n            }\n        }\n    }\n\n    onEntityMove() {\n        for (const item of this.items) {\n            item.stopCombatAnimations();\n        }\n\n        const entity = this.parentEntity;\n        const entityPosition = entity.getComponent(\"positionalobject\");\n        if (entityPosition) {\n            for (const item of this.items) {\n                const itemPosition = item.getComponent(\"positionalobject\");\n                if (itemPosition) {\n                    itemPosition.moveTo(entityPosition.x, entityPosition.y, entityPosition.z, false);\n                    engine.needsMapUpdate = true;\n                }\n            }\n        }\n\n        this.clearSaveCache();\n    }\n\n    onAddToScene() {\n        for (const item of this.items) {\n            const position = item.getComponent(\"positionalobject\");\n            if (position) {\n                if (!position.isVisible()) {\n                    position.setVisible();\n                } else {\n                    position.resetColor();\n                }\n            }\n        }\n    }\n\n    onMapTeardown() {\n        for (const item of this.items) {\n            item.callEvent(\"onMapTeardown\");\n        }\n    }\n\n    onCreateRemnant() {\n        for (const item of this.items) {\n            const position = item.getComponent(\"positionalobject\");\n            if (position) {\n                const remnant = item.clone();\n                remnant.setComponent(new Remnant({components: {remnant: {isRemnant: true, x: position.x, y: position.y, z: position.z}}}));\n\n                const remnantPosition = remnant.getComponent(\"positionalobject\");\n                remnantPosition.setVisible();\n                remnantPosition.shiftColor(.5);\n                engine.gameMap.items.push(remnant);\n\n                item.setComponent(new Remnant({components: {remnant: {isRemnant: false, x: position.x, y: position.y, z: position.z}}}));\n                position.setVisible(false);\n            }\n        }\n    }\n\n    onDestroyRemnant() {\n        for (const item of this.items) {\n            const itemRemnant = item.getComponent(\"remnant\");\n            if (itemRemnant) {\n                item.removeComponent(\"remnant\");\n            }\n        }\n    }\n}","import _Component from \"../_Component\";\nimport Extend from \"../../util/Extend\";\n\nexport default class Interactable extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"interactable\"}));\n    }\n\n    save() {\n        return null;\n    }\n\n    interact() {}\n}","import Interactable from \"./_Interactable\";\nimport Extend from \"../../util/Extend\";\nimport engine from \"../../Engine\";\n\nexport default class StairsInteractable extends Interactable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"stairsInteractable\"}));\n        const hasComponent = args.components && args.components.stairsInteractable !== undefined;\n\n        this.map = null;\n        this.x = null;\n        this.y = null;\n        this.z = null;\n        this.generator = null;\n\n        if (hasComponent) {\n            const stairsInteractable = args.components.stairsInteractable;\n            if (stairsInteractable) {\n                if (stairsInteractable.map !== undefined) {\n                    this.map = stairsInteractable.map;\n                }\n\n                if (stairsInteractable.x !== undefined) {\n                    this.x = stairsInteractable.x;\n                }\n\n                if (stairsInteractable.y !== undefined) {\n                    this.y = stairsInteractable.y;\n                }\n\n                if (stairsInteractable.z !== undefined) {\n                    this.z = stairsInteractable.z;\n                }\n\n                if (stairsInteractable.generator !== undefined) {\n                    this.generator = stairsInteractable.generator;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson = {\n            \"stairsInteractable\": {}\n        };\n\n        if (this.map) {\n            saveJson.stairsInteractable.map = this.map;\n        }\n\n        if (this.x !== null) {\n            saveJson.stairsInteractable.x = this.x;\n        }\n        if (this.y !== null) {\n            saveJson.stairsInteractable.y = this.y;\n        }\n        if (this.z !== null) {\n            saveJson.stairsInteractable.z = this.z;\n        }\n\n        if (this.generator) {\n            saveJson.stairsInteractable.generator = this.generator;\n        }\n\n        this.cachedSave = saveJson;\n\n        return saveJson;\n    }\n\n    setPosition(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.clearSaveCache();\n    }\n\n    interact() {\n        if (this.map) {\n            const playerPosition = engine.player.getComponent(\"positionalobject\");\n            playerPosition.x = this.x;\n            playerPosition.y = this.y;\n            playerPosition.z = this.z;\n            engine.setMap(engine.gameMaps.get(this.map), this);\n        } else if (this.generator) {\n            let args = {};\n            if (engine.gameMap.level) {\n                args.level = engine.gameMap.level + 1\n            }\n            const newMap = engine.mapLoader.loadMap(this.generator, args);\n            this.map = newMap.name;\n            this.generator = null;\n            engine.setMap(newMap, this);\n        }\n    }\n}","import html from '../../html/ui/BottomContainer.html';\nimport UIElement from \"./UIElement\";\nimport characterHealth from \"./CharacterHealth\";\nimport characterMana from \"./CharacterMana\";\nimport engine from \"../Engine\";\n\nclass BottomContainer extends UIElement {\n    constructor() {\n        super(html);\n\n        this.dom.getElementsByClassName(\"bottom-container__left\")[0].appendChild(characterHealth.dom);\n        this.dom.getElementsByClassName(\"bottom-container__right\")[0].appendChild(characterMana.dom);\n\n        this.xpFilledDom = this.dom.getElementsByClassName(\"character__xp-filled\")[0];\n\n        this.openCharacter = this.dom.getElementsByClassName(\"hotbar__open-character\")[0];\n        this.openSkills = this.dom.getElementsByClassName(\"hotbar__open-skill\")[0];\n\n        this.beltSlotsDom = this.dom.getElementsByClassName(\"belt-slots\")[0];\n    }\n\n    updateAll() {\n        this.updateXp();\n        this.updateStatPointsIndicator();\n        this.updateSkillPointsIndicator();\n        this.updateBeltSlots();\n    }\n\n    updateXp() {\n        const level = engine.player.getComponent(\"level\");\n        this.xpFilledDom.style.width = level.getPercentXPTowardsLevel() + \"%\";\n    }\n\n    updateStatPointsIndicator() {\n        const level = engine.player.getComponent(\"level\");\n        const statPointsAvailable = level.statPointsAvailable;\n        if (statPointsAvailable > 0) {\n            this.openCharacter.classList.add(\"has-statpoint\");\n        } else {\n            this.openCharacter.classList.remove(\"has-statpoint\");\n        }\n    }\n\n    updateSkillPointsIndicator() {\n        const level = engine.player.getComponent(\"level\");\n        const skillPointsAvailable = level.skillPointsAvailable;\n        if (skillPointsAvailable > 0) {\n            this.openSkills.classList.add(\"has-skillpoint\");\n        } else {\n            this.openSkills.classList.remove(\"has-skillpoint\");\n        }\n    }\n\n    updateBeltSlots() {\n        this.beltSlotsDom.innerHTML = \"\";\n        const playerEquipment = engine.player.getComponent(\"equipment\");\n        if (playerEquipment) {\n            // Get belt\n            const equipmentBeltItem = playerEquipment.items[7];\n            const beltItem = equipmentBeltItem.item;\n            if (beltItem) {\n                const beltEquippable = beltItem.getComponent(\"equippable\");\n                if (beltEquippable) {\n                    for (let i = 0; i < beltEquippable.maxStorage; i++) {\n                        const beltSlotDom = document.createElement(\"div\");\n                        beltSlotDom.classList.add(\"slot\", \"belt-slot\");\n                        beltSlotDom.setAttribute(\"data-index\", i);\n\n                        if (beltEquippable.storage.length >= i) {\n                            const storageItem = beltEquippable.storage[i];\n                            this.populateSlot(beltSlotDom, storageItem);\n                        }\n\n                        this.beltSlotsDom.appendChild(beltSlotDom);\n                    }\n                }\n            }\n        }\n    }\n\n    populateSlot(slot, item) {\n        if (item) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (itemPosition) {\n                let rotation = \"\";\n                if (itemPosition.zRot !== 0) {\n                    rotation = \"transform: rotate(\" + (itemPosition.zRot * 180) + \"deg);\";\n                }\n                slot.classList.add(\"has-item\");\n                let html = \"<div class='item' style='color:\" + itemPosition.color + \";\" + rotation + \"'><div class='item__icon'>\" + itemPosition.letter + \"</div>\";\n\n                if (item.amount > 1) {\n                    html += \"<span class='item__amount'>\" + item.amount + \"</span>\";\n                }\n\n                html += \"<div class='item__details'>\"\n                    + \"<span class='item__details-line item__name'>\" + item.name + \"</span>\";\n                if (item.description) {\n                    html += \"<span class='item__details-line item__description'>\" + item.description + \"</span>\"\n                }\n\n                html += \"<span class='item__details-line'><hr/></span>\";\n\n                html += item.getComponentDescriptions();\n\n                html += \"</div></div>\";\n\n                slot.innerHTML = html;\n            }\n        } else {\n            slot.classList.remove(\"has-item\");\n            slot.innerHTML = \"\";\n        }\n    }\n}\n\nconst bottomContainer = new BottomContainer();\nexport default bottomContainer;","import _Component from \"./_Component\";\nimport Extend from \"../util/Extend\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport engine from \"../Engine\";\nimport character from \"../ui/Character\";\nimport bottomContainer from \"../ui/BottomContainer\";\n\nexport default class Level extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"level\"}));\n\n        const hasComponent = args.components && args.components.level !== undefined;\n\n        this.level = 1;\n        this.xp = 0;\n        this.xpGiven = 0;\n        this.statPointsAvailable = 0;\n        this.skillPointsAvailable = 0;\n\n        this.statPointsPerLevel = 1;\n        this.skillPointsPerLevel = 1;\n\n        if (hasComponent) {\n            const level = args.components.level;\n            if (level.level !== undefined) {\n                this.level = level.level;\n            }\n\n            if (level.xp !== undefined) {\n                this.xp = level.xp;\n            }\n\n            if (level.xpGiven !== undefined) {\n                this.xpGiven = level.xpGiven;\n            }\n\n            if (level.statPointsAvailable !== undefined) {\n                this.statPointsAvailable = level.statPointsAvailable;\n            }\n\n            if (level.skillPointsAvailable !== undefined) {\n                this.skillPointsAvailable = level.skillPointsAvailable;\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson = {\n            level: {}\n        };\n\n        if (this.level > 1) {\n            saveJson.level = this.level;\n        }\n\n        if (this.xp > 0) {\n            saveJson.xp = this.xp;\n        }\n\n        if (this.xpGiven > 0) {\n            saveJson.xpGiven = this.xpGiven;\n        }\n\n        if (this.statPointsAvailable > 0) {\n            saveJson.statPointsAvailable = this.statPointsAvailable;\n        }\n\n        if (this.skillPointsAvailable > 0) {\n            saveJson.skillPointsAvailable = this.skillPointsAvailable;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    xpForLevel(level) {\n        return 75 * ((level * level) + level);\n    }\n\n    requiresLevelUp() {\n        return this.xp >= this.xpForLevel(this.level);\n    }\n\n    getPercentXPTowardsLevel() {\n        const previousLevelXp = this.xpForLevel(this.level - 1);\n        const levelXpAdjusted = this.xpForLevel(this.level) - previousLevelXp;\n        const xpAdjusted = this.xp - previousLevelXp;\n        return (xpAdjusted / levelXpAdjusted) * 100;\n    }\n\n    levelUp() {\n        this.level += 1;\n        this.statPointsAvailable += this.statPointsPerLevel;\n        this.skillPointsAvailable += this.skillPointsPerLevel;\n        messageConsole.text(\"You are now level \" + this.level + \"!\").build();\n\n        const fighter = this.parentEntity.getComponent(\"fighter\");\n        fighter.heal(fighter.maxHp);\n        fighter.recoverMana(fighter.maxMana);\n\n        bottomContainer.updateStatPointsIndicator();\n        bottomContainer.updateSkillPointsIndicator();\n        this.clearSaveCache();\n    }\n\n    useStatPoint() {\n        this.statPointsAvailable -= 1;\n        character.populate(engine.player);\n\n        bottomContainer.updateStatPointsIndicator();\n        this.clearSaveCache();\n    }\n\n    useSkillPoint() {\n        this.skillPointsAvailable -= 1;\n        //skills.populate(engine.player);\n\n        bottomContainer.updateSkillPointsIndicator();\n        this.clearSaveCache();\n    }\n\n    addXp(amount) {\n        if (amount <= 0) {\n            return;\n        }\n\n        this.xp += amount;\n        messageConsole.text(\"You gain \" + amount + \" xp.\").build();\n\n        if (this.requiresLevelUp()) {\n            this.levelUp();\n        }\n\n        if (character.isOpen()) {\n            character.populate(engine.player);\n        }\n\n        bottomContainer.updateXp();\n        this.clearSaveCache();\n    }\n\n    onEntityDeath() {\n        if (engine.player && !this.isPlayer()) {\n            const level = engine.player.getComponent(\"level\");\n            level.addXp(this.xpGiven);\n        }\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport engine from \"../../Engine\";\n\nexport default class EmptyTileTargetHandler extends SelectIndexHandler {\n    constructor(callback) {\n        super();\n\n        this.callback = callback;\n    }\n\n    confirmIndex() {\n        engine.processAction(this.callback(this.position));\n        this.exit();\n    }\n}","import Consumable from \"./_Consumable\";\nimport Extend from \"../../util/Extend\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport engine from \"../../Engine\";\nimport ItemAction from \"../../actions/itemAction/ItemAction\";\nimport NoAction from \"../../actions/NoAction\";\nimport EmptyTileTargetHandler from \"../../event/selectIndexHandler/EmptyTileTargetHandler\";\nimport UnableToPerformAction from \"../../actions/UnableToPerformAction\";\nimport entityLoader from \"../../entity/EntityLoader\";\n\nexport default class SummonPortalConsumable extends Consumable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"summonPortalConsumable\"}));\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            \"summonPortalConsumable\": {}\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getAction() {\n        const self = this;\n\n        if (engine.gameMap && engine.gameMap.name === \"town\") {\n            return new UnableToPerformAction(this.parentEntity, \"You can't summon a portal in town!\");\n        }\n\n        if (this.isPlayer()) {\n            messageConsole.text(\"Select a target location.\", \"#3fffff\").build();\n        }\n\n        engine.setEventHandler(new EmptyTileTargetHandler(function(targetPosition) {\n            return new ItemAction(self.getConsumer(), self.getItem(), targetPosition);\n        }));\n\n        return new NoAction(this.parentEntity);\n    }\n\n    /**\n     *\n     * @param {ItemAction} action\n     * @param {Vector3} targetPosition\n     */\n    activate(action, targetPosition) {\n        const wallTiles = engine.gameMap.tiles.get(targetPosition.z + 1);\n        if (wallTiles) {\n            const tilesX = wallTiles[targetPosition.x];\n            if (tilesX) {\n                const tile = tilesX[targetPosition.y];\n                if (tile) {\n                    const blocksMovement = tile.getComponent(\"walkable\");\n                    if (blocksMovement && blocksMovement.blocksMovement) {\n                        return new UnableToPerformAction(this.parentEntity, tile.name + \" is in the way.\");\n                    }\n                }\n            }\n        }\n\n        let hasFloorTile = false;\n        const floorTiles = engine.gameMap.tiles.get(targetPosition.z);\n        if (floorTiles) {\n            const tilesX = floorTiles[targetPosition.x];\n            if (tilesX) {\n                const tile = tilesX[targetPosition.y];\n                if (tile) {\n                    const walkable = tile.getComponent(\"walkable\");\n                    const position = tile.getComponent(\"positionalobject\");\n                    if (position && walkable && walkable.walkable) {\n                        if (position.transparency === 1 && position.hasObject()) {\n                            hasFloorTile = true;\n                        } else {\n                            return new UnableToPerformAction(this.parentEntity, \"You can't see there!\");\n                        }\n                    }\n                }\n            }\n        }\n\n        if (!hasFloorTile) {\n            return new UnableToPerformAction(this.parentEntity, \"No floor there to support the portal.\");\n        }\n\n        const target = action.getTargetActor();\n        if (target) {\n            return new UnableToPerformAction(this.parentEntity, target.name + \" is in the way.\");\n        }\n\n        engine.gameMap.tiles.get(targetPosition.z + 1)[targetPosition.x][targetPosition.y] = entityLoader.createFromTemplate('portal', {components: {positionalobject: {x: targetPosition.x, y: targetPosition.y, z: targetPosition.z + 1}, portalInteractable: {map: \"town\", x: 34, y:36, z:1}}});\n        const town = engine.gameMaps.get(\"town\");\n        town.tiles.get(1)[34][36] = entityLoader.createFromTemplate('portal', {components: {positionalobject: {x: 34, y: 36, z: 1}, portalInteractable: {map: engine.gameMap.name, x: targetPosition.x, y: targetPosition.y, z: targetPosition.z + 1}}});\n\n        this.consume();\n    }\n}","import Interactable from \"./_Interactable\";\nimport Extend from \"../../util/Extend\";\nimport engine from \"../../Engine\";\nimport entityLoader from \"../../entity/EntityLoader\";\n\nexport default class PortalInteractable extends Interactable {\n    constructor(args = {}) {\n        super(Extend.extend(args, {type: \"portalInteractable\"}));\n        const hasComponent = args.components && args.components.portalInteractable !== undefined;\n\n        this.map = null;\n        this.x = null;\n        this.y = null;\n        this.z = null;\n\n        if (hasComponent) {\n            const portalInteractable = args.components.portalInteractable;\n            if (portalInteractable) {\n                if (portalInteractable.map !== undefined) {\n                    this.map = portalInteractable.map;\n                }\n\n                if (portalInteractable.x !== undefined) {\n                    this.x = portalInteractable.x;\n                }\n\n                if (portalInteractable.y !== undefined) {\n                    this.y = portalInteractable.y;\n                }\n\n                if (portalInteractable.z !== undefined) {\n                    this.z = portalInteractable.z;\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        let saveJson = {\n            \"portalInteractable\": {}\n        };\n\n        if (this.map) {\n            saveJson.portalInteractable.map = this.map;\n        }\n\n        if (this.x !== null) {\n            saveJson.portalInteractable.x = this.x;\n        }\n        if (this.y !== null) {\n            saveJson.portalInteractable.y = this.y;\n        }\n        if (this.z !== null) {\n            saveJson.portalInteractable.z = this.z;\n        }\n\n        this.cachedSave = saveJson;\n\n        return saveJson;\n    }\n\n    setPosition(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.clearSaveCache();\n    }\n\n    interact() {\n        if (this.map) {\n            const playerPosition = engine.player.getComponent(\"positionalobject\");\n\n            if (this.map.name !== 'town') {\n                const town = engine.gameMaps.get(\"town\");\n                town.tiles.get(1)[34][36] = entityLoader.createFromTemplate('portal', {components: {positionalobject: {x: 34, y: 36, z: 1}, portalInteractable: {map: engine.gameMap.name, x: playerPosition.x, y: playerPosition.y, z: playerPosition.z}}});\n            }\n            this.parentEntity.getComponent(\"positionalobject\").teardown();\n            engine.gameMap.tiles.get(playerPosition.z)[playerPosition.x][playerPosition.y] = null;\n\n            playerPosition.x = this.x;\n            playerPosition.y = this.y;\n            playerPosition.z = this.z;\n            engine.setMap(engine.gameMaps.get(this.map), this);\n        }\n    }\n}","const EquipmentType = Object.freeze({\n    MAIN_HAND: \"mainhand\",\n    OFF_HAND: \"offhand\",\n    BODY: \"body\",\n    HELMET: \"helmet\",\n    GLOVES: \"gloves\",\n    SHOULDER: \"shoulder\",\n    BELT: \"belt\",\n    BOOTS: \"boots\",\n    STORAGE: \"storage\",\n    AMULET: \"amulet\",\n    RING: \"ring\"\n});\n\nexport default EquipmentType;","export default class EquipmentSlot {\n    constructor(slot, item) {\n        this.slot = slot;\n        this.item = item;\n    }\n}","import _Component from \"../_Component\";\nimport Extend from \"../../util/Extend\";\nimport EquipmentType from \"./EquipmentType\";\nimport EquipmentSlot from \"./EquipmentSlot\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport engine from \"../../Engine\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport inventory from \"../../ui/Inventory\";\n\nexport default class Equipment extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"equipment\"}));\n        const hasComponent = args.components && args.components.equipment !== undefined;\n\n        this.items = [];\n        this.items.push(new EquipmentSlot(EquipmentType.SHOULDER));\n        this.items.push(new EquipmentSlot(EquipmentType.HELMET));\n        this.items.push(new EquipmentSlot(EquipmentType.AMULET));\n        this.items.push(new EquipmentSlot(EquipmentType.MAIN_HAND));\n        this.items.push(new EquipmentSlot(EquipmentType.BODY));\n        this.items.push(new EquipmentSlot(EquipmentType.OFF_HAND));\n        this.items.push(new EquipmentSlot(EquipmentType.RING));\n        this.items.push(new EquipmentSlot(EquipmentType.BELT));\n        this.items.push(new EquipmentSlot(EquipmentType.RING));\n        this.items.push(new EquipmentSlot(EquipmentType.STORAGE));\n        this.items.push(new EquipmentSlot(EquipmentType.BOOTS));\n        this.items.push(new EquipmentSlot(EquipmentType.GLOVES));\n\n        if (hasComponent) {\n            const equipment = args.components.equipment;\n            if (equipment.items !== undefined) {\n                for (let i = 0; i < equipment.items.length; i++) {\n                    const item = equipment.items[i];\n                    if (item !== null) {\n                        if (item.load !== undefined) {\n                            this.items[i].item = entityLoader.createFromTemplate(item.load, item);\n                        } else {\n                            this.items[i].item = entityLoader.create(item);\n                        }\n                        this.items[i].item.parentEntity = this;\n                    }\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const itemJson = [];\n        for (const equipmentSlot of this.items) {\n            const item = equipmentSlot.item;\n            if (!item) {\n                itemJson.push(null);\n            } else {\n                itemJson.push(JSON.stringify(item.save()));\n            }\n        }\n\n        const saveJson = {\n            equipment: {\n                items: itemJson\n            }\n        };\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getEquippables() {\n        const equippables = [];\n        for (const equipmentItem of this.items) {\n            const item = equipmentItem.item;\n            if (item) {\n                const equippable = item.getComponent(\"equippable\");\n                if (equippable) {\n                    equippables.push(equippable);\n                }\n            }\n        }\n\n        return equippables;\n    }\n\n    move(fromIndex, toIndex) {\n        if (fromIndex !== toIndex) {\n            const fromItem = this.items[fromIndex].item;\n\n            this.items[fromIndex].item = this.items[toIndex].item;\n            this.items[toIndex].item = fromItem;\n\n            this.clearSaveCache();\n        }\n    }\n\n    dropAll() {\n        for (const equipmentItem of this.items) {\n            if (equipmentItem.item) {\n                this.drop(equipmentItem.item);\n            }\n        }\n\n        const gold = this.gold;\n        if (gold > 0) {\n            let goldItem = entityLoader.createFromTemplate('gold');\n            goldItem.amount = gold;\n            this.drop(goldItem);\n        }\n\n        this.clearSaveCache();\n    }\n\n    drop(item) {\n        if (item) {\n            const parentPosition = this.parentEntity.getComponent(\"positionalobject\");\n            engine.gameMap.addItem(item, parentPosition)\n\n            if (this.isPlayer()) {\n                messageConsole.text(\"You dropped the \" + item.name).build();\n            }\n\n            this.remove(item);\n            this.clearSaveCache();\n            if (this.isPlayer()) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n\n    remove(item) {\n        for (let i = 0; i < this.items.length; i++) {\n            const equipmentItem = this.items[i];\n            if (equipmentItem && equipmentItem.item === item) {\n                equipmentItem.item = null;\n                this.clearSaveCache();\n                engine.needsMapUpdate = true;\n                break;\n            }\n        }\n    }\n\n    addItem(item) {\n        const belt = this.items[7].item;\n        const storage = this.items[9].item;\n\n        let success = false;\n        if (belt) {\n            const beltEquippable = belt.getComponent(\"equippable\");\n            success = beltEquippable.addPartialStacks(item);\n        }\n\n        if (!success && storage) {\n            const storageEquippable = storage.getComponent(\"equippable\");\n            success = storageEquippable.addPartialStacks(item);\n        }\n\n        if (!success) {\n            for (let i = 0; i < this.items.length; i++) {\n                if (i === 7 || i === 9) {\n                    continue;\n                }\n\n                const item = this.items[i].item;\n                if (item) {\n                    const itemEquippable = item.getComponent(\"equippable\");\n                    success = itemEquippable.addPartialStacks(item);\n                    if (success) {\n                        break;\n                    }\n                }\n            }\n        }\n\n        if (!success && storage) {\n            const storageEquippable = storage.getComponent(\"equippable\");\n            success = storageEquippable.addFullStacks(item);\n        }\n\n        return success;\n    }\n\n    setItem(index, item) {\n        this.items[index].item = item;\n        this.clearSaveCache();\n    }\n\n    getItem(index) {\n        return this.items[index].item;\n    }\n\n    onEntityDeath() {\n        this.dropAll();\n    }\n}","import _Component from \"../_Component\";\nimport Extend from \"../../util/Extend\";\nimport EquipmentType from \"./EquipmentType\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport engine from \"../../Engine\";\nimport messageConsole from \"../../ui/MessageConsole\";\nimport inventory from \"../../ui/Inventory\";\n\nexport default class Equippable extends _Component {\n    constructor(args = {}) {\n        super(Extend.extend(args, {baseType: \"equippable\"}));\n        const hasComponent = args.components && args.components.equippable !== undefined;\n        this.slot = EquipmentType.MAIN_HAND;\n        this.minDamage = 0;\n        this.maxDamage = 0;\n        this.defense = 0;\n        this.blockChance = 0;\n        this.health = 0;\n        this.mana = 0;\n        this.strength = 0;\n        this.agility = 0;\n        this.constitution = 0;\n        this.wisdom = 0;\n        this.lightRadius = 0;\n        this.maxStorage = 0;\n        this.storage = [];\n\n        if (hasComponent) {\n            const equippable = args.components.equippable;\n            if (equippable.slot !== undefined) {\n                this.slot = equippable.slot;\n            }\n\n            const damage = equippable.damage;\n            if (damage !== undefined) {\n                if (typeof damage === \"string\") {\n                    const damageSplit = damage.split(\",\");\n                    this.minDamage = this.parseRandIntBetween(damageSplit[0]);\n\n                    if (damageSplit.length > 1) {\n                        this.maxDamage = this.parseRandIntBetween(damageSplit[1]);\n                    } else {\n                        this.maxDamage = this.minDamage;\n                    }\n                } else {\n                    this.minDamage = damage;\n                    this.maxDamage = this.minDamage;\n                }\n            }\n\n            if (equippable.defense !== undefined) {\n                this.defense = this.parseRandIntBetween(equippable.defense);\n            }\n\n            if (equippable.blockChance !== undefined) {\n                this.blockChance = this.parseRandIntBetween(equippable.blockChance);\n            }\n\n            if (equippable.health !== undefined) {\n                this.health = this.parseRandIntBetween(equippable.health);\n            }\n\n            if (equippable.mana !== undefined) {\n                this.mana = this.parseRandIntBetween(equippable.mana);\n            }\n\n            if (equippable.strength !== undefined) {\n                this.strength = this.parseRandIntBetween(equippable.strength);\n            }\n\n            if (equippable.agility !== undefined) {\n                this.agility = this.parseRandIntBetween(equippable.agility);\n            }\n\n            if (equippable.constitution !== undefined) {\n                this.constitution = this.parseRandIntBetween(equippable.constitution);\n            }\n\n            if (equippable.wisdom !== undefined) {\n                this.wisdom = this.parseRandIntBetween(equippable.wisdom);\n            }\n\n            if (equippable.lightRadius !== undefined) {\n                this.lightRadius = this.parseRandIntBetween(equippable.lightRadius);\n            }\n\n            if (equippable.maxStorage !== undefined) {\n                this.maxStorage = equippable.maxStorage;\n            }\n\n            if (equippable.storage !== undefined) {\n                for (let i = 0; i < equippable.storage.length; i++) {\n                    const item = equippable.storage[i];\n                    if (item !== null) {\n                        if (item.load !== undefined) {\n                            this.storage[i] = entityLoader.createFromTemplate(item.load, item);\n                        } else {\n                            this.storage[i] = entityLoader.create(item);\n                        }\n                        this.storage[i].parentEntity = this;\n                    }\n                }\n            }\n        }\n    }\n\n    save() {\n        if (this.cachedSave) {\n            return this.cachedSave;\n        }\n\n        const saveJson = {\n            equippable: {}\n        };\n\n        if (this.slot !== EquipmentType.MAIN_HAND) {\n            saveJson.equippable.slot = this.slot;\n        }\n\n        if (this.minDamage !== 0 || this.maxDamage !== 0) {\n            if (this.minDamage === this.maxDamage) {\n                saveJson.equippable.damage = this.minDamage;\n            } else {\n                saveJson.equippable.damage = this.minDamage + \",\" + this.maxDamage;\n            }\n        }\n\n        if (this.defense !== 0) {\n            saveJson.equippable.defense = this.defense;\n        }\n\n        if (this.blockChance !== 0) {\n            saveJson.equippable.blockChance = this.blockChance;\n        }\n\n        if (this.health !== 0) {\n            saveJson.equippable.health = this.health;\n        }\n\n        if (this.mana !== 0) {\n            saveJson.equippable.mana = this.mana;\n        }\n\n        if (this.strength !== 0) {\n            saveJson.equippable.strength = this.strength;\n        }\n\n        if (this.agility !== 0) {\n            saveJson.equippable.agility = this.agility;\n        }\n\n        if (this.constitution !== 0) {\n            saveJson.equippable.constitution = this.constitution;\n        }\n\n        if (this.wisdom !== 0) {\n            saveJson.equippable.wisdom = this.wisdom;\n        }\n\n        if (this.lightRadius !== 0) {\n            saveJson.equippable.lightRadius = this.lightRadius;\n        }\n\n        if (this.maxStorage !== 0) {\n            saveJson.equippable.maxStorage = this.maxStorage;\n        }\n\n        const storageJson = [];\n        for (const item of this.storage) {\n            if (!item) {\n                storageJson.push(null);\n            } else {\n                storageJson.push(JSON.stringify(item.save()));\n            }\n        }\n\n        if (storageJson.length > 0) {\n            saveJson.equippable.storage = storageJson;\n        }\n\n        this.cachedSave = saveJson;\n        return saveJson;\n    }\n\n    getDescription() {\n        let description = \"<span class='item__details-line'>Type: <span style='color: #fff;'>\" + this.slot + \"</span></span>\";\n\n        if (this.minDamage !== 0 || this.maxDamage !== 0) {\n            description += \"<span class='item__details-line'>Damage: <span style='color: #f00;'>\";\n            if (this.minDamage === this.maxDamage) {\n                description += this.minDamage;\n            } else {\n                description += this.minDamage + \" - \" + this.maxDamage;\n            }\n            description += \"</span></span>\";\n        }\n\n        if (this.defense !== 0) {\n            description += \"<span class='item__details-line'>Defense: <span style='color: #fff;'>\" + this.defense + \"</span></span>\";\n        }\n\n        if (this.blockChance !== 0) {\n            description += \"<span class='item__details-line'>Block Chance: <span style='color: #fff;'>\" + this.blockChance + \"</span></span>\";\n        }\n\n        if (this.health !== 0) {\n            description += \"<span class='item__details-line'>Health: <span style='color: #fff;'>+\" + this.health + \"</span></span>\";\n        }\n\n        if (this.mana !== 0) {\n            description += \"<span class='item__details-line'>Mana: <span style='color: #fff;'>+\" + this.mana + \"</span></span>\";\n        }\n\n        if (this.strength !== 0) {\n            description += \"<span class='item__details-line'>Strength: <span style='color: #fff;'>+\" + this.strength + \"</span></span>\";\n        }\n\n        if (this.agility !== 0) {\n            description += \"<span class='item__details-line'>Agility: <span style='color: #fff;'>+\" + this.agility + \"</span></span>\";\n        }\n\n        if (this.constitution !== 0) {\n            description += \"<span class='item__details-line'>Constitution: <span style='color: #fff;'>+\" + this.constitution + \"</span></span>\";\n        }\n\n        if (this.wisdom !== 0) {\n            description += \"<span class='item__details-line'>Wisdom: <span style='color: #fff;'>+\" + this.wisdom + \"</span></span>\";\n        }\n\n        if (this.lightRadius !== 0) {\n            description += \"<span class='item__details-line'>Light Radius: <span style='color: #fff;'>+\" + this.lightRadius + \"</span></span>\";\n        }\n\n        if (this.maxStorage === -1) {\n            description += \"<span class='item__details-line'>Storage: <span style='color: #fff;'>Unlimited</span></span>\";\n        } else if (this.maxStorage > 0) {\n            description += \"<span class='item__details-line'>Storage: <span style='color: #fff;'>\" + this.maxStorage + \"</span></span>\";\n        }\n\n        return description;\n    }\n\n    addFullStacks(item) {\n        this.clearSaveCache();\n\n        // Add full stack\n        if (this.maxStorage === -1) {\n            this.storage[this.storage.length] = item;\n            item.parentEntity = this;\n        } else {\n            for (let i = 0; i < this.maxStorage; i++) {\n                if (!this.storage[i]) {\n                    this.storage[i] = item;\n                    item.parentEntity = this;\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    addPartialStacks(item) {\n        if (item.amount <= 0) {\n            return false;\n        }\n        this.clearSaveCache();\n\n        const originalAmount = item.amount;\n        let amountToAdd = item.amount;\n\n        let partialMax;\n        if (this.maxStorage === -1) {\n            partialMax = this.storage.length;\n        } else {\n            partialMax = this.maxStorage;\n        }\n        // Add partial stack\n        for (let i = 0; i < partialMax; i++) {\n            const inventoryItem = this.storage[i];\n            if (inventoryItem) {\n                if (item.id === inventoryItem.id) {\n                    let amountCanAdd = inventoryItem.maxStackSize - inventoryItem.amount;\n                    if (amountCanAdd >= amountToAdd) {\n                        inventoryItem.setAmount(inventoryItem.amount + amountToAdd);\n                        return true;\n                    } else {\n                        inventoryItem.setAmount(inventoryItem.amount + amountCanAdd);\n                        item.setAmount(item.amount - amountCanAdd);\n                        amountToAdd -= amountCanAdd;\n                    }\n                }\n            }\n        }\n\n        return originalAmount !== amountToAdd;\n    }\n\n    use(item, amount) {\n        item.setAmount(item.amount - amount);\n        if (item.amount <= 0) {\n            this.remove(item);\n        }\n\n        this.clearSaveCache();\n    }\n\n    remove(item) {\n        const index = this.storage.indexOf(item);\n        if (index > -1) {\n            this.storage.splice(index, 1, null);\n        }\n\n        this.clearSaveCache();\n        engine.needsMapUpdate = true;\n    }\n\n    setItem(index, item) {\n        this.storage[index] = item;\n        this.clearSaveCache();\n    }\n\n    move(fromIndex, toIndex) {\n        if (fromIndex !== toIndex) {\n            const fromItem = this.storage[fromIndex];\n\n            this.storage[fromIndex] = this.storage[toIndex];\n            this.storage[toIndex] = fromItem;\n\n            this.clearSaveCache();\n            if (this.isPlayer()) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n\n    drop(item) {\n        if (item) {\n            let parent = this.parentEntity;\n            while (parent.type !== 'actor') {\n                parent = parent.parentEntity;\n            }\n            const parentPosition = parent.getComponent(\"positionalobject\");\n            engine.gameMap.addItem(item, parentPosition)\n\n            if (parent === engine.player) {\n                messageConsole.text(\"You dropped the \" + item.name).build();\n            }\n\n            this.remove(item);\n            this.clearSaveCache();\n            if (parent === engine.player) {\n                inventory.populateInventory(engine.player);\n            }\n        }\n    }\n}","import SolidObject from \"./positionalObject/SolidObject\";\nimport CharacterObject from \"./positionalObject/CharacterObject\";\nimport BlocksMovement from \"./BlocksMovement\";\nimport Walkable from \"./Walkable\";\nimport Fov from \"./Fov\";\nimport BlocksFov from \"./BlocksFov\";\nimport Openable from \"./Openable\";\nimport VisibilityModifier from \"./VisibilityModifier\";\nimport Fighter from \"./Fighter\";\nimport AIMeleeChase from \"./ai/AIMeleeChase\";\nimport Faction from \"./Faction\";\nimport Remnant from \"./Remnant\";\nimport AIDead from \"./ai/AIDead\";\nimport HealingConsumable from \"./consumable/HealingConsumable\";\nimport Inventory from \"./Inventory\";\nimport DamageNearestConsumable from \"./consumable/DamageNearestConsumable\";\nimport ConfusionConsumable from \"./consumable/ConfusionConsumable\";\nimport AIConfusedEnemy from \"./ai/AIConfusedEnemy\";\nimport AOEDamageConsumable from \"./consumable/AOEDamageConsumable\";\nimport ManaConsumable from \"./consumable/ManaConsumable\";\nimport AIGelatinousCube from \"./ai/AIGelatinousCube\";\nimport AIPlayer from \"./ai/AIPlayer\";\nimport ExplodeOnDeath from \"./ExplodeOnDeath\";\nimport AttachedItems from \"./AttachedItems\";\nimport StairsInteractable from \"./interactable/StairsInteractable\";\nimport Level from \"./Level\";\nimport SummonPortalConsumable from \"./consumable/SummonPortalConsumable\";\nimport PortalInteractable from \"./interactable/PortalInteractable\";\nimport Equipment from \"./equipment/Equipment\";\nimport Equippable from \"./equipment/Equippable\";\n\nclass ComponentLoader {\n    constructor() {\n        this.types = new Map();\n\n        // AI\n        this.load(new AIConfusedEnemy());\n        this.load(new AIDead());\n        this.load(new AIGelatinousCube());\n        this.load(new AIMeleeChase());\n        this.load(new AIPlayer());\n\n        // Consumables\n        this.load(new AOEDamageConsumable());\n        this.load(new ConfusionConsumable());\n        this.load(new DamageNearestConsumable());\n        this.load(new HealingConsumable());\n        this.load(new ManaConsumable());\n        this.load(new SummonPortalConsumable());\n\n        // Equipment\n        this.load(new Equipment());\n        this.load(new Equippable());\n\n        // Interactables\n        this.load(new StairsInteractable());\n        this.load(new PortalInteractable());\n\n        // Positionalobjects\n        this.load(new CharacterObject());\n        this.load(new SolidObject());\n\n        // Default components\n        this.load(new AttachedItems());\n        this.load(new BlocksFov());\n        this.load(new BlocksMovement());\n        this.load(new ExplodeOnDeath());\n        this.load(new Faction());\n        this.load(new Fighter());\n        this.load(new Fov());\n        this.load(new Inventory());\n        this.load(new Level());\n        this.load(new Openable());\n        this.load(new Remnant());\n        this.load(new VisibilityModifier());\n        this.load(new Walkable());\n    }\n\n    load(component) {\n        this.types.set(component.type, component);\n    }\n\n    create(entity, type, args) {\n        const component = this.types.get(type);\n        const constructor = component.constructor;\n        return new constructor(args);\n    }\n}\n\nconst componentLoader = new ComponentLoader();\nexport default componentLoader;","import _Component from \"../components/_Component\";\r\nimport componentLoader from \"../components/ComponentLoader\";\r\nimport Extend from \"../util/Extend\";\r\n\r\nexport default class _Entity {\r\n    constructor(args) {\r\n        this.type = args.type || \"entity\";\r\n        this.id = args.id;\r\n        this.name = args.name || \"\";\r\n        this.description = args.description || \"\";\r\n        this.componentArray = [];\r\n        this.components = {};\r\n        this.parent = null;\r\n        this.combatTweens = [];\r\n\r\n        if (args.components) {\r\n            this.loadComponents(args, args.components);\r\n            this.callEvent(\"onComponentsLoaded\");\r\n        }\r\n\r\n        this.cachedSave = null;\r\n    }\r\n\r\n    loadComponents(args, components) {\r\n        const self = this;\r\n        Object.keys(components).forEach(function(key) {\r\n            const type = componentLoader.types.get(key);\r\n            if (type) {\r\n                const baseType = type.baseType;\r\n                const existingComponent = self.getComponent(baseType);\r\n                if (!existingComponent) {\r\n                    self.setComponent(componentLoader.create(this, key, args));\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    setComponent(component) {\r\n        if (!(component instanceof _Component)) {\r\n            console.error(\"Invalid component: \", component);\r\n        }\r\n\r\n        component.parentEntity = this;\r\n        this.components[component.baseType] = component;\r\n        this.componentArray.push(component);\r\n\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    getComponent(baseType) {\r\n        return this.components[baseType];\r\n    }\r\n\r\n    removeComponent(baseType) {\r\n        if (!this.components[baseType]) {\r\n            return;\r\n        }\r\n\r\n        this.components[baseType] = undefined;\r\n        for (const component of this.componentArray) {\r\n            if (component.baseType === baseType) {\r\n                const index = this.componentArray.indexOf(component);\r\n                this.componentArray.splice(index, 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    clearSaveCache() {\r\n        this.cachedSave = null;\r\n    }\r\n\r\n    save() {\r\n        if (this.cachedSave !== null) {\r\n            return this.cachedSave;\r\n        }\r\n\r\n        let json = {\r\n            id: this.id,\r\n            type: this.type,\r\n            name: this.name,\r\n            description: this.description\r\n        };\r\n\r\n        json.components = {};\r\n        for (const component of this.componentArray) {\r\n            const save = component.save();\r\n            if (save !== null && save !== {}) {\r\n                Extend.deep(json.components, save);\r\n            }\r\n        }\r\n\r\n        this.cachedSave = json;\r\n        return json;\r\n    }\r\n\r\n    /**\r\n     * @returns {_Entity}\r\n     */\r\n    clone() {\r\n        console.error(\"Not implemented\");\r\n    }\r\n\r\n    callEvent(event, args) {\r\n        for (const component of this.componentArray) {\r\n            if (component[event]) {\r\n                component[event](args);\r\n            }\r\n        }\r\n\r\n        if (this[event]) {\r\n            this[event](args);\r\n        }\r\n    }\r\n\r\n    getComponentDescriptions() {\r\n        let description = \"\";\r\n        for (const component of this.componentArray) {\r\n            description += component.getDescription();\r\n        }\r\n\r\n        return description;\r\n    }\r\n\r\n    stopCombatAnimations() {\r\n        for (const tween of this.combatTweens) {\r\n            tween.stop();\r\n        }\r\n\r\n        const position = this.getComponent(\"positionalobject\");\r\n        if (position) {\r\n            position.updateObjectPosition();\r\n        }\r\n    }\r\n\r\n    setName(newName) {\r\n        this.name = newName;\r\n        this.clearSaveCache();\r\n    }\r\n\r\n    onEntityDeath() {\r\n        this.setName(\"Remains of \" + this.name);\r\n    }\r\n}","import _Entity from \"./_Entity\";\r\nimport Extend from \"../util/Extend\";\r\n\r\nexport default class Tile extends _Entity {\r\n    constructor(args = {}) {\r\n        super(Extend.deep(Tile.getDefaultTemplate(), args));\r\n    }\r\n\r\n    static getDefaultTemplate() {\r\n        return {type: \"tile\"};\r\n    }\r\n\r\n    clone() {\r\n        return new Tile(this.save());\r\n    }\r\n}","import _Entity from \"./_Entity\";\r\nimport Extend from \"../util/Extend\";\r\n\r\nexport default class Actor extends _Entity {\r\n    constructor(args = {}) {\r\n        super(Extend.deep(Actor.getDefaultTemplate(), args));\r\n    }\r\n\r\n    static getDefaultTemplate() {\r\n        return {type: \"actor\"};\r\n    }\r\n\r\n    isAlive() {\r\n        const fighter = this.getComponent(\"fighter\");\r\n        return fighter && fighter.hp > 0;\r\n    }\r\n\r\n    clone() {\r\n        return new Actor(this.save());\r\n    }\r\n}","import _Entity from \"./_Entity\";\nimport Extend from \"../util/Extend\";\n\nexport default class Item extends _Entity {\n    constructor(args = {}) {\n        super(Extend.deep(Item.getDefaultTemplate(), args));\n\n        this.amount = 1;\n        this.maxStackSize = 1;\n        if (args.amount !== undefined) {\n            this.amount = args.amount;\n        }\n\n        if (args.maxStackSize !== undefined) {\n            this.maxStackSize = args.maxStackSize;\n        }\n    }\n\n    save() {\n        return Extend.deep(super.save(), {\n            amount: this.amount,\n            maxStackSize: this.maxStackSize\n        });\n    }\n\n    clone() {\n        return new Item(this.save());\n    }\n\n    static getDefaultTemplate() {\n        return {type: \"item\"};\n    }\n\n    setAmount(amount) {\n        this.amount = amount;\n        this.clearSaveCache();\n    }\n}","import Tile from \"./Tile\";\nimport Actor from \"./Actor\";\nimport Item from \"./Item\";\nimport baseActorsList from \"../../json/actors/_base.json\";\nimport playerList from \"../../json/actors/player.json\";\nimport enemyList from \"../../json/actors/enemies.json\";\nimport placeholderList from \"../../json/actors/placeholder.json\";\nimport npcsList from \"../../json/actors/npcs.json\";\nimport baseTilesList from \"../../json/tiles/_base.json\";\nimport foliageList from \"../../json/tiles/foliage.json\";\nimport furnitureList from \"../../json/tiles/furniture.json\";\nimport baseItemsList from \"../../json/items/_base.json\";\nimport amuletsList from \"../../json/items/amulets.json\";\nimport armorList from \"../../json/items/armor.json\";\nimport beltsList from \"../../json/items/belts.json\";\nimport bootsList from \"../../json/items/boots.json\";\nimport glovesList from \"../../json/items/gloves.json\";\nimport helmetsList from \"../../json/items/helmets.json\";\nimport miscList from \"../../json/items/misc.json\";\nimport potionsList from \"../../json/items/potions.json\";\nimport ringsList from \"../../json/items/rings.json\";\nimport scrollsList from \"../../json/items/scrolls.json\";\nimport shieldsList from \"../../json/items/shields.json\";\nimport shoulderList from \"../../json/items/shoulder.json\";\nimport storageList from \"../../json/items/storage.json\";\nimport weaponsList from \"../../json/items/weapons.json\";\nimport Extend from \"../util/Extend\";\n\nclass EntityLoader {\n    constructor() {\n        this.types = new Map();\n        this.templates = new Map();\n\n        this.load(new Tile());\n        this.load(new Actor());\n        this.load(new Item());\n\n        this.loadTemplates();\n    }\n\n    load(entity) {\n        this.types.set(entity.type, entity);\n    }\n\n    create(json, args = {}) {\n        let parsedJson;\n        if (typeof json === 'object') {\n            parsedJson = json;\n        } else {\n            parsedJson = JSON.parse(json);\n        }\n\n        if (parsedJson.extends !== undefined) {\n            const template = JSON.parse(this.templates.get(parsedJson.extends));\n\n            delete parsedJson[\"extends\"];\n            return this.create(Extend.deep(template, parsedJson), args);\n        }\n\n        const entity = this.types.get(parsedJson.type);\n        return new entity.constructor(Extend.deep(parsedJson, args));\n    }\n\n    loadTemplates() {\n        this.loadTemplate(baseActorsList);\n        this.loadTemplate(playerList);\n        this.loadTemplate(enemyList);\n        this.loadTemplate(placeholderList);\n        this.loadTemplate(npcsList);\n\n        this.loadTemplate(baseTilesList);\n        this.loadTemplate(foliageList);\n        this.loadTemplate(furnitureList);\n\n        this.loadTemplate(baseItemsList);\n        this.loadTemplate(amuletsList);\n        this.loadTemplate(armorList);\n        this.loadTemplate(beltsList);\n        this.loadTemplate(bootsList);\n        this.loadTemplate(glovesList);\n        this.loadTemplate(helmetsList);\n        this.loadTemplate(miscList);\n        this.loadTemplate(potionsList);\n        this.loadTemplate(ringsList);\n        this.loadTemplate(scrollsList);\n        this.loadTemplate(shieldsList);\n        this.loadTemplate(shoulderList);\n        this.loadTemplate(storageList);\n        this.loadTemplate(weaponsList);\n    }\n\n    loadTemplate(entities) {\n        for (const entity of entities) {\n            const id = entity.id;\n            if (this.templates.has(id)) {\n                console.error(\"Template for entity id '\" + id + \"' already exists.\");\n            } else {\n                this.templates.set(id, JSON.stringify(entity));\n            }\n        }\n    }\n\n    createFromTemplate(id, args = {}) {\n        if (this.templates.has(id)) {\n            const template = this.templates.get(id);\n\n            return this.create(template, args);\n        } else {\n            console.error(\"Json template for id '\" + id + \"' is missing.\");\n        }\n\n        return null;\n    }\n}\n\nconst entityLoader = new EntityLoader();\nexport default entityLoader;","import ArrayUtil from \"../util/ArrayUtil\";\nimport sceneState from \"../SceneState\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport engine from \"../Engine\";\nimport Tile from \"../entity/Tile\";\nimport Fov from \"../components/Fov\";\nimport characterHealth from \"../ui/CharacterHealth\";\nimport details from \"../ui/Details\";\nimport characterMana from \"../ui/CharacterMana\";\nimport Actor from \"../entity/Actor\";\nimport Remnant from \"../components/Remnant\";\nimport inventory from \"../ui/Inventory\";\nimport {Vector3} from \"three\";\nimport Item from \"../entity/Item\";\nimport bottomContainer from \"../ui/BottomContainer\";\n\nexport default class GameMap {\n    constructor(name, width, height) {\n        this.name = name;\n        this.width = width;\n        this.height = height;\n\n        this.timeout = null;\n        this.saveCache = null;\n\n        this.init();\n    }\n\n    init() {\n        this.tiles = new Map();\n        for (let i = -1; i <= 2; i++) {\n            this.tiles.set(i, ArrayUtil.create2dArray(this.width));\n        }\n\n        this.actors = [];\n        this.items = [];\n    }\n\n    create() {};\n\n    teardown() {\n        if (this.timeout) {\n            clearTimeout(this.timeout);\n        }\n\n        engine.fov.teardown();\n        engine.airFov.teardown();\n\n        const tilesIter = this.tiles.entries();\n        for (const entry of tilesIter) {\n            const tilesArray = entry[1];\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = tilesArray[i][j];\n                    if (tile) {\n                        tile.callEvent(\"onMapTeardown\");\n                    }\n                }\n            }\n        }\n\n        for (const actor of this.actors) {\n            actor.callEvent(\"onMapTeardown\");\n        }\n\n        for (const item of this.items) {\n            item.callEvent(\"onMapTeardown\");\n        }\n    }\n\n    removeEntity(entity) {\n        if (entity instanceof Actor) {\n            this.removeActor(entity);\n        } else if (entity instanceof Item) {\n            this.removeItem(entity);\n        }\n\n    }\n\n    removeItem(item) {\n        const index = this.items.indexOf(item);\n        if (index > -1) {\n            this.items.splice(index, 1);\n        }\n    }\n\n    /**\n     *\n     * @param item\n     * @param groundPosition\n     * @returns {boolean} true if item added <br/>\n     *                    false if item merged and item is deleted\n     */\n    addItem(item, groundPosition) {\n        const itemPosition = item.getComponent(\"positionalobject\");\n        if (!groundPosition) {\n            groundPosition = itemPosition;\n        }\n\n        let amountToAdd = item.amount;\n        for (const mapItem of this.items) {\n            if (mapItem.id === item.id) {\n                const position = mapItem.getComponent(\"positionalobject\");\n                const remnant = mapItem.getComponent(\"remnant\");\n                if (position && groundPosition.isSamePosition(position) && (!remnant || !remnant.isRemnant)) {\n                    if (mapItem.maxStackSize === -1) {\n                        mapItem.setAmount(mapItem.amount + item.amount);\n                        itemPosition.teardown();\n                        return false;\n                    }\n\n                    let amountCanAdd = mapItem.maxStackSize - mapItem.amount;\n                    if (amountCanAdd >= amountToAdd) {\n                        mapItem.setAmount(mapItem.amount + amountToAdd);\n                        itemPosition.teardown();\n                        return false;\n                    } else {\n                        mapItem.setAmount(mapItem.amount + amountCanAdd);\n                        item.setAmount(item.amount - amountCanAdd);\n\n                        amountToAdd -= amountCanAdd;\n                    }\n                }\n            }\n        }\n\n\n        if (amountToAdd > 0) {\n            item.setAmount(amountToAdd);\n\n            itemPosition.moveTo(groundPosition.x, groundPosition.y, groundPosition.z, false);\n            item.parent = null;\n            this.items.push(item);\n            itemPosition.setVisible();\n            return true;\n        } else {\n            itemPosition.teardown();\n            return false;\n        }\n    }\n\n    removeActor(actor) {\n        const index = this.actors.indexOf(actor);\n        if (index > -1) {\n            this.actors.splice(index, 1);\n        }\n    }\n\n    save() {\n        if (engine.gameMap !== this && this.saveCache) {\n            return this.saveCache;\n        }\n\n        let saveData = {\n            name: this.name,\n            width: this.width,\n            height: this.height\n        };\n\n        saveData[\"tiles\"] = {};\n        const entries = this.tiles.entries();\n        for (const entry of entries) {\n            const tileMap = new Map();\n            let key = \"\";\n            let charCode = 65;\n\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = entry[1][i][j];\n                    if (tile) {\n                        const tileJson = JSON.stringify(tile.save());\n                        if (tileMap.has(tileJson)) {\n                            key += String.fromCharCode(tileMap.get(tileJson));\n                        } else {\n                            tileMap.set(tileJson, charCode);\n                            key += String.fromCharCode(charCode);\n\n                            charCode++;\n                            if (String.fromCharCode(charCode) === ' ') {\n                                charCode++;\n                            }\n                        }\n                    } else {\n                        key += ' ';\n                    }\n                }\n            }\n\n            const mapKey = entry[0];\n            saveData[\"tiles\"][mapKey] = {};\n            saveData[\"tiles\"][mapKey][\"key\"] = key;\n            saveData[\"tiles\"][mapKey][\"map\"] = {};\n\n            const tileMapIter = tileMap.entries();\n            for (const tileMapEntry of tileMapIter) {\n                saveData[\"tiles\"][mapKey][\"map\"][String.fromCharCode(tileMapEntry[1])] = tileMapEntry[0];\n            }\n        }\n\n        let actorJson = [];\n        for (const actor of this.actors) {\n            actorJson.push(JSON.stringify(actor.save()));\n        }\n        saveData[\"actors\"] = actorJson;\n\n        let itemJson = [];\n        for (const item of this.items) {\n            itemJson.push(JSON.stringify(item.save()));\n        }\n        saveData[\"items\"] = itemJson;\n\n        this.saveCache = saveData;\n        return saveData;\n    }\n\n    load(json) {\n        const tiles = json.tiles;\n        const entries = this.tiles.entries();\n        for (const entry of entries) {\n            const tileLayer = entry[1];\n            const tilesToLoad = tiles[entry[0]];\n            if (tilesToLoad) {\n                const key = tilesToLoad.key;\n                const map = tilesToLoad.map;\n\n                for (let i = 0; i < this.width; i++) {\n                    for (let j = 0; j < this.height; j++) {\n                        const index = i*this.height + j;\n                        const tile = map[key[index]];\n\n                        if (tile) {\n                            tileLayer[i][j] = entityLoader.create(tile, {components: {positionalobject: {x: i, y: j, z: entry[0]}}});\n                        }\n                    }\n                }\n            }\n        }\n\n        const actors = json.actors;\n        for (const actor of actors) {\n            const createdActor = entityLoader.create(actor);\n            this.actors.push(createdActor);\n        }\n\n        const items = json.items;\n        for (const item of items) {\n            const createdItem = entityLoader.create(item);\n            this.items.push(createdItem);\n        }\n    }\n\n    isInBounds(x, y) {\n        return 0 <= x && x < this.width && 0 <= y && y < this.height;\n    }\n\n    revealPreviouslyExplored() {\n        const tileIter = this.tiles.entries();\n        for (const entry of tileIter) {\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = entry[1][i][j];\n                    if (tile) {\n                        const position = tile.getComponent(\"positionalobject\");\n                        if (position && !position.isVisible()) {\n                            const fov = tile.getComponent(\"fov\");\n                            if (fov && fov.explored) {\n                                position.setVisible();\n                                this.setTransparency(position, -5, -5, position.z);\n                                position.shiftColor(.5);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                position.setVisible();\n                position.shiftColor(.5);\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                position.setVisible();\n                position.shiftColor(.5);\n            }\n        }\n    }\n\n    revealFromPosition(x, y, radius, delay = 25) {\n        const self = this;\n        const minX = Math.max(0, x - radius);\n        const maxX = Math.min(engine.gameMap.width, x + radius);\n        const minY = Math.max(0, y - radius);\n        const maxY = Math.min(engine.gameMap.height, y + radius);\n\n        if (delay === 0) {\n            self._revealGradually(minX, maxX, minY, maxY, x, y, 1, radius, delay);\n        } else {\n            self.timeout = setTimeout(function () {\n                self._revealGradually(minX, maxX, minY, maxY, x, y, 1, radius, delay);\n            }, delay);\n        }\n    }\n\n    _revealGradually(minX, maxX, minY, maxY, x, y, radius, maxRadius, delay) {\n        const self = this;\n        self.timeout = null;\n\n        if (radius <= maxRadius) {\n            self.timeout = setTimeout(function () {\n                self._revealGradually(minX, maxX, minY, maxY, x, y, radius + 1, maxRadius, delay);\n            }, delay);\n        }\n\n        const xRadiusMin = x - radius;\n        const xRadiusMax = x + radius;\n        const yRadiusMin = y - radius;\n        const yRadiusMax = y + radius;\n        for (let i = xRadiusMin; i <= xRadiusMax; i++) {\n            const xIsEdge = i === xRadiusMin || i === xRadiusMax;\n            for (let j = yRadiusMin; j <= yRadiusMax; j++) {\n                if (xIsEdge || j === yRadiusMin || j === yRadiusMax) {\n                    this._revealAtPosition(i, j);\n                    engine.needsMapUpdate = true;\n                }\n            }\n        }\n\n        if (xRadiusMin <= minX && xRadiusMax >= maxX && yRadiusMin <= minY && yRadiusMax >= maxY) {\n            return true;\n        }\n\n        return true;\n    }\n\n    _revealAtPosition(x, y) {\n        const tileIter = this.tiles.entries();\n        for (const entry of tileIter) {\n            const tileX = entry[1][x];\n            if (tileX) {\n                const tile = entry[1][x][y];\n                if (tile) {\n                    const position = tile.getComponent(\"positionalobject\");\n                    if (position && !position.isVisible()) {\n                        position.setVisible();\n                        this.setTransparency(position, -5, -5, position.z);\n                        position.shiftColor(.5);\n\n                        const fov = tile.getComponent(\"fov\");\n                        if (!fov) {\n                            tile.setComponent(new Fov({components: {fov: {explored: true, visible: false}}}));\n                        }\n                    }\n                }\n            }\n        }\n\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y) {\n                    entity.getComponent(\"positionalobject\").teardown();\n                }\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y) {\n                    entity.getComponent(\"positionalobject\").teardown();\n                }\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && position.x === x && position.y === y && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n    }\n\n    reveal() {\n        const tileIter = this.tiles.entries();\n        for (const entry of tileIter) {\n            for (let i = 0; i < this.width; i++) {\n                for (let j = 0; j < this.height; j++) {\n                    const tile = entry[1][i][j];\n                    if (tile) {\n                        const position = tile.getComponent(\"positionalobject\");\n                        if (position && !position.isVisible()) {\n                            position.setVisible();\n                            this.setTransparency(position, -5, -5, position.z);\n                            position.shiftColor(.5);\n\n                            const fov = tile.getComponent(\"fov\");\n                            if (!fov) {\n                                tile.setComponent(new Fov({components: {fov: {explored: true, visible: false}}}));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                entity.getComponent(\"positionalobject\").teardown();\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (remnant && remnant.isRemnant) {\n                entity.getComponent(\"positionalobject\").teardown();\n            }\n        }\n\n        for (const entity of this.items) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n\n        for (const entity of this.actors) {\n            const remnant = entity.getComponent(\"remnant\");\n            if (!remnant || !remnant.isRemnant) {\n                const position = entity.getComponent(\"positionalobject\");\n                if (position && !position.isVisible()) {\n                    const remnant = entity.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: true,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (entity instanceof Actor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    entity.setComponent(new Remnant({\n                        components: {\n                            remnant: {\n                                isRemnant: false,\n                                x: position.x,\n                                y: position.y,\n                                z: position.z\n                            }\n                        }\n                    }));\n                    position.setVisible(false);\n\n                    entity.callEvent(\"onCreateRemnant\");\n                }\n            }\n        }\n    }\n\n    updateFOV(x, y, z, range) {\n        engine.fov.compute(x, y, z, range, z-2, z+1);\n        engine.airFov.compute(x, y, z,range * 2, z+2, z+8);\n    }\n\n    draw(x, y, z) {\n        this.drawItemsInFov(engine.fov, x, y, z);\n        this.drawItemsInFov(engine.airFov, x, y, z);\n    }\n\n    drawItemsInFov(fov, x, y, z) {\n        const newObjects = fov.newObjects;\n\n        const newObjectsRemoved = [];\n        for (const newObject of newObjects) {\n            if (newObject instanceof Tile) {\n                const fovComponent = newObject.getComponent(\"fov\");\n                if (fovComponent) {\n                    fovComponent.setExplored(true);\n                    fovComponent.setVisible(true);\n                } else {\n                    newObject.setComponent(new Fov({components: {fov: {explored: true, visible: true}}}));\n                }\n            } else if (newObject instanceof Item) {\n                const remnant = newObject.getComponent(\"remnant\");\n                if (remnant && remnant.isRemnant) {\n                    const position = newObject.getComponent(\"positionalobject\");\n                    if (position) {\n                        position.teardown();\n                    }\n                    this.removeItem(newObject);\n\n                    newObjectsRemoved.push(newObject);\n\n                    fov.removeVisible(newObject);\n                }\n            } else if (newObject instanceof Actor) {\n                const remnant = newObject.getComponent(\"remnant\");\n                if (remnant) {\n                    if (remnant.isRemnant) {\n                        newObject.getComponent(\"positionalobject\").teardown();\n                        this.removeActor(newObject);\n\n                        newObjectsRemoved.push(newObject);\n\n                        const visibleIndex = fov.visibleObjects.indexOf(newObject);\n                        if (visibleIndex > -1 ) {\n                            fov.visibleObjects.splice(visibleIndex, 1);\n                        }\n                    } else {\n                        const actorsRemoved = [];\n                        // Remove remnant of now visible actor\n                        for (const actor of this.actors) {\n                            if (actor === newObject) {\n                                continue;\n                            }\n\n                            const actorRemnant = actor.getComponent(\"remnant\");\n                            if (actorRemnant && actorRemnant.isRemnant) {\n                                if (remnant.x === actorRemnant.x && remnant.y === actorRemnant.y && remnant.z === actorRemnant.z) {\n                                    actor.getComponent(\"positionalobject\").teardown();\n                                    actorsRemoved.push(actor);\n\n                                    newObjectsRemoved.push(actor);\n\n                                    const visibleIndex = fov.visibleObjects.indexOf(actor);\n                                    if (visibleIndex > -1 ) {\n                                        fov.visibleObjects.splice(visibleIndex, 1);\n                                    }\n\n                                    actor.callEvent(\"onDestroyRemnant\");\n\n                                    const itemsRemoved = [];\n                                    for (const item of this.items) {\n                                        const itemRemnant = item.getComponent(\"remnant\");\n                                        if (itemRemnant && itemRemnant.isRemnant) {\n                                            if (remnant.x === itemRemnant.x && remnant.y === itemRemnant.y && remnant.z === itemRemnant.z) {\n                                                itemsRemoved.push(item);\n                                                const itemPosition = item.getComponent(\"positionalobject\");\n                                                if (itemPosition) {\n                                                    itemPosition.teardown();\n                                                }\n                                                newObjectsRemoved.push(item);\n                                                fov.removeVisible(item);\n                                            }\n                                        }\n                                    }\n\n                                    for (const item of itemsRemoved) {\n                                        this.removeItem(item);\n                                    }\n\n                                    break;\n                                }\n                            }\n                        }\n\n                        for (const actor of actorsRemoved) {\n                            this.removeActor(actor);\n                        }\n\n                        newObject.removeComponent(\"remnant\");\n                    }\n                }\n            }\n        }\n\n        for (let newObject of newObjectsRemoved) {\n            const newIndex = newObjects.indexOf(newObject);\n            if (newIndex > -1) {\n                newObjects.splice(newIndex, 1);\n            }\n        }\n\n        for (const object of fov.previousVisibleObjects) {\n            const index = fov.visibleObjects.indexOf(object);\n            if (index === -1) {\n                const fovComponent = object.getComponent(\"fov\");\n                if (fovComponent) {\n                    fovComponent.setVisible(false);\n                }\n                fov.oldObjects.push(object);\n            }\n        }\n\n        for (const newObject of newObjects) {\n            const object = newObject.getComponent(\"positionalobject\");\n            if (object) {\n                if (!object.isVisible()) {\n                    object.setVisible();\n                } else {\n                    object.resetColor();\n                }\n            }\n\n            newObject.callEvent(\"onAddToScene\");\n        }\n\n        const visibleObjects = fov.visibleObjects;\n        for (const visibleObject of visibleObjects) {\n            if (visibleObject instanceof Tile) {\n                const object = visibleObject.getComponent(\"positionalobject\");\n\n                if (object) {\n                    this.setTransparency(object, x, y, z);\n                }\n            }\n        }\n\n        const oldObjects = fov.oldObjects;\n        for (const oldObject of oldObjects) {\n            const position = oldObject.getComponent(\"positionalobject\");\n            if (position) {\n                const isActor = oldObject instanceof Actor;\n                if (isActor || oldObject instanceof Item) {\n                    const remnant = oldObject.clone();\n                    remnant.setName(\"Sighting of \" + remnant.name);\n                    remnant.removeComponent(\"ai\");\n                    remnant.removeComponent(\"blocksMovement\");\n                    remnant.removeComponent(\"blocksFov\");\n                    remnant.setComponent(new Remnant({components: {remnant: {isRemnant: true, x: position.x, y: position.y, z: position.z}}}));\n\n                    const remnantPosition = remnant.getComponent(\"positionalobject\");\n                    remnantPosition.setVisible();\n                    remnantPosition.shiftColor(.5);\n                    if (isActor) {\n                        this.actors.push(remnant);\n                    } else {\n                        this.items.push(remnant);\n                    }\n\n                    oldObject.setComponent(new Remnant({components: {remnant: {isRemnant: false, x: position.x, y: position.y, z: position.z}}}));\n                    position.setVisible(false);\n\n                    oldObject.callEvent(\"onCreateRemnant\");\n                } else {\n                    this.setTransparency(position, x, y, z);\n\n                    if (position.hasObject()) {\n                        position.shiftColor(.5);\n                    }\n                }\n            }\n        }\n    }\n\n    setTransparency(object, x, y, z) {\n        if (object.z >= z) {\n            const xDiff = Math.abs(x - object.x);\n            const yDiff = Math.abs(y - object.y);\n            if (object.z > z) {\n                if (object.x >= x && object.y <= y && Math.max(xDiff, yDiff) < object.z + 3) {\n                    if (object.z > z + 1) {\n                        object.setTransparency(0);\n                    } else {\n                        object.setTransparency(.1);\n                    }\n                } else {\n                    object.setTransparency(1);\n                }\n            } else {\n                if (object.z <= z + 1 && xDiff <= 1 && yDiff <= 1) {\n                    object.setTransparency(.5);\n                } else {\n                    object.setTransparency(1);\n                }\n            }\n        } else {\n            object.setTransparency(1);\n        }\n    }\n\n    /**\n     * @param {Vector3} location\n     */\n    getAliveActorAtLocation(location) {\n        let aliveActor = null;\n        for (const actor of this.actors) {\n            if (actor.isAlive()) {\n                const position = actor.getComponent(\"positionalobject\");\n                if (position && location.x === position.x && location.y === position.y && location.z === position.z) {\n                    aliveActor = actor;\n                    break;\n                }\n            }\n        }\n\n        return aliveActor;\n    }\n\n    getBlockingActorAtLocation(x, y, z) {\n        let blockingActor = null;\n        for (const actor of this.actors) {\n            const position = actor.getComponent(\"positionalobject\");\n            if (position && x === position.x && y === position.y && z === position.z) {\n                const component = actor.getComponent(\"blocksMovement\");\n                if (component && component.blocksMovement) {\n                    blockingActor = actor;\n                    break;\n                }\n            }\n        }\n\n        return blockingActor;\n    }\n\n    /**\n     *\n     * @param {Vector3} position\n     */\n    isPositionVisible(position) {\n        let isVisible = false;\n\n        for (let z = position.z - 1; z <= position.z + 1; z++) {\n            const tiles = this.tiles.get(position.z);\n            if (tiles) {\n                const tileX = tiles[position.x];\n                if (tileX) {\n                    const tile = tileX[position.y];\n                    if (tile) {\n                        const fov = tile.getComponent(\"fov\");\n                        if (fov) {\n                            if (fov.visible) {\n                                isVisible = true;\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n\n        return isVisible;\n    }\n\n    addPlayer(x, y, z = 1) {\n        if (!engine.player) {\n            engine.player = entityLoader.createFromTemplate('player');\n        }\n\n        this.actors.push(engine.player);\n\n        const positionalObject = engine.player.getComponent(\"positionalobject\");\n        positionalObject.x = x;\n        positionalObject.y = y;\n        positionalObject.z = z;\n        positionalObject.setVisible();\n        sceneState.updateCameraPosition(engine.player);\n\n        this.updatePlayerUI();\n    }\n\n    updatePlayerUI() {\n        const playerFighter = engine.player.getComponent(\"fighter\");\n        bottomContainer.updateAll();\n        characterHealth.update(playerFighter.hp, playerFighter.maxHp);\n        characterMana.update(playerFighter.mana, playerFighter.maxMana);\n        details.updatePlayerDetails();\n        inventory.populateInventory(engine.player);\n    }\n}","import GameMap from \"./GameMap\";\nimport MapLayer from \"./MapLayer\";\nimport engine from \"../Engine\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport ArrayUtil from \"../util/ArrayUtil\";\n\nexport default class TutorialMap extends GameMap {\n    constructor() {\n        super(\"tutorial-map\", 35, 15);\n\n        this.floor = [\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"#####≈≈############################\",\n            \"#####≈≈############################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\"\n        ];\n\n        this.wall = [\n            \"###################################\",\n            \"###################################\",\n            \"####====###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"##===  =########################===\",\n            \"##=    =#################======#= >\",\n            \"##=    =#########=======#=    =#= =\",\n            \"##=    ===========     ===    === =\",\n            \"##=                    + +        =\",\n            \"##=       ==== ===     ===    =====\",\n            \"##=========##= =#=======#=    =####\",\n            \"#############= =#########======####\"\n        ];\n\n        this.overlay = [\n            \"###################################\",\n            \"########## RoguelikeDev ######v5_0#\",\n            \"###################################\",\n            \"############ does the ####2021#6-8#\",\n            \"###################################\",\n            \"### Complete Roguelike Tutorial ###\",\n            \"#####..############################\",\n            \"#####..############################\",\n            \"###....##########################.#\",\n            \"###....###################....###.#\",\n            \"###....###########.....###....###.#\",\n            \"###....................#.#........#\",\n            \"###.......####.###.....###....#####\",\n            \"##############.###########....#####\",\n            \"##############.####################\"\n        ];\n    }\n\n    init() {\n        super.init();\n\n        this.tiles.set(MapLayer.Decorative, ArrayUtil.create2dArray(this.width));\n    }\n\n    create() {\n        super.create();\n        const overlayColors = [\n            0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff, 0x66b2ff, 0x66d9ff, 0x66ffd9, 0x66ffb2, 0x66ff66, 0xb2ff66, 0xd9ff66, 0xffff66, 0xffd966, 0xffb266, 0xff8c66, 0xff668c, 0xff66b2, 0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff,\n            0x00ffbf, 0x00ff80, 0x00ff00, 0x80ff00, 0xffff00, 0xffbf00, 0xff8000, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333,\n            0x00a3d9, 0x00d9d9, 0x00d9a3, 0x00d96c, 0x00d900, 0x6cd900, 0xa3d900, 0xd9d900, 0xd9a300, 0xd96c00, 0xd93600, 0xd90000, 0x333333, 0x333333, 0x333333, 0x333333\n        ];\n        let overlayColorIndex = 0;\n        for (let j = 0; j < this.height; j++) {\n            for (let i = 0; i < this.width; i++) {\n                const floorChar = this.floor[this.height - j - 1].charAt(i);\n                switch(floorChar) {\n                    case \"#\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                    case \"≈\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate('water', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                }\n\n                const wallChar = this.wall[this.height - j - 1].charAt(i);\n                switch(wallChar) {\n                    case \"#\":\n                    case \"=\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \"+\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('door', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \">\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('stairs_north', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                }\n\n                let overlayChar = this.overlay[this.height - j - 1].charAt(i);\n                if (overlayChar !== \"#\") {\n                    if (overlayChar !== \".\") {\n                        this.tiles.get(MapLayer.DecorativeBG)[i][j] = entityLoader.createFromTemplate('art_backing', {components: {positionalobject: {x: i, y: j, z: 2}}});\n                    }\n\n                    if (overlayChar !== \" \" && overlayChar !== \".\") {\n                        if (overlayChar === \"_\") {\n                            overlayChar = \".\";\n                        }\n\n                        this.tiles.get(MapLayer.Decorative)[i][j] = entityLoader.createFromTemplate('art', {components: {characterobject: {x: i, y: j, z: 2.05, letter: overlayChar, color: overlayColors[overlayColorIndex]}}});\n                        overlayColorIndex ++;\n                    }\n                }\n            }\n        }\n\n        this.addPlayer(21, 3);\n        /*\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('ant', {components: {positionalobject: {x: 27, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('dragon_red', {components: {positionalobject: {x: 18, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('goblin', {components: {positionalobject: {x: 5, y: 2, z: 1}}}));\n\n        engine.gameMap.items.push(entityLoader.createFromTemplate('potion_health', {components: {positionalobject: {x: 3, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('^', {components: {positionalobject: {x: 6, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('tower_shield', {components: {positionalobject: {x: 28, y: 1, z: 1}}}));\n         */\n\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('gelatinous_cube', {components: {positionalobject: {x: 18, y: 4, z: 1}}}));\n        for (let i = 0; i < 2; i++) {\n            engine.gameMap.items.push(entityLoader.createFromTemplate('scroll_confusion', {components: {positionalobject: {x: 21, y: 3, z: 1}}}));\n        }\n        engine.gameMap.items.push(entityLoader.createFromTemplate('potion_health', {components: {positionalobject: {x: 19, y: 4, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('tower_shield', {components: {positionalobject: {x: 19, y: 4, z: 1}}}));\n\n\n        for (let i = 18; i <= 22; i++) {\n            for (let j = 2; j <= 4; j++) {\n                engine.gameMap.items.push(entityLoader.createFromTemplate('gold', {amount: 5, components: {positionalobject: {x: i, y: j, z: 1}}}));\n            }\n        }\n    }\n}","import entityGroups from \"../../../json/generation/_entityGroups.json\";\nimport itemGroups from \"../../../json/generation/_itemGroups.json\";\nimport basicDungeon from \"../../../json/generation/basic-dungeon.json\";\nimport {MathUtils} from \"three\";\n\nclass ChanceLoader {\n    constructor() {\n        this.entityGroups = new Map();\n        this.itemGroups = new Map();\n        this.generators = new Map();\n\n        this.loadEntityGroups(entityGroups);\n        this.loadItemGroups(itemGroups);\n\n        this.loadGenerator(\"basic-dungeon\", basicDungeon);\n    }\n\n    loadEntityGroups(entityGroups) {\n        for (const group of entityGroups) {\n            this.entityGroups.set(group.id, group.entities);\n        }\n    }\n\n    loadItemGroups(itemGroups) {\n        for (const group of itemGroups) {\n            this.itemGroups.set(group.id, group.items);\n        }\n    }\n\n    loadGenerator(name, generator) {\n        this.generators.set(name, generator);\n    }\n\n    getChancesForLevel(name, level) {\n        let chances;\n        const generator = this.generators.get(name);\n        for (const group of generator) {\n            if (group.level > level) {\n                break;\n            }\n\n            chances = group;\n        }\n\n        return chances;\n    }\n\n    getActorForLevel(name, level) {\n        const chances = this.getChancesForLevel(name, level);\n        const actors = chances.actors;\n\n        let actorOrGroup = this.getRandomFromGroup(actors);\n        while (actorOrGroup.group !== undefined) {\n            const actorGroup = this.entityGroups.get(actorOrGroup.group);\n            actorOrGroup = this.getRandomFromGroup(actorGroup);\n        }\n\n        return actorOrGroup.id;\n    }\n\n    getItemForLevel(name, level) {\n        const chances = this.getChancesForLevel(name, level);\n        const items = chances.items;\n\n        let itemOrGroup = this.getRandomFromGroup(items);\n        while (itemOrGroup.group !== undefined) {\n            const itemGroup = this.itemGroups.get(itemOrGroup.group);\n            itemOrGroup = this.getRandomFromGroup(itemGroup);\n        }\n\n        return itemOrGroup.id;\n    }\n\n    getRandomFromGroup(group) {\n        let totalWeight = 0;\n        for (const chance of group) {\n            totalWeight += chance.weight;\n        }\n\n        let returnChance;\n        let currentWeight = 0;\n        const rand = MathUtils.randFloat(0, totalWeight);\n        for (const chance of group) {\n            currentWeight += chance.weight;\n\n            if (rand < currentWeight) {\n                returnChance = chance;\n                break;\n            }\n        }\n\n        return returnChance;\n    }\n}\n\nconst chanceLoader = new ChanceLoader();\nexport default chanceLoader;","import MapLayer from \"../MapLayer\";\r\nimport {MathUtils} from \"three\";\r\nimport engine from \"../../Engine\";\r\nimport entityLoader from \"../../entity/EntityLoader\";\r\nimport chanceLoader from \"../mapGeneration/ChanceLoader\";\r\n\r\nexport default class RectangularRoom {\r\n    constructor(x, y, width, height) {\r\n        this.x1 = x;\r\n        this.y1 = y;\r\n        this.x2 = x + width;\r\n        this.y2 = y + height;\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    getCenterX() {\r\n        return Math.round((this.x1 + this.x2) / 2);\r\n    }\r\n\r\n    getCenterY() {\r\n        return Math.round((this.y1 + this.y2) / 2);\r\n    }\r\n\r\n    intersects(otherRoom) {\r\n        return this.x1 <= otherRoom.x2\r\n            && this.x2 >= otherRoom.x1\r\n            && this.y1 <= otherRoom.y2\r\n            && this.y2 >= otherRoom.y1;\r\n    }\r\n\r\n    createRoom(gameMap) {\r\n        const left = Math.max(0, this.x1);\r\n        const right = Math.min(gameMap.width, this.x2 + 1);\r\n        const top = Math.max(0, this.y1);\r\n        const bottom = Math.min(gameMap.height, this.y2 + 1);\r\n        for (let i = left; i < right; i++) {\r\n            for (let j = top; j < bottom; j++) {\r\n                const previousFloorTile = gameMap.tiles.get(MapLayer.Floor)[i][j];\r\n                if (!previousFloorTile) {\r\n                    gameMap.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: 0}}});\r\n                }\r\n\r\n                const isVerticalEdge = (i === this.x1 || i === this.x2) && j >= this.y1 && j <= this.y2;\r\n                const isHorizontalEdge = (j === this.y1 || j === this.y2) && i >= this.x1 && i <= this.x2;\r\n                const wallTile = gameMap.tiles.get(MapLayer.Wall)[i][j];\r\n                if (isHorizontalEdge || isVerticalEdge) {\r\n                    if (!previousFloorTile && !wallTile) {\r\n                        gameMap.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 1}}});\r\n                    }\r\n                } else {\r\n                    if (wallTile) {\r\n                        gameMap.tiles.get(MapLayer.Wall)[i][j] = null;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    placeEntities(name, level, maxMonsters) {\r\n        const numMonsters = MathUtils.randInt(0, maxMonsters);\r\n        for (let i = 0; i < numMonsters; i++) {\r\n            const x = MathUtils.randInt(this.x1 + 1, this.x2 -1);\r\n            const y = MathUtils.randInt(this.y1 + 1, this.y2 -1);\r\n\r\n            const blockingActor = engine.gameMap.getBlockingActorAtLocation(x, y, 1);\r\n            if (!blockingActor) {\r\n                const position = {components: {positionalobject: {x: x, y: y, z: 1}}};\r\n\r\n                const actorId = chanceLoader.getActorForLevel(name, level);\r\n                const actor = entityLoader.createFromTemplate(actorId, position);\r\n\r\n                engine.gameMap.actors.push(actor);\r\n            }\r\n        }\r\n    }\r\n\r\n    placeItems(name, level, maxItems) {\r\n        const numItems = MathUtils.randInt(0, maxItems);\r\n        for (let i = 0; i < numItems; i++) {\r\n            const x = MathUtils.randInt(this.x1 + 1, this.x2 -1);\r\n            const y = MathUtils.randInt(this.y1 + 1, this.y2 -1);\r\n\r\n            const position = {components: {positionalobject: {x: x, y: y, z: 1}}};\r\n            const itemId = chanceLoader.getItemForLevel(name, level);\r\n            const item = entityLoader.createFromTemplate(itemId, position);\r\n\r\n            engine.gameMap.items.push(item);\r\n        }\r\n\r\n        const numGoldItems = MathUtils.randInt(0, maxItems);\r\n        for (let i = 0; i < numGoldItems; i++) {\r\n            const x = MathUtils.randInt(this.x1 + 1, this.x2 -1);\r\n            const y = MathUtils.randInt(this.y1 + 1, this.y2 -1);\r\n            const amount = MathUtils.randInt(1, 25);\r\n            const position = {amount: amount, components: {positionalobject: {x: x, y: y, z: 1}}};\r\n            let item = entityLoader.createFromTemplate('gold', position);\r\n\r\n            engine.gameMap.items.push(item);\r\n        }\r\n    }\r\n}","import entityLoader from \"../../entity/EntityLoader\";\r\n\r\nexport default class MapGeneration {\r\n    static floorEntity = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: 0, y: 0, z: 0}}});\r\n    static wallEntity = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: 0, y: 0, z: 0}}});\r\n\r\n    constructor() {}\r\n\r\n    static tunnelBetween(gameMap, x1, y1, x2, y2) {\r\n        let cornerX,\r\n            cornerY;\r\n        if (Math.random() < 0.5) {\r\n            cornerX = x2;\r\n            cornerY = y1;\r\n        } else {\r\n            cornerX = x1;\r\n            cornerY = y2;\r\n        }\r\n\r\n        this.bresenham(gameMap, x1, y1, cornerX, cornerY);\r\n        this.bresenham(gameMap, cornerX, cornerY, x2, y2);\r\n    }\r\n\r\n    static bresenham(gameMap, x1, y1, x2, y2) {\r\n        if (x1 === x2) {\r\n            if (y1 === y2) {\r\n                return;\r\n            }\r\n\r\n            let startY = y1;\r\n            let endY = y2;\r\n            if (y1 > y2) {\r\n                startY = y2;\r\n                endY = y1;\r\n            }\r\n            for (let i = x1 - 1; i <= x1 + 1; i++) {\r\n                for (let j = startY; j <= endY; j++) {\r\n                    this.bresenhamCreateTiles(gameMap, i === x1, i, j);\r\n                }\r\n            }\r\n        } else {\r\n            let startX = x1;\r\n            let endX = x2;\r\n            if (x1 > x2) {\r\n                startX = x2;\r\n                endX = x1;\r\n            }\r\n\r\n            for (let j = y1 - 1; j <= y1 + 1; j++) {\r\n                for (let i = startX; i <= endX; i++) {\r\n                    this.bresenhamCreateTiles(gameMap, j === y1, i, j);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    static bresenhamCreateTiles(gameMap, createWall, i, j) {\r\n        if (createWall) {\r\n            const wallTile = gameMap.tiles.get(1)[i][j];\r\n            if (wallTile) {\r\n                const blocksMovement = wallTile.getComponent(\"blocksMovement\");\r\n                if (blocksMovement && blocksMovement.blocksMovement) {\r\n                    gameMap.tiles.get(1)[i][j] = null;\r\n                }\r\n            }\r\n        } else {\r\n            const floorTile = gameMap.tiles.get(0)[i][j];\r\n            if (!floorTile) {\r\n                const wall = this.wallEntity.clone();\r\n                wall.getComponent(\"positionalobject\").moveTo(i, j, 1, false);\r\n                gameMap.tiles.get(1)[i][j] = wall;\r\n            }\r\n        }\r\n\r\n        const floor = this.floorEntity.clone();\r\n        floor.getComponent(\"positionalobject\").moveTo(i, j, 0, false);\r\n        gameMap.tiles.get(0)[i][j] = floor;\r\n    }\r\n}","import GameMap from \"./GameMap\";\r\nimport RectangularRoom from \"./room/RectangularRoom\";\r\nimport MapGeneration from \"./mapGeneration/MapGeneration\";\r\nimport entityLoader from \"../entity/EntityLoader\";\r\nimport {MathUtils} from \"three\";\r\nimport engine from \"../Engine\";\r\nimport Extend from \"../util/Extend\";\r\n\r\nexport default class BasicDungeon extends GameMap {\r\n    constructor(width, height, args = {}) {\r\n        const level = args.level || 1;\r\n        const name = \"basic-dungeon-\" + level;\r\n        super(name, width, height);\r\n\r\n        this.maxRooms = args.maxRooms || 30;\r\n        this.roomMinSize = args.roomMinSize || 6;\r\n        this.roomMaxSize = args.roomMaxSize || 10;\r\n        this.level = level;\r\n\r\n        this.maxMonstersByFloor = [\r\n            {level: 1, amount: 2},\r\n            {level: 4, amount: 3},\r\n            {level: 7, amount: 4}\r\n        ];\r\n        this.maxItemsByFloor = [\r\n            {level: 1, amount: 2},\r\n            {level: 4, amount: 3},\r\n            {level: 6, amount: 5}\r\n        ];\r\n    }\r\n\r\n    getFloorAmount(weights) {\r\n        let amount = 0;\r\n        for (const weight of weights) {\r\n            if (weight.level > this.level) {\r\n                break;\r\n            }\r\n\r\n            amount = weight.amount;\r\n        }\r\n\r\n        return amount;\r\n    }\r\n\r\n    save() {\r\n        if (engine.gameMap !== this && this.saveCache) {\r\n            return this.saveCache;\r\n        }\r\n\r\n        let saveJson = {\r\n            level: this.level\r\n        };\r\n\r\n        this.saveCache = Extend.deep(super.save(), saveJson);\r\n        return saveJson;\r\n    }\r\n\r\n    create(previousMapName, stairsInteractable) {\r\n        super.create();\r\n\r\n        const floorEntity = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: 0, y: 0, z: 0}}});\r\n        const wallEntity = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: 0, y: 0, z: 0}}});\r\n        // Pre-fill with floor and walls\r\n        for (let j = 0; j < this.height; j++) {\r\n            for (let i = 0; i < this.width; i++) {\r\n                const below = floorEntity.clone();\r\n                below.getComponent(\"positionalobject\").moveTo(i, j, -1, false);\r\n                const floor = floorEntity.clone();\r\n                floor.getComponent(\"positionalobject\").moveTo(i, j, 0, false);\r\n                const wall = wallEntity.clone();\r\n                wall.getComponent(\"positionalobject\").moveTo(i, j, 1, false);\r\n                this.tiles.get(-1)[i][j] = below;\r\n                this.tiles.get(0)[i][j] = floor;\r\n                this.tiles.get(1)[i][j] = wall;\r\n            }\r\n        }\r\n\r\n        const rooms = [];\r\n        for (let i = 0; i < this.maxRooms; i++) {\r\n            const roomWidth = MathUtils.randInt(this.roomMinSize, this.roomMaxSize);\r\n            const roomHeight = MathUtils.randInt(this.roomMinSize, this.roomMaxSize);\r\n\r\n            const x = MathUtils.randInt(0, this.width - roomWidth - 1);\r\n            const y = MathUtils.randInt(0, this.height - roomHeight - 1);\r\n\r\n            const newRoom = new RectangularRoom(x, y, roomWidth, roomHeight);\r\n            let intersectsOtherRoom = false;\r\n            for (const room of rooms) {\r\n                if (newRoom.intersects(room)) {\r\n                    intersectsOtherRoom = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (intersectsOtherRoom) {\r\n                continue;\r\n            }\r\n\r\n            newRoom.createRoom(this);\r\n\r\n            if (rooms.length === 0) {\r\n                const centerX = newRoom.getCenterX();\r\n                const centerY = newRoom.getCenterY();\r\n\r\n                if (stairsInteractable) {\r\n                    stairsInteractable.setPosition(centerX, centerY, 1);\r\n                }\r\n\r\n                const playerPosition = engine.player.getComponent(\"positionalobject\");\r\n                if (playerPosition) {\r\n                    this.tiles.get(1)[centerX][centerY] = entityLoader.createFromTemplate('stairs_north', {components: {positionalobject: {x: centerX, y: centerY, z: 1}, stairsInteractable: {map: previousMapName, x: playerPosition.x, y: playerPosition.y, z: playerPosition.z}}});\r\n                }\r\n                this.addPlayer(centerX, centerY);\r\n            } else {\r\n                const lastRoom = rooms[rooms.length - 1];\r\n                MapGeneration.tunnelBetween(this, lastRoom.getCenterX(), lastRoom.getCenterY(), newRoom.getCenterX(), newRoom.getCenterY());\r\n            }\r\n\r\n            newRoom.placeEntities(\"basic-dungeon\", this.level, this.getFloorAmount(this.maxMonstersByFloor));\r\n            newRoom.placeItems(\"basic-dungeon\", this.level, this.getFloorAmount(this.maxItemsByFloor));\r\n\r\n            rooms.push(newRoom);\r\n        }\r\n\r\n        const lastRoom = rooms[rooms.length - 1];\r\n        const lastRoomCenterX = lastRoom.getCenterX();\r\n        const lastRoomCenterY = lastRoom.getCenterY();\r\n        this.tiles.get(0)[lastRoomCenterX][lastRoomCenterY] = entityLoader.createFromTemplate('stairs_north', {components: {positionalobject: {x: lastRoomCenterX, y: lastRoomCenterY, z: 0}, stairsInteractable: {generator: \"basic-dungeon\"}}});\r\n    }\r\n}","import html from '../../../html/ui/editor/EditorControls.html';\nimport UIElement from \"../UIElement\";\n\nclass EditorControls extends UIElement {\n    constructor() {\n        super(html);\n\n        this.addAction(\"select\", \"👆\", true);\n        this.addAction(\"paint\", \"🖌\");\n        this.addAction(\"delete\", \"⌫\");\n\n        this.activeAction = \"select\";\n\n        this.dom.addEventListener(\"click\", this);\n    }\n\n    handleEvent(e) {\n        switch(e.type) {\n            case \"click\":\n                this.setControl(e);\n                break;\n        }\n    }\n\n    addAction(subId, char, active) {\n        const action = document.createElement(\"button\");\n        action.id = \"editor-controls-\" + subId;\n        action.setAttribute(\"data-action\", subId);\n        action.classList.add(\"editor-controls__action\");\n        if (active) {\n            action.classList.add(\"active\");\n        }\n        action.innerHTML = char;\n\n        this.dom.appendChild(action);\n    }\n\n    setControl(e) {\n        const target = e.target;\n        if (target.type === \"submit\") {\n            if (!target.classList.contains(\"active\")) {\n                const allActions = target.parentNode.children;\n                for (const action of allActions) {\n                    action.classList.remove(\"active\");\n                }\n\n                this.activeAction = target.getAttribute(\"data-action\");\n                target.classList.add(\"active\");\n            }\n        }\n\n    }\n}\n\nconst editorControls = new EditorControls();\nexport default editorControls;","import html from '../../../html/ui/editor/EditorInfo.html';\r\nimport engine from \"../../Engine\";\r\nimport UIElement from \"../UIElement\";\r\n\r\nclass EditorInfo extends UIElement {\r\n    constructor() {\r\n        super(html);\r\n\r\n        this.dataMap = new Map();\r\n\r\n        const entityDom = document.createElement(\"div\");\r\n        entityDom.classList.add(\"editor-info__component\", \"active\");\r\n        this.addData(\"entity\", entityDom);\r\n        this.addData(\"name\", entityDom);\r\n        this.dom.appendChild(entityDom);\r\n\r\n        this.positionalObject = document.createElement(\"div\");\r\n        this.positionalObject.classList.add(\"editor-info__component\");\r\n        this.addData(\"baseType\", this.positionalObject);\r\n        this.addData(\"x\", this.positionalObject);\r\n        this.addData(\"y\", this.positionalObject);\r\n        this.addData(\"z\", this.positionalObject);\r\n        this.addData(\"color\", this.positionalObject);\r\n        this.addDataInput(\"scale\", this.positionalObject);\r\n\r\n        this.addData(\"xRot\", this.positionalObject);\r\n        this.addData(\"yRot\", this.positionalObject);\r\n        this.addData(\"zRot\", this.positionalObject);\r\n\r\n        this.addData(\"xOffset\", this.positionalObject);\r\n        this.addData(\"yOffset\", this.positionalObject);\r\n        this.addData(\"zOffset\", this.positionalObject);\r\n        this.dom.appendChild(this.positionalObject);\r\n\r\n        this.walkable = document.createElement(\"div\");\r\n        this.walkable.classList.add(\"editor-info__component\");\r\n        this.addData(\"walkable\", this.walkable);\r\n        this.dom.appendChild(this.walkable);\r\n\r\n        this.blocksMovement = document.createElement(\"div\");\r\n        this.blocksMovement.classList.add(\"editor-info__component\");\r\n        this.addData(\"blocksMovement\", this.blocksMovement);\r\n        this.dom.appendChild(this.blocksMovement);\r\n    }\r\n\r\n    addDataInput(id, domElement) {\r\n        this.addData(id, domElement, \"input\")\r\n    }\r\n\r\n    addData(id, domElement, type = \"text\") {\r\n        const self = this;\r\n        const data = document.createElement(\"div\");\r\n        data.classList.add(\"editor-info__data\");\r\n\r\n        const label = document.createElement(\"span\");\r\n        label.classList.add(\"editor-info__label\");\r\n        label.innerHTML = id + \": \";\r\n        data.appendChild(label);\r\n\r\n        let dataDom;\r\n        if (type === \"text\") {\r\n            dataDom = document.createElement(\"span\");\r\n        } else if (type === \"input\") {\r\n            dataDom = document.createElement(\"input\");\r\n            dataDom.setAttribute(\"tabindex\", \"-1\");\r\n\r\n            dataDom.onchange = function(e) {\r\n                self.updateScale(self, e);\r\n            }\r\n            dataDom.onblur = function(e) {\r\n                self.updateScale(self, e);\r\n            }\r\n        }\r\n        dataDom.classList.add(\"editor-info__\" + type);\r\n        dataDom.id = \"editor-info-\" + id;\r\n        data.appendChild(dataDom);\r\n\r\n        domElement.appendChild(data);\r\n\r\n        this.dataMap.set(id, dataDom);\r\n    }\r\n\r\n    updateScale(self, e) {\r\n        let value = e.target.value;\r\n        if (value < 0.1) {\r\n            value = 0.1;\r\n            e.target.value = value;\r\n        } else if (value > 1) {\r\n            value = 1;\r\n            e.target.value = value;\r\n        }\r\n\r\n        if (self.entity) {\r\n            const positionalObject = self.entity.getComponent(\"positionalobject\");\r\n            if (positionalObject) {\r\n                positionalObject.scale = value;\r\n                positionalObject.teardown();\r\n                positionalObject.setVisible();\r\n                engine.needsMapUpdate = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    setData(id, data) {\r\n        const domElement = this.dataMap.get(id);\r\n        if (domElement.tagName === \"INPUT\") {\r\n            domElement.value = data;\r\n        } else {\r\n            domElement.innerHTML = data;\r\n        }\r\n    }\r\n\r\n    setDataForEntity(entity) {\r\n        this.entity = entity;\r\n        this.setData(\"entity\", entity.type);\r\n        this.setData(\"name\", entity.name);\r\n\r\n        const positionalObject = entity.getComponent(\"positionalobject\");\r\n        if (positionalObject) {\r\n            this.positionalObject.classList.add(\"active\");\r\n            this.setData(\"x\", positionalObject.x);\r\n            this.setData(\"y\", positionalObject.y);\r\n            this.setData(\"z\", positionalObject.z);\r\n\r\n            this.setData(\"baseType\", positionalObject.type);\r\n            this.setData(\"color\", positionalObject.color);\r\n            this.setData(\"scale\", positionalObject.scale);\r\n\r\n            this.setData(\"xRot\", positionalObject.xRot);\r\n            this.setData(\"yRot\", positionalObject.yRot);\r\n            this.setData(\"zRot\", positionalObject.zRot);\r\n\r\n            this.setData(\"xOffset\", positionalObject.xOffset);\r\n            this.setData(\"yOffset\", positionalObject.yOffset);\r\n            this.setData(\"zOffset\", positionalObject.zOffset);\r\n        } else {\r\n            this.positionalObject.classList.remove(\"active\");\r\n        }\r\n\r\n        const walkable = entity.getComponent(\"walkable\");\r\n        if (walkable) {\r\n            this.walkable.classList.add(\"active\");\r\n            this.setData(\"walkable\", walkable.walkable);\r\n        } else {\r\n            this.walkable.classList.remove(\"active\");\r\n        }\r\n\r\n        const blocksMovement = entity.getComponent(\"blocksMovement\");\r\n        if (blocksMovement) {\r\n            this.blocksMovement.classList.add(\"active\");\r\n            this.setData(\"blocksMovement\", blocksMovement.blocksMovement);\r\n        } else {\r\n            this.blocksMovement.classList.remove(\"active\");\r\n        }\r\n    }\r\n}\r\n\r\nconst editorInfo = new EditorInfo();\r\nexport default editorInfo;","import engine from \"../Engine\";\nimport controls from \"../controls/Controls\";\nimport TutorialMap from \"../map/TutorialMap\";\nimport EventHandler from \"./_EventHandler\";\nimport editorControls from \"../ui/editor/EditorControls\";\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\nimport Tile from \"../entity/Tile\";\nimport Actor from \"../entity/Actor\";\nimport Item from \"../entity/Item\";\nimport editorInfo from \"../ui/editor/EditorInfo\";\nimport BumpAction from \"../actions/actionWithDirection/BumpAction\";\n\nexport default class EditorEventHandler extends EventHandler {\n    constructor() {\n        super();\n        this.selectedEntity = null;\n\n        editorControls.open();\n        editorInfo.open();\n    }\n\n    teardown() {\n        super.teardown();\n        this.clearSelected();\n\n        editorControls.close();\n        editorInfo.close();\n    }\n\n    clearSelected() {\n        if (this.selectedEntity !== null) {\n            const object = this.selectedEntity.getComponent(\"positionalobject\");\n            if (object) {\n                object.removeHighlight();\n            }\n        }\n    }\n\n    handleInput() {\n        let action = null;\n        if (controls.testPressed(\"editor-up\")) {\n            action = new BumpAction(engine.player, 0, 1);\n        } else if (controls.testPressed(\"editor-down\")) {\n            action = new BumpAction(engine.player, 0, -1);\n        } else if (controls.testPressed(\"editor-left\")) {\n            action = new BumpAction(engine.player, -1);\n        } else if (controls.testPressed(\"editor-right\")) {\n            action = new BumpAction(engine.player, 1);\n        } else if (controls.testPressed(\"debug\")) {\n            engine.gameMap.reveal();\n            engine.needsMapUpdate = true;\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n            editorControls.close();\n            editorInfo.close();\n        } else if (controls.testPressed(\"debug2\")) {\n            engine.clearMaps();\n            engine.setMap(new TutorialMap());\n        }\n\n        return action;\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        if (target.tagName === \"CANVAS\") {\n            if (editorControls.activeAction === 'select') {\n                const intersects = this.getMouseIntersectingObjects(e);\n                let anyFound = false;\n                for (let i = 0; i < intersects.length; i++) {\n                    const object = intersects[i].object;\n                    const parentEntity = object.parentEntity;\n                    if (parentEntity) {\n                        const parentObject = parentEntity.getComponent(\"positionalobject\");\n                        if (parentObject) {\n                            // Skip invisible items\n                            if (parentObject.transparency === 0) {\n                                continue;\n                            }\n\n                            this.clearSelected();\n                            this.selectedEntity = parentEntity;\n                            editorInfo.setDataForEntity(this.selectedEntity);\n                            parentObject.highlight();\n                        }\n\n                        anyFound = true;\n                        break;\n                    }\n                }\n\n                if (!anyFound) {\n                    this.clearSelected();\n                }\n            } else if (editorControls.activeAction === 'delete') {\n                this.removeEntityFromMouseEvent(e);\n            }\n        }\n\n        engine.needsMapUpdate = true;\n    }\n\n    onMouseMove(e) {\n        const intersects = this.getMouseIntersectingObjects(e);\n\n        let anyFound = false;\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity) {\n                const parentObject = parentEntity.getComponent(\"positionalobject\");\n                if (parentObject && !parentObject.highlighted) {\n                    // Skip invisible items\n                    if (parentObject.transparency === 0) {\n                        continue;\n                    }\n\n                    if (!this.isHighlighted(parentEntity)) {\n                        this.clearAndSetHighlight(parentEntity);\n                    }\n                }\n\n                anyFound = true;\n                break;\n            }\n        }\n\n        if (!anyFound) {\n            this.clearHighlights(true);\n        }\n\n        if (this.mouseDown && editorControls.activeAction === 'delete') {\n            this.removeEntityFromMouseEvent(e);\n        }\n\n        engine.needsMapUpdate = true;\n    }\n\n    removeEntityFromMouseEvent(e) {\n        const intersects = this.getMouseIntersectingObjects(e);\n\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity) {\n                const parentObject = parentEntity.getComponent(\"positionalobject\");\n\n                if (parentEntity instanceof Tile) {\n                    engine.gameMap.tiles.get(parentObject.z)[parentObject.x][parentObject.y] = null;\n                } else if (parentEntity instanceof Actor) {\n                    engine.gameMap.removeActor(parentEntity);\n                } else if (parentEntity instanceof Item) {\n                    engine.gameMap.removeItem(parentEntity)\n                }\n                parentObject.teardown();\n\n                break;\n            }\n        }\n    }\n}","import Action from \"./_Action\";\nimport engine from \"../Engine\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport UnableToPerformAction from \"./UnableToPerformAction\";\nimport inventory from \"../ui/Inventory\";\nimport NoAction from \"./NoAction\";\n\nexport default class PickupAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        const entityInventory = this.entity.getComponent(\"inventory\");\n\n        const itemsToPickup = [];\n        let anyGoldPickedUp = false;\n        for (const item of engine.gameMap.items) {\n            const itemPosition = item.getComponent(\"positionalobject\");\n            if (position.x === itemPosition.x && position.y === itemPosition.y && position.z === itemPosition.z) {\n                if (entityInventory.add(item)) {\n                    anyGoldPickedUp = true;\n                    item.parentEntity = entityInventory;\n                    engine.gameMap.removeItem(item);\n                    itemPosition.teardown();\n\n                    engine.fov.remove(item);\n                    engine.needsMapUpdate = true;\n\n                    if (this.isPlayer()) {\n                        inventory.populateInventory(engine.player);\n\n                        if (item.amount > 1) {\n                            messageConsole.text(\"You picked up \" + item.amount + \" \" + item.name);\n                        } else {\n                            messageConsole.text(\"You picked up the \" + item.name);\n                        }\n                        messageConsole.build();\n                    }\n                } else {\n                    itemsToPickup.push(item);\n                }\n            }\n        }\n\n        const entityEquipment = this.entity.getComponent(\"equipment\");\n        for (const item of itemsToPickup) {\n            if (entityEquipment.addItem(item)) {\n                const itemPosition = item.getComponent(\"positionalobject\");\n                engine.gameMap.removeItem(item);\n                itemPosition.teardown();\n\n                engine.fov.remove(item);\n                engine.needsMapUpdate = true;\n\n                if (this.isPlayer()) {\n                    inventory.populateInventory(engine.player);\n\n                    if (item.amount > 1) {\n                        messageConsole.text(\"You picked up \" + item.amount + \" \" + item.name);\n                    } else {\n                        messageConsole.text(\"You picked up the \" + item.name);\n                    }\n                    messageConsole.build();\n                }\n\n                return this;\n            } else {\n                if (!anyGoldPickedUp) {\n                    return new UnableToPerformAction(this.entity, \"Nothing to pick up here.\");\n                }\n            }\n        }\n\n        return new NoAction(this.entity);\n    }\n}","import SelectIndexHandler from \"./_SelectIndexHandler\";\nimport controls from \"../../controls/Controls\";\n\nexport default class LookHandler extends SelectIndexHandler {\n    constructor() {\n        super();\n    }\n\n    handleInput() {\n        if (controls.testPressed(\"look\")) {\n            this.exit();\n        }\n\n        super.handleInput();\n    }\n\n    confirmIndex() {\n        this.exit();\n    }\n}","import html from '../../../html/menu/PauseMenu.html';\nimport UIElement from \"../UIElement\";\n\nclass PauseMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst pauseMenu = new PauseMenu();\nexport default pauseMenu;","import engine from \"./Engine\";\nimport messageConsole from \"./ui/MessageConsole\";\n\nclass SaveManager {\n    constructor() {\n        this.saveName = \"default\";\n        this.autosaveTurnCounter = 0;\n        this.loadSaves();\n    }\n\n    getCurrentSaveName() {\n        return \"save-\" + this.saveName;\n    }\n\n    save() {\n        this.saveSaves();\n        engine.save(this.getCurrentSaveName());\n    }\n\n    delete(saveToDelete) {\n        delete this.saves[saveToDelete];\n        this.save();\n\n        if (this.saveName === saveToDelete) {\n            this.saveName = \"default\";\n        }\n    }\n\n    autosave() {\n        const settings = engine.settings;\n        if (settings.autosavesEnabled) {\n            if (this.autosaveTurnCounter < settings.autosaveTurns) {\n                this.autosaveTurnCounter ++;\n                return;\n            }\n\n            this.autosaveTurnCounter = 0;\n\n            let autosave;\n            const lastAutosave = this.getLastAutosave();\n            if (lastAutosave === -1) {\n                autosave = 1;\n            } else if (lastAutosave < settings.autosaveAmount) {\n                autosave = lastAutosave + 1;\n            } else {\n                autosave = 1;\n            }\n\n            engine.save(this.getCurrentSaveName() + \"-autosave\" + autosave);\n\n            this.setLastAutosave(autosave);\n            messageConsole.text(\"Game autosaved.\").build();\n        }\n    }\n\n    loadSaves() {\n        const saves = localStorage.getItem(\"saves\");\n        if (saves) {\n            this.saves = JSON.parse(saves);\n        } else {\n            this.saves = {};\n        }\n    }\n\n    saveSaves() {\n        const save = this.saves[this.saveName];\n        if (save === undefined) {\n            this.saves[this.saveName] = {\"name\": this.getCurrentSaveName(), \"lastAutosave\": -1, \"date\": new Date()};\n        }\n\n        localStorage.setItem(\"saves\", JSON.stringify(this.saves));\n    }\n\n    getLastAutosave() {\n        let save = this.saves[this.saveName];\n        if (save === undefined) {\n            return -1;\n        } else {\n            return save.lastAutosave;\n        }\n    }\n\n    setLastAutosave(autosave) {\n        const save = this.saves[this.saveName];\n        if (save === undefined) {\n            this.saves[this.saveName] = {\"name\": this.getCurrentSaveName(), \"lastAutosave\": autosave};\n        } else {\n            save.lastAutosave = autosave;\n        }\n\n        this.saveSaves();\n    }\n}\n\nconst saveManager = new SaveManager();\nexport default saveManager;","import html from '../../../html/menu/LoadGame.html';\nimport UIElement from \"../UIElement\";\nimport saveManager from \"../../SaveManager\";\nimport saveHtml from \"../../../html/template/Save.html\";\n\nclass LoadGameMenu extends UIElement {\n    constructor() {\n        super(html);\n\n        this.oldSavesDom = this.dom.getElementsByClassName(\"loadgame__oldsaves\")[0];\n        this.loadSaves();\n    }\n\n    loadSaves() {\n        const self = this;\n        this.oldSavesDom.innerHTML = \"\";\n        for (const [key, value] of Object.entries(saveManager.saves)) {\n            const saveElement = this.htmlToElement(saveHtml);\n            saveElement.getElementsByClassName(\"save__text\")[0].innerText = key;\n            saveElement.getElementsByClassName(\"save__date\")[0].innerText = this.formatDate(value.date);\n            saveElement.getElementsByClassName(\"save__time\")[0].innerText = this.formatTime(value.date);\n            self.oldSavesDom.appendChild(saveElement);\n        }\n    }\n\n\n    formatDate(date) {\n        const formatted = new Date(date);\n        return formatted.getFullYear() + \"-\" + (formatted.getMonth() + 1) + \"-\" + formatted.getDate();\n    }\n\n    formatTime(date) {\n        const formatted = new Date(date);\n        return formatted.getHours() + \":\" + formatted.getMinutes() + \":\" + formatted.getSeconds();\n    }\n}\n\nconst loadGameMenu = new LoadGameMenu();\nexport default loadGameMenu;","import EventHandler from \"./_EventHandler\";\nimport engine from \"../Engine\";\n\nexport default class MenuEventHandler extends EventHandler {\n    constructor(eventHandler) {\n        super();\n\n        this.previousEventHandler = eventHandler;\n    }\n\n    returnToPreviousMenu() {\n        engine.setEventHandler(new this.previousEventHandler.constructor());\n    }\n}","import loadGameMenu from \"../ui/menu/LoadGameMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport engine from \"../Engine\";\nimport saveManager from \"../SaveManager\";\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\n\nexport default class LoadGameMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        loadGameMenu.loadSaves();\n        loadGameMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        loadGameMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (classList.contains(\"menu__back\")) {\n            this.returnToPreviousMenu();\n        } else if (classList.contains(\"save__title\")) {\n            const textDom = target.getElementsByClassName(\"save__text\")[0];\n            saveManager.saveName = textDom.innerText;\n            engine.load(saveManager.getCurrentSaveName());\n\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n        } else if (classList.contains(\"save__delete\")) {\n            const saveToDelete = target.parentNode.getElementsByClassName(\"save__text\")[0].innerText;\n            saveManager.delete(saveToDelete);\n            loadGameMenu.loadSaves();\n        }\n    }\n}","import html from '../../../html/menu/Controls.html';\nimport UIElement from \"../UIElement\";\n\nclass ControlsMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst controlsMenu = new ControlsMenu();\nexport default controlsMenu;","import controlsMenu from \"../ui/menu/ControlsMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport controls from \"../controls/Controls\";\n\nexport default class ControlsMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        this.isEditingKey = false;\n        this.editingDom = null\n        this.tempValue = null;\n\n        this.tempControls = controls.clone();\n        this.populateControls();\n        controlsMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        controlsMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (this.editingDom) {\n            this.editingDom.value = this.tempValue;\n            this.editingDom = null;\n            this.isEditingKey = false;\n        }\n\n        if (classList.contains(\"menu__save\")) {\n            this.saveAndExit();\n        } else if (classList.contains(\"menu__cancel\")) {\n            this.cancel();\n        } else if (classList.contains(\"menu__reset\")) {\n            this.resetControls();\n        } else {\n            if (target.tagName === \"INPUT\") {\n                this.tempValue = target.value;\n                target.value = \"\";\n                this.editingDom = target;\n                this.isEditingKey = true;\n            }\n        }\n    }\n\n    onKeydown(e) {\n        const target = e.target;\n        if (this.isEditingKey && target.tagName === \"INPUT\") {\n            const key = target.getAttribute(\"data-key\");\n            const index = target.getAttribute(\"data-index\");\n\n            const newKey = controls.getKey(e.key, e.code);\n            target.value = newKey;\n            e.preventDefault();\n            target.blur();\n\n            this.setKey(key, index, newKey);\n\n            this.isEditingKey = false;\n            this.editingDom = null;\n        }\n    }\n\n    setKey(key, index, value) {\n        const keys = this.tempControls.get(key);\n        keys[index] = value;\n    }\n\n    saveAndExit() {\n        controls.setControls(this.tempControls);\n        this.returnToPreviousMenu();\n    }\n\n    cancel() {\n        this.returnToPreviousMenu();\n    }\n\n    resetControls() {\n        controls.resetToDefault();\n        this.tempControls = controls.clone();\n        this.populateControls();\n    }\n\n    populateControls() {\n        // Movement\n        this.populateControl(\"up\", \"control-moveup\");\n        this.populateControl(\"down\", \"control-movedown\");\n        this.populateControl(\"left\", \"control-moveleft\");\n        this.populateControl(\"right\", \"control-moveright\");\n        this.populateControl(\"nw\", \"control-movenw\");\n        this.populateControl(\"ne\", \"control-movene\");\n        this.populateControl(\"sw\", \"control-movesw\");\n        this.populateControl(\"se\", \"control-movese\");\n        this.populateControl(\"wait\", \"control-movewait\");\n\n        // Actions\n        this.populateControl(\"inventory\", \"control-inventory\");\n        this.populateControl(\"character\", \"control-character\");\n        this.populateControl(\"closeall\", \"control-closeall\");\n        this.populateControl(\"get\", \"control-get\");\n        this.populateControl(\"look\", \"control-look\");\n        this.populateControl(\"pause\", \"control-pause\");\n        this.populateControl(\"interact\", \"control-interact\");\n        this.populateControl(\"quicksave\", \"control-quicksave\");\n        this.populateControl(\"quickload\", \"control-quickload\");\n\n        // Other\n        this.populateControl(\"confirm\", \"control-confirm\");\n        this.populateControl(\"cancel\", \"control-cancel\");\n        this.populateControl(\"modifier-speed1\", \"control-targetingmodifier1\");\n        this.populateControl(\"modifier-speed2\", \"control-targetingmodifier2\");\n        this.populateControl(\"modifier-speed3\", \"control-targetingmodifier3\");\n\n        // Debug\n        this.populateControl(\"debug\", \"control-revealmap\");\n        this.populateControl(\"debug2\", \"control-debugroom\");\n        this.populateControl(\"reset\", \"control-generatemap\");\n    }\n\n    populateControl(keyName, id) {\n        const keys = controls.controls.get(keyName);\n\n        const primaryKey = document.getElementById(id);\n        primaryKey.setAttribute(\"data-key\", keyName);\n        primaryKey.setAttribute(\"data-index\", \"0\");\n        if (keys.length > 0) {\n            primaryKey.value = keys[0];\n        } else {\n            primaryKey.value = \"\";\n        }\n\n        const secondaryKey = document.getElementById(id + \"-alt\");\n        secondaryKey.setAttribute(\"data-key\", keyName);\n        secondaryKey.setAttribute(\"data-index\", \"1\");\n        if (keys.length > 1) {\n            secondaryKey.value = keys[1];\n        } else {\n            secondaryKey.value = \"\";\n        }\n    }\n}","import html from '../../../html/menu/Settings.html';\nimport UIElement from \"../UIElement\";\n\nclass SettingsMenu extends UIElement {\n    constructor() {\n        super(html);\n\n        this.showStats = true;\n    }\n\n\n}\n\nconst settingsMenu = new SettingsMenu();\nexport default settingsMenu;","export default class Settings {\n    constructor() {\n        this.messageConsolePosition = \"\";\n\n        this.autosavesEnabled = true;\n        this.autosaveAmount = 3;\n        this.autosaveTurns = 100;\n        this.displayFPS = false;\n        this.debugControlsEnabled = false;\n\n        this.load();\n    }\n\n    load() {\n        const settings = localStorage.getItem(\"settings\");\n        if (settings) {\n            const json = JSON.parse(settings);\n            if (json.messageConsolePosition !== undefined) {\n                this.messageConsolePosition = json.messageConsolePosition;\n            }\n            if (json.autosavesEnabled !== undefined) {\n                this.autosavesEnabled = json.autosavesEnabled;\n            }\n            if (json.autosaveAmount !== undefined) {\n                this.autosaveAmount = json.autosaveAmount;\n            }\n            if (json.autosaveTurns !== undefined) {\n                this.autosaveTurns = json.autosaveTurns;\n            }\n            if (json.displayFPS !== undefined) {\n                this.displayFPS = json.displayFPS;\n            }\n            if (json.debugControlsEnabled !== undefined) {\n                this.debugControlsEnabled = json.debugControlsEnabled;\n            }\n        }\n    }\n\n    save() {\n        const toSave = {\n            messageConsolePosition: this.messageConsolePosition,\n            autosavesEnabled: this.autosavesEnabled,\n            autosaveAmount: this.autosaveAmount,\n            autosaveTurns: this.autosaveTurns,\n            displayFPS: this.displayFPS,\n            debugControlsEnabled: this.debugControlsEnabled\n        };\n\n        localStorage.setItem(\"settings\", JSON.stringify(toSave));\n    }\n}","import settingsMenu from \"../ui/menu/SettingsMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport Settings from \"../settings/Settings\";\nimport engine from \"../Engine\";\nimport sceneState from \"../SceneState\";\n\nexport default class SettingsMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        this.tempSettings = new Settings();\n        this.populateSettings();\n        settingsMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        settingsMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const id = target.id;\n        const classList = target.classList;\n\n        if (classList.contains(\"menu__save\")) {\n            this.saveAndExit();\n        } else if (classList.contains(\"menu__cancel\")) {\n            this.cancel();\n        } else if (id === \"setting-displayfps\") {\n            this.tempSettings.displayFPS = target.checked;\n            this.applyDisplayFPS(this.tempSettings);\n        } else if (id === \"setting-autosavesenabled\") {\n            this.tempSettings.autosavesEnabled = target.checked;\n            this.applyAutosavesEnabled(this.tempSettings);\n        } else if (id === \"setting-debugcontrolsenabled\") {\n            this.tempSettings.debugControlsEnabled = target.checked;\n        }\n    }\n\n    onChange(e) {\n        const target = e.target;\n        const id = target.id;\n\n        if (id === \"setting-autosaveamount\") {\n            let newSaveAmount = parseInt(target.value);\n            if (newSaveAmount) {\n                if (newSaveAmount < 1) {\n                    target.value = 1;\n                    newSaveAmount = 1;\n                } else if (newSaveAmount > 9) {\n                    target.value = 9;\n                    newSaveAmount = 9;\n                }\n            } else {\n                target.value = 3;\n                newSaveAmount = 3;\n            }\n\n            this.tempSettings.autosaveAmount = newSaveAmount;\n        } else if (id === \"setting-autosaveturns\") {\n            let newTurnsAmount = parseInt(target.value);\n            if (newTurnsAmount) {\n                if (newTurnsAmount < 10) {\n                    target.value = 10;\n                    newTurnsAmount = 10;\n                } else if (newTurnsAmount > 1000) {\n                    target.value = 1000;\n                    newTurnsAmount = 1000;\n                }\n            } else {\n                target.value = 100;\n                newTurnsAmount = 100;\n            }\n\n            this.tempSettings.autosaveTurns = newTurnsAmount;\n        }\n    }\n\n    saveAndExit() {\n        engine.settings = this.tempSettings;\n        engine.settings.save();\n        this.returnToPreviousMenu();\n    }\n\n    cancel() {\n        this.applyAllSettings(engine.settings);\n        this.returnToPreviousMenu();\n    }\n\n    populateSettings() {\n        const displayFPSCheckbox = document.getElementById(\"setting-displayfps\");\n        displayFPSCheckbox.checked = this.tempSettings.displayFPS;\n\n        const debugControlsEnabledCheckbox = document.getElementById(\"setting-debugcontrolsenabled\");\n        debugControlsEnabledCheckbox.checked = this.tempSettings.debugControlsEnabled;\n\n        const autosavesEnabledCheckbox = document.getElementById(\"setting-autosavesenabled\");\n        autosavesEnabledCheckbox.checked = this.tempSettings.autosavesEnabled;\n\n        const autosaveAmountInput = document.getElementById(\"setting-autosaveamount\");\n        autosaveAmountInput.value = this.tempSettings.autosaveAmount;\n\n        const autosaveTurnsInput = document.getElementById(\"setting-autosaveturns\");\n        autosaveTurnsInput.value = this.tempSettings.autosaveTurns;\n    }\n\n    applyAllSettings(settings) {\n        this.applyDisplayFPS(settings);\n        this.applyAutosavesEnabled(settings);\n    }\n\n    applyDisplayFPS(settings) {\n        sceneState.updateStatsVisibility(settings);\n    }\n\n    applyAutosavesEnabled(settings) {\n        const autosaveAmountInput = document.getElementById(\"setting-autosaveamount\");\n        const autosaveTurnsInput = document.getElementById(\"setting-autosaveturns\");\n        if (settings.autosavesEnabled) {\n            autosaveAmountInput.removeAttribute(\"disabled\");\n            autosaveTurnsInput.removeAttribute(\"disabled\");\n        } else {\n            autosaveAmountInput.setAttribute(\"disabled\", \"disabled\");\n            autosaveTurnsInput.setAttribute(\"disabled\", \"disabled\");\n        }\n    }\n}","import html from '../../../html/menu/Credits.html';\nimport UIElement from \"../UIElement\";\n\nclass CreditsMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst creditsMenu = new CreditsMenu();\nexport default creditsMenu;","import creditsMenu from \"../ui/menu/CreditsMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\n\nexport default class CreditsMenuEventsHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n        const self = this;\n\n        creditsMenu.open();\n        this.timeout = setTimeout(function() {\n            self.onLeftClick();\n        }, 31000);\n    }\n\n    teardown() {\n        super.teardown();\n\n        clearTimeout(this.timeout);\n        creditsMenu.close();\n    }\n\n    onLeftClick(e) {\n        this.returnToPreviousMenu();\n    }\n}","import html from '../../../html/menu/SaveGame.html';\nimport saveHtml from '../../../html/template/Save.html';\nimport UIElement from \"../UIElement\";\nimport saveManager from \"../../SaveManager\";\n\nclass SaveGameMenu extends UIElement {\n    constructor() {\n        super(html);\n\n        this.overwriteDom = this.dom.getElementsByClassName(\"savegame__overwrite\")[0];\n        this.oldSavesDom = this.dom.getElementsByClassName(\"savegame__oldsaves\")[0];\n    }\n\n    loadSaves() {\n        const self = this;\n        this.oldSavesDom.innerHTML = \"\";\n        for (const [key, value] of Object.entries(saveManager.saves)) {\n            const saveElement = this.htmlToElement(saveHtml);\n            saveElement.getElementsByClassName(\"save__text\")[0].innerText = key;\n            saveElement.getElementsByClassName(\"save__date\")[0].innerText = this.formatDate(value.date);\n            saveElement.getElementsByClassName(\"save__time\")[0].innerText = this.formatTime(value.date);\n            self.oldSavesDom.appendChild(saveElement);\n        }\n    }\n\n    formatDate(date) {\n        const formatted = new Date(date);\n        return formatted.getFullYear() + \"-\" + (formatted.getMonth() + 1) + \"-\" + formatted.getDate();\n    }\n\n    formatTime(date) {\n        const formatted = new Date(date);\n        return formatted.getHours() + \":\" + formatted.getMinutes() + \":\" + formatted.getSeconds();\n    }\n}\n\nconst saveGameMenu = new SaveGameMenu();\nexport default saveGameMenu;","import saveGameMenu from \"../ui/menu/SaveGameMenu\";\nimport MenuEventHandler from \"./_MenuEventHandler\";\nimport saveManager from \"../SaveManager\";\n\nexport default class SaveGameMenuEventHandler extends MenuEventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        this.overwriteName = \"\";\n        saveGameMenu.loadSaves();\n        saveGameMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        saveGameMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const classList = target.classList;\n\n        if (saveGameMenu.overwriteDom.classList.contains(\"active\")) {\n            if (classList.contains(\"save__overwrite\")) {\n                saveManager.saveName = this.overwriteName;\n                saveManager.save();\n\n                saveGameMenu.loadSaves();\n                saveGameMenu.overwriteDom.classList.remove(\"active\")\n            } else if (classList.contains(\"save__overwrite-cancel\")) {\n                saveGameMenu.overwriteDom.classList.remove(\"active\")\n            }\n        } else {\n            if (classList.contains(\"menu__back\")) {\n                this.returnToPreviousMenu();\n            } else if (classList.contains(\"save__confirm\")) {\n                const input = saveGameMenu.dom.getElementsByClassName(\"savegame__newsave-input\")[0];\n                const newSaveName = input.value;\n\n                if (saveManager.saves[newSaveName] !== undefined) {\n                    const overwriteTitleDom = saveGameMenu.overwriteDom.getElementsByClassName(\"savegame__overwrite-title\")[0];\n                    overwriteTitleDom.innerText = newSaveName + \" already exists. Overwrite?\";\n                    this.overwriteName = newSaveName;\n                    saveGameMenu.overwriteDom.classList.add(\"active\");\n                } else {\n                    saveManager.saveName = newSaveName;\n                    saveManager.save();\n                    saveGameMenu.loadSaves();\n                }\n            } else if (classList.contains(\"save__title\")) {\n                const textDom = target.getElementsByClassName(\"save__text\")[0];\n                const saveName = textDom.innerText;\n                const overwriteTitleDom = saveGameMenu.overwriteDom.getElementsByClassName(\"savegame__overwrite-title\")[0];\n                overwriteTitleDom.innerText = \"Overwrite \" + saveName + \"?\";\n                this.overwriteName = saveName;\n                saveGameMenu.overwriteDom.classList.add(\"active\");\n            } else if (classList.contains(\"save__delete\")) {\n                const saveToDelete = target.parentNode.getElementsByClassName(\"save__text\")[0].innerText;\n                saveManager.delete(saveToDelete);\n                saveGameMenu.loadSaves();\n            }\n        }\n    }\n}","import EventHandler from \"./_EventHandler\";\nimport pauseMenu from \"../ui/menu/PauseMenu\";\nimport controls from \"../controls/Controls\";\nimport engine from \"../Engine\";\n\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\nimport LoadGameMenuEventHandler from \"./LoadGameMenuEventHandler\";\nimport ControlsMenuEventHandler from \"./ControlsMenuEventHandler\";\nimport SettingsMenuEventHandler from \"./SettingsMenuEventHandler\";\nimport CreditsMenuEventsHandler from \"./CreditsMenuEventsHandler\";\nimport SaveGameMenuEventHandler from \"./SaveGameMenuEventHandler\";\nimport MainMenuEventHandler from \"./MainMenuEventHandler\";\n\nexport default class PauseMenuEventHandler extends EventHandler {\n    constructor(eventHandler) {\n        super(eventHandler);\n\n        pauseMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        pauseMenu.close();\n    }\n\n    handleInput() {\n        if (controls.testPressed(\"pause\")) {\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n        }\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const id = target.id;\n\n        switch(id) {\n            case \"pausemenu__savegame\":\n                this.openSaveGameMenu();\n                break;\n            case \"pausemenu__loadgame\":\n                this.openLoadGameMenu();\n                break;\n            case \"pausemenu__controls\":\n                this.openControlsMenu();\n                break;\n            case \"pausemenu__settings\":\n                this.openSettingsMenu();\n                break;\n            case \"pausemenu__credits\":\n                this.openCreditsMenu();\n                break;\n            case \"pausemenu__quit\":\n                this.quit();\n                break;\n            default:\n                break;\n        }\n\n        if (target.classList.contains(\"menu__returntogame\")) {\n            engine.setEventHandler(new DefaultPlayerEventHandler());\n        }\n    }\n\n    openSaveGameMenu() {\n        engine.setEventHandler(new SaveGameMenuEventHandler(this));\n    }\n\n    openLoadGameMenu() {\n        engine.setEventHandler(new LoadGameMenuEventHandler(this));\n    }\n\n    openControlsMenu() {\n        engine.setEventHandler(new ControlsMenuEventHandler(this));\n    }\n\n    openSettingsMenu() {\n        engine.setEventHandler(new SettingsMenuEventHandler(this));\n    }\n\n    openCreditsMenu() {\n        engine.setEventHandler(new CreditsMenuEventsHandler(this));\n    }\n\n    quit() {\n        engine.player = null;\n        engine.setEventHandler(new MainMenuEventHandler());\n    }\n}","import Action from \"./_Action\";\nimport UnableToPerformAction from \"./UnableToPerformAction\";\nimport engine from \"../Engine\";\nimport NoAction from \"./NoAction\";\n\nexport default class InteractAction extends Action {\n    constructor(entity) {\n        super(entity);\n    }\n\n    perform() {\n        const position = this.entity.getComponent(\"positionalobject\");\n        if (!position) {\n            return new UnableToPerformAction(this.entity, \"Entity doesn't have a position.\");\n        }\n\n        const gameMap = engine.gameMap;\n        const wallTile = gameMap.tiles.get(position.z)[position.x][position.y];\n        if (wallTile) {\n            const wallInteractable = wallTile.getComponent(\"interactable\");\n            if (wallInteractable) {\n                wallInteractable.interact();\n                return new NoAction(this.entity);\n            }\n        }\n\n        const floorTile = gameMap.tiles.get(position.z - 1)[position.x][position.y];\n        if (floorTile) {\n            const floorInteractable = floorTile.getComponent(\"interactable\");\n            if (floorInteractable) {\n                floorInteractable.interact();\n                return new NoAction(this.entity);\n            }\n        }\n\n        return new UnableToPerformAction(this.entity, \"There is nothing to interact with here.\");\n    }\n}","import ItemAction from \"./ItemAction\";\n\nexport default class DropFromEquipmentAction extends ItemAction {\n    constructor(entity, item, targetPosition) {\n        super(entity, item, targetPosition);\n    }\n\n    perform() {\n        const entityEquipment = this.entity.getComponent(\"equipment\");\n        entityEquipment.drop(this.item);\n    }\n}","import engine from \"../Engine\";\nimport controls from \"../controls/Controls\";\nimport TutorialMap from \"../map/TutorialMap\";\nimport BasicDungeon from \"../map/BasicDungeon\";\nimport Tile from \"../entity/Tile\";\nimport sceneState from \"../SceneState\";\nimport EventHandler from \"./_EventHandler\";\nimport EditorEventHandler from \"./EditorEventHandler\";\nimport BumpAction from \"../actions/actionWithDirection/BumpAction\";\nimport WaitAction from \"../actions/WaitAction\";\nimport PickupAction from \"../actions/PickupAction\";\nimport inventory from \"../ui/Inventory\";\nimport {Vector2} from \"three\";\nimport LookHandler from \"./selectIndexHandler/LookHandler\";\nimport characterHealth from \"../ui/CharacterHealth\";\nimport characterMana from \"../ui/CharacterMana\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport details from \"../ui/Details\";\nimport PauseMenuEventHandler from \"./PauseMenuEventHandler\";\nimport InteractAction from \"../actions/InteractAction\";\nimport character from \"../ui/Character\";\nimport bottomContainer from \"../ui/BottomContainer\";\nimport DropFromEquipmentAction from \"../actions/itemAction/DropFromEquipmentAction\";\n\nexport default class DefaultPlayerEventHandler extends EventHandler {\n    constructor() {\n        super();\n\n        bottomContainer.open();\n        characterHealth.open();\n        characterMana.open();\n        messageConsole.open();\n        details.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        bottomContainer.close();\n        characterHealth.close();\n        characterMana.close();\n        messageConsole.close();\n        details.close();\n    }\n\n    handleInput() {\n        let action = null;\n        if (this.isPlayerTurn) {\n            if (controls.testPressed(\"up\")) {\n                action = new BumpAction(engine.player, 0, 1);\n            } else if (controls.testPressed(\"down\")) {\n                action = new BumpAction(engine.player, 0, -1);\n            } else if (controls.testPressed(\"left\")) {\n                action = new BumpAction(engine.player, -1);\n            } else if (controls.testPressed(\"right\")) {\n                action = new BumpAction(engine.player, 1);\n            } else if (controls.testPressed(\"nw\")) {\n                action = new BumpAction(engine.player, -1, 1);\n            } else if (controls.testPressed(\"ne\")) {\n                action = new BumpAction(engine.player, 1, 1);\n            } else if (controls.testPressed(\"sw\")) {\n                action = new BumpAction(engine.player, -1, -1);\n            } else if (controls.testPressed(\"se\")) {\n                action = new BumpAction(engine.player, 1, -1);\n            } else if (controls.testPressed(\"wait\")) {\n                action = new WaitAction(engine.player);\n            } else if (controls.testPressed(\"get\")) {\n                action = new PickupAction(engine.player);\n            } else if (controls.testPressed(\"interact\")) {\n                action = new InteractAction(engine.player);\n            } else if (controls.testPressed(\"look\")) {\n                engine.setEventHandler(new LookHandler());\n            } else if (controls.testPressed(\"inventory\")) {\n                inventory.toggle();\n\n                this.hideItemTooltip();\n            } else if (controls.testPressed(\"character\")) {\n                character.toggle();\n            } else if (controls.testPressed(\"closeall\")) {\n                if (inventory.isOpen()) {\n                    inventory.close();\n                }\n\n                if (character.isOpen()) {\n                    character.close();\n                }\n            } else if (controls.testPressed(\"pause\")) {\n                engine.setEventHandler(new PauseMenuEventHandler());\n            } else if (controls.testPressed(\"quicksave\", 1000)) {\n                engine.save(\"quicksave\");\n            } else if (controls.testPressed(\"quickload\", 1000)) {\n                engine.load(\"quicksave\");\n            } else if (engine.settings.debugControlsEnabled) {\n                if (controls.testPressed(\"debug\")) {\n                    engine.gameMap.reveal();\n                    engine.needsMapUpdate = true;\n                    engine.setEventHandler(new EditorEventHandler());\n                } else if (controls.testPressed(\"debug2\")) {\n                    engine.clearMaps();\n                    engine.setMap(new TutorialMap());\n                } else if (controls.testPressed(\"reset\")) {\n                    engine.clearMaps();\n                    engine.setMap(new BasicDungeon(100, 100));\n                }\n            }\n        }\n\n        return action;\n    }\n\n    onMouseMove(e) {\n        const target = e.target;\n        this.mouse.x = (e.clientX / sceneState.canvasDom.offsetWidth) * 2 - 1;\n        this.mouse.y = -(e.clientY / sceneState.canvasDom.offsetHeight) * 2 + 1;\n\n        this.raycaster.setFromCamera(this.mouse, sceneState.camera);\n\n        const intersects = this.raycaster.intersectObject(sceneState.scene, true);\n\n        let anyFound = false;\n        for (let i = 0; i < intersects.length; i++) {\n            const object = intersects[i].object;\n            const parentEntity = object.parentEntity;\n            if (parentEntity && parentEntity instanceof Tile) {\n                const parentPosition = parentEntity.getComponent(\"positionalobject\");\n                if (parentPosition) {\n                    // Skip invisible/unseen items\n                    if (parentPosition.transparency === 0 || !parentPosition.hasObject()) {\n                        continue;\n                    }\n\n                    if (!this.isHighlighted(parentEntity)) {\n                        this.clearAndSetHighlight(parentEntity);\n                    }\n\n                    anyFound = true;\n                    break;\n                }\n            }\n        }\n\n        if (!anyFound) {\n            this.clearHighlights(true);\n        }\n\n        if (this.attemptToDrag) {\n            this.dragDistance = Math.max(Math.abs(this.dragStart.x - e.clientX), Math.abs(this.dragStart.y - e.clientY));\n\n            if (this.dragDistance > 10) {\n                this.attemptToDrag = false;\n                this.startDragging();\n            }\n        }\n\n        if (this.isDragging) {\n            inventory.itemDragDom.style.left = (e.clientX + this.dragOffset.x) + \"px\";\n            inventory.itemDragDom.style.top = (e.clientY + this.dragOffset.y) + \"px\";\n        }\n\n        if (this.attemptToDrag || this.isDragging) {\n            this.hoveringOver = null;\n        } else {\n            const isSlot = target.classList.contains(\"slot\");\n            if (isSlot && target.classList.contains(\"has-item\")) {\n                if (target !== this.hoveringOver) {\n                    this.hoveringOver = e.target;\n                    const details = target.getElementsByClassName(\"item__details\")[0];\n                    const clone = details.cloneNode(true);\n\n                    inventory.itemTooltipDom.innerHTML = \"\";\n                    inventory.itemTooltipDom.appendChild(clone);\n\n                    this.updateToolTipSize(e);\n                    inventory.itemTooltipDom.classList.add(\"active\");\n                } else {\n                    this.updateToolTipSize(e);\n                }\n            } else {\n                this.hideItemTooltip();\n            }\n        }\n\n        engine.needsMapUpdate = true;\n    }\n\n    startDragging() {\n        this.isDragging = true;\n\n        this.slotDragging.classList.add(\"dragging\");\n        inventory.itemDragDom.classList.add(\"active\");\n        this.hideItemTooltip();\n    }\n\n    updateToolTipSize(e) {\n        const tooltipRect = inventory.itemTooltipDom.getBoundingClientRect();\n        inventory.itemTooltipDom.style.left = (e.clientX - tooltipRect.width - 25) + \"px\";\n        inventory.itemTooltipDom.style.top = (e.clientY - (tooltipRect.height / 2)) + \"px\";\n    }\n\n    hideItemTooltip() {\n        this.hoveringOver = null;\n        inventory.itemTooltipDom.classList.remove(\"active\");\n    }\n\n    onLeftClick(e) {\n        if (this.isDragging) {\n            this.isDragging = false;\n        } else {\n            const target = e.target;\n            const classList = target.classList;\n            if (classList.contains(\"has-item\")) {\n                const sourceSlot = target.getAttribute(\"data-index\");\n                let sourceItem;\n                if (classList.contains(\"inventory__storage-slot\")) {\n                    const sourceStorage = target.parentNode.getAttribute(\"data-index\");\n                    const sourceStorageItem = inventory.openStorages[sourceStorage];\n                    const sourceStorageEquippable = sourceStorageItem.getComponent(\"equippable\");\n                    sourceItem = sourceStorageEquippable.storage[sourceSlot];\n                } else if (classList.contains(\"belt-slot\")) {\n                    const sourceSlot = target.getAttribute(\"data-index\");\n                    const playerEquipment = engine.player.getComponent(\"equipment\");\n                    if (playerEquipment) {\n                        const beltItem = playerEquipment.getItem(7);\n                        if (beltItem) {\n                            const beltEquippable = beltItem.getComponent(\"equippable\");\n                            sourceItem = beltEquippable.storage[sourceSlot];\n                        }\n                    }\n                }\n\n                if (sourceItem) {\n                    const consumable = sourceItem.getComponent(\"consumable\");\n                    if (consumable) {\n                        this.hideItemTooltip();\n                        if (engine.processAction(consumable.getAction())) {\n                            inventory.populateInventory(engine.player);\n                        }\n                    }\n                }\n            } else if (classList.contains(\"stat__level\")) {\n                const level = engine.player.getComponent(\"level\");\n                if (level.statPointsAvailable > 0) {\n                    const fighter = engine.player.getComponent(\"fighter\");\n                    const parentClasses = target.parentNode.classList;\n                    if (parentClasses.contains(\"stat--strength\")) {\n                        fighter.baseStrength += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                    } else if (parentClasses.contains(\"stat--agility\")) {\n                        fighter.baseAgility += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                    } else if (parentClasses.contains(\"stat--constitution\")) {\n                        fighter.baseConstitution += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                        characterHealth.update(fighter.hp, fighter.maxHp);\n                    } else if (parentClasses.contains(\"stat--wisdom\")) {\n                        fighter.baseWisdom += 1;\n                        fighter.recalculateStats();\n                        level.useStatPoint();\n                        characterMana.update(fighter.mana, fighter.maxMana);\n                    }\n                }\n            } else if (classList.contains(\"hotbar__open-inventory\")) {\n                inventory.toggle();\n            } else if (classList.contains(\"hotbar__open-character\")) {\n                character.toggle();\n            } else if (classList.contains(\"hotbar__open-skill\")) {\n                //skills.toggle();\n            }\n        }\n    }\n\n    onMouseDown(e) {\n        const target = e.target;\n        const isSlot = target.classList.contains(\"slot\") && !target.classList.contains(\"belt-slot\");\n        if (isSlot && target.classList.contains(\"has-item\")) {\n            // Handle adding gold to inventory\n            if (target.classList.contains(\"pickup-slot\")) {\n                const index = target.getAttribute(\"data-index\");\n                const item = inventory.itemsOnGround[index];\n                if (item) {\n                    const playerInventory = engine.player.getComponent(\"inventory\");\n                    if (playerInventory.add(item)) {\n                        engine.gameMap.removeItem(item);\n                        item.getComponent(\"positionalobject\").teardown();\n                        engine.fov.remove(item);\n                        inventory.populateInventory(engine.player);\n                        engine.needsMapUpdate = true;\n                        return;\n                    }\n                }\n            }\n\n            this.slotDragging = target;\n            document.body.classList.add(\"disable-select\");\n\n            const targetRect = target.getBoundingClientRect();\n            this.dragStart = new Vector2(e.clientX, e.clientY);\n            this.attemptToDrag = true;\n\n            this.dragOffset = new Vector2(targetRect.left - e.clientX, targetRect.top - e.clientY);\n\n            const item = target.getElementsByClassName(\"item\")[0];\n            const clone = item.cloneNode(true);\n\n            inventory.itemDragDom.innerHTML = \"\";\n            inventory.itemDragDom.appendChild(clone);\n            inventory.itemDragDom.style.width = targetRect.width + \"px\";\n            inventory.itemDragDom.style.height = targetRect.height + \"px\";\n            inventory.itemDragDom.style.left = (e.clientX + this.dragOffset.x) + \"px\";\n            inventory.itemDragDom.style.top = (e.clientY + this.dragOffset.y) + \"px\";\n        }\n    }\n\n    onMouseUp(e) {\n        this.attemptToDrag = false;\n        document.body.classList.remove(\"disable-select\");\n\n        if (this.isDragging) {\n            this.slotDragging.classList.remove(\"dragging\");\n            inventory.itemDragDom.classList.remove(\"active\");\n\n            const playerEquipment = engine.player.getComponent(\"equipment\");\n\n            const target = e.target;\n            const sourceIsGround = this.slotDragging.classList.contains(\"pickup-slot\");\n            const sourceIsInventorySlot = this.slotDragging.classList.contains(\"inventory__storage-slot\");\n            const sourceIsEquipmentSlot = this.slotDragging.classList.contains(\"inventory__equipment-slot\");\n            const targetIsGround = target.classList.contains(\"pickup-slot\");\n            const targetIsInventorySlot = target.classList.contains(\"inventory__storage-slot\");\n            const targetIsEquipmentSlot = target.classList.contains(\"inventory__equipment-slot\");\n\n            const sourceSlot = this.slotDragging.getAttribute(\"data-index\");\n            const targetSlot = target.getAttribute(\"data-index\");\n            if ((targetIsGround || targetIsInventorySlot || targetIsEquipmentSlot) && !target.classList.contains(\"disabled\")) {\n                if (sourceIsGround) {\n                    const sourceItem = inventory.itemsOnGround[sourceSlot];\n                    if (targetIsEquipmentSlot) {\n                        const fromEquippable = sourceItem.getComponent(\"equippable\");\n                        if (fromEquippable && fromEquippable.slot === playerEquipment.items[targetSlot].slot) {\n                            const targetItem = playerEquipment.getItem(targetSlot);\n                            if (targetItem) {\n                                engine.processAction(new DropFromEquipmentAction(engine.player, targetItem));\n                            }\n\n                            playerEquipment.setItem(targetSlot, sourceItem);\n                            sourceItem.parentEntity = playerEquipment;\n                            engine.gameMap.removeItem(sourceItem);\n                            sourceItem.getComponent(\"positionalobject\").teardown();\n                            engine.fov.remove(sourceItem);\n                            engine.needsMapUpdate = true;\n\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                            engine.player.callEvent(\"onEquipmentChange\");\n                        }\n                    } else if (targetIsInventorySlot) {\n                        const targetStorage = target.parentNode.getAttribute(\"data-index\");\n                        const storageItem = inventory.openStorages[targetStorage];\n                        const storageEquippable = storageItem.getComponent(\"equippable\");\n                        const targetItem = storageEquippable.storage[targetSlot];\n                        if (targetItem) {\n                            storageEquippable.drop(targetItem);\n                        }\n\n                        storageEquippable.setItem(targetSlot, sourceItem);\n                        sourceItem.parentEntity = storageEquippable;\n                        engine.gameMap.removeItem(sourceItem);\n                        sourceItem.getComponent(\"positionalobject\").teardown();\n                        engine.fov.remove(sourceItem);\n                        engine.needsMapUpdate = true;\n\n                        inventory.populateInventory(engine.player);\n                        bottomContainer.updateBeltSlots();\n                    }\n                } else if (sourceIsEquipmentSlot) {\n                    const sourceItem = playerEquipment.getItem(sourceSlot);\n                    if (targetIsEquipmentSlot) {\n                        if (targetSlot !== sourceSlot && playerEquipment.items[targetSlot].slot === playerEquipment.items[sourceSlot].slot) {\n                            playerEquipment.move(sourceSlot, targetSlot);\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                            engine.player.callEvent(\"onEquipmentChange\");\n                        }\n                    } else if (targetIsInventorySlot) {\n                        const targetStorage = target.parentNode.getAttribute(\"data-index\");\n                        const storageItem = inventory.openStorages[targetStorage];\n\n                        if (sourceItem === storageItem) {\n                            messageConsole.text(\"You can't put \" + sourceItem.name + \" inside itself!\").build();\n                            return;\n                        }\n\n                        const storageEquippable = storageItem.getComponent(\"equippable\");\n                        const targetItem = storageEquippable.storage[targetSlot];\n                        if (targetItem) {\n                            const fromEquippable = sourceItem.getComponent(\"equippable\");\n                            // Invalid slot\n                            if (fromEquippable && fromEquippable.slot !== playerEquipment.items[targetSlot].slot) {\n                                return;\n                            }\n                        }\n\n                        playerEquipment.setItem(sourceSlot, targetItem);\n                        storageEquippable.setItem(targetSlot, sourceItem);\n                        sourceItem.parentEntity = playerEquipment;\n\n                        inventory.populateInventory(engine.player);\n                        bottomContainer.updateBeltSlots();\n                        engine.player.callEvent(\"onEquipmentChange\");\n                    } else if (targetIsGround) {\n                        engine.processAction(new DropFromEquipmentAction(engine.player, sourceItem));\n                        bottomContainer.updateBeltSlots();\n                        engine.player.callEvent(\"onEquipmentChange\");\n                    }\n                } else if (sourceIsInventorySlot) {\n                    const sourceStorage = this.slotDragging.parentNode.getAttribute(\"data-index\");\n                    const sourceStorageItem = inventory.openStorages[sourceStorage];\n                    const sourceStorageEquippable = sourceStorageItem.getComponent(\"equippable\");\n                    const sourceItem = sourceStorageEquippable.storage[sourceSlot];\n\n                    if (targetIsEquipmentSlot) {\n                        const fromEquippable = sourceItem.getComponent(\"equippable\");\n                        if (fromEquippable && fromEquippable.slot === playerEquipment.items[targetSlot].slot) {\n                            const targetItem = playerEquipment.getItem(targetSlot);\n\n                            let parent = sourceItem.parentEntity;\n                            while(parent) {\n                                if (parent === targetItem) {\n                                    messageConsole.text(\"You can't equip a container from within its parent. Consider moving it elsewhere first.\").build();\n                                    return;\n                                }\n                                parent = parent.parentEntity;\n                            }\n                            playerEquipment.setItem(targetSlot, sourceItem);\n                            sourceStorageEquippable.setItem(sourceSlot, targetItem);\n                            sourceItem.parentEntity = playerEquipment;\n\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                            engine.player.callEvent(\"onEquipmentChange\");\n                        }\n                    } else if (targetIsInventorySlot) {\n                        const targetStorage = target.parentNode.getAttribute(\"data-index\");\n                        const targetStorageItem = inventory.openStorages[targetStorage];\n\n                        if (sourceStorageItem === targetStorageItem) {\n                            sourceStorageEquippable.move(sourceSlot, targetSlot);\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                        } else {\n                            const targetStorageEquippable = targetStorageItem.getComponent(\"equippable\");\n                            const targetItem = targetStorageEquippable.storage[targetSlot];\n\n                            sourceStorageEquippable.setItem(sourceSlot, targetItem);\n                            if (targetItem) {\n                                targetItem.parentEntity = sourceStorageEquippable;\n                            }\n                            targetStorageEquippable.setItem(targetSlot, sourceItem);\n                            sourceItem.parentEntity = targetStorageEquippable;\n                            inventory.populateInventory(engine.player);\n                            bottomContainer.updateBeltSlots();\n                        }\n                    } else if (targetIsGround) {\n                        sourceStorageEquippable.drop(sourceItem);\n                        bottomContainer.updateBeltSlots();\n                    }\n                }\n            } else if (target.tagName === \"CANVAS\") {\n                if (sourceIsInventorySlot) {\n                    const sourceStorage = this.slotDragging.parentNode.getAttribute(\"data-index\");\n                    const sourceStorageItem = inventory.openStorages[sourceStorage];\n                    const sourceStorageEquippable = sourceStorageItem.getComponent(\"equippable\");\n                    const sourceItem = sourceStorageEquippable.storage[sourceSlot];\n\n                    sourceStorageEquippable.drop(sourceItem);\n                } else if (sourceIsEquipmentSlot) {\n                    engine.processAction(new DropFromEquipmentAction(engine.player, playerEquipment.getItem(sourceSlot)));\n                }\n            }\n        }\n    }\n}","import html from '../../../html/menu/MainMenu.html';\nimport UIElement from \"../UIElement\";\n\nclass MainMenu extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst mainMenu = new MainMenu();\nexport default mainMenu;","import RectangularRoom from \"./RectangularRoom\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport {MathUtils} from \"three\";\nimport engine from \"../../Engine\";\n\nexport default class Shop extends RectangularRoom {\n    constructor(x, y, width, height) {\n        super(x, y, width, height);\n    }\n\n    createRoom(gameMap) {\n        this.walls = [];\n        const left = Math.max(0, this.x1);\n        const right = Math.min(gameMap.width, this.x2 + 1);\n        const top = Math.max(0, this.y1);\n        const bottom = Math.min(gameMap.height, this.y2 + 1);\n\n        for (let i = left; i < right; i++) {\n            for (let j = top; j < bottom; j++) {\n                const previousFloorTile = gameMap.tiles.get(0)[i][j];\n                if (!previousFloorTile) {\n                    gameMap.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n                    gameMap.tiles.get(0)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                }\n\n                const isVerticalEdge = (i === this.x1 || i === this.x2) && j >= this.y1 && j <= this.y2;\n                const isHorizontalEdge = (j === this.y1 || j === this.y2) && i >= this.x1 && i <= this.x2;\n                const wallTile = gameMap.tiles.get(1)[i][j];\n                if (isHorizontalEdge || isVerticalEdge) {\n                    if (!previousFloorTile && !wallTile) {\n                        gameMap.tiles.get(1)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        gameMap.tiles.get(2)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 2}}});\n\n                        let isCorner = isHorizontalEdge && isVerticalEdge;\n                        if (!isCorner) {\n                            this.walls.push(gameMap.tiles.get(1)[i][j]);\n                        }\n                    }\n                } else {\n                    if (wallTile) {\n                        gameMap.tiles.get(1)[i][j] = null;\n                    }\n                }\n            }\n        }\n\n        let randWall = MathUtils.randInt(0, this.walls.length - 1);\n        const wall = this.walls[randWall];\n        const position = wall.getComponent(\"positionalobject\");\n\n        gameMap.tiles.get(1)[position.x][position.y] = entityLoader.createFromTemplate('door', {components: {positionalobject: {x: position.x, y: position.y, z: 1}}});\n\n        const x = MathUtils.randInt(this.x1 + 1, this.x2 - 1);\n        const y = MathUtils.randInt(this.y1 + 1, this.y2 - 1);\n        const npc = entityLoader.createFromTemplate('shop_owner', {components: {positionalobject: {x: x, y: y, z: 1}}});\n        engine.gameMap.actors.push(npc);\n    }\n}","import RectangularRoom from \"./RectangularRoom\";\nimport entityLoader from \"../../entity/EntityLoader\";\nimport {MathUtils} from \"three\";\nimport engine from \"../../Engine\";\n\nexport default class Forge extends RectangularRoom {\n    constructor(x, y, width, height) {\n        super(x, y, width, height);\n    }\n\n    createRoom(gameMap) {\n        this.walls = [];\n        const left = Math.max(0, this.x1);\n        const right = Math.min(gameMap.width, this.x2 + 1);\n        const top = Math.max(0, this.y1);\n        const bottom = Math.min(gameMap.height, this.y2 + 1);\n\n        for (let i = left; i < right; i++) {\n            for (let j = top; j < bottom; j++) {\n                const isRightHalf = i > this.x1 + (this.width / 2);\n                const isBottomHalf = j < this.y1 + (this.height / 2);\n                const previousFloorTile = gameMap.tiles.get(0)[i][j];\n                if (!previousFloorTile) {\n                    gameMap.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n\n                    if (isRightHalf || isBottomHalf) {\n                        gameMap.tiles.get(0)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                    } else {\n                        gameMap.tiles.get(0)[i][j] = entityLoader.createFromTemplate('floor_gravel', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                    }\n                }\n\n                const isVerticalEdge = (i === this.x1 || i === this.x2) && j >= this.y1 && j <= this.y2;\n                const isHorizontalEdge = (j === this.y1 || j === this.y2) && i >= this.x1 && i <= this.x2;\n                const wallTile = gameMap.tiles.get(1)[i][j];\n                if (isHorizontalEdge || isVerticalEdge) {\n                    if (!previousFloorTile && !wallTile) {\n                        if (isRightHalf || isBottomHalf) {\n                            gameMap.tiles.get(1)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                            gameMap.tiles.get(2)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 2}}});\n\n                            let isCorner = isHorizontalEdge && isVerticalEdge;\n                            if (!isCorner) {\n                                this.walls.push(gameMap.tiles.get(1)[i][j]);\n                            }\n                        }\n                    }\n                } else {\n                    if (wallTile) {\n                        gameMap.tiles.get(1)[i][j] = null;\n                    }\n                }\n            }\n        }\n\n        const x = MathUtils.randInt(this.x1 + 1, this.x2 - 1);\n        const y = MathUtils.randInt(this.y1 + 1, this.y2 - 1);\n        const npc = entityLoader.createFromTemplate('shop_owner', {components: {positionalobject: {x: x, y: y, z: 1}}});\n        engine.gameMap.actors.push(npc);\n    }\n}","import GameMap from \"./GameMap\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport MapLayer from \"./MapLayer\";\nimport Shop from \"./room/Shop\";\nimport ArrayUtil from \"../util/ArrayUtil\";\nimport {MathUtils} from \"three\";\nimport Forge from \"./room/Forge\";\n\nexport default class Town extends GameMap {\n    constructor() {\n        super(\"town\", 65, 70);\n    }\n\n    init() {\n        this.tiles = new Map();\n        for (let i = -1; i < 10; i++) {\n            this.tiles.set(i, ArrayUtil.create2dArray(this.width));\n        }\n\n        this.actors = [];\n        this.items = [];\n    }\n\n    create() {\n        super.create();\n\n        const shop1 = new Shop(18, 28, 6, 8);\n        shop1.createRoom(this);\n\n        const shop2 = new Shop(16, 40, 7, 7);\n        shop2.createRoom(this);\n\n        const shop3 = new Shop(35, 48, 10, 6);\n        shop3.createRoom(this);\n\n        const shop4 = new Shop(40, 41, 5, 7);\n        shop4.createRoom(this);\n\n        const shop5 = new Forge(37, 26, 10, 10);\n        shop5.createRoom(this);\n\n        let jStart = 10;\n        let jEnd = 15;\n        for (let i = 5; i < this.width - 5; i++) {\n            const jStartRandom = Math.random();\n            if (jStartRandom > .95) {\n                jStart -= 1;\n            } else if (jStartRandom > .9) {\n                jStart += 1;\n            }\n\n\n            const jEndRandom = Math.random();\n            if (jEndRandom > .95) {\n                jEnd -= 1;\n            } else if (jEndRandom > .9) {\n                jEnd += 1;\n            }\n\n            if (jEnd < jStart + 2) {\n                jEnd = jStart + 2;\n            }\n\n            if (jEnd > jStart + 6) {\n                jEnd = jStart + 6;\n            }\n\n            for (let j = jStart; j <= jEnd; j++) {\n                this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n                this.tiles.get(0)[i][j] = entityLoader.createFromTemplate('water', {components: {positionalobject: {x: i, y: j, z: 0}}});\n            }\n        }\n\n        // Fill rest of floors\n        for (let j = 5; j < this.height - 5; j++) {\n            for (let i = 5; i < this.width - 5; i++) {\n                if (i === 44 && j >= 33 && j <= 35) {\n                    this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('table', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                }\n\n                if ((i === 37 && j === 36) || ((i === 42 && j === 31))) {\n                    this.tiles.get(1)[i][j] = entityLoader.createFromTemplate('post', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    this.tiles.get(2)[i][j] = entityLoader.createFromTemplate('post', {components: {positionalobject: {x: i, y: j, z: 2}}});\n                }\n\n                const floorTile = this.tiles.get(MapLayer.Floor)[i][j];\n                if (!floorTile) {\n                    this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n\n                    if (i === 31 && j === 31) {\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate(\"stairs_north\", {components: {positionalobject: {x: i, y: j, z: 0}, stairsInteractable: {generator: \"basic-dungeon\"}}});\n                    } else {\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate('floor_grass', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                    }\n\n                    if (i === 29 && j >= 35 && j <= 39) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('fence_vertical', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 32 && j === 41) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('well', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        this.tiles.get(2)[i][j] = entityLoader.createFromTemplate('well_top', {components: {positionalobject: {x: i, y: j, z: 2}}});\n                    } else if ((i === 36 || i === 37) && j === 47) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('barrel', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 19 && j === 17) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('bench_south', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 20 && j === 17) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('bench_south_left', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i === 18 && j === 17) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('bench_south_right', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else if (i > 17 && i < 21 && j === 20) {\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('bench_stone', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                    } else {\n                        const floor = this.tiles.get(MapLayer.Floor)[i][j];\n                        if (floor.components.walkable && floor.components.walkable.walkable) {\n                            if (Math.random() < .01) {\n                                this.createTree(i, j);\n                            } else if (Math.random() < .05) {\n                                this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('stone', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                            } else {\n                                if (Math.random() < .3) {\n                                    const randomGrass = MathUtils.randInt(1, 4);\n                                    this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('grass' + randomGrass, {components: {positionalobject: {x: i, y: j, z: 1}}});\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        this.addPlayer(33, 36);\n    }\n\n    createTree(x, y) {\n        for (let z = 1; z <= 8; z++) {\n            this.tiles.get(z)[x][y] = entityLoader.createFromTemplate('tree_trunk', {components: {positionalobject: {x: x, y: y, z: z}}});\n        }\n\n        for (let z = 5; z < 10; z++) {\n            for (let i = -2; i <= 2; i++) {\n                for (let j = -2; j <= 2; j++) {\n                    if (i !== 0 || j !== 0) {\n                        const absI = Math.abs(i);\n                        const absJ = Math.abs(j);\n                        if ((absI === 2 || absJ === 2)) {\n                            // Skip corners\n                            if (absI === 2 && absJ === 2) {\n                                continue;\n                            }\n\n                            // Skip top and bottom outsides\n                            if ((z === 5 || z === 9)) {\n                                continue;\n                            }\n\n                            // Skip some leaves\n                            if (Math.random() < .1) {\n                                continue;\n                            }\n                        }\n\n                        if (this.tiles.get(z)[x+i]) {\n                            this.tiles.get(z)[x+i][y+j] = entityLoader.createFromTemplate('tree_leaves', {components: {positionalobject: {x: x+i, y: y+j, z: z}}});\n                        }\n                    }\n                }\n            }\n        }\n\n        this.tiles.get(9)[x][y] = entityLoader.createFromTemplate('tree_leaves', {components: {positionalobject: {x: x, y: y, z: 9}}});\n    }\n}","import EventHandler from \"./_EventHandler\";\nimport DefaultPlayerEventHandler from \"./DefaultPlayerEventHandler\";\nimport engine from \"../Engine\";\nimport BasicDungeon from \"../map/BasicDungeon\";\nimport messageConsole from \"../ui/MessageConsole\";\nimport mainMenu from \"../ui/menu/MainMenu\";\nimport LoadGameMenuEventHandler from \"./LoadGameMenuEventHandler\";\nimport ControlsMenuEventHandler from \"./ControlsMenuEventHandler\";\nimport SettingsMenuEventHandler from \"./SettingsMenuEventHandler\";\nimport CreditsMenuEventsHandler from \"./CreditsMenuEventsHandler\";\nimport Town from \"../map/Town\";\n\nexport default class MainMenuEventHandler extends EventHandler {\n    constructor() {\n        super();\n\n        mainMenu.open();\n    }\n\n    teardown() {\n        super.teardown();\n\n        mainMenu.close();\n    }\n\n    onLeftClick(e) {\n        const target = e.target;\n        const id = target.id;\n\n        switch(id) {\n            case \"mainmenu__newgame\":\n                this.startNewGame();\n                break;\n            case \"mainmenu__loadgame\":\n                this.openLoadGameMenu();\n                break;\n            case \"mainmenu__controls\":\n                this.openControlsMenu();\n                break;\n            case \"mainmenu__settings\":\n                this.openSettingsMenu();\n                break;\n            case \"mainmenu__credits\":\n                this.openCreditsMenu();\n                break;\n            default:\n                break;\n        }\n    }\n\n    startNewGame() {\n        engine.clearMaps();\n        engine.setMap(new Town());\n        engine.gameMap.reveal();\n        engine.setEventHandler(new DefaultPlayerEventHandler());\n        messageConsole.clear();\n        messageConsole.text(\"Welcome adventurer!\").build();\n    }\n\n    openLoadGameMenu() {\n        engine.setEventHandler(new LoadGameMenuEventHandler(this));\n    }\n\n    openControlsMenu() {\n        engine.setEventHandler(new ControlsMenuEventHandler(this));\n    }\n\n    openSettingsMenu() {\n        engine.setEventHandler(new SettingsMenuEventHandler(this));\n    }\n\n    openCreditsMenu() {\n        engine.setEventHandler(new CreditsMenuEventsHandler(this));\n    }\n}","import BasicDungeon from \"./BasicDungeon\";\n\nexport default class MapLoader {\n    constructor() {}\n\n    loadMap(mapType, args = {}) {\n        switch(mapType) {\n            case \"basic-dungeon\":\n                return new BasicDungeon(100, 100, args);\n            default:\n                return null;\n        }\n    }\n}","import UnableToPerformAction from \"./actions/UnableToPerformAction\";\r\nimport sceneState from \"./SceneState\";\r\nimport AdamMilazzoFov from \"./map/fov/AdamMilazzoFov\";\r\nimport SimpleFov from \"./map/fov/SimpleFov\";\r\nimport messageConsole from \"./ui/MessageConsole\";\r\nimport NoAction from \"./actions/NoAction\";\r\nimport MainMenuEventHandler from \"./event/MainMenuEventHandler\";\r\nimport Settings from \"./settings/Settings\";\r\nimport saveManager from \"./SaveManager\";\r\nimport GameMap from \"./map/GameMap\";\r\nimport MapLoader from \"./map/MapLoader\";\r\n\r\nclass Engine {\r\n    constructor() {\r\n        this.eventHandler = new MainMenuEventHandler();\r\n        this.settings = new Settings();\r\n        this.player = null;\r\n        this.gameMap = null;\r\n        this.gameMaps = new Map();\r\n        this.mapLoader = new MapLoader();\r\n        this.needsMapUpdate = false;\r\n        this.fov = new AdamMilazzoFov();\r\n        this.airFov = new SimpleFov();\r\n    }\r\n\r\n    setEventHandler(eventHandler) {\r\n        if (this.eventHandler) {\r\n            this.eventHandler.teardown();\r\n        }\r\n\r\n        this.eventHandler = eventHandler;\r\n    }\r\n\r\n    handleEvents() {\r\n        this.processAction(this.eventHandler.handleInput());\r\n    }\r\n\r\n    processAction(action) {\r\n        if (action != null && this.eventHandler.isPlayerTurn) {\r\n            const performedAction = action.perform();\r\n            if (performedAction instanceof NoAction) {\r\n                return false;\r\n            }\r\n\r\n            if (performedAction instanceof UnableToPerformAction) {\r\n                if (performedAction.reason) {\r\n                    messageConsole.text(performedAction.reason).build();\r\n                }\r\n                return false;\r\n            } else {\r\n                sceneState.updateCameraPosition(engine.player);\r\n\r\n                engine.gameMap.updatePlayerUI();\r\n                engine.needsMapUpdate = true;\r\n\r\n                this.handleEnemyTurns();\r\n\r\n                saveManager.autosave();\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    handleEnemyTurns() {\r\n        this.eventHandler.isPlayerTurn = false;\r\n        for (const actor of this.gameMap.actors) {\r\n            if (actor !== this.player) {\r\n                const ai = actor.getComponent(\"ai\");\r\n                if (ai) {\r\n                    ai.perform();\r\n                }\r\n            }\r\n        }\r\n        this.eventHandler.isPlayerTurn = true;\r\n    }\r\n\r\n    setMap(map, stairsInteractable) {\r\n        if (this.gameMap === map) {\r\n            return;\r\n        }\r\n\r\n        let previousMapName = null;\r\n        if (this.gameMap) {\r\n            previousMapName = this.gameMap.name;\r\n            this.gameMap.teardown();\r\n            const playerIndex = this.gameMap.actors.indexOf(this.player);\r\n            this.gameMap.actors.splice(playerIndex, 1);\r\n            this.gameMap.save();\r\n        }\r\n\r\n        this.gameMap = map;\r\n        this.addMap(map, previousMapName, stairsInteractable);\r\n        map.save();\r\n        if (this.gameMap.actors.indexOf(this.player) === -1) {\r\n            this.gameMap.actors.push(this.player);\r\n        }\r\n\r\n        const positionalObject = this.player.getComponent(\"positionalobject\");\r\n        positionalObject.setVisible();\r\n        sceneState.updateCameraPosition(this.player);\r\n        this.gameMap.revealPreviouslyExplored();\r\n        this.gameMap.updatePlayerUI();\r\n        this.needsMapUpdate = true;\r\n    }\r\n\r\n    addMap(map, previousMapName, stairsInteractable) {\r\n        if (!this.gameMaps.has(map.name)) {\r\n            this.gameMaps.set(map.name, map);\r\n            map.create(previousMapName, stairsInteractable);\r\n        }\r\n    }\r\n\r\n    clearMaps() {\r\n        this.player = null;\r\n        this.gameMaps = new Map();\r\n    }\r\n\r\n    save(name) {\r\n        const maps = [];\r\n        for (const map of this.gameMaps.values()) {\r\n            maps.push(map.save());\r\n        }\r\n\r\n        let saveJson = {\r\n            \"name\": name,\r\n            \"date\": new Date(),\r\n            \"currentMap\": this.gameMap.name,\r\n            \"maps\": maps\r\n        };\r\n\r\n        localStorage.setItem(name, JSON.stringify(saveJson));\r\n    }\r\n\r\n    load(name) {\r\n        this.clearMaps();\r\n        const loadData = localStorage.getItem(name);\r\n        if (loadData) {\r\n            const json = JSON.parse(loadData);\r\n            const currentMap = json.currentMap;\r\n            for (const map of json.maps) {\r\n                const newMap = new GameMap(map.name, map.width, map.height);\r\n                newMap.load(map);\r\n                this.addMap(newMap);\r\n\r\n                if (newMap.name === currentMap) {\r\n                    for (const actor of newMap.actors) {\r\n                        if (actor.name === 'Player') {\r\n                            this.player = actor;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    this.setMap(newMap);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst engine = new Engine();\r\nexport default engine;","import html from '../../../html/ui/editor/EditorLayer.html';\nimport UIElement from \"../UIElement\";\n\nclass EditorLayer extends UIElement{\n    constructor() {\n        super(html);\n    }\n}\n\nconst editorLayer = new EditorLayer();\nexport default editorLayer;","import html from '../../../html/ui/editor/EditorPaint.html';\nimport UIElement from \"../UIElement\";\n\nclass EditorPaint extends UIElement {\n    constructor() {\n        super(html);\n    }\n}\n\nconst editorPaint = new EditorPaint();\nexport default editorPaint;","import * as THREE from \"three\";\r\nimport Stats from \"stats.js\";\r\nimport engine from \"./Engine\";\r\nimport messageConsole from \"./ui/MessageConsole\";\r\nimport details from \"./ui/Details\";\r\nimport inventory from \"./ui/Inventory\";\r\nimport editorControls from \"./ui/editor/EditorControls\";\r\nimport editorLayer from \"./ui/editor/EditorLayer\";\r\nimport editorInfo from \"./ui/editor/EditorInfo\";\r\nimport editorPaint from \"./ui/editor/EditorPaint\";\r\nimport mainMenu from \"./ui/menu/MainMenu\";\r\nimport controlsMenu from \"./ui/menu/ControlsMenu\";\r\nimport creditsMenu from \"./ui/menu/CreditsMenu\";\r\nimport gameOverMenu from \"./ui/menu/GameOverMenu\";\r\nimport loadGameMenu from \"./ui/menu/LoadGameMenu\";\r\nimport saveGameMenu from \"./ui/menu/SaveGameMenu\";\r\nimport settingsMenu from \"./ui/menu/SettingsMenu\";\r\nimport pauseMenu from \"./ui/menu/PauseMenu\";\r\nimport character from \"./ui/Character\";\r\nimport bottomContainer from \"./ui/BottomContainer\";\r\n\r\nclass SceneState {\r\n    constructor() {\r\n        this.scene = new THREE.Scene();\r\n\r\n        this.setupGameHtml();\r\n\r\n        this.setupLights();\r\n        this.updateCamera();\r\n\r\n        window.addEventListener( 'resize', this);\r\n    }\r\n\r\n    setupGameHtml() {\r\n        const gameDom = document.createElement(\"div\");\r\n        gameDom.classList.add(\"game\");\r\n\r\n        this.canvasDom = document.createElement(\"div\");\r\n        this.canvasDom.classList.add(\"view\");\r\n        gameDom.appendChild(this.canvasDom);\r\n        gameDom.appendChild(details.dom);\r\n        gameDom.appendChild(bottomContainer.dom);\r\n        gameDom.appendChild(messageConsole.dom);\r\n        gameDom.appendChild(inventory.dom);\r\n        gameDom.appendChild(character.dom);\r\n\r\n        gameDom.appendChild(editorControls.dom);\r\n        gameDom.appendChild(editorInfo.dom);\r\n        gameDom.appendChild(editorLayer.dom);\r\n        gameDom.appendChild(editorPaint.dom);\r\n\r\n        gameDom.appendChild(controlsMenu.dom);\r\n        gameDom.appendChild(creditsMenu.dom);\r\n        gameDom.appendChild(gameOverMenu.dom);\r\n        gameDom.appendChild(loadGameMenu.dom);\r\n        gameDom.appendChild(mainMenu.dom);\r\n        gameDom.appendChild(pauseMenu.dom);\r\n        gameDom.appendChild(saveGameMenu.dom);\r\n        gameDom.appendChild(settingsMenu.dom);\r\n\r\n        this.renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});\r\n        this.renderer.setClearColor(0xaaaaaa, 1);\r\n        this.canvasDom.appendChild(this.renderer.domElement);\r\n        document.body.appendChild(gameDom);\r\n\r\n        this.stats = new Stats();\r\n        this.stats.showPanel(0);\r\n        this.stats.dom.classList.add(\"ui\");\r\n        document.body.appendChild(this.stats.dom);\r\n        this.updateStatsVisibility(engine.settings);\r\n    }\r\n\r\n    handleEvent(e) {\r\n        switch(e.type) {\r\n            case \"resize\":\r\n                this.updateCamera();\r\n\r\n                if (this.player) {\r\n                    this.updateCameraPosition(this.player);\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    setupLights() {\r\n        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\r\n        this.scene.add(ambientLight);\r\n\r\n        const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n        dirLight.position.set(100, -300, 400);\r\n        this.scene.add(dirLight);\r\n    }\r\n\r\n    updateCamera() {\r\n        const aspectRatio = this.canvasDom.offsetWidth / this.canvasDom.offsetHeight;\r\n\r\n        const viewSize = 80;\r\n        const left = -aspectRatio * viewSize / 2\r\n        const right = aspectRatio * viewSize / 2;\r\n        const top = viewSize / 2;\r\n        const bottom = -viewSize / 2;\r\n        this.camera = new THREE.OrthographicCamera(left, right, top, bottom, -10000, 10000);\r\n        this.renderer.setSize(this.canvasDom.offsetWidth, this.canvasDom.offsetHeight);\r\n    }\r\n\r\n    updateCameraPosition(player, lookAt = player) {\r\n        this.player = player;\r\n        this.camera.up.set(0, 0, 1);\r\n        const positionalObject = lookAt.getComponent(\"positionalobject\");\r\n        if (positionalObject) {\r\n            const position = positionalObject.getObjectPosition();\r\n            this.camera.position.set(200 + position.x, -200 + position.y, 300);\r\n            this.camera.lookAt(position.x, position.y, 0);\r\n            engine.needsMapUpdate = true;\r\n        }\r\n    }\r\n\r\n    updateStatsVisibility(settings) {\r\n        if (settings.displayFPS) {\r\n            this.stats.dom.classList.add(\"active\");\r\n        } else {\r\n            this.stats.dom.classList.remove(\"active\");\r\n        }\r\n    }\r\n}\r\n\r\n\r\nconst sceneState = new SceneState();\r\nexport default sceneState;","import GameMap from \"./GameMap\";\nimport MapLayer from \"./MapLayer\";\nimport engine from \"../Engine\";\nimport entityLoader from \"../entity/EntityLoader\";\nimport ArrayUtil from \"../util/ArrayUtil\";\n\nexport default class MainMenuMap extends GameMap {\n    constructor() {\n        super(\"main-menu\", 35, 15);\n\n        this.floor = [\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"#####≈≈############################\",\n            \"#####≈≈############################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\",\n            \"###################################\"\n        ];\n\n        this.wall = [\n            \"###################################\",\n            \"###################################\",\n            \"####====###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"####=  =###########################\",\n            \"##===  =########################===\",\n            \"##=    =#################======#= >\",\n            \"##=    =#########=======#=    =#= =\",\n            \"##=    ===========     ===    === =\",\n            \"##=                    + +        =\",\n            \"##=       ==== ===     ===    =====\",\n            \"##=========##= =#=======#=    =####\",\n            \"#############= =#########======####\"\n        ];\n\n        this.overlay = [\n            \"###################################\",\n            \"########## RoguelikeDev ######v5_0#\",\n            \"###################################\",\n            \"############ does the ####2021#6-8#\",\n            \"###################################\",\n            \"### Complete Roguelike Tutorial ###\",\n            \"#####..############################\",\n            \"#####..############################\",\n            \"###....##########################.#\",\n            \"###....###################....###.#\",\n            \"###....###########.....###....###.#\",\n            \"###....................#.#........#\",\n            \"###.......####.###.....###....#####\",\n            \"##############.###########....#####\",\n            \"##############.####################\"\n        ];\n    }\n\n    init() {\n        super.init();\n\n        this.tiles.set(MapLayer.Decorative, ArrayUtil.create2dArray(this.width));\n    }\n\n    create() {\n        super.create();\n        const overlayColors = [\n            0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff, 0x66b2ff, 0x66d9ff, 0x66ffd9, 0x66ffb2, 0x66ff66, 0xb2ff66, 0xd9ff66, 0xffff66, 0xffd966, 0xffb266, 0xff8c66, 0xff668c, 0xff66b2, 0xff66d9, 0xff66ff, 0xd966ff, 0xb266ff, 0x8c66ff, 0x6666ff,\n            0x00ffbf, 0x00ff80, 0x00ff00, 0x80ff00, 0xffff00, 0xffbf00, 0xff8000, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333, 0x333333,\n            0x00a3d9, 0x00d9d9, 0x00d9a3, 0x00d96c, 0x00d900, 0x6cd900, 0xa3d900, 0xd9d900, 0xd9a300, 0xd96c00, 0xd93600, 0xd90000, 0x333333, 0x333333, 0x333333, 0x333333\n        ];\n        let overlayColorIndex = 0;\n        for (let j = 0; j < this.height; j++) {\n            for (let i = 0; i < this.width; i++) {\n                const floorChar = this.floor[this.height - j - 1].charAt(i);\n                switch(floorChar) {\n                    case \"#\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                    case \"≈\":\n                        this.tiles.get(-1)[i][j] = entityLoader.createFromTemplate('floor', {components: {positionalobject: {x: i, y: j, z: -1}}});\n                        this.tiles.get(MapLayer.Floor)[i][j] = entityLoader.createFromTemplate('water', {components: {positionalobject: {x: i, y: j, z: 0}}});\n                        break;\n                }\n\n                const wallChar = this.wall[this.height - j - 1].charAt(i);\n                switch(wallChar) {\n                    case \"#\":\n                    case \"=\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('wall', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \"+\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('door', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                    case \">\":\n                        this.tiles.get(MapLayer.Wall)[i][j] = entityLoader.createFromTemplate('stairs_north', {components: {positionalobject: {x: i, y: j, z: 1}}});\n                        break;\n                }\n\n                let overlayChar = this.overlay[this.height - j - 1].charAt(i);\n                if (overlayChar !== \"#\") {\n                    if (overlayChar !== \".\") {\n                        this.tiles.get(MapLayer.DecorativeBG)[i][j] = entityLoader.createFromTemplate('art_backing', {components: {positionalobject: {x: i, y: j, z: 2}}});\n                    }\n\n                    if (overlayChar !== \" \" && overlayChar !== \".\") {\n                        if (overlayChar === \"_\") {\n                            overlayChar = \".\";\n                        }\n\n                        this.tiles.get(MapLayer.Decorative)[i][j] = entityLoader.createFromTemplate('art', {components: {characterobject: {x: i, y: j, z: 2.05, letter: overlayChar, color: overlayColors[overlayColorIndex]}}});\n                        overlayColorIndex ++;\n                    }\n                }\n            }\n        }\n\n        this.addPlayer(21, 3);\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('ant', {components: {positionalobject: {x: 27, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('dragon_red', {components: {positionalobject: {x: 18, y: 4, z: 1}}}));\n        engine.gameMap.actors.push(entityLoader.createFromTemplate('goblin', {components: {positionalobject: {x: 5, y: 2, z: 1}}}));\n\n        engine.gameMap.items.push(entityLoader.createFromTemplate('potion_health', {components: {positionalobject: {x: 3, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('^', {components: {positionalobject: {x: 6, y: 5, z: 1}}}));\n        engine.gameMap.items.push(entityLoader.createFromTemplate('tower_shield', {components: {positionalobject: {x: 28, y: 1, z: 1}}}));\n    }\n}","import './styles/style.css';\nimport sceneState from './js/SceneState.js';\nimport engine from \"./js/Engine\";\nimport {TWEEN} from \"three/examples/jsm/libs/tween.module.min\";\nimport details from \"./js/ui/Details\";\nimport MainMenuMap from \"./js/map/MainMenuMap\";\n\n(function () {\n    const init = function() {\n        engine.clearMaps();\n        engine.setMap(new MainMenuMap());\n        const playerPosition = engine.player.getComponent(\"positionalobject\");\n        engine.gameMap.revealFromPosition(playerPosition.x, playerPosition.y, 100, 0);\n        engine.needsMapUpdate = true;\n\n        sceneState.renderer.setAnimationLoop(animation);\n    }\n\n    const animation = function(time) {\n        sceneState.stats.begin();\n\n        engine.handleEvents();\n        if (engine.needsMapUpdate) {\n            updateRender();\n            engine.needsMapUpdate = false;\n        }\n\n        TWEEN.update();\n\n        sceneState.stats.end();\n    }\n\n    const updateRender = function() {\n        if (engine.player) {\n            const playerPosition = engine.player.getComponent(\"positionalobject\");\n            if (playerPosition) {\n                let playerVisibility = 5;\n                const tileAtPlayer = engine.gameMap.tiles.get(playerPosition.z)[playerPosition.x][playerPosition.y];\n                if (tileAtPlayer) {\n                    const modifier = tileAtPlayer.getComponent(\"visibilityModifier\");\n                    if (modifier) {\n                        playerVisibility = modifier.getVisibility(playerVisibility);\n                    }\n                }\n\n                const isFovNew = engine.fov.visibleObjects.length === 0;\n\n                engine.gameMap.updateFOV(playerPosition.x, playerPosition.y, playerPosition.z, playerVisibility);\n                engine.gameMap.draw(playerPosition.x, playerPosition.y, playerPosition.z);\n\n                if (isFovNew) {\n                    details.updatePlayerDetails();\n                }\n            }\n\n            sceneState.renderer.render(sceneState.scene, sceneState.camera);\n        }\n    }\n\n    init();\n}());"],"sourceRoot":""}